{"ast":null,"code":"import _regeneratorRuntime from \"/Users/wubenqi/nebula-chat/telegram-react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/wubenqi/nebula-chat/telegram-react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _toConsumableArray from \"/Users/wubenqi/nebula-chat/telegram-react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nvar _jsxFileName = \"/Users/wubenqi/nebula-chat/telegram-react/src/Utils/Message.js\";\n\n/*\n *  Copyright (c) 2018-present, Evgeny Nadymov\n *\n * This source code is licensed under the GPL v.3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\nimport React from 'react';\nimport emojiRegex from 'emoji-regex';\nimport MentionLink from '../Components/Additional/MentionLink';\nimport Poll from '../Components/Message/Media/Poll';\nimport SafeLink from '../Components/Additional/SafeLink';\nimport dateFormat from '../Utils/Date';\nimport { searchChat, setMediaViewerContent } from '../Actions/Client';\nimport { getChatTitle, isMeChat } from './Chat';\nimport { openUser } from './../Actions/Client';\nimport { getFitSize, getPhotoSize, getSize } from './Common';\nimport { download, saveOrDownload } from './File';\nimport { getAudioTitle } from './Media';\nimport { getDecodedUrl } from './Url';\nimport { getServiceMessageContent } from './ServiceMessage';\nimport { getUserFullName } from './User';\nimport { LOCATION_HEIGHT, LOCATION_SCALE, LOCATION_WIDTH, LOCATION_ZOOM, PHOTO_DISPLAY_SIZE, PHOTO_SIZE } from '../Constants';\nimport AppStore from '../Stores/ApplicationStore';\nimport ChatStore from '../Stores/ChatStore';\nimport FileStore from '../Stores/FileStore';\nimport MessageStore from '../Stores/MessageStore';\nimport UserStore from '../Stores/UserStore';\nimport TdLibController from '../Controllers/TdLibController';\nexport function isMetaBubble(chatId, messageId) {\n  var message = MessageStore.get(chatId, messageId);\n\n  if (!message) {\n    return false;\n  }\n\n  var content = message.content;\n\n  if (!content) {\n    return false;\n  }\n\n  var caption = content.caption;\n\n  if (caption && caption.text && caption.text.length > 0) {\n    return false;\n  }\n\n  switch (content['@type']) {\n    case 'messageAnimation':\n      {\n        return true;\n      }\n\n    case 'messageLocation':\n      {\n        return true;\n      }\n\n    case 'messagePhoto':\n      {\n        return true;\n      }\n\n    case 'messageSticker':\n      {\n        return true;\n      }\n\n    case 'messageVideo':\n      {\n        return true;\n      }\n\n    case 'messageVideoNote':\n      {\n        return true;\n      }\n  }\n\n  return false;\n}\nexport function isMessageUnread(chatId, messageId) {\n  var chat = ChatStore.get(chatId);\n\n  if (!chat) {\n    return false;\n  }\n\n  var last_read_inbox_message_id = chat.last_read_inbox_message_id,\n      last_read_outbox_message_id = chat.last_read_outbox_message_id;\n  var message = MessageStore.get(chatId, messageId);\n\n  if (!message) {\n    return false;\n  }\n\n  var id = message.id,\n      is_outgoing = message.is_outgoing;\n  var isMe = isMeChat(chatId);\n\n  if (is_outgoing && isMe) {\n    return false;\n  }\n\n  return is_outgoing ? id > last_read_outbox_message_id : id > last_read_inbox_message_id;\n}\n\nfunction getAuthor(message) {\n  var t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function (k) {\n    return k;\n  };\n  if (!message) return null;\n  var forward_info = message.forward_info;\n\n  if (forward_info) {\n    switch (forward_info['@type']) {\n      case 'messageForwardedFromUser':\n        {\n          if (forward_info.sender_user_id > 0) {\n            var user = UserStore.get(forward_info.sender_user_id);\n\n            if (user) {\n              return getUserFullName(forward_info.sender_user_id, null, t);\n            }\n          }\n\n          break;\n        }\n\n      case 'messageForwardedPost':\n        {\n          var chat = ChatStore.get(forward_info.chat_id);\n\n          if (chat) {\n            return chat.title;\n          }\n\n          break;\n        }\n    }\n  }\n\n  return getTitle(message, t);\n}\n\nfunction getTitle(message) {\n  var t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function (k) {\n    return k;\n  };\n  if (!message) return null;\n  var sender_user_id = message.sender_user_id,\n      chat_id = message.chat_id;\n\n  if (sender_user_id) {\n    var user = UserStore.get(sender_user_id);\n\n    if (user) {\n      return getUserFullName(sender_user_id, null, t);\n    }\n  }\n\n  if (chat_id) {\n    var chat = ChatStore.get(chat_id);\n\n    if (chat) {\n      return chat.title;\n    }\n  }\n\n  return null;\n}\n\nfunction substring(text, start, end) {\n  if (start < 0) start = 0;\n  if (start > text.length - 1) start = text.length - 1;\n  if (end < start) end = start;\n  if (end > text.length) end = text.length;\n  return text.substring(start, end);\n}\n\nfunction stopPropagation(event) {\n  event.stopPropagation();\n}\n\nfunction searchCurrentChat(event, text) {\n  event.stopPropagation();\n  event.preventDefault();\n  var chatId = AppStore.chatId;\n  searchChat(chatId, text);\n}\n\nfunction getFormattedText(formattedText) {\n  var t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function (k) {\n    return k;\n  };\n  if (formattedText['@type'] !== 'formattedText') return null;\n  var text = formattedText.text,\n      entities = formattedText.entities;\n  if (!text) return null;\n  if (!entities) return text;\n  var deleteLineBreakAfterPre = false;\n  var result = [];\n  var index = 0;\n\n  var _loop = function _loop(i) {\n    var entity = entities[i];\n    var offset = entity.offset,\n        length = entity.length,\n        type = entity.type; // skip nested entities\n\n    if (index > offset) {\n      return \"continue\";\n    }\n\n    var textBefore = substring(text, index, offset);\n    var textBeforeLength = textBefore.length;\n\n    if (textBefore) {\n      if (deleteLineBreakAfterPre && textBefore.length > 0 && textBefore[0] === '\\n') {\n        textBefore = textBefore.substr(1);\n        deleteLineBreakAfterPre = false;\n      }\n\n      if (textBefore) {\n        result.push(textBefore);\n      }\n    }\n\n    var entityKey = offset;\n    var entityText = substring(text, offset, offset + length);\n\n    if (deleteLineBreakAfterPre && entityText.length > 0 && entityText[0] === '\\n') {\n      entityText = entityText.substr(1);\n      deleteLineBreakAfterPre = false;\n    }\n\n    switch (type['@type']) {\n      case 'textEntityTypeBold':\n        {\n          result.push(React.createElement(\"strong\", {\n            key: entityKey,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 206\n            },\n            __self: this\n          }, entityText));\n          break;\n        }\n\n      case 'textEntityTypeBotCommand':\n        {\n          var command = entityText.length > 0 && entityText[0] === '/' ? substring(entityText, 1) : entityText;\n          result.push(React.createElement(\"a\", {\n            key: entityKey,\n            onClick: stopPropagation,\n            href: \"tg://bot_command?command=\".concat(command, \"&bot=\"),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 212\n            },\n            __self: this\n          }, entityText));\n          break;\n        }\n\n      case 'textEntityTypeCashtag':\n        {\n          result.push(React.createElement(\"a\", {\n            key: entityKey,\n            onClick: function onClick(event) {\n              return searchCurrentChat(event, entityText);\n            },\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 220\n            },\n            __self: this\n          }, entityText));\n          break;\n        }\n\n      case 'textEntityTypeCode':\n        {\n          result.push(React.createElement(\"code\", {\n            key: entityKey,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 227\n            },\n            __self: this\n          }, entityText));\n          break;\n        }\n\n      case 'textEntityTypeEmailAddress':\n        {\n          result.push(React.createElement(\"a\", {\n            key: entityKey,\n            href: \"mailto:\".concat(entityText),\n            onClick: stopPropagation,\n            target: \"_blank\",\n            rel: \"noopener noreferrer\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 232\n            },\n            __self: this\n          }, entityText));\n          break;\n        }\n\n      case 'textEntityTypeHashtag':\n        {\n          result.push(React.createElement(\"a\", {\n            key: entityKey,\n            onClick: function onClick(event) {\n              return searchCurrentChat(event, entityText);\n            },\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 245\n            },\n            __self: this\n          }, entityText));\n          break;\n        }\n\n      case 'textEntityTypeItalic':\n        {\n          result.push(React.createElement(\"em\", {\n            key: entityKey,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 252\n            },\n            __self: this\n          }, entityText));\n          break;\n        }\n\n      case 'textEntityTypeMentionName':\n        {\n          result.push(React.createElement(MentionLink, {\n            key: entityKey,\n            userId: type.user_id,\n            title: getUserFullName(type.user_id, null, t),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 257\n            },\n            __self: this\n          }, entityText));\n          break;\n        }\n\n      case 'textEntityTypeMention':\n        {\n          result.push(React.createElement(MentionLink, {\n            key: entityKey,\n            username: entityText,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 265\n            },\n            __self: this\n          }, entityText));\n          break;\n        }\n\n      case 'textEntityTypePhoneNumber':\n        {\n          result.push(React.createElement(\"a\", {\n            key: entityKey,\n            href: \"tel:\".concat(entityText),\n            onClick: stopPropagation,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 273\n            },\n            __self: this\n          }, entityText));\n          break;\n        }\n\n      case 'textEntityTypePre':\n        {\n          result.push(React.createElement(\"pre\", {\n            key: entityKey,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 280\n            },\n            __self: this\n          }, entityText));\n          deleteLineBreakAfterPre = true;\n          break;\n        }\n\n      case 'textEntityTypePreCode':\n        {\n          result.push(React.createElement(\"pre\", {\n            key: entityKey,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 286\n            },\n            __self: this\n          }, React.createElement(\"code\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 287\n            },\n            __self: this\n          }, entityText)));\n          deleteLineBreakAfterPre = true;\n          break;\n        }\n\n      case 'textEntityTypeTextUrl':\n        {\n          var url = type.url ? type.url : entityText;\n          result.push(React.createElement(SafeLink, {\n            key: entityKey,\n            url: url,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 297\n            },\n            __self: this\n          }, entityText));\n          break;\n        }\n\n      case 'textEntityTypeUrl':\n        {\n          result.push(React.createElement(SafeLink, {\n            key: entityKey,\n            url: entityText,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 305\n            },\n            __self: this\n          }, entityText));\n          break;\n        }\n\n      default:\n        result.push(entityText);\n        break;\n    }\n\n    index += textBeforeLength + entity.length;\n  };\n\n  for (var i = 0; i < entities.length; i++) {\n    var _ret = _loop(i);\n\n    if (_ret === \"continue\") continue;\n  }\n\n  if (index < text.length) {\n    var textAfter = text.substring(index);\n\n    if (deleteLineBreakAfterPre && textAfter.length > 0 && textAfter[0] === '\\n') {\n      textAfter = textAfter.substr(1);\n    }\n\n    if (textAfter) {\n      result.push(textAfter);\n    }\n  }\n\n  return result;\n}\n\nfunction getText(message, meta) {\n  var t = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : function (k) {\n    return k;\n  };\n  if (!message) return null;\n  var result = [];\n  var content = message.content;\n  if (!content) return [].concat(_toConsumableArray(result), [meta]);\n  var text = content.text,\n      caption = content.caption;\n\n  if (text && text['@type'] === 'formattedText' && text.text) {\n    result = getFormattedText(text, t);\n  } else if (caption && caption['@type'] === 'formattedText' && caption.text) {\n    var formattedText = getFormattedText(caption, t);\n\n    if (formattedText) {\n      result = result.concat(formattedText);\n    }\n  }\n\n  return result && result.length > 0 ? [].concat(_toConsumableArray(result), [meta]) : [];\n}\n\nfunction getWebPage(message) {\n  if (!message) return null;\n  if (!message.content) return null;\n  return message.content.web_page;\n}\n\nfunction getDate(date) {\n  if (!date) return null;\n  var d = new Date(date * 1000);\n  return dateFormat(d, 'H:MM'); //date.toDateString();\n}\n\nfunction getDateHint(date) {\n  if (!date) return null;\n  var d = new Date(date * 1000);\n  return dateFormat(d, 'H:MM:ss d.mm.yyyy'); //date.toDateString();\n}\n\nfunction isForwardOriginHidden(forwardInfo) {\n  if (!forwardInfo) return false;\n  var origin = forwardInfo.origin;\n  if (!origin) return false;\n\n  switch (origin['@type']) {\n    case 'messageForwardOriginUser':\n      {\n        return false;\n      }\n\n    case 'messageForwardOriginHiddenUser':\n      {\n        return true;\n      }\n\n    case 'messageForwardOriginChannel':\n      {\n        return false;\n      }\n  }\n\n  return false;\n}\n\nfunction getForwardTitle(forwardInfo) {\n  var t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function (key) {\n    return key;\n  };\n  if (!forwardInfo) return '';\n  var origin = forwardInfo.origin;\n  if (!origin) return '';\n\n  switch (origin['@type']) {\n    case 'messageForwardOriginUser':\n      {\n        var sender_user_id = origin.sender_user_id;\n        return getUserFullName(sender_user_id, null, t);\n      }\n\n    case 'messageForwardOriginHiddenUser':\n      {\n        var sender_name = origin.sender_name;\n        return sender_name;\n      }\n\n    case 'messageForwardOriginChannel':\n      {\n        var chat_id = origin.chat_id,\n            author_signature = origin.author_signature;\n        return getChatTitle(chat_id, false, t) + (author_signature ? \" (\".concat(author_signature, \")\") : '');\n      }\n  }\n\n  return '';\n}\n\nfunction getUnread(message) {\n  if (!message) return false;\n  if (!message.chat_id) return false;\n  if (!message.is_outgoing) return false;\n  var chat = ChatStore.get(message.chat_id);\n  if (!chat) return false;\n  return chat.last_read_outbox_message_id < message.id;\n}\n\nfunction getSenderUserId(message) {\n  if (!message) return null;\n  return message.sender_user_id;\n}\n\nfunction filterDuplicateMessages(result, history) {\n  if (result.messages.length === 0) return;\n  if (history.length === 0) return;\n  var map = history.reduce(function (accumulator, current) {\n    accumulator.set(current.id, current.id);\n    return accumulator;\n  }, new Map());\n  result.messages = result.messages.filter(function (x) {\n    return !map.has(x.id);\n  });\n}\n\nfunction filterMessages(messages) {\n  return messages.filter(function (x) {\n    return x.content['@type'] !== 'messageChatUpgradeTo';\n  });\n}\n\nfunction getContent(message) {\n  var t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function (key) {\n    return key;\n  };\n  if (!message) return null;\n  var content = message.content;\n  if (!content) return null;\n  var caption = '';\n\n  if (content.caption && content.caption.text) {\n    caption = \", \".concat(content.caption.text);\n  }\n\n  if (message.ttl > 0) {\n    return getServiceMessageContent(message);\n  }\n\n  switch (content['@type']) {\n    case 'messageAnimation':\n      {\n        return t('AttachGif') + caption;\n      }\n\n    case 'messageAudio':\n      {\n        return t('AttachMusic') + caption;\n      }\n\n    case 'messageBasicGroupChatCreate':\n      {\n        return getServiceMessageContent(message);\n      }\n\n    case 'messageCall':\n      {\n        return t('Call') + caption;\n      }\n\n    case 'messageChatAddMembers':\n      {\n        return getServiceMessageContent(message);\n      }\n\n    case 'messageChatChangePhoto':\n      {\n        return getServiceMessageContent(message);\n      }\n\n    case 'messageChatChangeTitle':\n      {\n        return getServiceMessageContent(message);\n      }\n\n    case 'messageChatDeleteMember':\n      {\n        return getServiceMessageContent(message);\n      }\n\n    case 'messageChatDeletePhoto':\n      {\n        return getServiceMessageContent(message);\n      }\n\n    case 'messageChatJoinByLink':\n      {\n        return getServiceMessageContent(message);\n      }\n\n    case 'messageChatSetTtl':\n      {\n        return getServiceMessageContent(message);\n      }\n\n    case 'messageChatUpgradeFrom':\n      {\n        return getServiceMessageContent(message);\n      }\n\n    case 'messageChatUpgradeTo':\n      {\n        return getServiceMessageContent(message);\n      }\n\n    case 'messageContact':\n      {\n        return t('AttachContact') + caption;\n      }\n\n    case 'messageContactRegistered':\n      {\n        return getServiceMessageContent(message);\n      }\n\n    case 'messageCustomServiceAction':\n      {\n        return getServiceMessageContent(message);\n      }\n\n    case 'messageDocument':\n      {\n        var _document = content.document;\n\n        if (_document && _document.file_name) {\n          return _document.file_name + caption;\n        }\n\n        return t('AttachDocument') + caption;\n      }\n\n    case 'messageExpiredPhoto':\n      {\n        return t('AttachPhoto') + caption;\n      }\n\n    case 'messageExpiredVideo':\n      {\n        return t('AttachVideo') + caption;\n      }\n\n    case 'messageGame':\n      {\n        return t('AttachGame') + caption;\n      }\n\n    case 'messageGameScore':\n      {\n        return getServiceMessageContent(message);\n      }\n\n    case 'messageInvoice':\n      {\n        return getServiceMessageContent(message);\n      }\n\n    case 'messageLocation':\n      {\n        return t('AttachLocation') + caption;\n      }\n\n    case 'messagePassportDataReceived':\n      {\n        return getServiceMessageContent(message);\n      }\n\n    case 'messagePassportDataSent':\n      {\n        return getServiceMessageContent(message);\n      }\n\n    case 'messagePaymentSuccessful':\n      {\n        return getServiceMessageContent(message);\n      }\n\n    case 'messagePaymentSuccessfulBot':\n      {\n        return getServiceMessageContent(message);\n      }\n\n    case 'messagePhoto':\n      {\n        return t('AttachPhoto') + caption;\n      }\n\n    case 'messagePoll':\n      {\n        var poll = content.poll;\n        return '📊 ' + (poll.question || t('Poll')) + caption;\n      }\n\n    case 'messagePinMessage':\n      {\n        return getServiceMessageContent(message);\n      }\n\n    case 'messageScreenshotTaken':\n      {\n        return getServiceMessageContent(message);\n      }\n\n    case 'messageSticker':\n      {\n        var sticker = content.sticker;\n        var emoji = '';\n\n        if (sticker && sticker.emoji) {\n          emoji = sticker.emoji;\n        }\n\n        return t('AttachSticker') + (emoji ? \" \".concat(emoji) : '') + caption;\n      }\n\n    case 'messageSupergroupChatCreate':\n      {\n        return getServiceMessageContent(message);\n      }\n\n    case 'messageText':\n      {\n        return content.text.text + caption;\n      }\n\n    case 'messageUnsupported':\n      {\n        return getServiceMessageContent(message);\n      }\n\n    case 'messageVenue':\n      {\n        return t('AttachLocation') + caption;\n      }\n\n    case 'messageVideo':\n      {\n        return t('AttachVideo') + caption;\n      }\n\n    case 'messageVideoNote':\n      {\n        return t('AttachRound') + caption;\n      }\n\n    case 'messageVoiceNote':\n      {\n        return t('AttachAudio') + caption;\n      }\n\n    case 'messageWebsiteConnected':\n      {\n        return getServiceMessageContent(message);\n      }\n\n    default:\n      {\n        return t('UnsupportedAttachment');\n      }\n  }\n}\n\nfunction isMediaContent(content) {\n  if (!content) return false;\n  return content['@type'] === 'messagePhoto';\n}\n\nfunction getLocationId(location) {\n  var width = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : LOCATION_WIDTH;\n  var height = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : LOCATION_HEIGHT;\n  var zoom = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : LOCATION_ZOOM;\n  var scale = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : LOCATION_SCALE;\n  if (!location) return null;\n  var longitude = location.longitude,\n      latitude = location.latitude;\n  return \"loc=\".concat(latitude, \",\").concat(longitude, \"&size=\").concat(width, \",\").concat(height, \"&scale=\").concat(scale, \"&zoom=\").concat(zoom);\n}\n\nfunction isVideoMessage(chatId, messageId) {\n  var message = MessageStore.get(chatId, messageId);\n  if (!message) return false;\n  var content = message.content;\n  if (!content) return false;\n\n  switch (content['@type']) {\n    case 'messageVideo':\n      {\n        return true;\n      }\n\n    case 'messageText':\n      {\n        var web_page = content.web_page;\n        return Boolean(web_page.video);\n      }\n\n    default:\n      {\n        return false;\n      }\n  }\n}\n\nfunction isLottieMessage(chatId, messageId) {\n  var message = MessageStore.get(chatId, messageId);\n  if (!message) return false;\n  var content = message.content;\n  if (!content) return false;\n\n  switch (content['@type']) {\n    case 'messageDocument':\n      {\n        var _document2 = content.document;\n        if (!_document2) return false;\n        var file_name = _document2.file_name;\n        return file_name && file_name.toLowerCase().endsWith('.json');\n      }\n\n    case 'messageText':\n      {\n        var web_page = content.web_page;\n        if (!web_page) return false;\n        var _document3 = web_page.document;\n        if (!_document3) return false;\n        var _file_name = _document3.file_name;\n        return _file_name && _file_name.toLowerCase().endsWith('.json');\n      }\n\n    default:\n      {\n        return false;\n      }\n  }\n}\n\nfunction isAnimationMessage(chatId, messageId) {\n  var message = MessageStore.get(chatId, messageId);\n  if (!message) return false;\n  var content = message.content;\n  if (!content) return false;\n\n  switch (content['@type']) {\n    case 'messageAnimation':\n      {\n        return true;\n      }\n\n    case 'messageText':\n      {\n        var web_page = content.web_page;\n        return Boolean(web_page.animation);\n      }\n\n    default:\n      {\n        return false;\n      }\n  }\n}\n\nfunction isContentOpened(chatId, messageId) {\n  var message = MessageStore.get(chatId, messageId);\n  if (!message) return true;\n  var content = message.content;\n  if (!content) return true;\n\n  switch (content['@type']) {\n    case 'messageVoiceNote':\n      {\n        return content.is_listened;\n      }\n\n    case 'messageVideoNote':\n      {\n        return content.is_viewed;\n      }\n\n    default:\n      {\n        return true;\n      }\n  }\n}\n\nfunction getMediaTitle(message) {\n  var t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function (k) {\n    return k;\n  };\n  if (!message) return null;\n  var content = message.content;\n  if (!content) return null;\n\n  switch (content['@type']) {\n    case 'messageAudio':\n      {\n        var audio = content.audio;\n\n        if (audio) {\n          return getAudioTitle(audio);\n        }\n\n        break;\n      }\n\n    case 'messageText':\n      {\n        var web_page = content.web_page;\n\n        if (web_page) {\n          var _audio = web_page.audio;\n\n          if (_audio) {\n            return getAudioTitle(_audio);\n          }\n\n          break;\n        }\n      }\n  }\n\n  return getAuthor(message, t);\n}\n\nfunction hasAudio(chatId, messageId) {\n  var message = MessageStore.get(chatId, messageId);\n  if (!message) return false;\n  var content = message.content;\n  if (!content) return false;\n\n  switch (content['@type']) {\n    case 'messageAudio':\n      {\n        var audio = content.audio;\n\n        if (audio) {\n          return true;\n        }\n\n        break;\n      }\n\n    case 'messageText':\n      {\n        var web_page = content.web_page;\n\n        if (web_page) {\n          var _audio2 = web_page.audio;\n\n          if (_audio2) {\n            return true;\n          }\n        }\n\n        break;\n      }\n  }\n\n  return false;\n}\n\nfunction hasVideoNote(chatId, messageId) {\n  var message = MessageStore.get(chatId, messageId);\n  if (!message) return false;\n  var content = message.content;\n  if (!content) return false;\n\n  switch (content['@type']) {\n    case 'messageVideoNote':\n      {\n        var video_note = content.video_note;\n\n        if (video_note) {\n          return true;\n        }\n\n        break;\n      }\n\n    case 'messageText':\n      {\n        var web_page = content.web_page;\n\n        if (web_page) {\n          var _video_note = web_page.video_note;\n\n          if (_video_note) {\n            return true;\n          }\n        }\n\n        break;\n      }\n  }\n\n  return false;\n}\n\nfunction getSearchMessagesFilter(chatId, messageId) {\n  var message = MessageStore.get(chatId, messageId);\n  if (!message) return null;\n  var content = message.content;\n  if (!content) return null;\n\n  switch (content['@type']) {\n    case 'messageAudio':\n      {\n        var audio = content.audio;\n\n        if (audio) {\n          return {\n            '@type': 'searchMessagesFilterAudio'\n          };\n        }\n\n        break;\n      }\n\n    case 'messageVoiceNote':\n      {\n        var voice_note = content.voice_note;\n\n        if (voice_note) {\n          return {\n            '@type': 'searchMessagesFilterVoiceNote'\n          };\n        }\n\n        break;\n      }\n\n    case 'messageVideoNote':\n      {\n        var video_note = content.video_note;\n\n        if (video_note) {\n          return null;\n          return {\n            '@type': 'searchMessagesFilterVideoNote'\n          };\n        }\n\n        break;\n      }\n\n    case 'messageText':\n      {\n        var web_page = content.web_page;\n\n        if (web_page) {\n          var _audio3 = web_page.audio,\n              _voice_note = web_page.voice_note,\n              _video_note2 = web_page.video_note;\n\n          if (_audio3) {\n            return null;\n            return {\n              '@type': 'searchMessagesFilterAudio'\n            };\n          }\n\n          if (_voice_note) {\n            return null;\n            return {\n              '@type': 'searchMessagesFilterVoiceNote'\n            };\n          }\n\n          if (_video_note2) {\n            return null;\n            return {\n              '@type': 'searchMessagesFilterVideoNote'\n            };\n          }\n\n          break;\n        }\n      }\n  }\n\n  return null;\n}\n\nfunction openAnimation(animation, message, fileCancel) {\n  if (!animation) return;\n  if (!message) return;\n  var chat_id = message.chat_id,\n      id = message.id;\n  var file = animation.animation;\n  if (!file) return;\n  file = FileStore.get(file.id) || file;\n\n  if (fileCancel && file.local.is_downloading_active) {\n    FileStore.cancelGetRemoteFile(file.id, message);\n    return;\n  } else if (fileCancel && file.remote.is_uploading_active) {\n    FileStore.cancelUploadFile(file.id, message);\n    return;\n  } else {// download file at loadMediaViewerContent instead\n    // download(file, message, FileStore.updateAnimationBlob(chat_id, id, file.id));\n  }\n\n  TdLibController.clientUpdate({\n    '@type': 'clientUpdateActiveAnimation',\n    chatId: chat_id,\n    messageId: id\n  });\n  TdLibController.send({\n    '@type': 'openMessageContent',\n    chat_id: chat_id,\n    message_id: id\n  });\n  setMediaViewerContent({\n    chatId: chat_id,\n    messageId: id\n  });\n}\n\nfunction openAudio(audio, message, fileCancel) {\n  if (!audio) return;\n  if (!message) return;\n  var chat_id = message.chat_id,\n      id = message.id;\n  var file = audio.audio;\n  if (!file) return;\n  file = FileStore.get(file.id) || file;\n\n  if (fileCancel && file.local.is_downloading_active) {\n    FileStore.cancelGetRemoteFile(file.id, message);\n    return;\n  } else if (fileCancel && file.remote.is_uploading_active) {\n    FileStore.cancelUploadFile(file.id, message);\n    return;\n  } else {\n    download(file, message, function () {\n      return FileStore.updateAudioBlob(chat_id, id, file.id);\n    });\n  }\n\n  TdLibController.send({\n    '@type': 'openMessageContent',\n    chat_id: chat_id,\n    message_id: id\n  });\n  TdLibController.clientUpdate({\n    '@type': 'clientUpdateMediaActive',\n    chatId: chat_id,\n    messageId: id\n  });\n}\n\nfunction openChatPhoto(photo, message, fileCancel) {\n  if (!photo) return;\n  if (!message) return;\n  var chat_id = message.chat_id,\n      id = message.id;\n  var photoSize = getPhotoSize(photo.sizes);\n  if (!photoSize) return;\n  var file = photoSize.photo;\n  if (!file) return;\n  file = FileStore.get(file.id) || file;\n\n  if (fileCancel && file.local.is_downloading_active) {\n    FileStore.cancelGetRemoteFile(file.id, message);\n    return;\n  } else if (fileCancel && file.remote.is_uploading_active) {\n    FileStore.cancelUploadFile(file.id, message);\n    return;\n  }\n\n  download(file, message, function () {\n    return FileStore.updatePhotoBlob(chat_id, id, file.id);\n  });\n  TdLibController.send({\n    '@type': 'openMessageContent',\n    chat_id: chat_id,\n    message_id: id\n  });\n  setMediaViewerContent({\n    chatId: chat_id,\n    messageId: id\n  });\n}\n\nfunction openContact(contact, message, fileCancel) {\n  if (!contact) return;\n  if (!message) return;\n  var chat_id = message.chat_id,\n      id = message.id;\n  TdLibController.send({\n    '@type': 'openMessageContent',\n    chat_id: chat_id,\n    message_id: id\n  });\n  openUser(contact.user_id, true);\n}\n\nfunction openDocument(document, message, fileCancel) {\n  if (!document) return;\n  if (!message) return;\n  var chat_id = message.chat_id,\n      id = message.id;\n  var file = document.document;\n  if (!file) return;\n  file = FileStore.get(file.id) || file;\n\n  if (fileCancel && file.local.is_downloading_active) {\n    FileStore.cancelGetRemoteFile(file.id, message);\n    return;\n  } else if (fileCancel && file.remote.is_uploading_active) {\n    FileStore.cancelUploadFile(file.id, message);\n    return;\n  }\n\n  TdLibController.send({\n    '@type': 'openMessageContent',\n    chat_id: chat_id,\n    message_id: id\n  });\n\n  if (isLottieMessage(chat_id, id)) {\n    TdLibController.send({\n      '@type': 'openMessageContent',\n      chat_id: chat_id,\n      message_id: id\n    });\n    setMediaViewerContent({\n      chatId: chat_id,\n      messageId: id\n    });\n  } else {\n    saveOrDownload(file, document.file_name, message);\n  }\n}\n\nfunction openGame(game, message, fileCancel) {\n  if (!game) return;\n  if (!message) return;\n  var chat_id = message.chat_id,\n      id = message.id;\n  var animation = game.animation;\n\n  if (animation) {\n    var file = animation.animation;\n    if (!file) return;\n    file = FileStore.get(file.id) || file;\n\n    if (fileCancel && file.local.is_downloading_active) {\n      FileStore.cancelGetRemoteFile(file.id, message);\n      return;\n    } else if (fileCancel && file.remote.is_uploading_active) {\n      FileStore.cancelUploadFile(file.id, message);\n      return;\n    }\n\n    download(file, message, function () {\n      return FileStore.updateAnimationBlob(chat_id, id, file.id);\n    });\n  }\n\n  TdLibController.send({\n    '@type': 'openMessageContent',\n    chat_id: chat_id,\n    message_id: id\n  });\n  TdLibController.clientUpdate({\n    '@type': 'clientUpdateActiveAnimation',\n    chatId: chat_id,\n    messageId: id\n  });\n}\n\nfunction openPhoto(photo, message, fileCancel) {\n  if (!photo) return;\n  if (!message) return;\n  var chat_id = message.chat_id,\n      id = message.id;\n  var photoSize = getPhotoSize(photo.sizes);\n  if (!photoSize) return;\n  var file = photoSize.photo;\n  if (!file) return;\n  file = FileStore.get(file.id) || file;\n\n  if (fileCancel && file.local.is_downloading_active) {\n    FileStore.cancelGetRemoteFile(file.id, message);\n    return;\n  } else if (fileCancel && file.remote.is_uploading_active) {\n    FileStore.cancelUploadFile(file.id, message);\n    return;\n  }\n\n  download(file, message, function () {\n    return FileStore.updatePhotoBlob(chat_id, id, file.id);\n  });\n  TdLibController.send({\n    '@type': 'openMessageContent',\n    chat_id: chat_id,\n    message_id: id\n  });\n  setMediaViewerContent({\n    chatId: chat_id,\n    messageId: id\n  });\n}\n\nfunction openSticker(_x, _x2, _x3) {\n  return _openSticker.apply(this, arguments);\n}\n\nfunction _openSticker() {\n  _openSticker = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee(sticker, message, fileCancel) {\n    var chat_id, id, set_id, stickerSet;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            if (sticker) {\n              _context.next = 2;\n              break;\n            }\n\n            return _context.abrupt(\"return\");\n\n          case 2:\n            if (message) {\n              _context.next = 4;\n              break;\n            }\n\n            return _context.abrupt(\"return\");\n\n          case 4:\n            chat_id = message.chat_id, id = message.id;\n            TdLibController.send({\n              '@type': 'openMessageContent',\n              chat_id: chat_id,\n              message_id: id\n            });\n            set_id = sticker.set_id;\n\n            if (set_id) {\n              _context.next = 9;\n              break;\n            }\n\n            return _context.abrupt(\"return\");\n\n          case 9:\n            _context.next = 11;\n            return TdLibController.send({\n              '@type': 'getStickerSet',\n              set_id: set_id\n            });\n\n          case 11:\n            stickerSet = _context.sent;\n\n            if (stickerSet) {\n              _context.next = 14;\n              break;\n            }\n\n            return _context.abrupt(\"return\");\n\n          case 14:\n            TdLibController.clientUpdate({\n              '@type': 'clientUpdateStickerSet',\n              stickerSet: stickerSet\n            });\n\n          case 15:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n  return _openSticker.apply(this, arguments);\n}\n\nfunction openVideo(video, message, fileCancel) {\n  if (!video) return;\n  if (!message) return;\n  var chat_id = message.chat_id,\n      id = message.id;\n  var file = video.video;\n  if (!file) return;\n  file = FileStore.get(file.id) || file;\n\n  if (fileCancel && file.local.is_downloading_active) {\n    FileStore.cancelGetRemoteFile(file.id, message);\n    return;\n  } else if (fileCancel && file.remote.is_uploading_active) {\n    FileStore.cancelUploadFile(file.id, message);\n    return;\n  }\n\n  TdLibController.send({\n    '@type': 'openMessageContent',\n    chat_id: chat_id,\n    message_id: id\n  });\n  setMediaViewerContent({\n    chatId: chat_id,\n    messageId: id\n  });\n}\n\nfunction openVideoNote(videoNote, message, fileCancel) {\n  if (!videoNote) return;\n  if (!message) return;\n  var chat_id = message.chat_id,\n      id = message.id;\n  var file = videoNote.video;\n  if (!file) return;\n  file = FileStore.get(file.id) || file;\n\n  if (fileCancel && file.local.is_downloading_active) {\n    FileStore.cancelGetRemoteFile(file.id, message);\n    return;\n  } else if (fileCancel && file.remote.is_uploading_active) {\n    FileStore.cancelUploadFile(file.id, message);\n    return;\n  }\n\n  download(file, message, function () {\n    return FileStore.updateVideoNoteBlob(chat_id, id, file.id);\n  });\n  TdLibController.send({\n    '@type': 'openMessageContent',\n    chat_id: chat_id,\n    message_id: id\n  });\n  TdLibController.clientUpdate({\n    '@type': 'clientUpdateMediaActive',\n    chatId: chat_id,\n    messageId: id\n  });\n}\n\nfunction openVoiceNote(voiceNote, message, fileCancel) {\n  if (!voiceNote) return;\n  if (!message) return;\n  var chat_id = message.chat_id,\n      id = message.id;\n  var file = voiceNote.voice;\n  if (!file) return;\n  file = FileStore.get(file.id) || file;\n\n  if (fileCancel && file.local.is_downloading_active) {\n    FileStore.cancelGetRemoteFile(file.id, message);\n    return;\n  } else if (fileCancel && file.remote.is_uploading_active) {\n    FileStore.cancelUploadFile(file.id, message);\n    return;\n  } else {\n    download(file, message, function () {\n      return FileStore.updateVoiceNoteBlob(chat_id, id, file.id);\n    });\n  }\n\n  TdLibController.send({\n    '@type': 'openMessageContent',\n    chat_id: chat_id,\n    message_id: id\n  });\n  TdLibController.clientUpdate({\n    '@type': 'clientUpdateMediaActive',\n    chatId: chat_id,\n    messageId: id\n  });\n}\n\nfunction openMedia(chatId, messageId) {\n  var fileCancel = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n  var message = MessageStore.get(chatId, messageId);\n  if (!message) return;\n  var content = message.content;\n  if (!content) return null;\n\n  switch (content['@type']) {\n    case 'messageAnimation':\n      {\n        var animation = content.animation;\n\n        if (animation) {\n          openAnimation(animation, message, fileCancel);\n        }\n\n        break;\n      }\n\n    case 'messageAudio':\n      {\n        var audio = content.audio;\n\n        if (audio) {\n          // openDocument(audio, message, fileCancel);\n          openAudio(audio, message, fileCancel);\n        }\n\n        break;\n      }\n\n    case 'messageChatChangePhoto':\n      {\n        var photo = content.photo;\n\n        if (photo) {\n          openChatPhoto(photo, message, fileCancel);\n        }\n\n        break;\n      }\n\n    case 'messageContact':\n      {\n        var contact = content.contact;\n\n        if (contact) {\n          openContact(contact, message, fileCancel);\n        }\n\n        break;\n      }\n\n    case 'messageDocument':\n      {\n        var _document4 = content.document;\n\n        if (_document4) {\n          openDocument(_document4, message, fileCancel);\n        }\n\n        break;\n      }\n\n    case 'messageGame':\n      {\n        var game = content.game;\n\n        if (game) {\n          openGame(game, message, fileCancel);\n        }\n\n        break;\n      }\n\n    case 'messagePhoto':\n      {\n        var _photo = content.photo;\n\n        if (_photo) {\n          openPhoto(_photo, message, fileCancel);\n        }\n\n        break;\n      }\n\n    case 'messageSticker':\n      {\n        var sticker = content.sticker;\n\n        if (sticker) {\n          openSticker(sticker, message, fileCancel);\n        }\n\n        break;\n      }\n\n    case 'messageText':\n      {\n        var web_page = content.web_page;\n\n        if (web_page) {\n          var _animation = web_page.animation,\n              _audio4 = web_page.audio,\n              _document5 = web_page.document,\n              _photo2 = web_page.photo,\n              _sticker = web_page.sticker,\n              video = web_page.video,\n              video_note = web_page.video_note,\n              voice_note = web_page.voice_note;\n\n          if (_animation) {\n            openAnimation(_animation, message, fileCancel);\n          }\n\n          if (_audio4) {\n            openAudio(_audio4, message, fileCancel);\n          }\n\n          if (_document5) {\n            openDocument(_document5, message, fileCancel);\n          }\n\n          if (_sticker) {\n            openSticker(_sticker, message, fileCancel);\n          }\n\n          if (video) {\n            openVideo(video, message, fileCancel);\n          }\n\n          if (video_note) {\n            openVideoNote(video_note, message, fileCancel);\n          }\n\n          if (voice_note) {\n            openVoiceNote(voice_note, message, fileCancel);\n          }\n\n          if (_photo2) {\n            openPhoto(_photo2, message, fileCancel);\n          }\n        }\n\n        break;\n      }\n\n    case 'messageVideo':\n      {\n        var _video = content.video;\n\n        if (_video) {\n          openVideo(_video, message, fileCancel);\n        }\n\n        break;\n      }\n\n    case 'messageVideoNote':\n      {\n        var _video_note3 = content.video_note;\n\n        if (_video_note3) {\n          openVideoNote(_video_note3, message, fileCancel);\n        }\n\n        break;\n      }\n\n    case 'messageVoiceNote':\n      {\n        var _voice_note2 = content.voice_note;\n\n        if (_voice_note2) {\n          openVoiceNote(_voice_note2, message, fileCancel);\n        }\n\n        break;\n      }\n  }\n}\n\nfunction isDeletedMessage(message) {\n  return message && message['@type'] === 'deletedMessage';\n}\n\nexport function getReplyMinithumbnail(chatId, messageId) {\n  var message = MessageStore.get(chatId, messageId);\n  if (!message) return;\n  var content = message.content;\n  if (!content) return null;\n\n  switch (content['@type']) {\n    case 'messageAnimation':\n      {\n        var animation = content.animation;\n        if (!animation) return null;\n        var minithumbnail = animation.minithumbnail;\n        return minithumbnail || null;\n      }\n\n    case 'messageAudio':\n      {\n        return null;\n      }\n\n    case 'messageChatChangePhoto':\n      {\n        var photo = content.photo;\n        if (!photo) return null;\n        return photo.minithumbnail || null;\n      }\n\n    case 'messageDocument':\n      {\n        var _document6 = content.document;\n        if (!_document6) return null;\n        var _minithumbnail = _document6.minithumbnail;\n        return _minithumbnail || null;\n      }\n\n    case 'messageGame':\n      {\n        var game = content.game;\n        if (!game) return null;\n        var _animation2 = game.animation,\n            _photo3 = game.photo;\n\n        if (_animation2) {\n          var _minithumbnail2 = _animation2.minithumbnail;\n\n          if (_minithumbnail2) {\n            return _minithumbnail2;\n          }\n        }\n\n        if (_photo3) {\n          return _photo3.minithumbnail || null;\n        }\n\n        return null;\n      }\n\n    case 'messagePhoto':\n      {\n        var _photo4 = content.photo;\n        if (!_photo4) return null;\n        return _photo4.minithumbnail || null;\n      }\n\n    case 'messageSticker':\n      {\n        return null;\n      }\n\n    case 'messageText':\n      {\n        var web_page = content.web_page;\n\n        if (web_page) {\n          var _animation3 = web_page.animation,\n              audio = web_page.audio,\n              _document7 = web_page.document,\n              _photo5 = web_page.photo,\n              sticker = web_page.sticker,\n              video = web_page.video,\n              video_note = web_page.video_note;\n\n          if (_photo5) {\n            return _photo5.minithumbnail || null;\n          }\n\n          if (_animation3) {\n            var _minithumbnail3 = _animation3.minithumbnail;\n            return _minithumbnail3 || null;\n          }\n\n          if (audio) {\n            return null;\n          }\n\n          if (_document7) {\n            var _minithumbnail4 = _document7.minithumbnail;\n            return _minithumbnail4 || null;\n          }\n\n          if (sticker) {\n            return null;\n          }\n\n          if (video) {\n            var _minithumbnail5 = video.minithumbnail;\n            return _minithumbnail5 || null;\n          }\n\n          if (video_note) {\n            var _minithumbnail6 = video_note.minithumbnail;\n            return _minithumbnail6 || null;\n          }\n        }\n\n        break;\n      }\n\n    case 'messageVideo':\n      {\n        var _video2 = content.video;\n        if (!_video2) return null;\n        var _minithumbnail7 = _video2.minithumbnail;\n        return _minithumbnail7 || null;\n      }\n\n    case 'messageVideoNote':\n      {\n        var _video_note4 = content.video_note;\n        if (!_video_note4) return null;\n        var _minithumbnail8 = _video_note4.minithumbnail;\n        return _minithumbnail8 || null;\n      }\n  }\n\n  return null;\n}\n\nfunction getReplyPhotoSize(chatId, messageId) {\n  var message = MessageStore.get(chatId, messageId);\n  if (!message) return;\n  var content = message.content;\n  if (!content) return null;\n\n  switch (content['@type']) {\n    case 'messageAnimation':\n      {\n        var animation = content.animation;\n        if (!animation) return null;\n        var thumbnail = animation.thumbnail;\n        return thumbnail || null;\n      }\n\n    case 'messageAudio':\n      {\n        var audio = content.audio;\n        if (!audio) return null;\n        var album_cover_thumbnail = audio.album_cover_thumbnail;\n        return album_cover_thumbnail || null;\n      }\n\n    case 'messageChatChangePhoto':\n      {\n        var photo = content.photo;\n        if (!photo) return null;\n        return getPhotoSize(photo.sizes);\n      }\n\n    case 'messageDocument':\n      {\n        var _document8 = content.document;\n        if (!_document8) return null;\n        var _thumbnail = _document8.thumbnail;\n        return _thumbnail || null;\n      }\n\n    case 'messageGame':\n      {\n        var game = content.game;\n        if (!game) return null;\n        var _animation4 = game.animation,\n            _photo6 = game.photo;\n\n        if (_animation4) {\n          var _thumbnail2 = _animation4.thumbnail;\n\n          if (_thumbnail2) {\n            return _thumbnail2;\n          }\n        }\n\n        if (_photo6) {\n          return getPhotoSize(_photo6.sizes);\n        }\n\n        return null;\n      }\n\n    case 'messagePhoto':\n      {\n        var _photo7 = content.photo;\n        if (!_photo7) return null;\n        return getPhotoSize(_photo7.sizes);\n      }\n\n    case 'messageSticker':\n      {\n        var sticker = content.sticker;\n        if (!sticker) return null;\n        var _thumbnail3 = sticker.thumbnail;\n        return _thumbnail3 || null;\n      }\n\n    case 'messageText':\n      {\n        var web_page = content.web_page;\n\n        if (web_page) {\n          var _animation5 = web_page.animation,\n              _audio5 = web_page.audio,\n              _document9 = web_page.document,\n              _photo8 = web_page.photo,\n              _sticker2 = web_page.sticker,\n              video = web_page.video,\n              video_note = web_page.video_note;\n\n          if (_photo8) {\n            return getPhotoSize(_photo8.sizes);\n          }\n\n          if (_animation5) {\n            var _thumbnail4 = _animation5.thumbnail;\n            return _thumbnail4 || null;\n          }\n\n          if (_audio5) {\n            var _album_cover_thumbnail = _audio5.album_cover_thumbnail;\n            return _album_cover_thumbnail || null;\n          }\n\n          if (_document9) {\n            var _thumbnail5 = _document9.thumbnail;\n            return _thumbnail5 || null;\n          }\n\n          if (_sticker2) {\n            var _thumbnail6 = _sticker2.thumbnail;\n            return _thumbnail6 || null;\n          }\n\n          if (video) {\n            var _thumbnail7 = video.thumbnail;\n            return _thumbnail7 || null;\n          }\n\n          if (video_note) {\n            var _thumbnail8 = video_note.thumbnail;\n            return _thumbnail8 || null;\n          }\n        }\n\n        break;\n      }\n\n    case 'messageVideo':\n      {\n        var _video3 = content.video;\n        if (!_video3) return null;\n        var _thumbnail9 = _video3.thumbnail;\n        return _thumbnail9 || null;\n      }\n\n    case 'messageVideoNote':\n      {\n        var _video_note5 = content.video_note;\n        if (!_video_note5) return null;\n        var _thumbnail10 = _video_note5.thumbnail;\n        return _thumbnail10 || null;\n      }\n  }\n\n  return null;\n}\n\nfunction getEmojiMatches(chatId, messageId) {\n  var message = MessageStore.get(chatId, messageId);\n  if (!message) return 0;\n  var content = message.content;\n  if (!content) return 0;\n  if (content['@type'] !== 'messageText') return 0;\n  var textContent = content.text;\n  if (!textContent) return;\n  if (textContent['@type'] !== 'formattedText') return 0;\n  var text = textContent.text,\n      entities = textContent.entities;\n  if (!text) return 0;\n  if (entities && entities.length > 0) return 0;\n  var lastIndex = 0;\n  var emojiMatches = 0;\n  var m;\n  var re = emojiRegex();\n\n  do {\n    m = re.exec(text);\n\n    if (m) {\n      emojiMatches += 1; // none-emoji symbol between prev and current emojis or before first\n\n      if (lastIndex !== m.index) {\n        emojiMatches = 0;\n        break;\n      } // more than 3 emojis in a row\n\n\n      if (emojiMatches > 3) {\n        emojiMatches = 0;\n        break;\n      }\n\n      lastIndex = re.lastIndex;\n    } // none-emoji symbol at the end\n\n\n    if (!m && lastIndex !== text.length) {\n      emojiMatches = 0;\n      break;\n    }\n  } while (m);\n\n  return emojiMatches;\n}\n\nfunction messageComparatorDesc(left, right) {\n  return left.id - right.id;\n}\n\nfunction checkInclusion(index, entities) {\n  if (!entities) return false;\n  if (!entities.length) return false;\n\n  for (var i = 0; i < entities.length; i++) {\n    if (index >= entities[i].offset && index < entities[i].offset + entities[i].length) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\nfunction checkIntersection(startIndex, endIndex, entities) {\n  if (!entities) return false;\n  if (!entities.length) return false;\n\n  for (var i = 0; i < entities.length; i++) {\n    if (startIndex <= entities[i].offset && entities[i].offset + entities[i].length - 1 <= endIndex) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\nfunction checkEntity(startIndex, endIndex, entities) {\n  return !checkInclusion(startIndex, entities) && !checkInclusion(endIndex, entities) && !checkIntersection(startIndex, endIndex, entities);\n}\n\nfunction removeOffsetAfter(start, countToRemove, entities) {\n  if (!entities) return;\n  if (!entities.length) return;\n  entities.forEach(function (e) {\n    if (e.offset > start) {\n      e.offset -= countToRemove;\n    }\n  });\n}\n\nfunction addOffsetAfter(start, countToAdd, entities) {\n  if (!entities) return;\n  if (!entities.length) return;\n  entities.forEach(function (e) {\n    if (e.offset > start) {\n      e.offset += countToAdd;\n    }\n  });\n}\n\nfunction removeEntities(startIndex, endIndex, entities) {\n  if (!entities) return;\n  if (!entities.length) return;\n\n  for (var i = 0; i < entities.length; i++) {\n    var entity = entities[i];\n    var entityStart = entity.offset;\n    var entityEnd = entity.offset + entity.length - 1;\n\n    if (startIndex <= entityStart && entityStart <= endIndex || startIndex <= entityEnd && entityEnd <= endIndex || entityStart < startIndex && endIndex > entityEnd) {\n      entities.splice(i--, 1);\n    }\n  }\n}\n\nfunction addTextNode(offset, length, text, nodes) {\n  var node = document.createTextNode(text.substr(offset, length));\n  nodes.push(node);\n}\n\nexport function getNodes(text, entities) {\n  var t = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : function (k) {\n    return k;\n  };\n  if (!text) return [];\n  entities = (entities || []).sort(function (a, b) {\n    if (a.offset - b.offset !== 0) {\n      return a.offset - b.offset;\n    }\n\n    return b.length - a.length;\n  });\n  var nodes = [];\n  var offset = 0;\n  var prevEntity = null;\n  entities.forEach(function (x) {\n    if (x.offset - offset > 0) {\n      addTextNode(offset, x.offset - offset, text, nodes);\n      offset = x.offset;\n    }\n\n    if (!(prevEntity && checkInclusion(x.offset, [prevEntity]))) {\n      switch (x.type['@type']) {\n        case 'textEntityTypeBold':\n          {\n            var node = document.createElement('b');\n            node.innerText = text.substr(x.offset, x.length);\n            nodes.push(node);\n            break;\n          }\n\n        case 'textEntityTypeBotCommand':\n          {\n            addTextNode(x.offset, x.length, text, nodes);\n            break;\n          }\n\n        case 'textEntityTypeCashtag':\n          {\n            addTextNode(x.offset, x.length, text, nodes);\n            break;\n          }\n\n        case 'textEntityTypeCode':\n          {\n            var _node = document.createTextNode('`' + text.substr(x.offset, x.length) + '`');\n\n            nodes.push(_node);\n            break;\n          }\n\n        case 'textEntityTypeEmailAddress':\n          {\n            addTextNode(x.offset, x.length, text, nodes);\n            break;\n          }\n\n        case 'textEntityTypeHashtag':\n          {\n            addTextNode(x.offset, x.length, text, nodes);\n            break;\n          }\n\n        case 'textEntityTypeItalic':\n          {\n            var _node2 = document.createElement('i');\n\n            _node2.innerText = text.substr(x.offset, x.length);\n            nodes.push(_node2);\n            break;\n          }\n\n        case 'textEntityTypeMention':\n          {\n            addTextNode(x.offset, x.length, text, nodes);\n            break;\n          }\n\n        case 'textEntityTypeMentionName':\n          {\n            try {\n              var user_id = x.type.user_id;\n              var user = UserStore.get(user_id);\n\n              if (user) {\n                var _node3 = document.createElement('a'); // node.href = getDecodedUrl(url, false);\n\n\n                _node3.title = getUserFullName(user_id, null, t); // node.target = '_blank';\n                // node.rel = 'noopener noreferrer';\n\n                _node3.dataset.userId = user_id;\n                _node3.innerText = text.substr(x.offset, x.length);\n                nodes.push(_node3);\n              } else {\n                addTextNode(x.offset, x.length, text, nodes);\n              }\n            } catch (_unused) {\n              addTextNode(x.offset, x.length, text, nodes);\n            }\n\n            break;\n          }\n\n        case 'textEntityTypePhoneNumber':\n          {\n            addTextNode(x.offset, x.length, text, nodes);\n            break;\n          }\n\n        case 'textEntityTypePre':\n          {\n            var _node4 = document.createTextNode('```' + text.substr(x.offset, x.length) + '```');\n\n            nodes.push(_node4);\n            break;\n          }\n\n        case 'textEntityTypePreCode':\n          {\n            var _node5 = document.createTextNode('```' + text.substr(x.offset, x.length) + '```');\n\n            nodes.push(_node5);\n            break;\n          }\n\n        case 'textEntityTypeTextUrl':\n          {\n            try {\n              var url = x.type.url;\n\n              var _node6 = document.createElement('a');\n\n              _node6.href = getDecodedUrl(url, false);\n              _node6.title = getDecodedUrl(url, false);\n              _node6.target = '_blank';\n              _node6.rel = 'noopener noreferrer';\n              _node6.innerText = text.substr(x.offset, x.length);\n              nodes.push(_node6);\n            } catch (_unused2) {\n              addTextNode(x.offset, x.length, text, nodes);\n            }\n\n            break;\n          }\n\n        case 'textEntityTypeUrl':\n          {\n            addTextNode(x.offset, x.length, text, nodes);\n            break;\n          }\n\n        default:\n          {\n            addTextNode(x.offset, x.length, text, nodes);\n            break;\n          }\n      }\n\n      prevEntity = x;\n      offset += x.length;\n    }\n  });\n\n  if (offset < text.length) {\n    addTextNode(offset, text.length - offset, text, nodes);\n  }\n\n  return nodes;\n} // based on code from official Android Telegram client\n// https://github.com/DrKLO/Telegram/blob/28eb8dfd0ef959fd5ad7d5d22f1d32879707c0a0/TMessagesProj/src/main/java/org/telegram/messenger/MediaDataController.java#L3782\n\nexport function getEntities(text) {\n  var entities = [];\n  if (!text) return {\n    text: text,\n    entities: entities\n  };\n  text = text.replace(/<div><br><\\/div>/gi, '<br>');\n  text = text.replace(/<div>/gi, '<br>');\n  text = text.replace(/<\\/div>/gi, '');\n  text = text.split('<br>').join('\\n'); // console.log(`[ge] start text=${text}`);\n\n  var index = -1; // first index of end tag\n\n  var lastIndex = 0; // first index after end tag\n\n  var start = -1; // first index of start tag\n\n  var isPre = false;\n  var mono = '`';\n  var pre = '```';\n  var bold = '**';\n  var italic = '__'; // 0 looking for html entities\n\n  var result = new DOMParser().parseFromString(text, 'text/html');\n  var offset = 0;\n  var length = 0;\n  var finalText = '';\n  result.body.childNodes.forEach(function (node) {\n    var textContent = node.textContent,\n        nodeName = node.nodeName;\n    length = textContent.length;\n    finalText += textContent;\n\n    if (!checkEntity(offset, offset + length - 1, entities)) {\n      return;\n    }\n\n    switch (nodeName) {\n      case '#text':\n        {\n          offset += length;\n          break;\n        }\n\n      case 'A':\n        {\n          if (node.dataset.userId) {\n            entities.push({\n              '@type': 'textEntity',\n              offset: offset,\n              length: length,\n              type: {\n                '@type': 'textEntityTypeMentionName',\n                user_id: node.dataset.userId\n              },\n              textContent: finalText.substring(offset, offset + length)\n            });\n          } else if (node.href) {\n            entities.push({\n              '@type': 'textEntity',\n              offset: offset,\n              length: length,\n              type: {\n                '@type': 'textEntityTypeTextUrl',\n                url: node.href\n              },\n              textContent: finalText.substring(offset, offset + length)\n            });\n          }\n\n          offset += length;\n          break;\n        }\n\n      case 'B':\n      case 'STRONG':\n        {\n          entities.push({\n            '@type': 'textEntity',\n            offset: offset,\n            length: length,\n            type: {\n              '@type': 'textEntityTypeBold'\n            },\n            textContent: finalText.substring(offset, offset + length)\n          });\n          offset += length;\n          break;\n        }\n\n      case 'BR':\n        {\n          break;\n        }\n\n      case 'CODE':\n        {\n          entities.push({\n            '@type': 'textEntity',\n            offset: offset,\n            length: length,\n            type: {\n              '@type': 'textEntityTypeCode'\n            },\n            textContent: finalText.substring(offset, offset + length)\n          });\n          offset += length;\n          break;\n        }\n\n      case 'I':\n      case 'EM':\n        {\n          entities.push({\n            '@type': 'textEntity',\n            offset: offset,\n            length: length,\n            type: {\n              '@type': 'textEntityTypeItalic'\n            },\n            textContent: finalText.substring(offset, offset + length)\n          });\n          offset += length;\n          break;\n        }\n\n      case 'PRE':\n        {\n          entities.push({\n            '@type': 'textEntity',\n            offset: offset,\n            length: length,\n            type: {\n              '@type': 'textEntityTypePre'\n            },\n            textContent: finalText.substring(offset, offset + length)\n          });\n          offset += length;\n          break;\n        }\n\n      default:\n        {\n          offset += length;\n          break;\n        }\n    }\n  });\n  text = finalText; // console.log(`[ge] HTML nodes text=${text}`, entities);\n  // 1 looking for ``` and ` in order to find mono and pre entities\n\n  while ((index = text.indexOf(isPre ? pre : mono, lastIndex)) !== -1) {\n    if (start === -1) {\n      // find start tag\n      isPre = text.length - index > 2 && text[index + 1] === mono && text[index + 2] === mono;\n      start = index;\n      lastIndex = index + (isPre ? 3 : 1);\n    } else {\n      // find end tag\n      for (var i = index + (isPre ? 3 : 1); i < text.length; i++) {\n        if (text[i] === mono) {\n          index++;\n        } else {\n          break;\n        }\n      }\n\n      lastIndex = index + (isPre ? 3 : 1);\n\n      if (isPre) {\n        // add pre tag\n        var textBefore = text.substring(0, start);\n        var textContent = text.substring(start + 3, index);\n        var textAfter = text.substring(index + 3, text.length);\n\n        if (textContent.length > 0) {\n          offset = start;\n          length = index - start - 3;\n          text = textBefore + textContent + textAfter;\n          var entity = {\n            '@type': 'textEntity',\n            offset: offset,\n            length: length,\n            language: '',\n            type: {\n              '@type': 'textEntityTypePre'\n            },\n            textContent: text.substring(offset, offset + length)\n          };\n          removeEntities(offset, offset + length - 1 + 6);\n          removeOffsetAfter(offset + length, 6, entities);\n          entities.push(entity);\n          lastIndex -= 6; // clean text before\n\n          if (textBefore.length > 0) {\n            var lastChar = textBefore[textBefore.length - 1];\n\n            if (lastChar !== '\\n') {\n              if (lastChar === ' ' || lastChar === '\\xA0') {\n                textBefore = textBefore.substr(0, textBefore.length - 1) + '\\n';\n                text = textBefore + textContent + textAfter;\n              } else {\n                textBefore += '\\n';\n                text = textBefore + textContent + textAfter;\n                addOffsetAfter(offset - 1, 1, entities);\n                lastIndex += 1;\n              }\n            }\n          } // clean text after\n\n\n          if (textAfter.length > 0) {\n            var firstChar = textAfter[0];\n\n            if (firstChar !== '\\n') {\n              if (firstChar === ' ' || firstChar === '\\xA0') {\n                textAfter = '\\n' + textAfter.substr(1);\n                text = textBefore + textContent + textAfter;\n              } else {\n                textAfter = '\\n' + textAfter;\n                text = textBefore + textContent + textAfter;\n                addOffsetAfter(offset + length - 1, 1, entities);\n                lastIndex += 1;\n              }\n            }\n          } // clean text content\n\n\n          if (textContent.length > 2) {\n            if (textContent[0] === '\\n') {\n              textContent = textContent.substring(1);\n              text = textBefore + textContent + textAfter;\n              entity.length -= 1;\n              entity.textContent = textContent;\n              removeOffsetAfter(entity.offset + entity.length - 1, 1, entities);\n              lastIndex -= 1;\n            }\n          }\n\n          if (textContent.length > 2) {\n            if (textContent[textContent.length - 1] === '\\n') {\n              textContent = textContent.substring(0, textContent.length - 1);\n              text = textBefore + textContent + textAfter;\n              entity.length -= 1;\n              entity.textContent = textContent;\n              removeOffsetAfter(entity.offset + entity.length - 1, 1, entities);\n              lastIndex -= 1;\n            }\n          }\n        }\n      } else {\n        // add code tag\n        if (start + 1 !== index) {\n          offset = start;\n          length = index - start - 1;\n          text = text.substring(0, start) + text.substring(start + 1, index) + text.substring(index + 1, text.length);\n          var _entity = {\n            '@type': 'textEntity',\n            offset: offset,\n            length: length,\n            type: {\n              '@type': 'textEntityTypeCode'\n            },\n            textContent: text.substring(offset, offset + length)\n          };\n          removeEntities(offset, offset + length - 1 + 2);\n          removeOffsetAfter(offset + length, 2, entities);\n          entities.push(_entity);\n          lastIndex -= 2;\n        }\n      }\n\n      start = -1;\n      isPre = false;\n    }\n  } // 1.1 case when ``` is one ` mono symbol\n\n\n  if (start !== -1 && isPre) {\n    offset = start;\n    length = 1;\n\n    if (checkEntity(offset, offset + length + 2 - 1, entities)) {\n      text = text.substring(0, start) + text.substring(start + 2, text.length);\n      var _entity2 = {\n        '@type': 'textEntity',\n        offset: offset,\n        length: length,\n        type: {\n          '@type': 'textEntityTypeCode'\n        },\n        textContent: text.substring(offset, offset + length)\n      };\n      removeEntities(offset, offset + length - 1 + 2);\n      removeOffsetAfter(offset + length, 2, entities);\n      entities.push(_entity2);\n    }\n  } // console.log(`[ge] pre and code text=${text}`, entities);\n  // 2 looking for bold, italic entities\n\n\n  for (var c = 0; c < 2; c++) {\n    lastIndex = 0;\n    start = -1;\n    var checkString = c === 0 ? bold : italic;\n    var checkChar = c === 0 ? '*' : '_';\n\n    while ((index = text.indexOf(checkString, lastIndex)) !== -1) {\n      if (start === -1) {\n        var prevChar = index === 0 ? ' ' : text[index - 1];\n\n        if (!checkInclusion(index, entities) && (prevChar === ' ' || prevChar === '\\xA0' || prevChar === '\\n')) {\n          start = index;\n        }\n\n        lastIndex = index + 2;\n      } else {\n        for (var a = index + 2; a < text.length; a++) {\n          if (text[a] === checkChar) {\n            index++;\n          } else {\n            break;\n          }\n        }\n\n        lastIndex = index + 2;\n\n        if (checkInclusion(index, entities) || checkIntersection(start, index, entities)) {\n          start = -1;\n          continue;\n        }\n\n        if (start + 2 !== index) {\n          offset = start;\n          length = index - start - 2;\n          text = text.substring(0, start) + text.substring(start + 2, index) + text.substring(index + 2, text.length);\n          var _entity3 = {\n            '@type': 'textEntity',\n            offset: offset,\n            length: length,\n            language: '',\n            type: {\n              '@type': c === 0 ? 'textEntityTypeBold' : 'textEntityTypeItalic'\n            },\n            textContent: text.substring(offset, offset + length)\n          };\n          removeOffsetAfter(offset + length, 4, entities);\n          entities.push(_entity3);\n          lastIndex -= 4;\n        }\n\n        start = -1;\n      }\n    }\n  } // console.log(`[ge] result text=${text}`, entities);\n\n\n  return {\n    text: text,\n    entities: entities\n  };\n}\nexport function canMessageBeEdited(chatId, messageId) {\n  var message = MessageStore.get(chatId, messageId);\n  if (!message) return false;\n  var can_be_edited = message.can_be_edited;\n  return can_be_edited;\n}\nexport function showMessageForward(chatId, messageId) {\n  var message = MessageStore.get(chatId, messageId);\n  if (!message) return false;\n  var forward_info = message.forward_info,\n      content = message.content;\n  return forward_info && content && content['@type'] !== 'messageSticker' && content['@type'] !== 'messageAudio';\n}\nexport function isTextMessage(chatId, messageId) {\n  var message = MessageStore.get(chatId, messageId);\n  if (!message) return false;\n  var content = message.content;\n  return content && content['@type'] === 'messageText';\n}\nexport function isMessagePinned(chatId, messageId) {\n  var chat = ChatStore.get(chatId);\n  if (!chat) return false;\n  return chat.pinned_message_id === messageId;\n}\nexport function canMessageBeUnvoted(chatId, messageId) {\n  var message = MessageStore.get(chatId, messageId);\n  if (!message) return false;\n  var content = message.content;\n  if (!content) return;\n  if (content['@type'] !== 'messagePoll') return;\n  var poll = content.poll;\n  if (!poll) return false;\n  var type = poll.type,\n      is_closed = poll.is_closed,\n      options = poll.options;\n  if (!type) return false;\n  if (type['@type'] !== 'pollTypeRegular') return false;\n  if (is_closed) return false;\n  return options.some(function (x) {\n    return x.is_chosen || x.is_being_chosen;\n  });\n}\nexport function canMessageBeClosed(chatId, messageId) {\n  var message = MessageStore.get(chatId, messageId);\n  if (!message) return false;\n  var content = message.content,\n      can_be_edited = message.can_be_edited;\n  if (!content) return;\n  if (content['@type'] !== 'messagePoll') return;\n  return can_be_edited;\n}\nexport function canMessageBeForwarded(chatId, messageId) {\n  var message = MessageStore.get(chatId, messageId);\n  return message && message.can_be_forwarded;\n}\nexport function canMessageBeDeleted(chatId, messageId) {\n  var message = MessageStore.get(chatId, messageId);\n  return message && (message.can_be_deleted_only_for_self || message.can_be_deleted_for_all_users);\n}\nexport function getMessageStyle(chatId, messageId) {\n  var message = MessageStore.get(chatId, messageId);\n  if (!message) return null;\n  var content = message.content;\n  if (!content) return null;\n\n  switch (content['@type']) {\n    case 'messageAnimation':\n      {\n        var animation = content.animation;\n        if (!animation) return null;\n        var width = animation.width,\n            height = animation.height,\n            thumbnail = animation.thumbnail;\n        var size = {\n          width: width,\n          height: height\n        } || thumbnail;\n        if (!size) return null;\n        var fitSize = getFitSize(size, PHOTO_DISPLAY_SIZE, false);\n        if (!fitSize) return null;\n        return {\n          width: fitSize.width\n        };\n      }\n\n    case 'messagePhoto':\n      {\n        var photo = content.photo;\n        if (!photo) return null;\n\n        var _size = getSize(photo.sizes, PHOTO_SIZE);\n\n        if (!_size) return null;\n\n        var _fitSize = getFitSize(_size, PHOTO_DISPLAY_SIZE, false);\n\n        if (!_fitSize) return null;\n        return {\n          width: _fitSize.width\n        };\n      }\n\n    case 'messageVideo':\n      {\n        var video = content.video;\n        if (!video) return null;\n        var _thumbnail11 = video.thumbnail,\n            _width = video.width,\n            _height = video.height;\n\n        var _size2 = {\n          width: _width,\n          height: _height\n        } || _thumbnail11;\n\n        if (!_size2) return null;\n\n        var _fitSize2 = getFitSize(_size2, PHOTO_DISPLAY_SIZE);\n\n        if (!_fitSize2) return null;\n        return {\n          width: _fitSize2.width\n        };\n      }\n  }\n\n  return null;\n}\nexport { getAuthor, getTitle, getText, getFormattedText, getWebPage, getContent, getDate, getDateHint, isForwardOriginHidden, getForwardTitle, getUnread, getSenderUserId, filterDuplicateMessages, filterMessages, isMediaContent, isDeletedMessage, isVideoMessage, isAnimationMessage, isLottieMessage, getLocationId, isContentOpened, getMediaTitle, hasAudio, hasVideoNote, getSearchMessagesFilter, openMedia, getReplyPhotoSize, getEmojiMatches, messageComparatorDesc, substring, stopPropagation };","map":{"version":3,"sources":["/Users/wubenqi/nebula-chat/telegram-react/src/Utils/Message.js"],"names":["React","emojiRegex","MentionLink","Poll","SafeLink","dateFormat","searchChat","setMediaViewerContent","getChatTitle","isMeChat","openUser","getFitSize","getPhotoSize","getSize","download","saveOrDownload","getAudioTitle","getDecodedUrl","getServiceMessageContent","getUserFullName","LOCATION_HEIGHT","LOCATION_SCALE","LOCATION_WIDTH","LOCATION_ZOOM","PHOTO_DISPLAY_SIZE","PHOTO_SIZE","AppStore","ChatStore","FileStore","MessageStore","UserStore","TdLibController","isMetaBubble","chatId","messageId","message","get","content","caption","text","length","isMessageUnread","chat","last_read_inbox_message_id","last_read_outbox_message_id","id","is_outgoing","isMe","getAuthor","t","k","forward_info","sender_user_id","user","chat_id","title","getTitle","substring","start","end","stopPropagation","event","searchCurrentChat","preventDefault","getFormattedText","formattedText","entities","deleteLineBreakAfterPre","result","index","i","entity","offset","type","textBefore","textBeforeLength","substr","push","entityKey","entityText","command","user_id","url","textAfter","getText","meta","concat","getWebPage","web_page","getDate","date","d","Date","getDateHint","isForwardOriginHidden","forwardInfo","origin","getForwardTitle","key","sender_name","author_signature","getUnread","getSenderUserId","filterDuplicateMessages","history","messages","map","reduce","accumulator","current","set","Map","filter","x","has","filterMessages","getContent","ttl","document","file_name","poll","question","sticker","emoji","isMediaContent","getLocationId","location","width","height","zoom","scale","longitude","latitude","isVideoMessage","Boolean","video","isLottieMessage","toLowerCase","endsWith","isAnimationMessage","animation","isContentOpened","is_listened","is_viewed","getMediaTitle","audio","hasAudio","hasVideoNote","video_note","getSearchMessagesFilter","voice_note","openAnimation","fileCancel","file","local","is_downloading_active","cancelGetRemoteFile","remote","is_uploading_active","cancelUploadFile","clientUpdate","send","message_id","openAudio","updateAudioBlob","openChatPhoto","photo","photoSize","sizes","updatePhotoBlob","openContact","contact","openDocument","openGame","game","updateAnimationBlob","openPhoto","openSticker","set_id","stickerSet","openVideo","openVideoNote","videoNote","updateVideoNoteBlob","openVoiceNote","voiceNote","voice","updateVoiceNoteBlob","openMedia","isDeletedMessage","getReplyMinithumbnail","minithumbnail","getReplyPhotoSize","thumbnail","album_cover_thumbnail","getEmojiMatches","textContent","lastIndex","emojiMatches","m","re","exec","messageComparatorDesc","left","right","checkInclusion","checkIntersection","startIndex","endIndex","checkEntity","removeOffsetAfter","countToRemove","forEach","e","addOffsetAfter","countToAdd","removeEntities","entityStart","entityEnd","splice","addTextNode","nodes","node","createTextNode","getNodes","sort","a","b","prevEntity","createElement","innerText","dataset","userId","href","target","rel","getEntities","replace","split","join","isPre","mono","pre","bold","italic","DOMParser","parseFromString","finalText","body","childNodes","nodeName","indexOf","language","lastChar","firstChar","c","checkString","checkChar","prevChar","canMessageBeEdited","can_be_edited","showMessageForward","isTextMessage","isMessagePinned","pinned_message_id","canMessageBeUnvoted","is_closed","options","some","is_chosen","is_being_chosen","canMessageBeClosed","canMessageBeForwarded","can_be_forwarded","canMessageBeDeleted","can_be_deleted_only_for_self","can_be_deleted_for_all_users","getMessageStyle","size","fitSize"],"mappings":"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","sourcesContent":["/*\n *  Copyright (c) 2018-present, Evgeny Nadymov\n *\n * This source code is licensed under the GPL v.3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport React from 'react';\nimport emojiRegex from 'emoji-regex';\nimport MentionLink from '../Components/Additional/MentionLink';\nimport Poll from '../Components/Message/Media/Poll';\nimport SafeLink from '../Components/Additional/SafeLink';\nimport dateFormat from '../Utils/Date';\nimport { searchChat, setMediaViewerContent } from '../Actions/Client';\nimport { getChatTitle, isMeChat } from './Chat';\nimport { openUser } from './../Actions/Client';\nimport { getFitSize, getPhotoSize, getSize } from './Common';\nimport { download, saveOrDownload } from './File';\nimport { getAudioTitle } from './Media';\nimport { getDecodedUrl } from './Url';\nimport { getServiceMessageContent } from './ServiceMessage';\nimport { getUserFullName } from './User';\nimport { LOCATION_HEIGHT, LOCATION_SCALE, LOCATION_WIDTH, LOCATION_ZOOM, PHOTO_DISPLAY_SIZE, PHOTO_SIZE } from '../Constants';\nimport AppStore from '../Stores/ApplicationStore';\nimport ChatStore from '../Stores/ChatStore';\nimport FileStore from '../Stores/FileStore';\nimport MessageStore from '../Stores/MessageStore';\nimport UserStore from '../Stores/UserStore';\nimport TdLibController from '../Controllers/TdLibController';\n\nexport function isMetaBubble(chatId, messageId) {\n    const message = MessageStore.get(chatId, messageId);\n    if (!message) {\n        return false;\n    }\n\n    const { content } = message;\n    if (!content) {\n        return false;\n    }\n\n    const { caption } = content;\n    if (caption && caption.text && caption.text.length > 0) {\n        return false;\n    }\n\n    switch (content['@type']) {\n        case 'messageAnimation': {\n            return true;\n        }\n        case 'messageLocation': {\n            return true;\n        }\n        case 'messagePhoto': {\n            return true;\n        }\n        case 'messageSticker': {\n            return true;\n        }\n        case 'messageVideo': {\n            return true;\n        }\n        case 'messageVideoNote': {\n            return true;\n        }\n    }\n\n    return false;\n}\n\nexport function isMessageUnread(chatId, messageId) {\n    const chat = ChatStore.get(chatId);\n    if (!chat) {\n        return false;\n    }\n\n    const { last_read_inbox_message_id, last_read_outbox_message_id } = chat;\n\n    const message = MessageStore.get(chatId, messageId);\n    if (!message) {\n        return false;\n    }\n\n    const { id, is_outgoing } = message;\n    const isMe = isMeChat(chatId);\n    if (is_outgoing && isMe) {\n        return false;\n    }\n\n    return is_outgoing ? id > last_read_outbox_message_id : id > last_read_inbox_message_id;\n}\n\nfunction getAuthor(message, t = k => k) {\n    if (!message) return null;\n\n    const { forward_info } = message;\n\n    if (forward_info) {\n        switch (forward_info['@type']) {\n            case 'messageForwardedFromUser': {\n                if (forward_info.sender_user_id > 0) {\n                    const user = UserStore.get(forward_info.sender_user_id);\n                    if (user) {\n                        return getUserFullName(forward_info.sender_user_id, null, t);\n                    }\n                }\n                break;\n            }\n            case 'messageForwardedPost': {\n                const chat = ChatStore.get(forward_info.chat_id);\n                if (chat) {\n                    return chat.title;\n                }\n                break;\n            }\n        }\n    }\n\n    return getTitle(message, t);\n}\n\nfunction getTitle(message, t = k => k) {\n    if (!message) return null;\n\n    const { sender_user_id, chat_id } = message;\n\n    if (sender_user_id) {\n        const user = UserStore.get(sender_user_id);\n        if (user) {\n            return getUserFullName(sender_user_id, null, t);\n        }\n    }\n\n    if (chat_id) {\n        const chat = ChatStore.get(chat_id);\n        if (chat) {\n            return chat.title;\n        }\n    }\n\n    return null;\n}\n\nfunction substring(text, start, end) {\n    if (start < 0) start = 0;\n    if (start > text.length - 1) start = text.length - 1;\n    if (end < start) end = start;\n    if (end > text.length) end = text.length;\n\n    return text.substring(start, end);\n}\n\nfunction stopPropagation(event) {\n    event.stopPropagation();\n}\n\nfunction searchCurrentChat(event, text) {\n    event.stopPropagation();\n    event.preventDefault();\n\n    const { chatId } = AppStore;\n\n    searchChat(chatId, text);\n}\n\nfunction getFormattedText(formattedText, t = k => k) {\n    if (formattedText['@type'] !== 'formattedText') return null;\n\n    const { text, entities } = formattedText;\n    if (!text) return null;\n    if (!entities) return text;\n\n    let deleteLineBreakAfterPre = false;\n    let result = [];\n    let index = 0;\n    for (let i = 0; i < entities.length; i++) {\n        const entity = entities[i];\n        const { offset, length, type } = entity;\n\n        // skip nested entities\n        if (index > offset) {\n            continue;\n        }\n\n        let textBefore = substring(text, index, offset);\n        const textBeforeLength = textBefore.length;\n        if (textBefore) {\n            if (deleteLineBreakAfterPre && textBefore.length > 0 && textBefore[0] === '\\n') {\n                textBefore = textBefore.substr(1);\n                deleteLineBreakAfterPre = false;\n            }\n            if (textBefore) {\n                result.push(textBefore);\n            }\n        }\n\n        const entityKey = offset;\n        let entityText = substring(text, offset, offset + length);\n        if (deleteLineBreakAfterPre && entityText.length > 0 && entityText[0] === '\\n') {\n            entityText = entityText.substr(1);\n            deleteLineBreakAfterPre = false;\n        }\n\n        switch (type['@type']) {\n            case 'textEntityTypeBold': {\n                result.push(<strong key={entityKey}>{entityText}</strong>);\n                break;\n            }\n            case 'textEntityTypeBotCommand': {\n                const command = entityText.length > 0 && entityText[0] === '/' ? substring(entityText, 1) : entityText;\n                result.push(\n                    <a key={entityKey} onClick={stopPropagation} href={`tg://bot_command?command=${command}&bot=`}>\n                        {entityText}\n                    </a>\n                );\n                break;\n            }\n            case 'textEntityTypeCashtag': {\n                result.push(\n                    <a key={entityKey} onClick={event => searchCurrentChat(event, entityText)}>\n                        {entityText}\n                    </a>\n                );\n                break;\n            }\n            case 'textEntityTypeCode': {\n                result.push(<code key={entityKey}>{entityText}</code>);\n                break;\n            }\n            case 'textEntityTypeEmailAddress': {\n                result.push(\n                    <a\n                        key={entityKey}\n                        href={`mailto:${entityText}`}\n                        onClick={stopPropagation}\n                        target='_blank'\n                        rel='noopener noreferrer'>\n                        {entityText}\n                    </a>\n                );\n                break;\n            }\n            case 'textEntityTypeHashtag': {\n                result.push(\n                    <a key={entityKey} onClick={event => searchCurrentChat(event, entityText)}>\n                        {entityText}\n                    </a>\n                );\n                break;\n            }\n            case 'textEntityTypeItalic': {\n                result.push(<em key={entityKey}>{entityText}</em>);\n                break;\n            }\n            case 'textEntityTypeMentionName': {\n                result.push(\n                    <MentionLink key={entityKey} userId={type.user_id} title={getUserFullName(type.user_id, null, t)}>\n                        {entityText}\n                    </MentionLink>\n                );\n                break;\n            }\n            case 'textEntityTypeMention': {\n                result.push(\n                    <MentionLink key={entityKey} username={entityText}>\n                        {entityText}\n                    </MentionLink>\n                );\n                break;\n            }\n            case 'textEntityTypePhoneNumber': {\n                result.push(\n                    <a key={entityKey} href={`tel:${entityText}`} onClick={stopPropagation}>\n                        {entityText}\n                    </a>\n                );\n                break;\n            }\n            case 'textEntityTypePre': {\n                result.push(<pre key={entityKey}>{entityText}</pre>);\n                deleteLineBreakAfterPre = true;\n                break;\n            }\n            case 'textEntityTypePreCode': {\n                result.push(\n                    <pre key={entityKey}>\n                        <code>{entityText}</code>\n                    </pre>\n                );\n                deleteLineBreakAfterPre = true;\n                break;\n            }\n            case 'textEntityTypeTextUrl': {\n                const url = type.url ? type.url : entityText;\n\n                result.push(\n                    <SafeLink key={entityKey} url={url}>\n                        {entityText}\n                    </SafeLink>\n                );\n                break;\n            }\n            case 'textEntityTypeUrl': {\n                result.push(\n                    <SafeLink key={entityKey} url={entityText}>\n                        {entityText}\n                    </SafeLink>\n                );\n                break;\n            }\n            default:\n                result.push(entityText);\n                break;\n        }\n\n        index += textBeforeLength + entity.length;\n    }\n\n    if (index < text.length) {\n        let textAfter = text.substring(index);\n        if (deleteLineBreakAfterPre && textAfter.length > 0 && textAfter[0] === '\\n') {\n            textAfter = textAfter.substr(1);\n        }\n        if (textAfter) {\n            result.push(textAfter);\n        }\n    }\n\n    return result;\n}\n\nfunction getText(message, meta, t = k => k) {\n    if (!message) return null;\n\n    let result = [];\n\n    const { content } = message;\n    if (!content) return [...result, meta];\n\n    const { text, caption } = content;\n\n    if (text && text['@type'] === 'formattedText' && text.text) {\n        result = getFormattedText(text, t);\n    } else if (caption && caption['@type'] === 'formattedText' && caption.text) {\n        const formattedText = getFormattedText(caption, t);\n        if (formattedText) {\n            result = result.concat(formattedText);\n        }\n    }\n\n    return result && result.length > 0 ? [...result, meta] : [];\n}\n\nfunction getWebPage(message) {\n    if (!message) return null;\n    if (!message.content) return null;\n\n    return message.content.web_page;\n}\n\nfunction getDate(date) {\n    if (!date) return null;\n\n    const d = new Date(date * 1000);\n\n    return dateFormat(d, 'H:MM'); //date.toDateString();\n}\n\nfunction getDateHint(date) {\n    if (!date) return null;\n\n    const d = new Date(date * 1000);\n    return dateFormat(d, 'H:MM:ss d.mm.yyyy'); //date.toDateString();\n}\n\nfunction isForwardOriginHidden(forwardInfo) {\n    if (!forwardInfo) return false;\n\n    const { origin } = forwardInfo;\n    if (!origin) return false;\n\n    switch (origin['@type']) {\n        case 'messageForwardOriginUser': {\n            return false;\n        }\n        case 'messageForwardOriginHiddenUser': {\n            return true;\n        }\n        case 'messageForwardOriginChannel': {\n            return false;\n        }\n    }\n\n    return false;\n}\n\nfunction getForwardTitle(forwardInfo, t = key => key) {\n    if (!forwardInfo) return '';\n\n    const { origin } = forwardInfo;\n    if (!origin) return '';\n\n    switch (origin['@type']) {\n        case 'messageForwardOriginUser': {\n            const { sender_user_id } = origin;\n\n            return getUserFullName(sender_user_id, null, t);\n        }\n        case 'messageForwardOriginHiddenUser': {\n            const { sender_name } = origin;\n\n            return sender_name;\n        }\n        case 'messageForwardOriginChannel': {\n            const { chat_id, author_signature } = origin;\n\n            return getChatTitle(chat_id, false, t) + (author_signature ? ` (${author_signature})` : '');\n        }\n    }\n\n    return '';\n}\n\nfunction getUnread(message) {\n    if (!message) return false;\n    if (!message.chat_id) return false;\n    if (!message.is_outgoing) return false;\n\n    let chat = ChatStore.get(message.chat_id);\n    if (!chat) return false;\n\n    return chat.last_read_outbox_message_id < message.id;\n}\n\nfunction getSenderUserId(message) {\n    if (!message) return null;\n\n    return message.sender_user_id;\n}\n\nfunction filterDuplicateMessages(result, history) {\n    if (result.messages.length === 0) return;\n    if (history.length === 0) return;\n\n    const map = history.reduce(function(accumulator, current) {\n        accumulator.set(current.id, current.id);\n        return accumulator;\n    }, new Map());\n\n    result.messages = result.messages.filter(x => !map.has(x.id));\n}\n\nfunction filterMessages(messages) {\n    return messages.filter(x => x.content['@type'] !== 'messageChatUpgradeTo');\n}\n\nfunction getContent(message, t = key => key) {\n    if (!message) return null;\n\n    const { content } = message;\n    if (!content) return null;\n\n    let caption = '';\n    if (content.caption && content.caption.text) {\n        caption = `, ${content.caption.text}`;\n    }\n\n    if (message.ttl > 0) {\n        return getServiceMessageContent(message);\n    }\n\n    switch (content['@type']) {\n        case 'messageAnimation': {\n            return t('AttachGif') + caption;\n        }\n        case 'messageAudio': {\n            return t('AttachMusic') + caption;\n        }\n        case 'messageBasicGroupChatCreate': {\n            return getServiceMessageContent(message);\n        }\n        case 'messageCall': {\n            return t('Call') + caption;\n        }\n        case 'messageChatAddMembers': {\n            return getServiceMessageContent(message);\n        }\n        case 'messageChatChangePhoto': {\n            return getServiceMessageContent(message);\n        }\n        case 'messageChatChangeTitle': {\n            return getServiceMessageContent(message);\n        }\n        case 'messageChatDeleteMember': {\n            return getServiceMessageContent(message);\n        }\n        case 'messageChatDeletePhoto': {\n            return getServiceMessageContent(message);\n        }\n        case 'messageChatJoinByLink': {\n            return getServiceMessageContent(message);\n        }\n        case 'messageChatSetTtl': {\n            return getServiceMessageContent(message);\n        }\n        case 'messageChatUpgradeFrom': {\n            return getServiceMessageContent(message);\n        }\n        case 'messageChatUpgradeTo': {\n            return getServiceMessageContent(message);\n        }\n        case 'messageContact': {\n            return t('AttachContact') + caption;\n        }\n        case 'messageContactRegistered': {\n            return getServiceMessageContent(message);\n        }\n        case 'messageCustomServiceAction': {\n            return getServiceMessageContent(message);\n        }\n        case 'messageDocument': {\n            const { document } = content;\n            if (document && document.file_name) {\n                return document.file_name + caption;\n            }\n\n            return t('AttachDocument') + caption;\n        }\n        case 'messageExpiredPhoto': {\n            return t('AttachPhoto') + caption;\n        }\n        case 'messageExpiredVideo': {\n            return t('AttachVideo') + caption;\n        }\n        case 'messageGame': {\n            return t('AttachGame') + caption;\n        }\n        case 'messageGameScore': {\n            return getServiceMessageContent(message);\n        }\n        case 'messageInvoice': {\n            return getServiceMessageContent(message);\n        }\n        case 'messageLocation': {\n            return t('AttachLocation') + caption;\n        }\n        case 'messagePassportDataReceived': {\n            return getServiceMessageContent(message);\n        }\n        case 'messagePassportDataSent': {\n            return getServiceMessageContent(message);\n        }\n        case 'messagePaymentSuccessful': {\n            return getServiceMessageContent(message);\n        }\n        case 'messagePaymentSuccessfulBot': {\n            return getServiceMessageContent(message);\n        }\n        case 'messagePhoto': {\n            return t('AttachPhoto') + caption;\n        }\n        case 'messagePoll': {\n            const { poll } = content;\n\n            return '📊 ' + (poll.question || t('Poll')) + caption;\n        }\n        case 'messagePinMessage': {\n            return getServiceMessageContent(message);\n        }\n        case 'messageScreenshotTaken': {\n            return getServiceMessageContent(message);\n        }\n        case 'messageSticker': {\n            const { sticker } = content;\n            let emoji = '';\n            if (sticker && sticker.emoji) {\n                emoji = sticker.emoji;\n            }\n\n            return t('AttachSticker') + (emoji ? ` ${emoji}` : '') + caption;\n        }\n        case 'messageSupergroupChatCreate': {\n            return getServiceMessageContent(message);\n        }\n        case 'messageText': {\n            return content.text.text + caption;\n        }\n        case 'messageUnsupported': {\n            return getServiceMessageContent(message);\n        }\n        case 'messageVenue': {\n            return t('AttachLocation') + caption;\n        }\n        case 'messageVideo': {\n            return t('AttachVideo') + caption;\n        }\n        case 'messageVideoNote': {\n            return t('AttachRound') + caption;\n        }\n        case 'messageVoiceNote': {\n            return t('AttachAudio') + caption;\n        }\n        case 'messageWebsiteConnected': {\n            return getServiceMessageContent(message);\n        }\n        default: {\n            return t('UnsupportedAttachment');\n        }\n    }\n}\n\nfunction isMediaContent(content) {\n    if (!content) return false;\n\n    return content['@type'] === 'messagePhoto';\n}\n\nfunction getLocationId(\n    location,\n    width = LOCATION_WIDTH,\n    height = LOCATION_HEIGHT,\n    zoom = LOCATION_ZOOM,\n    scale = LOCATION_SCALE\n) {\n    if (!location) return null;\n\n    const { longitude, latitude } = location;\n    return `loc=${latitude},${longitude}&size=${width},${height}&scale=${scale}&zoom=${zoom}`;\n}\n\nfunction isVideoMessage(chatId, messageId) {\n    const message = MessageStore.get(chatId, messageId);\n    if (!message) return false;\n\n    const { content } = message;\n    if (!content) return false;\n\n    switch (content['@type']) {\n        case 'messageVideo': {\n            return true;\n        }\n        case 'messageText': {\n            const { web_page } = content;\n            return Boolean(web_page.video);\n        }\n        default: {\n            return false;\n        }\n    }\n}\n\nfunction isLottieMessage(chatId, messageId) {\n    const message = MessageStore.get(chatId, messageId);\n    if (!message) return false;\n\n    const { content } = message;\n    if (!content) return false;\n\n    switch (content['@type']) {\n        case 'messageDocument': {\n            const { document } = content;\n            if (!document) return false;\n\n            const { file_name } = document;\n\n            return file_name && file_name.toLowerCase().endsWith('.json');\n        }\n        case 'messageText': {\n            const { web_page } = content;\n            if (!web_page) return false;\n\n            const { document } = web_page;\n            if (!document) return false;\n\n            const { file_name } = document;\n\n            return file_name && file_name.toLowerCase().endsWith('.json');\n        }\n        default: {\n            return false;\n        }\n    }\n}\n\nfunction isAnimationMessage(chatId, messageId) {\n    const message = MessageStore.get(chatId, messageId);\n    if (!message) return false;\n\n    const { content } = message;\n    if (!content) return false;\n\n    switch (content['@type']) {\n        case 'messageAnimation': {\n            return true;\n        }\n        case 'messageText': {\n            const { web_page } = content;\n            return Boolean(web_page.animation);\n        }\n        default: {\n            return false;\n        }\n    }\n}\n\nfunction isContentOpened(chatId, messageId) {\n    const message = MessageStore.get(chatId, messageId);\n    if (!message) return true;\n\n    const { content } = message;\n    if (!content) return true;\n\n    switch (content['@type']) {\n        case 'messageVoiceNote': {\n            return content.is_listened;\n        }\n        case 'messageVideoNote': {\n            return content.is_viewed;\n        }\n        default: {\n            return true;\n        }\n    }\n}\n\nfunction getMediaTitle(message, t = k => k) {\n    if (!message) return null;\n\n    const { content } = message;\n    if (!content) return null;\n\n    switch (content['@type']) {\n        case 'messageAudio': {\n            const { audio } = content;\n            if (audio) {\n                return getAudioTitle(audio);\n            }\n            break;\n        }\n        case 'messageText': {\n            const { web_page } = content;\n            if (web_page) {\n                const { audio } = web_page;\n                if (audio) {\n                    return getAudioTitle(audio);\n                }\n                break;\n            }\n        }\n    }\n\n    return getAuthor(message, t);\n}\n\nfunction hasAudio(chatId, messageId) {\n    const message = MessageStore.get(chatId, messageId);\n    if (!message) return false;\n\n    const { content } = message;\n    if (!content) return false;\n\n    switch (content['@type']) {\n        case 'messageAudio': {\n            const { audio } = content;\n            if (audio) {\n                return true;\n            }\n\n            break;\n        }\n        case 'messageText': {\n            const { web_page } = content;\n            if (web_page) {\n                const { audio } = web_page;\n                if (audio) {\n                    return true;\n                }\n            }\n\n            break;\n        }\n    }\n\n    return false;\n}\n\nfunction hasVideoNote(chatId, messageId) {\n    const message = MessageStore.get(chatId, messageId);\n    if (!message) return false;\n\n    const { content } = message;\n    if (!content) return false;\n\n    switch (content['@type']) {\n        case 'messageVideoNote': {\n            const { video_note } = content;\n            if (video_note) {\n                return true;\n            }\n\n            break;\n        }\n        case 'messageText': {\n            const { web_page } = content;\n            if (web_page) {\n                const { video_note } = web_page;\n                if (video_note) {\n                    return true;\n                }\n            }\n\n            break;\n        }\n    }\n\n    return false;\n}\n\nfunction getSearchMessagesFilter(chatId, messageId) {\n    const message = MessageStore.get(chatId, messageId);\n    if (!message) return null;\n\n    const { content } = message;\n    if (!content) return null;\n\n    switch (content['@type']) {\n        case 'messageAudio': {\n            const { audio } = content;\n            if (audio) {\n                return {\n                    '@type': 'searchMessagesFilterAudio'\n                };\n            }\n            break;\n        }\n        case 'messageVoiceNote': {\n            const { voice_note } = content;\n            if (voice_note) {\n                return {\n                    '@type': 'searchMessagesFilterVoiceNote'\n                };\n            }\n            break;\n        }\n        case 'messageVideoNote': {\n            const { video_note } = content;\n            if (video_note) {\n                return null;\n\n                return {\n                    '@type': 'searchMessagesFilterVideoNote'\n                };\n            }\n            break;\n        }\n        case 'messageText': {\n            const { web_page } = content;\n            if (web_page) {\n                const { audio, voice_note, video_note } = web_page;\n                if (audio) {\n                    return null;\n\n                    return {\n                        '@type': 'searchMessagesFilterAudio'\n                    };\n                }\n\n                if (voice_note) {\n                    return null;\n\n                    return {\n                        '@type': 'searchMessagesFilterVoiceNote'\n                    };\n                }\n\n                if (video_note) {\n                    return null;\n\n                    return {\n                        '@type': 'searchMessagesFilterVideoNote'\n                    };\n                }\n                break;\n            }\n        }\n    }\n\n    return null;\n}\n\nfunction openAnimation(animation, message, fileCancel) {\n    if (!animation) return;\n    if (!message) return;\n\n    const { chat_id, id } = message;\n\n    let { animation: file } = animation;\n    if (!file) return;\n\n    file = FileStore.get(file.id) || file;\n    if (fileCancel && file.local.is_downloading_active) {\n        FileStore.cancelGetRemoteFile(file.id, message);\n        return;\n    } else if (fileCancel && file.remote.is_uploading_active) {\n        FileStore.cancelUploadFile(file.id, message);\n        return;\n    } else {\n        // download file at loadMediaViewerContent instead\n        // download(file, message, FileStore.updateAnimationBlob(chat_id, id, file.id));\n    }\n\n    TdLibController.clientUpdate({\n        '@type': 'clientUpdateActiveAnimation',\n        chatId: chat_id,\n        messageId: id\n    });\n\n    TdLibController.send({\n        '@type': 'openMessageContent',\n        chat_id: chat_id,\n        message_id: id\n    });\n\n    setMediaViewerContent({\n        chatId: chat_id,\n        messageId: id\n    });\n}\n\nfunction openAudio(audio, message, fileCancel) {\n    if (!audio) return;\n    if (!message) return;\n\n    const { chat_id, id } = message;\n\n    let { audio: file } = audio;\n    if (!file) return;\n\n    file = FileStore.get(file.id) || file;\n    if (fileCancel && file.local.is_downloading_active) {\n        FileStore.cancelGetRemoteFile(file.id, message);\n        return;\n    } else if (fileCancel && file.remote.is_uploading_active) {\n        FileStore.cancelUploadFile(file.id, message);\n        return;\n    } else {\n        download(file, message, () => FileStore.updateAudioBlob(chat_id, id, file.id));\n    }\n\n    TdLibController.send({\n        '@type': 'openMessageContent',\n        chat_id: chat_id,\n        message_id: id\n    });\n\n    TdLibController.clientUpdate({\n        '@type': 'clientUpdateMediaActive',\n        chatId: chat_id,\n        messageId: id\n    });\n}\n\nfunction openChatPhoto(photo, message, fileCancel) {\n    if (!photo) return;\n    if (!message) return;\n\n    const { chat_id, id } = message;\n\n    const photoSize = getPhotoSize(photo.sizes);\n    if (!photoSize) return;\n\n    let { photo: file } = photoSize;\n    if (!file) return;\n\n    file = FileStore.get(file.id) || file;\n    if (fileCancel && file.local.is_downloading_active) {\n        FileStore.cancelGetRemoteFile(file.id, message);\n        return;\n    } else if (fileCancel && file.remote.is_uploading_active) {\n        FileStore.cancelUploadFile(file.id, message);\n        return;\n    }\n\n    download(file, message, () => FileStore.updatePhotoBlob(chat_id, id, file.id));\n\n    TdLibController.send({\n        '@type': 'openMessageContent',\n        chat_id: chat_id,\n        message_id: id\n    });\n\n    setMediaViewerContent({\n        chatId: chat_id,\n        messageId: id\n    });\n}\n\nfunction openContact(contact, message, fileCancel) {\n    if (!contact) return;\n    if (!message) return;\n\n    const { chat_id, id } = message;\n\n    TdLibController.send({\n        '@type': 'openMessageContent',\n        chat_id: chat_id,\n        message_id: id\n    });\n\n    openUser(contact.user_id, true);\n}\n\nfunction openDocument(document, message, fileCancel) {\n    if (!document) return;\n    if (!message) return;\n\n    const { chat_id, id } = message;\n\n    let { document: file } = document;\n    if (!file) return;\n\n    file = FileStore.get(file.id) || file;\n    if (fileCancel && file.local.is_downloading_active) {\n        FileStore.cancelGetRemoteFile(file.id, message);\n        return;\n    } else if (fileCancel && file.remote.is_uploading_active) {\n        FileStore.cancelUploadFile(file.id, message);\n        return;\n    }\n\n    TdLibController.send({\n        '@type': 'openMessageContent',\n        chat_id: chat_id,\n        message_id: id\n    });\n\n    if (isLottieMessage(chat_id, id)) {\n        TdLibController.send({\n            '@type': 'openMessageContent',\n            chat_id: chat_id,\n            message_id: id\n        });\n\n        setMediaViewerContent({\n            chatId: chat_id,\n            messageId: id\n        });\n    } else {\n        saveOrDownload(file, document.file_name, message);\n    }\n}\n\nfunction openGame(game, message, fileCancel) {\n    if (!game) return;\n    if (!message) return;\n\n    const { chat_id, id } = message;\n\n    const { animation } = game;\n    if (animation) {\n        let { animation: file } = animation;\n        if (!file) return;\n\n        file = FileStore.get(file.id) || file;\n        if (fileCancel && file.local.is_downloading_active) {\n            FileStore.cancelGetRemoteFile(file.id, message);\n            return;\n        } else if (fileCancel && file.remote.is_uploading_active) {\n            FileStore.cancelUploadFile(file.id, message);\n            return;\n        }\n\n        download(file, message, () => FileStore.updateAnimationBlob(chat_id, id, file.id));\n    }\n\n    TdLibController.send({\n        '@type': 'openMessageContent',\n        chat_id: chat_id,\n        message_id: id\n    });\n\n    TdLibController.clientUpdate({\n        '@type': 'clientUpdateActiveAnimation',\n        chatId: chat_id,\n        messageId: id\n    });\n}\n\nfunction openPhoto(photo, message, fileCancel) {\n    if (!photo) return;\n    if (!message) return;\n\n    const { chat_id, id } = message;\n\n    const photoSize = getPhotoSize(photo.sizes);\n    if (!photoSize) return;\n\n    let { photo: file } = photoSize;\n    if (!file) return;\n\n    file = FileStore.get(file.id) || file;\n    if (fileCancel && file.local.is_downloading_active) {\n        FileStore.cancelGetRemoteFile(file.id, message);\n        return;\n    } else if (fileCancel && file.remote.is_uploading_active) {\n        FileStore.cancelUploadFile(file.id, message);\n        return;\n    }\n\n    download(file, message, () => FileStore.updatePhotoBlob(chat_id, id, file.id));\n\n    TdLibController.send({\n        '@type': 'openMessageContent',\n        chat_id: chat_id,\n        message_id: id\n    });\n\n    setMediaViewerContent({\n        chatId: chat_id,\n        messageId: id\n    });\n}\n\nasync function openSticker(sticker, message, fileCancel) {\n    if (!sticker) return;\n    if (!message) return;\n\n    const { chat_id, id } = message;\n\n    TdLibController.send({\n        '@type': 'openMessageContent',\n        chat_id: chat_id,\n        message_id: id\n    });\n\n    const { set_id } = sticker;\n    if (!set_id) return;\n\n    const stickerSet = await TdLibController.send({\n        '@type': 'getStickerSet',\n        set_id\n    });\n\n    if (!stickerSet) return;\n\n    TdLibController.clientUpdate({\n        '@type': 'clientUpdateStickerSet',\n        stickerSet\n    });\n}\n\nfunction openVideo(video, message, fileCancel) {\n    if (!video) return;\n    if (!message) return;\n\n    const { chat_id, id } = message;\n\n    let { video: file } = video;\n    if (!file) return;\n\n    file = FileStore.get(file.id) || file;\n    if (fileCancel && file.local.is_downloading_active) {\n        FileStore.cancelGetRemoteFile(file.id, message);\n        return;\n    } else if (fileCancel && file.remote.is_uploading_active) {\n        FileStore.cancelUploadFile(file.id, message);\n        return;\n    }\n\n    TdLibController.send({\n        '@type': 'openMessageContent',\n        chat_id: chat_id,\n        message_id: id\n    });\n\n    setMediaViewerContent({\n        chatId: chat_id,\n        messageId: id\n    });\n}\n\nfunction openVideoNote(videoNote, message, fileCancel) {\n    if (!videoNote) return;\n    if (!message) return;\n\n    const { chat_id, id } = message;\n\n    let { video: file } = videoNote;\n    if (!file) return;\n\n    file = FileStore.get(file.id) || file;\n    if (fileCancel && file.local.is_downloading_active) {\n        FileStore.cancelGetRemoteFile(file.id, message);\n        return;\n    } else if (fileCancel && file.remote.is_uploading_active) {\n        FileStore.cancelUploadFile(file.id, message);\n        return;\n    }\n\n    download(file, message, () => FileStore.updateVideoNoteBlob(chat_id, id, file.id));\n\n    TdLibController.send({\n        '@type': 'openMessageContent',\n        chat_id: chat_id,\n        message_id: id\n    });\n\n    TdLibController.clientUpdate({\n        '@type': 'clientUpdateMediaActive',\n        chatId: chat_id,\n        messageId: id\n    });\n}\n\nfunction openVoiceNote(voiceNote, message, fileCancel) {\n    if (!voiceNote) return;\n    if (!message) return;\n\n    const { chat_id, id } = message;\n\n    let { voice: file } = voiceNote;\n    if (!file) return;\n\n    file = FileStore.get(file.id) || file;\n    if (fileCancel && file.local.is_downloading_active) {\n        FileStore.cancelGetRemoteFile(file.id, message);\n        return;\n    } else if (fileCancel && file.remote.is_uploading_active) {\n        FileStore.cancelUploadFile(file.id, message);\n        return;\n    } else {\n        download(file, message, () => FileStore.updateVoiceNoteBlob(chat_id, id, file.id));\n    }\n\n    TdLibController.send({\n        '@type': 'openMessageContent',\n        chat_id: chat_id,\n        message_id: id\n    });\n\n    TdLibController.clientUpdate({\n        '@type': 'clientUpdateMediaActive',\n        chatId: chat_id,\n        messageId: id\n    });\n}\n\nfunction openMedia(chatId, messageId, fileCancel = true) {\n    const message = MessageStore.get(chatId, messageId);\n    if (!message) return;\n\n    const { content } = message;\n    if (!content) return null;\n\n    switch (content['@type']) {\n        case 'messageAnimation': {\n            const { animation } = content;\n            if (animation) {\n                openAnimation(animation, message, fileCancel);\n            }\n\n            break;\n        }\n        case 'messageAudio': {\n            const { audio } = content;\n            if (audio) {\n                // openDocument(audio, message, fileCancel);\n                openAudio(audio, message, fileCancel);\n            }\n\n            break;\n        }\n        case 'messageChatChangePhoto': {\n            const { photo } = content;\n            if (photo) {\n                openChatPhoto(photo, message, fileCancel);\n            }\n\n            break;\n        }\n        case 'messageContact': {\n            const { contact } = content;\n            if (contact) {\n                openContact(contact, message, fileCancel);\n            }\n\n            break;\n        }\n        case 'messageDocument': {\n            const { document } = content;\n            if (document) {\n                openDocument(document, message, fileCancel);\n            }\n\n            break;\n        }\n        case 'messageGame': {\n            const { game } = content;\n            if (game) {\n                openGame(game, message, fileCancel);\n            }\n\n            break;\n        }\n        case 'messagePhoto': {\n            const { photo } = content;\n            if (photo) {\n                openPhoto(photo, message, fileCancel);\n            }\n\n            break;\n        }\n        case 'messageSticker': {\n            const { sticker } = content;\n            if (sticker) {\n                openSticker(sticker, message, fileCancel);\n            }\n\n            break;\n        }\n        case 'messageText': {\n            const { web_page } = content;\n            if (web_page) {\n                const { animation, audio, document, photo, sticker, video, video_note, voice_note } = web_page;\n\n                if (animation) {\n                    openAnimation(animation, message, fileCancel);\n                }\n\n                if (audio) {\n                    openAudio(audio, message, fileCancel);\n                }\n\n                if (document) {\n                    openDocument(document, message, fileCancel);\n                }\n\n                if (sticker) {\n                    openSticker(sticker, message, fileCancel);\n                }\n\n                if (video) {\n                    openVideo(video, message, fileCancel);\n                }\n\n                if (video_note) {\n                    openVideoNote(video_note, message, fileCancel);\n                }\n\n                if (voice_note) {\n                    openVoiceNote(voice_note, message, fileCancel);\n                }\n\n                if (photo) {\n                    openPhoto(photo, message, fileCancel);\n                }\n            }\n\n            break;\n        }\n        case 'messageVideo': {\n            const { video } = content;\n            if (video) {\n                openVideo(video, message, fileCancel);\n            }\n\n            break;\n        }\n        case 'messageVideoNote': {\n            const { video_note } = content;\n            if (video_note) {\n                openVideoNote(video_note, message, fileCancel);\n            }\n\n            break;\n        }\n        case 'messageVoiceNote': {\n            const { voice_note } = content;\n            if (voice_note) {\n                openVoiceNote(voice_note, message, fileCancel);\n            }\n\n            break;\n        }\n    }\n}\n\nfunction isDeletedMessage(message) {\n    return message && message['@type'] === 'deletedMessage';\n}\n\nexport function getReplyMinithumbnail(chatId, messageId) {\n    const message = MessageStore.get(chatId, messageId);\n    if (!message) return;\n\n    const { content } = message;\n    if (!content) return null;\n\n    switch (content['@type']) {\n        case 'messageAnimation': {\n            const { animation } = content;\n            if (!animation) return null;\n\n            const { minithumbnail } = animation;\n            return minithumbnail || null;\n        }\n        case 'messageAudio': {\n            return null;\n        }\n        case 'messageChatChangePhoto': {\n            const { photo } = content;\n            if (!photo) return null;\n\n            return photo.minithumbnail || null;\n        }\n        case 'messageDocument': {\n            const { document } = content;\n            if (!document) return null;\n\n            const { minithumbnail } = document;\n            return minithumbnail || null;\n        }\n        case 'messageGame': {\n            const { game } = content;\n            if (!game) return null;\n\n            const { animation, photo } = game;\n            if (animation) {\n                const { minithumbnail } = animation;\n                if (minithumbnail) {\n                    return minithumbnail;\n                }\n            }\n\n            if (photo) {\n                return photo.minithumbnail || null;\n            }\n\n            return null;\n        }\n        case 'messagePhoto': {\n            const { photo } = content;\n            if (!photo) return null;\n\n            return photo.minithumbnail || null;\n        }\n        case 'messageSticker': {\n            return null;\n        }\n        case 'messageText': {\n            const { web_page } = content;\n            if (web_page) {\n                const { animation, audio, document, photo, sticker, video, video_note } = web_page;\n                if (photo) {\n                    return photo.minithumbnail || null;\n                }\n                if (animation) {\n                    const { minithumbnail } = animation;\n                    return minithumbnail || null;\n                }\n                if (audio) {\n                    return null;\n                }\n                if (document) {\n                    const { minithumbnail } = document;\n                    return minithumbnail || null;\n                }\n                if (sticker) {\n                    return null;\n                }\n                if (video) {\n                    const { minithumbnail } = video;\n                    return minithumbnail || null;\n                }\n                if (video_note) {\n                    const { minithumbnail } = video_note;\n                    return minithumbnail || null;\n                }\n            }\n\n            break;\n        }\n        case 'messageVideo': {\n            const { video } = content;\n            if (!video) return null;\n\n            const { minithumbnail } = video;\n            return minithumbnail || null;\n        }\n        case 'messageVideoNote': {\n            const { video_note } = content;\n            if (!video_note) return null;\n\n            const { minithumbnail } = video_note;\n            return minithumbnail || null;\n        }\n    }\n\n    return null;\n}\n\nfunction getReplyPhotoSize(chatId, messageId) {\n    const message = MessageStore.get(chatId, messageId);\n    if (!message) return;\n\n    const { content } = message;\n    if (!content) return null;\n\n    switch (content['@type']) {\n        case 'messageAnimation': {\n            const { animation } = content;\n            if (!animation) return null;\n\n            const { thumbnail } = animation;\n            return thumbnail || null;\n        }\n        case 'messageAudio': {\n            const { audio } = content;\n            if (!audio) return null;\n\n            const { album_cover_thumbnail } = audio;\n            return album_cover_thumbnail || null;\n        }\n        case 'messageChatChangePhoto': {\n            const { photo } = content;\n            if (!photo) return null;\n\n            return getPhotoSize(photo.sizes);\n        }\n        case 'messageDocument': {\n            const { document } = content;\n            if (!document) return null;\n\n            const { thumbnail } = document;\n            return thumbnail || null;\n        }\n        case 'messageGame': {\n            const { game } = content;\n            if (!game) return null;\n\n            const { animation, photo } = game;\n            if (animation) {\n                const { thumbnail } = animation;\n                if (thumbnail) {\n                    return thumbnail;\n                }\n            }\n\n            if (photo) {\n                return getPhotoSize(photo.sizes);\n            }\n\n            return null;\n        }\n        case 'messagePhoto': {\n            const { photo } = content;\n            if (!photo) return null;\n\n            return getPhotoSize(photo.sizes);\n        }\n        case 'messageSticker': {\n            const { sticker } = content;\n            if (!sticker) return null;\n\n            const { thumbnail } = sticker;\n            return thumbnail || null;\n        }\n        case 'messageText': {\n            const { web_page } = content;\n            if (web_page) {\n                const { animation, audio, document, photo, sticker, video, video_note } = web_page;\n                if (photo) {\n                    return getPhotoSize(photo.sizes);\n                }\n                if (animation) {\n                    const { thumbnail } = animation;\n                    return thumbnail || null;\n                }\n                if (audio) {\n                    const { album_cover_thumbnail } = audio;\n                    return album_cover_thumbnail || null;\n                }\n                if (document) {\n                    const { thumbnail } = document;\n                    return thumbnail || null;\n                }\n                if (sticker) {\n                    const { thumbnail } = sticker;\n                    return thumbnail || null;\n                }\n                if (video) {\n                    const { thumbnail } = video;\n                    return thumbnail || null;\n                }\n                if (video_note) {\n                    const { thumbnail } = video_note;\n                    return thumbnail || null;\n                }\n            }\n\n            break;\n        }\n        case 'messageVideo': {\n            const { video } = content;\n            if (!video) return null;\n\n            const { thumbnail } = video;\n            return thumbnail || null;\n        }\n        case 'messageVideoNote': {\n            const { video_note } = content;\n            if (!video_note) return null;\n\n            const { thumbnail } = video_note;\n            return thumbnail || null;\n        }\n    }\n\n    return null;\n}\n\nfunction getEmojiMatches(chatId, messageId) {\n    const message = MessageStore.get(chatId, messageId);\n    if (!message) return 0;\n\n    const { content } = message;\n    if (!content) return 0;\n    if (content['@type'] !== 'messageText') return 0;\n\n    const { text: textContent } = content;\n    if (!textContent) return;\n    if (textContent['@type'] !== 'formattedText') return 0;\n\n    const { text, entities } = textContent;\n    if (!text) return 0;\n    if (entities && entities.length > 0) return 0;\n\n    let lastIndex = 0;\n    let emojiMatches = 0;\n    let m;\n    const re = emojiRegex();\n    do {\n        m = re.exec(text);\n\n        if (m) {\n            emojiMatches += 1;\n            // none-emoji symbol between prev and current emojis or before first\n            if (lastIndex !== m.index) {\n                emojiMatches = 0;\n                break;\n            }\n            // more than 3 emojis in a row\n            if (emojiMatches > 3) {\n                emojiMatches = 0;\n                break;\n            }\n            lastIndex = re.lastIndex;\n        }\n        // none-emoji symbol at the end\n        if (!m && lastIndex !== text.length) {\n            emojiMatches = 0;\n            break;\n        }\n    } while (m);\n\n    return emojiMatches;\n}\n\nfunction messageComparatorDesc(left, right) {\n    return left.id - right.id;\n}\n\nfunction checkInclusion(index, entities) {\n    if (!entities) return false;\n    if (!entities.length) return false;\n\n    for (let i = 0; i < entities.length; i++) {\n        if (index >= entities[i].offset && index < entities[i].offset + entities[i].length) {\n            return true;\n        }\n    }\n\n    return false;\n}\n\nfunction checkIntersection(startIndex, endIndex, entities) {\n    if (!entities) return false;\n    if (!entities.length) return false;\n\n    for (let i = 0; i < entities.length; i++) {\n        if (startIndex <= entities[i].offset && entities[i].offset + entities[i].length - 1 <= endIndex) {\n            return true;\n        }\n    }\n\n    return false;\n}\n\nfunction checkEntity(startIndex, endIndex, entities) {\n    return (\n        !checkInclusion(startIndex, entities) &&\n        !checkInclusion(endIndex, entities) &&\n        !checkIntersection(startIndex, endIndex, entities)\n    );\n}\n\nfunction removeOffsetAfter(start, countToRemove, entities) {\n    if (!entities) return;\n    if (!entities.length) return;\n\n    entities.forEach(e => {\n        if (e.offset > start) {\n            e.offset -= countToRemove;\n        }\n    });\n}\n\nfunction addOffsetAfter(start, countToAdd, entities) {\n    if (!entities) return;\n    if (!entities.length) return;\n\n    entities.forEach(e => {\n        if (e.offset > start) {\n            e.offset += countToAdd;\n        }\n    });\n}\n\nfunction removeEntities(startIndex, endIndex, entities) {\n    if (!entities) return;\n    if (!entities.length) return;\n\n    for (let i = 0; i < entities.length; i++) {\n        const entity = entities[i];\n        const entityStart = entity.offset;\n        const entityEnd = entity.offset + entity.length - 1;\n        if (\n            (startIndex <= entityStart && entityStart <= endIndex) ||\n            (startIndex <= entityEnd && entityEnd <= endIndex) ||\n            (entityStart < startIndex && endIndex > entityEnd)\n        ) {\n            entities.splice(i--, 1);\n        }\n    }\n}\n\nfunction addTextNode(offset, length, text, nodes) {\n    const node = document.createTextNode(text.substr(offset, length));\n    nodes.push(node);\n}\n\nexport function getNodes(text, entities, t = k => k) {\n    if (!text) return [];\n\n    entities = (entities || []).sort((a, b) => {\n        if (a.offset - b.offset !== 0) {\n            return a.offset - b.offset;\n        }\n\n        return b.length - a.length;\n    });\n\n    let nodes = [];\n    let offset = 0;\n    let prevEntity = null;\n    entities.forEach(x => {\n        if (x.offset - offset > 0) {\n            addTextNode(offset, x.offset - offset, text, nodes);\n            offset = x.offset;\n        }\n\n        if (!(prevEntity && checkInclusion(x.offset, [prevEntity]))) {\n            switch (x.type['@type']) {\n                case 'textEntityTypeBold': {\n                    const node = document.createElement('b');\n                    node.innerText = text.substr(x.offset, x.length);\n                    nodes.push(node);\n                    break;\n                }\n                case 'textEntityTypeBotCommand': {\n                    addTextNode(x.offset, x.length, text, nodes);\n                    break;\n                }\n                case 'textEntityTypeCashtag': {\n                    addTextNode(x.offset, x.length, text, nodes);\n                    break;\n                }\n                case 'textEntityTypeCode': {\n                    const node = document.createTextNode('`' + text.substr(x.offset, x.length) + '`');\n                    nodes.push(node);\n                    break;\n                }\n                case 'textEntityTypeEmailAddress': {\n                    addTextNode(x.offset, x.length, text, nodes);\n                    break;\n                }\n                case 'textEntityTypeHashtag': {\n                    addTextNode(x.offset, x.length, text, nodes);\n                    break;\n                }\n                case 'textEntityTypeItalic': {\n                    const node = document.createElement('i');\n                    node.innerText = text.substr(x.offset, x.length);\n                    nodes.push(node);\n                    break;\n                }\n                case 'textEntityTypeMention': {\n                    addTextNode(x.offset, x.length, text, nodes);\n                    break;\n                }\n                case 'textEntityTypeMentionName': {\n                    try {\n                        const { user_id } = x.type;\n                        const user = UserStore.get(user_id);\n                        if (user) {\n                            const node = document.createElement('a');\n                            // node.href = getDecodedUrl(url, false);\n                            node.title = getUserFullName(user_id, null, t);\n                            // node.target = '_blank';\n                            // node.rel = 'noopener noreferrer';\n                            node.dataset.userId = user_id;\n                            node.innerText = text.substr(x.offset, x.length);\n                            nodes.push(node);\n                        } else {\n                            addTextNode(x.offset, x.length, text, nodes);\n                        }\n                    } catch {\n                        addTextNode(x.offset, x.length, text, nodes);\n                    }\n                    break;\n                }\n                case 'textEntityTypePhoneNumber': {\n                    addTextNode(x.offset, x.length, text, nodes);\n                    break;\n                }\n                case 'textEntityTypePre': {\n                    const node = document.createTextNode('```' + text.substr(x.offset, x.length) + '```');\n                    nodes.push(node);\n                    break;\n                }\n                case 'textEntityTypePreCode': {\n                    const node = document.createTextNode('```' + text.substr(x.offset, x.length) + '```');\n                    nodes.push(node);\n                    break;\n                }\n                case 'textEntityTypeTextUrl': {\n                    try {\n                        const { url } = x.type;\n\n                        const node = document.createElement('a');\n                        node.href = getDecodedUrl(url, false);\n                        node.title = getDecodedUrl(url, false);\n                        node.target = '_blank';\n                        node.rel = 'noopener noreferrer';\n                        node.innerText = text.substr(x.offset, x.length);\n                        nodes.push(node);\n                    } catch {\n                        addTextNode(x.offset, x.length, text, nodes);\n                    }\n                    break;\n                }\n                case 'textEntityTypeUrl': {\n                    addTextNode(x.offset, x.length, text, nodes);\n                    break;\n                }\n                default: {\n                    addTextNode(x.offset, x.length, text, nodes);\n                    break;\n                }\n            }\n\n            prevEntity = x;\n            offset += x.length;\n        }\n    });\n\n    if (offset < text.length) {\n        addTextNode(offset, text.length - offset, text, nodes);\n    }\n\n    return nodes;\n}\n\n// based on code from official Android Telegram client\n// https://github.com/DrKLO/Telegram/blob/28eb8dfd0ef959fd5ad7d5d22f1d32879707c0a0/TMessagesProj/src/main/java/org/telegram/messenger/MediaDataController.java#L3782\nexport function getEntities(text) {\n    const entities = [];\n    if (!text) return { text, entities };\n\n    text = text.replace(/<div><br><\\/div>/gi, '<br>');\n    text = text.replace(/<div>/gi, '<br>');\n    text = text.replace(/<\\/div>/gi, '');\n\n    text = text.split('<br>').join('\\n');\n\n    // console.log(`[ge] start text=${text}`);\n\n    let index = -1; // first index of end tag\n    let lastIndex = 0; // first index after end tag\n    let start = -1; // first index of start tag\n    let isPre = false;\n    const mono = '`';\n    const pre = '```';\n    const bold = '**';\n    const italic = '__';\n\n    // 0 looking for html entities\n    const result = new DOMParser().parseFromString(text, 'text/html');\n    let offset = 0;\n    let length = 0;\n    let finalText = '';\n    result.body.childNodes.forEach(node => {\n        const { textContent, nodeName } = node;\n\n        length = textContent.length;\n        finalText += textContent;\n\n        if (!checkEntity(offset, offset + length - 1, entities)) {\n            return;\n        }\n\n        switch (nodeName) {\n            case '#text': {\n                offset += length;\n                break;\n            }\n            case 'A': {\n                if (node.dataset.userId) {\n                    entities.push({\n                        '@type': 'textEntity',\n                        offset,\n                        length,\n                        type: { '@type': 'textEntityTypeMentionName', user_id: node.dataset.userId },\n                        textContent: finalText.substring(offset, offset + length)\n                    });\n                } else if (node.href) {\n                    entities.push({\n                        '@type': 'textEntity',\n                        offset,\n                        length,\n                        type: { '@type': 'textEntityTypeTextUrl', url: node.href },\n                        textContent: finalText.substring(offset, offset + length)\n                    });\n                }\n                offset += length;\n                break;\n            }\n            case 'B':\n            case 'STRONG': {\n                entities.push({\n                    '@type': 'textEntity',\n                    offset,\n                    length,\n                    type: { '@type': 'textEntityTypeBold' },\n                    textContent: finalText.substring(offset, offset + length)\n                });\n                offset += length;\n                break;\n            }\n            case 'BR': {\n                break;\n            }\n            case 'CODE': {\n                entities.push({\n                    '@type': 'textEntity',\n                    offset,\n                    length,\n                    type: { '@type': 'textEntityTypeCode' },\n                    textContent: finalText.substring(offset, offset + length)\n                });\n                offset += length;\n                break;\n            }\n            case 'I':\n            case 'EM': {\n                entities.push({\n                    '@type': 'textEntity',\n                    offset,\n                    length,\n                    type: { '@type': 'textEntityTypeItalic' },\n                    textContent: finalText.substring(offset, offset + length)\n                });\n                offset += length;\n                break;\n            }\n            case 'PRE': {\n                entities.push({\n                    '@type': 'textEntity',\n                    offset,\n                    length,\n                    type: { '@type': 'textEntityTypePre' },\n                    textContent: finalText.substring(offset, offset + length)\n                });\n                offset += length;\n                break;\n            }\n            default: {\n                offset += length;\n                break;\n            }\n        }\n    });\n    text = finalText;\n    // console.log(`[ge] HTML nodes text=${text}`, entities);\n\n    // 1 looking for ``` and ` in order to find mono and pre entities\n    while ((index = text.indexOf(isPre ? pre : mono, lastIndex)) !== -1) {\n        if (start === -1) {\n            // find start tag\n            isPre = text.length - index > 2 && text[index + 1] === mono && text[index + 2] === mono;\n            start = index;\n            lastIndex = index + (isPre ? 3 : 1);\n        } else {\n            // find end tag\n            for (let i = index + (isPre ? 3 : 1); i < text.length; i++) {\n                if (text[i] === mono) {\n                    index++;\n                } else {\n                    break;\n                }\n            }\n\n            lastIndex = index + (isPre ? 3 : 1);\n            if (isPre) {\n                // add pre tag\n\n                let textBefore = text.substring(0, start);\n                let textContent = text.substring(start + 3, index);\n                let textAfter = text.substring(index + 3, text.length);\n\n                if (textContent.length > 0) {\n                    offset = start;\n                    length = index - start - 3;\n\n                    text = textBefore + textContent + textAfter;\n\n                    const entity = {\n                        '@type': 'textEntity',\n                        offset,\n                        length,\n                        language: '',\n                        type: { '@type': 'textEntityTypePre' },\n                        textContent: text.substring(offset, offset + length)\n                    };\n                    removeEntities(offset, offset + length - 1 + 6);\n                    removeOffsetAfter(offset + length, 6, entities);\n                    entities.push(entity);\n                    lastIndex -= 6;\n\n                    // clean text before\n                    if (textBefore.length > 0) {\n                        const lastChar = textBefore[textBefore.length - 1];\n                        if (lastChar !== '\\n') {\n                            if (lastChar === ' ' || lastChar === '\\xA0') {\n                                textBefore = textBefore.substr(0, textBefore.length - 1) + '\\n';\n                                text = textBefore + textContent + textAfter;\n                            } else {\n                                textBefore += '\\n';\n                                text = textBefore + textContent + textAfter;\n                                addOffsetAfter(offset - 1, 1, entities);\n                                lastIndex += 1;\n                            }\n                        }\n                    }\n\n                    // clean text after\n                    if (textAfter.length > 0) {\n                        const firstChar = textAfter[0];\n                        if (firstChar !== '\\n') {\n                            if (firstChar === ' ' || firstChar === '\\xA0') {\n                                textAfter = '\\n' + textAfter.substr(1);\n                                text = textBefore + textContent + textAfter;\n                            } else {\n                                textAfter = '\\n' + textAfter;\n                                text = textBefore + textContent + textAfter;\n                                addOffsetAfter(offset + length - 1, 1, entities);\n                                lastIndex += 1;\n                            }\n                        }\n                    }\n\n                    // clean text content\n                    if (textContent.length > 2) {\n                        if (textContent[0] === '\\n') {\n                            textContent = textContent.substring(1);\n                            text = textBefore + textContent + textAfter;\n                            entity.length -= 1;\n                            entity.textContent = textContent;\n                            removeOffsetAfter(entity.offset + entity.length - 1, 1, entities);\n                            lastIndex -= 1;\n                        }\n                    }\n\n                    if (textContent.length > 2) {\n                        if (textContent[textContent.length - 1] === '\\n') {\n                            textContent = textContent.substring(0, textContent.length - 1);\n                            text = textBefore + textContent + textAfter;\n                            entity.length -= 1;\n                            entity.textContent = textContent;\n                            removeOffsetAfter(entity.offset + entity.length - 1, 1, entities);\n                            lastIndex -= 1;\n                        }\n                    }\n                }\n            } else {\n                // add code tag\n                if (start + 1 !== index) {\n                    offset = start;\n                    length = index - start - 1;\n\n                    text =\n                        text.substring(0, start) +\n                        text.substring(start + 1, index) +\n                        text.substring(index + 1, text.length);\n\n                    const entity = {\n                        '@type': 'textEntity',\n                        offset,\n                        length,\n                        type: { '@type': 'textEntityTypeCode' },\n                        textContent: text.substring(offset, offset + length)\n                    };\n                    removeEntities(offset, offset + length - 1 + 2);\n                    removeOffsetAfter(offset + length, 2, entities);\n                    entities.push(entity);\n                    lastIndex -= 2;\n                }\n            }\n\n            start = -1;\n            isPre = false;\n        }\n    }\n\n    // 1.1 case when ``` is one ` mono symbol\n    if (start !== -1 && isPre) {\n        offset = start;\n        length = 1;\n\n        if (checkEntity(offset, offset + length + 2 - 1, entities)) {\n            text = text.substring(0, start) + text.substring(start + 2, text.length);\n\n            const entity = {\n                '@type': 'textEntity',\n                offset,\n                length,\n                type: { '@type': 'textEntityTypeCode' },\n                textContent: text.substring(offset, offset + length)\n            };\n            removeEntities(offset, offset + length - 1 + 2);\n            removeOffsetAfter(offset + length, 2, entities);\n            entities.push(entity);\n        }\n    }\n\n    // console.log(`[ge] pre and code text=${text}`, entities);\n    // 2 looking for bold, italic entities\n    for (let c = 0; c < 2; c++) {\n        lastIndex = 0;\n        start = -1;\n        const checkString = c === 0 ? bold : italic;\n        const checkChar = c === 0 ? '*' : '_';\n        while ((index = text.indexOf(checkString, lastIndex)) !== -1) {\n            if (start === -1) {\n                const prevChar = index === 0 ? ' ' : text[index - 1];\n                if (\n                    !checkInclusion(index, entities) &&\n                    (prevChar === ' ' || prevChar === '\\xA0' || prevChar === '\\n')\n                ) {\n                    start = index;\n                }\n                lastIndex = index + 2;\n            } else {\n                for (let a = index + 2; a < text.length; a++) {\n                    if (text[a] === checkChar) {\n                        index++;\n                    } else {\n                        break;\n                    }\n                }\n                lastIndex = index + 2;\n                if (checkInclusion(index, entities) || checkIntersection(start, index, entities)) {\n                    start = -1;\n                    continue;\n                }\n                if (start + 2 !== index) {\n                    offset = start;\n                    length = index - start - 2;\n                    text =\n                        text.substring(0, start) +\n                        text.substring(start + 2, index) +\n                        text.substring(index + 2, text.length);\n\n                    const entity = {\n                        '@type': 'textEntity',\n                        offset,\n                        length,\n                        language: '',\n                        type: { '@type': c === 0 ? 'textEntityTypeBold' : 'textEntityTypeItalic' },\n                        textContent: text.substring(offset, offset + length)\n                    };\n                    removeOffsetAfter(offset + length, 4, entities);\n                    entities.push(entity);\n                    lastIndex -= 4;\n                }\n                start = -1;\n            }\n        }\n    }\n    // console.log(`[ge] result text=${text}`, entities);\n\n    return { text, entities };\n}\n\nexport function canMessageBeEdited(chatId, messageId) {\n    const message = MessageStore.get(chatId, messageId);\n    if (!message) return false;\n\n    const { can_be_edited } = message;\n\n    return can_be_edited;\n}\n\nexport function showMessageForward(chatId, messageId) {\n    const message = MessageStore.get(chatId, messageId);\n    if (!message) return false;\n\n    const { forward_info, content } = message;\n\n    return forward_info && content && content['@type'] !== 'messageSticker' && content['@type'] !== 'messageAudio';\n}\n\nexport function isTextMessage(chatId, messageId) {\n    const message = MessageStore.get(chatId, messageId);\n    if (!message) return false;\n\n    const { content } = message;\n\n    return content && content['@type'] === 'messageText';\n}\n\nexport function isMessagePinned(chatId, messageId) {\n    const chat = ChatStore.get(chatId);\n    if (!chat) return false;\n\n    return chat.pinned_message_id === messageId;\n}\n\nexport function canMessageBeUnvoted(chatId, messageId) {\n    const message = MessageStore.get(chatId, messageId);\n    if (!message) return false;\n\n    const { content } = message;\n    if (!content) return;\n    if (content['@type'] !== 'messagePoll') return;\n\n    const { poll } = content;\n    if (!poll) return false;\n\n    const { type, is_closed, options } = poll;\n    if (!type) return false;\n    if (type['@type'] !== 'pollTypeRegular') return false;\n    if (is_closed) return false;\n\n    return options.some(x => x.is_chosen || x.is_being_chosen);\n}\n\nexport function canMessageBeClosed(chatId, messageId) {\n    const message = MessageStore.get(chatId, messageId);\n    if (!message) return false;\n\n    const { content, can_be_edited } = message;\n    if (!content) return;\n    if (content['@type'] !== 'messagePoll') return;\n\n    return can_be_edited;\n}\n\nexport function canMessageBeForwarded(chatId, messageId) {\n    const message = MessageStore.get(chatId, messageId);\n\n    return message && message.can_be_forwarded;\n}\n\nexport function canMessageBeDeleted(chatId, messageId) {\n    const message = MessageStore.get(chatId, messageId);\n\n    return message && (message.can_be_deleted_only_for_self || message.can_be_deleted_for_all_users);\n}\n\nexport function getMessageStyle(chatId, messageId) {\n    const message = MessageStore.get(chatId, messageId);\n    if (!message) return null;\n\n    const { content } = message;\n    if (!content) return null;\n\n    switch (content['@type']) {\n        case 'messageAnimation': {\n            const { animation } = content;\n            if (!animation) return null;\n\n            const { width, height, thumbnail } = animation;\n\n            const size = { width, height } || thumbnail;\n            if (!size) return null;\n\n            const fitSize = getFitSize(size, PHOTO_DISPLAY_SIZE, false);\n            if (!fitSize) return null;\n\n            return { width: fitSize.width };\n        }\n        case 'messagePhoto': {\n            const { photo } = content;\n            if (!photo) return null;\n\n            const size = getSize(photo.sizes, PHOTO_SIZE);\n            if (!size) return null;\n\n            const fitSize = getFitSize(size, PHOTO_DISPLAY_SIZE, false);\n            if (!fitSize) return null;\n\n            return { width: fitSize.width };\n        }\n        case 'messageVideo': {\n            const { video } = content;\n            if (!video) return null;\n\n            const { thumbnail, width, height } = video;\n\n            const size = { width, height } || thumbnail;\n            if (!size) return null;\n\n            const fitSize = getFitSize(size, PHOTO_DISPLAY_SIZE);\n            if (!fitSize) return null;\n\n            return { width: fitSize.width };\n        }\n    }\n\n    return null;\n}\n\nexport {\n    getAuthor,\n    getTitle,\n    getText,\n    getFormattedText,\n    getWebPage,\n    getContent,\n    getDate,\n    getDateHint,\n    isForwardOriginHidden,\n    getForwardTitle,\n    getUnread,\n    getSenderUserId,\n    filterDuplicateMessages,\n    filterMessages,\n    isMediaContent,\n    isDeletedMessage,\n    isVideoMessage,\n    isAnimationMessage,\n    isLottieMessage,\n    getLocationId,\n    isContentOpened,\n    getMediaTitle,\n    hasAudio,\n    hasVideoNote,\n    getSearchMessagesFilter,\n    openMedia,\n    getReplyPhotoSize,\n    getEmojiMatches,\n    messageComparatorDesc,\n    substring,\n    stopPropagation\n};\n"]},"metadata":{},"sourceType":"module"}