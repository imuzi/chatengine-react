{"ast":null,"code":"import _regeneratorRuntime from \"/Users/wubenqi/nebula-chat/telegram-react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _toConsumableArray from \"/Users/wubenqi/nebula-chat/telegram-react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _asyncToGenerator from \"/Users/wubenqi/nebula-chat/telegram-react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\n/*\n *  Copyright (c) 2018-present, Evgeny Nadymov\n *\n * This source code is licensed under the GPL v.3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\nimport { getPhotoSize, getPhotoThumbnailSize, getSize } from './Common';\nimport { getChatUserId } from './Chat';\nimport { getProfilePhoto } from './User';\nimport { getLocationId } from './Message';\nimport { FILE_PRIORITY, IV_LOCATION_HEIGHT, IV_LOCATION_WIDTH, IV_PHOTO_SIZE, LOCATION_HEIGHT, LOCATION_SCALE, LOCATION_WIDTH, LOCATION_ZOOM, PHOTO_BIG_SIZE, PHOTO_SIZE, PRELOAD_ANIMATION_SIZE, PRELOAD_AUDIO_SIZE, PRELOAD_DOCUMENT_SIZE, PRELOAD_STICKER_SIZE, PRELOAD_VIDEO_SIZE, PRELOAD_VIDEONOTE_SIZE, PRELOAD_VOICENOTE_SIZE, THUMBNAIL_PRIORITY } from '../Constants';\nimport ChatStore from '../Stores/ChatStore';\nimport FileStore from '../Stores/FileStore';\nimport MessageStore from '../Stores/MessageStore';\nimport UserStore from '../Stores/UserStore';\nimport TdLibController from '../Controllers/TdLibController';\n\nfunction getSizeString(size) {\n  if (!size) return \"0 B\";\n\n  if (size < 1024) {\n    return \"\".concat(size, \" B\");\n  }\n\n  if (size < 1024 * 1024) {\n    return \"\".concat((size / 1024).toFixed(1), \" KB\");\n  }\n\n  if (size < 1024 * 1024 * 1024) {\n    return \"\".concat((size / 1024 / 1024).toFixed(1), \" MB\");\n  }\n\n  return \"\".concat((size / 1024 / 1024 / 1024).toFixed(1), \" GB\");\n}\n\nfunction getFileSize(file) {\n  if (!file) return '';\n  var size = file.size;\n  if (!size) return '';\n  return getSizeString(size);\n}\n\nfunction getBigPhoto(photo) {\n  if (!photo) return null;\n  return photo.big;\n}\n\nfunction saveData(data, filename, mime) {\n  var blob = new Blob([data], {\n    type: mime || 'application/octet-stream'\n  });\n\n  if (typeof window.navigator.msSaveBlob !== 'undefined') {\n    // IE workaround for \"HTML7007: One or more blob URLs were\n    // revoked by closing the blob for which they were created.\n    // These URLs will no longer resolve as the data backing\n    // the URL has been freed.\"\n    window.navigator.msSaveBlob(blob, filename);\n  } else {\n    var blobURL = window.URL.createObjectURL(blob);\n    var tempLink = document.createElement('a');\n    tempLink.style.display = 'none';\n    tempLink.href = blobURL;\n    tempLink.setAttribute('download', filename); // Safari thinks _blank anchor are pop ups. We only want to set _blank\n    // target if the browser does not support the HTML5 download attribute.\n    // This allows you to download files in desktop safari if pop up blocking\n    // is enabled.\n\n    if (typeof tempLink.download === 'undefined') {\n      tempLink.setAttribute('target', '_blank');\n    }\n\n    document.body.appendChild(tempLink);\n    tempLink.click();\n    document.body.removeChild(tempLink);\n    window.URL.revokeObjectURL(blobURL);\n  }\n}\n\nfunction saveBlob(blob, filename) {\n  if (typeof window.navigator.msSaveBlob !== 'undefined') {\n    // IE workaround for \"HTML7007: One or more blob URLs were\n    // revoked by closing the blob for which they were created.\n    // These URLs will no longer resolve as the data backing\n    // the URL has been freed.\"\n    window.navigator.msSaveBlob(blob, filename);\n  } else {\n    var blobURL = window.URL.createObjectURL(blob);\n    var tempLink = document.createElement('a');\n    tempLink.style.display = 'none';\n    tempLink.href = blobURL;\n    tempLink.setAttribute('download', filename); // Safari thinks _blank anchor are pop ups. We only want to set _blank\n    // target if the browser does not support the HTML5 download attribute.\n    // This allows you to download files in desktop safari if pop up blocking\n    // is enabled.\n\n    if (typeof tempLink.download === 'undefined') {\n      tempLink.setAttribute('target', '_blank');\n    }\n\n    document.body.appendChild(tempLink);\n    tempLink.click();\n    document.body.removeChild(tempLink);\n    window.URL.revokeObjectURL(blobURL);\n  }\n}\n\nfunction loadReplies(_x, _x2, _x3) {\n  return _loadReplies.apply(this, arguments);\n}\n\nfunction _loadReplies() {\n  _loadReplies = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee(store, chatId, messageIds) {\n    var result, i;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            if (chatId) {\n              _context.next = 2;\n              break;\n            }\n\n            return _context.abrupt(\"return\");\n\n          case 2:\n            if (messageIds) {\n              _context.next = 4;\n              break;\n            }\n\n            return _context.abrupt(\"return\");\n\n          case 4:\n            if (messageIds.length) {\n              _context.next = 6;\n              break;\n            }\n\n            return _context.abrupt(\"return\");\n\n          case 6:\n            _context.next = 8;\n            return TdLibController.send({\n              '@type': 'getMessages',\n              chat_id: chatId,\n              message_ids: messageIds\n            });\n\n          case 8:\n            result = _context.sent;\n            result.messages = result.messages.map(function (message, i) {\n              return message || {\n                '@type': 'deletedMessage',\n                chat_id: chatId,\n                id: messageIds[i],\n                content: null\n              };\n            });\n            MessageStore.setItems(result.messages);\n\n            for (i = messageIds.length - 1; i >= 0; i--) {\n              MessageStore.emit('getMessageResult', MessageStore.get(chatId, messageIds[i]));\n            }\n\n            store = FileStore.getStore();\n            loadReplyContents(store, result.messages);\n\n          case 14:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n  return _loadReplies.apply(this, arguments);\n}\n\nfunction loadReplyContents(store, messages) {\n  for (var i = messages.length - 1; i >= 0; i--) {\n    var message = messages[i];\n\n    if (!message) {\n      continue;\n    }\n\n    var content = message.content;\n\n    if (content) {\n      switch (content['@type']) {\n        case 'messageAnimation':\n          {\n            var animation = content.animation;\n            loadAnimationThumbnailContent(store, animation, message);\n            break;\n          }\n\n        case 'messageAudio':\n          {\n            var audio = content.audio;\n            loadAudioThumbnailContent(store, audio, message);\n            break;\n          }\n\n        case 'messageChatChangePhoto':\n          {\n            var photo = content.photo;\n            loadPhotoContent(store, photo, message);\n            break;\n          }\n\n        case 'messageDocument':\n          {\n            var _document = content.document;\n            loadDocumentThumbnailContent(store, _document, message);\n            break;\n          }\n\n        case 'messageGame':\n          {\n            var game = content.game;\n            loadGameThumbnailContent(store, game, message);\n            break;\n          }\n\n        case 'messagePhoto':\n          {\n            var _photo = content.photo;\n            loadPhotoContent(store, _photo, message);\n            break;\n          }\n\n        case 'messageSticker':\n          {\n            var sticker = content.sticker;\n            loadStickerThumbnailContent(store, sticker, message);\n            break;\n          }\n\n        case 'messageText':\n          {\n            var web_page = content.web_page;\n            if (!web_page) break;\n            var _animation = web_page.animation,\n                _audio = web_page.audio,\n                _document2 = web_page.document,\n                _photo2 = web_page.photo,\n                _sticker = web_page.sticker,\n                video = web_page.video,\n                video_note = web_page.video_note;\n\n            if (_photo2) {\n              loadPhotoContent(store, _photo2, message);\n              break;\n            }\n\n            if (_animation) {\n              loadAnimationThumbnailContent(store, _animation, message);\n              break;\n            }\n\n            if (_audio) {\n              loadAudioThumbnailContent(store, _audio, message);\n              break;\n            }\n\n            if (_document2) {\n              loadDocumentThumbnailContent(store, _document2, message);\n              break;\n            }\n\n            if (_sticker) {\n              loadStickerThumbnailContent(store, _sticker, message);\n              break;\n            }\n\n            if (video) {\n              loadVideoThumbnailContent(store, video, message);\n              break;\n            }\n\n            if (video_note) {\n              loadVideoNoteThumbnailContent(store, video_note, message);\n              break;\n            }\n\n            break;\n          }\n\n        case 'messageVideo':\n          {\n            var _video = content.video;\n            loadVideoThumbnailContent(store, _video, message);\n            break;\n          }\n\n        case 'messageVideoNote':\n          {\n            var _video_note = content.video_note;\n            loadVideoNoteThumbnailContent(store, _video_note, message);\n            break;\n          }\n      }\n    }\n  }\n}\n\nfunction loadAudioContent(store, audio, message) {\n  var useFileSize = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : true;\n  if (!audio) return;\n  var file = audio.audio;\n  if (!file) return;\n  file = FileStore.get(file.id) || file;\n  var _file = file,\n      id = _file.id,\n      size = _file.size;\n  var blob = FileStore.getBlob(id);\n  if (blob) return;\n  var chatId = message ? message.chat_id : 0;\n  var messageId = message ? message.id : 0;\n  FileStore.getLocalFile(store, file, null, function () {\n    return FileStore.updateAudioBlob(chatId, messageId, id);\n  }, function () {\n    if (!useFileSize || size && size < PRELOAD_AUDIO_SIZE) {\n      FileStore.getRemoteFile(id, FILE_PRIORITY, message || audio);\n    }\n  });\n}\n\nfunction loadAudioThumbnailContent(store, audio, message) {\n  if (!audio) return false;\n  var photoSize = audio.album_cover_thumbnail;\n  if (!photoSize) return false;\n  var file = photoSize.photo;\n  if (!file) return false;\n  file = FileStore.get(file.id) || file;\n  var _file2 = file,\n      id = _file2.id;\n  var blob = FileStore.getBlob(file.id);\n  if (blob) return true;\n  var chatId = message ? message.chat_id : 0;\n  var messageId = message ? message.id : 0;\n  FileStore.getLocalFile(store, file, null, function () {\n    return FileStore.updateAudioThumbnailBlob(chatId, messageId, id);\n  }, function () {\n    return FileStore.getRemoteFile(id, THUMBNAIL_PRIORITY, message || audio);\n  });\n  return true;\n}\n\nfunction cancelLoadAnimationContent(animation) {\n  var file = animation.animation;\n  if (!file) return;\n  var id = file.id;\n  var blob = file.blob || FileStore.getBlob(id);\n  if (blob) return;\n  FileStore.cancelGetRemoteFile(id);\n}\n\nfunction loadAnimationContent(store, animation, message) {\n  var useFileSize = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : true;\n  if (!animation) return;\n  var file = animation.animation;\n  if (!file) return;\n  file = FileStore.get(file.id) || file;\n  var _file3 = file,\n      id = _file3.id,\n      size = _file3.size;\n  var blob = FileStore.getBlob(id);\n  if (blob) return;\n  var chatId = message ? message.chat_id : 0;\n  var messageId = message ? message.id : 0;\n  FileStore.getLocalFile(store, file, null, function () {\n    return FileStore.updateAnimationBlob(chatId, messageId, id);\n  }, function () {\n    if (!useFileSize || size && size < PRELOAD_ANIMATION_SIZE) {\n      FileStore.getRemoteFile(id, FILE_PRIORITY, message || animation);\n    }\n  });\n}\n\nfunction cancelLoadAnimationThumbnailContent(animation) {\n  if (!animation) return;\n  var photoSize = animation.thumbnail;\n  if (!photoSize) return;\n  var file = photoSize.photo;\n  if (!file) return;\n  file = FileStore.get(file.id) || file;\n  var _file4 = file,\n      id = _file4.id;\n  var blob = FileStore.getBlob(id);\n  if (blob) return;\n  FileStore.cancelGetRemoteFile(id);\n}\n\nfunction loadAnimationThumbnailContent(store, animation, message) {\n  if (!animation) return false;\n  var photoSize = animation.thumbnail;\n  if (!photoSize) return false;\n  var file = photoSize.photo;\n  if (!file) return false;\n  file = FileStore.get(file.id) || file;\n  var _file5 = file,\n      id = _file5.id;\n  var blob = FileStore.getBlob(file.id);\n  if (blob) return true;\n  var chatId = message ? message.chat_id : 0;\n  var messageId = message ? message.id : 0;\n  FileStore.getLocalFile(store, file, null, function () {\n    return FileStore.updateAnimationThumbnailBlob(chatId, messageId, id);\n  }, function () {\n    return FileStore.getRemoteFile(id, THUMBNAIL_PRIORITY, message || animation);\n  });\n  return true;\n}\n\nfunction loadContactContent(store, contact, message) {\n  if (!contact) return;\n  if (!message) return;\n  var user_id = contact.user_id;\n  var user = UserStore.get(user_id);\n  if (!user) return;\n  loadUserContent(store, user);\n}\n\nfunction loadDocumentContent(store, document, message) {\n  var useFileSize = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : true;\n  if (!document) return;\n  var file = document.document;\n  if (!file) return;\n  file = FileStore.get(file.id) || file;\n  var _file6 = file,\n      id = _file6.id,\n      size = _file6.size;\n  var blob = FileStore.getBlob(id);\n  if (blob) return;\n  var chatId = message ? message.chat_id : 0;\n  var messageId = message ? message.id : 0;\n  FileStore.getLocalFile(store, file, null, function () {\n    return FileStore.updateDocumentBlob(chatId, messageId, id);\n  }, function () {\n    if (!useFileSize || size && size < PRELOAD_DOCUMENT_SIZE) {\n      FileStore.getRemoteFile(id, FILE_PRIORITY, message || document);\n    }\n  });\n}\n\nfunction loadDocumentThumbnailContent(store, document, message) {\n  if (!document) return false;\n  var photoSize = document.thumbnail;\n  if (!photoSize) return false;\n  var file = photoSize.photo;\n  if (!file) return false;\n  file = FileStore.get(file.id) || file;\n  var _file7 = file,\n      id = _file7.id;\n  var blob = FileStore.getBlob(file.id);\n  if (blob) return true;\n  var chatId = message ? message.chat_id : 0;\n  var messageId = message ? message.id : 0;\n  FileStore.getLocalFile(store, file, null, function () {\n    return FileStore.updateDocumentThumbnailBlob(chatId, messageId, id);\n  }, function () {\n    return FileStore.getRemoteFile(id, THUMBNAIL_PRIORITY, message || document);\n  });\n  return true;\n}\n\nfunction loadGameContent(store, game, message) {\n  var useFileSize = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : true;\n  if (!game) return;\n  var animation = game.animation;\n  loadAnimationContent(store, animation, message, useFileSize);\n}\n\nfunction loadGameThumbnailContent(store, game, message) {\n  if (!game) return false;\n  var photo = game.photo,\n      animation = game.animation;\n\n  if (loadAnimationThumbnailContent(store, animation, message)) {\n    return true;\n  }\n\n  loadPhotoContent(store, photo, message);\n  return true;\n}\n\nfunction loadPageBlockMapContent(_x4, _x5, _x6) {\n  return _loadPageBlockMapContent.apply(this, arguments);\n}\n\nfunction _loadPageBlockMapContent() {\n  _loadPageBlockMapContent = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee2(store, pageBlockMap, message) {\n    var location, locationId, file, _file31, id, blob, chatId, messageId;\n\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            if (pageBlockMap) {\n              _context2.next = 2;\n              break;\n            }\n\n            return _context2.abrupt(\"return\");\n\n          case 2:\n            location = pageBlockMap.location;\n            locationId = getLocationId(location, IV_LOCATION_WIDTH, IV_LOCATION_HEIGHT);\n\n            if (locationId) {\n              _context2.next = 6;\n              break;\n            }\n\n            return _context2.abrupt(\"return\");\n\n          case 6:\n            file = FileStore.getLocationFile(locationId);\n\n            if (file) {\n              _context2.next = 13;\n              break;\n            }\n\n            _context2.next = 10;\n            return TdLibController.send({\n              '@type': 'getMapThumbnailFile',\n              location: location,\n              width: IV_LOCATION_WIDTH,\n              height: IV_LOCATION_HEIGHT,\n              zoom: LOCATION_ZOOM,\n              scale: LOCATION_SCALE,\n              chat_id: message ? message.chat_id : 0\n            });\n\n          case 10:\n            file = _context2.sent;\n            FileStore.setLocationFile(locationId, file);\n            store = FileStore.getStore();\n\n          case 13:\n            file = FileStore.get(file.id) || file;\n            _file31 = file, id = _file31.id;\n            blob = FileStore.getBlob(file.id);\n\n            if (!blob) {\n              _context2.next = 18;\n              break;\n            }\n\n            return _context2.abrupt(\"return\");\n\n          case 18:\n            chatId = message ? message.chat_id : 0;\n            messageId = message ? message.id : 0;\n            FileStore.getLocalFile(store, file, null, function () {\n              return FileStore.updateLocationBlob(chatId, messageId, id);\n            }, function () {\n              return FileStore.getRemoteFile(id, FILE_PRIORITY, message || pageBlockMap);\n            });\n\n          case 21:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n  return _loadPageBlockMapContent.apply(this, arguments);\n}\n\nfunction loadLocationContent(_x7, _x8, _x9) {\n  return _loadLocationContent.apply(this, arguments);\n}\n\nfunction _loadLocationContent() {\n  _loadLocationContent = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee3(store, location, message) {\n    var locationId, file, _file32, id, blob, chatId, messageId;\n\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            if (location) {\n              _context3.next = 2;\n              break;\n            }\n\n            return _context3.abrupt(\"return\");\n\n          case 2:\n            locationId = getLocationId(location);\n\n            if (locationId) {\n              _context3.next = 5;\n              break;\n            }\n\n            return _context3.abrupt(\"return\");\n\n          case 5:\n            file = FileStore.getLocationFile(locationId);\n\n            if (file) {\n              _context3.next = 12;\n              break;\n            }\n\n            _context3.next = 9;\n            return TdLibController.send({\n              '@type': 'getMapThumbnailFile',\n              location: location,\n              width: LOCATION_WIDTH,\n              height: LOCATION_HEIGHT,\n              zoom: LOCATION_ZOOM,\n              scale: LOCATION_SCALE,\n              chat_id: message ? message.chat_id : 0\n            });\n\n          case 9:\n            file = _context3.sent;\n            FileStore.setLocationFile(locationId, file);\n            store = FileStore.getStore();\n\n          case 12:\n            file = FileStore.get(file.id) || file;\n            _file32 = file, id = _file32.id;\n            blob = FileStore.getBlob(file.id);\n\n            if (!blob) {\n              _context3.next = 17;\n              break;\n            }\n\n            return _context3.abrupt(\"return\");\n\n          case 17:\n            chatId = message ? message.chat_id : 0;\n            messageId = message ? message.id : 0;\n            FileStore.getLocalFile(store, file, null, function () {\n              return FileStore.updateLocationBlob(chatId, messageId, id);\n            }, function () {\n              return FileStore.getRemoteFile(id, FILE_PRIORITY, message || location);\n            });\n\n          case 20:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3);\n  }));\n  return _loadLocationContent.apply(this, arguments);\n}\n\nfunction cancelLoadBigPhotoContent(photo) {\n  if (!photo) return;\n  var sizes = photo.sizes;\n  if (!sizes) return;\n  var photoSize = getSize(sizes, PHOTO_BIG_SIZE);\n  if (!photoSize) return;\n  var file = photoSize.photo;\n  if (!file) return;\n  file = FileStore.get(file.id) || file;\n  var _file8 = file,\n      id = _file8.id;\n  var blob = FileStore.getBlob(id);\n  if (blob) return;\n  FileStore.cancelGetRemoteFile(id);\n}\n\nfunction loadBigPhotoContent(store, photo, message) {\n  if (!photo) return;\n  var sizes = photo.sizes;\n  if (!sizes) return;\n  var photoSize = getSize(sizes, PHOTO_BIG_SIZE);\n  if (!photoSize) return;\n  var file = photoSize.photo;\n  if (!file) return;\n  file = FileStore.get(file.id) || file;\n  var _file9 = file,\n      id = _file9.id;\n  var blob = FileStore.getBlob(id);\n  if (blob) return;\n  var chatId = message ? message.chat_id : 0;\n  var messageId = message ? message.id : 0;\n  FileStore.getLocalFile(store, file, null, function () {\n    return FileStore.updatePhotoBlob(chatId, messageId, id);\n  }, function () {\n    return FileStore.getRemoteFile(id, FILE_PRIORITY, message || photo);\n  });\n}\n\nfunction loadPhotoContent(store, photo, message) {\n  var displaySize = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : PHOTO_SIZE;\n  if (!photo) return;\n  var sizes = photo.sizes;\n  if (!sizes) return;\n  var photoSize = getPhotoSize(sizes, displaySize);\n  if (!photoSize) return;\n  var file = photoSize.photo;\n  if (!file) return;\n  file = FileStore.get(file.id) || file;\n  var _file10 = file,\n      id = _file10.id;\n  var blob = FileStore.getBlob(id);\n  if (blob) return;\n  var chatId = message ? message.chat_id : 0;\n  var messageId = message ? message.id : 0;\n  FileStore.getLocalFile(store, file, null, function () {\n    return FileStore.updatePhotoBlob(chatId, messageId, id);\n  }, function () {\n    return FileStore.getRemoteFile(id, FILE_PRIORITY, message || photo);\n  });\n}\n\nfunction loadPhotoThumbnailContent(store, photo, message) {\n  if (!photo) return false;\n  if (!message) return false;\n  var thumbSize = getPhotoThumbnailSize(photo.sizes);\n  if (!thumbSize) return false;\n  var photoSize = getPhotoSize(photo.sizes);\n  if (photoSize === thumbSize) return;\n  var file = thumbSize.photo;\n  if (!file) return false;\n  file = FileStore.get(file.id) || file;\n  var _file11 = file,\n      id = _file11.id;\n  var blob = FileStore.getBlob(id);\n  if (blob) return true;\n  FileStore.getLocalFile(store, file, null, function () {\n    return FileStore.updatePhotoBlob(message.chat_id, message.id, id);\n  }, function () {\n    return FileStore.getRemoteFile(id, THUMBNAIL_PRIORITY, message);\n  });\n  return true;\n}\n\nfunction loadStickerContent(store, sticker, message) {\n  var useFileSize = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : true;\n  if (!sticker) return;\n  var file = sticker.sticker;\n  if (!file) return;\n  file = FileStore.get(file.id) || file;\n  var _file12 = file,\n      id = _file12.id,\n      size = _file12.size;\n  var blob = FileStore.getBlob(id);\n  if (blob) return;\n  var chatId = message ? message.chat_id : 0;\n  var messageId = message ? message.id : 0;\n  FileStore.getLocalFile(store, file, null, function () {\n    return FileStore.updateStickerBlob(chatId, messageId, id);\n  }, function () {\n    if (!useFileSize || size && size < PRELOAD_STICKER_SIZE) {\n      FileStore.getRemoteFile(id, FILE_PRIORITY, message || sticker);\n    }\n  });\n}\n\nfunction loadStickerThumbnailContent(store, sticker, message) {\n  if (!sticker) return false;\n  var photoSize = sticker.thumbnail;\n  if (!photoSize) return false;\n  var file = photoSize.photo;\n  if (!file) return false;\n  file = FileStore.get(file.id) || file;\n  var _file13 = file,\n      id = _file13.id;\n  var blob = FileStore.getBlob(id);\n  if (blob) return true;\n  var chatId = message ? message.chat_id : 0;\n  var messageId = message ? message.id : 0;\n  FileStore.getLocalFile(store, file, null, function () {\n    return FileStore.updateStickerThumbnailBlob(chatId, messageId, id);\n  }, function () {\n    return FileStore.getRemoteFile(id, THUMBNAIL_PRIORITY, message || sticker);\n  });\n  return true;\n}\n\nfunction cancelLoadVideoContent(video) {\n  if (!video) return;\n  var file = video.video;\n  if (!file) return;\n  file = FileStore.get(file.id) || file;\n  var _file14 = file,\n      id = _file14.id;\n  var blob = FileStore.getBlob(id);\n  if (blob) return;\n  FileStore.cancelGetRemoteFile(id);\n}\n\nfunction loadVideoContent(store, video, message) {\n  var useFileSize = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : true;\n  if (!video) return;\n  var file = video.video;\n  if (!file) return;\n  file = FileStore.get(file.id) || file;\n  var _file15 = file,\n      id = _file15.id,\n      size = _file15.size;\n  var blob = FileStore.getBlob(id);\n  if (blob) return;\n  var chatId = message ? message.chat_id : 0;\n  var messageId = message ? message.id : 0;\n  FileStore.getLocalFile(store, file, null, function () {\n    return FileStore.updateVideoBlob(chatId, messageId, id);\n  }, function () {\n    if (!useFileSize || size && size < PRELOAD_VIDEO_SIZE) {\n      FileStore.getRemoteFile(id, FILE_PRIORITY, message || video);\n    }\n  });\n}\n\nfunction cancelLoadVideoThumbnailContent(video) {\n  if (!video) return;\n  var photoSize = video.thumbnail;\n  if (!photoSize) return false;\n  var file = photoSize.photo;\n  if (!file) return false;\n  file = FileStore.get(file.id) || file;\n  var _file16 = file,\n      id = _file16.id;\n  var blob = FileStore.getBlob(id);\n  if (blob) return true;\n  FileStore.cancelGetRemoteFile(id);\n}\n\nfunction loadVideoThumbnailContent(store, video, message) {\n  if (!video) return false;\n  var photoSize = video.thumbnail;\n  if (!photoSize) return false;\n  var file = photoSize.photo;\n  if (!file) return false;\n  file = FileStore.get(file.id) || file;\n  var _file17 = file,\n      id = _file17.id;\n  var blob = FileStore.getBlob(id);\n  if (blob) return true;\n  var chatId = message ? message.chat_id : 0;\n  var messageId = message ? message.id : 0;\n  FileStore.getLocalFile(store, file, null, function () {\n    return FileStore.updateVideoThumbnailBlob(chatId, messageId, id);\n  }, function () {\n    return FileStore.getRemoteFile(id, THUMBNAIL_PRIORITY, message || video);\n  });\n  return true;\n}\n\nfunction loadVideoNoteContent(store, videoNote, message) {\n  var useFileSize = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : true;\n  if (!videoNote) return;\n  var file = videoNote.video;\n  if (!file) return;\n  file = FileStore.get(file.id) || file;\n  var _file18 = file,\n      id = _file18.id,\n      size = _file18.size;\n  var blob = FileStore.getBlob(id);\n  if (blob) return;\n  var chatId = message ? message.chat_id : 0;\n  var messageId = message ? message.id : 0;\n  FileStore.getLocalFile(store, file, null, function () {\n    return FileStore.updateVideoNoteBlob(chatId, messageId, id);\n  }, function () {\n    if (!useFileSize || size && size < PRELOAD_VIDEONOTE_SIZE) {\n      FileStore.getRemoteFile(id, FILE_PRIORITY, message || videoNote);\n    }\n  });\n}\n\nfunction loadVideoNoteThumbnailContent(store, videoNote, message) {\n  if (!videoNote) return false;\n  var photoSize = videoNote.thumbnail;\n  if (!photoSize) return false;\n  var file = photoSize.photo;\n  if (!file) return false;\n  file = FileStore.get(file.id) || file;\n  var _file19 = file,\n      id = _file19.id;\n  var blob = FileStore.getBlob(id);\n  if (blob) return true;\n  var chatId = message ? message.chat_id : 0;\n  var messageId = message ? message.id : 0;\n  FileStore.getLocalFile(store, file, null, function () {\n    return FileStore.updateVideoNoteThumbnailBlob(chatId, messageId, id);\n  }, function () {\n    return FileStore.getRemoteFile(id, THUMBNAIL_PRIORITY, message || videoNote);\n  });\n  return true;\n}\n\nfunction loadVoiceNoteContent(store, voiceNote, message) {\n  var useFileSize = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : true;\n  if (!voiceNote) return;\n  var file = voiceNote.voice;\n  if (!file) return;\n  file = FileStore.get(file.id) || file;\n  var _file20 = file,\n      id = _file20.id,\n      size = _file20.size;\n  var blob = FileStore.getBlob(id);\n  if (blob) return;\n  var chatId = message ? message.chat_id : 0;\n  var messageId = message ? message.id : 0;\n  FileStore.getLocalFile(store, file, null, function () {\n    return FileStore.updateVoiceNoteBlob(chatId, messageId, id);\n  }, function () {\n    if (!useFileSize || size && size < PRELOAD_VOICENOTE_SIZE) {\n      FileStore.getRemoteFile(id, FILE_PRIORITY, message || voiceNote);\n    }\n  });\n}\n\nfunction loadMessageContents(store, messages) {\n  var users = new Map();\n  var chatId = 0;\n  var replies = new Map();\n\n  for (var i = messages.length - 1; i >= 0; i--) {\n    var message = messages[i];\n\n    if (!message) {\n      continue;\n    }\n\n    var chat_id = message.chat_id,\n        content = message.content,\n        sender_user_id = message.sender_user_id,\n        reply_to_message_id = message.reply_to_message_id;\n\n    if (sender_user_id) {\n      users.set(sender_user_id, sender_user_id);\n    }\n\n    if (reply_to_message_id) {\n      chatId = chat_id;\n      replies.set(reply_to_message_id, reply_to_message_id);\n    }\n\n    if (content) {\n      switch (content['@type']) {\n        case 'messageAnimation':\n          {\n            var animation = content.animation;\n            loadAnimationContent(store, animation, message);\n            loadAnimationThumbnailContent(store, animation, message);\n            break;\n          }\n\n        case 'messageAudio':\n          {\n            var audio = content.audio;\n            loadAudioContent(store, audio, message);\n            loadAudioThumbnailContent(store, audio, message);\n            break;\n          }\n\n        case 'messageChatChangePhoto':\n          {\n            var photo = content.photo;\n            loadPhotoContent(store, photo, message);\n            loadBigPhotoContent(store, photo, message);\n            break;\n          }\n\n        case 'messageContact':\n          {\n            var contact = content.contact;\n            loadContactContent(store, contact, message);\n            break;\n          }\n\n        case 'messageDocument':\n          {\n            var _document3 = content.document;\n            loadDocumentContent(store, _document3, message);\n            loadDocumentThumbnailContent(store, _document3, message);\n            break;\n          }\n\n        case 'messageGame':\n          {\n            var game = content.game;\n            loadGameContent(store, game, message);\n            loadGameThumbnailContent(store, game, message);\n            break;\n          }\n\n        case 'messageLocation':\n          {\n            var location = content.location;\n            loadLocationContent(store, location, message);\n            break;\n          }\n\n        case 'messageText':\n          {\n            var web_page = content.web_page;\n\n            if (!web_page) {\n              break;\n            }\n\n            var _animation2 = web_page.animation,\n                _audio2 = web_page.audio,\n                _document4 = web_page.document,\n                _photo3 = web_page.photo,\n                sticker = web_page.sticker,\n                video = web_page.video,\n                video_note = web_page.video_note,\n                voice_note = web_page.voice_note;\n            var loadPhoto = true;\n\n            if (_animation2) {\n              loadAnimationContent(store, _animation2, message);\n              loadPhoto = !loadAnimationThumbnailContent(store, _animation2, message);\n            }\n\n            if (_audio2) {\n              loadAudioContent(store, _audio2, message);\n              loadPhoto = !loadAudioThumbnailContent(store, _audio2, message);\n            }\n\n            if (_document4) {\n              loadDocumentContent(store, _document4, message);\n              loadPhoto = !loadDocumentThumbnailContent(store, _document4, message);\n            }\n\n            if (sticker) {\n              loadStickerContent(store, sticker, message);\n              loadPhoto = !loadStickerThumbnailContent(store, sticker, message);\n            }\n\n            if (video) {\n              // loadVideoContent(store, video, message); // start loading only on video click event\n              loadPhoto = !loadVideoThumbnailContent(store, video, message);\n            }\n\n            if (video_note) {\n              loadVideoNoteContent(store, video_note, message);\n              loadPhoto = !loadVideoNoteThumbnailContent(store, video_note, message);\n            }\n\n            if (voice_note) {\n              loadVoiceNoteContent(store, voice_note, message);\n            }\n\n            if (loadPhoto) {\n              loadBigPhotoContent(store, _photo3, message);\n              loadPhotoContent(store, _photo3, message);\n              loadPhotoThumbnailContent(store, _photo3, message);\n            }\n\n            break;\n          }\n\n        case 'messagePhoto':\n          {\n            var _photo4 = content.photo;\n            loadBigPhotoContent(store, _photo4, message);\n            loadPhotoContent(store, _photo4, message);\n            loadPhotoThumbnailContent(store, _photo4, message);\n            break;\n          }\n\n        case 'messageSticker':\n          {\n            var _sticker2 = content.sticker;\n            loadStickerContent(store, _sticker2, message);\n            loadStickerThumbnailContent(store, _sticker2, message);\n            break;\n          }\n\n        case 'messageVenue':\n          {\n            var venue = content.venue;\n            var _location = venue.location;\n            loadLocationContent(store, _location, message);\n            break;\n          }\n\n        case 'messageVideo':\n          {\n            var _video2 = content.video; // loadVideoContent(store, video, message); // start loading only on video click event\n\n            loadVideoThumbnailContent(store, _video2, message);\n            break;\n          }\n\n        case 'messageVideoNote':\n          {\n            var _video_note2 = content.video_note;\n            loadVideoNoteContent(store, _video_note2, message);\n            loadVideoNoteThumbnailContent(store, _video_note2, message);\n            break;\n          }\n\n        case 'messageVoiceNote':\n          {\n            var _voice_note = content.voice_note;\n            loadVoiceNoteContent(store, _voice_note, message);\n            break;\n          }\n\n        default:\n          {\n            break;\n          }\n      }\n    }\n  }\n\n  loadUsersContent(store, _toConsumableArray(users.keys()));\n  loadReplies(store, chatId, _toConsumableArray(replies.keys()));\n}\n\nexport function saveMedia(media, message) {\n  if (!media) return;\n\n  switch (media['@type']) {\n    case 'animation':\n      {\n        saveAnimation(media, message);\n        break;\n      }\n\n    case 'document':\n      {\n        saveDocument(media, message);\n        break;\n      }\n\n    case 'photo':\n      {\n        savePhoto(media, message);\n        break;\n      }\n\n    case 'video':\n      {\n        saveVideo(media, message);\n        break;\n      }\n  }\n}\n\nfunction saveAnimation(animation, message) {\n  var chatId = message ? message.chat_id : 0;\n  var messageId = message ? message.id : 0;\n  if (!animation) return;\n  var file = animation.animation,\n      file_name = animation.file_name;\n  if (!file) return;\n  var fileId = file.id;\n  saveOrDownload(file, file_name || fileId, message || animation, function () {\n    return FileStore.updateAnimationBlob(chatId, messageId, fileId);\n  });\n}\n\nfunction saveDocument(document, message) {\n  var chatId = message ? message.chat_id : 0;\n  var messageId = message ? message.id : 0;\n  if (!document) return;\n  var file = document.document,\n      file_name = document.file_name;\n  if (!file) return;\n  var fileId = file.id;\n  saveOrDownload(file, file_name || fileId, message || document, function () {\n    return FileStore.updateDocumentBlob(chatId, messageId, fileId);\n  });\n}\n\nfunction saveVideo(video, message) {\n  var chatId = message ? message.chat_id : 0;\n  var messageId = message ? message.id : 0;\n  if (!video) return;\n  var file = video.video,\n      file_name = video.file_name;\n  if (!file) return;\n  var fileId = file.id;\n  saveOrDownload(file, file_name || fileId, message || video, function () {\n    return FileStore.updateVideoBlob(chatId, messageId, fileId);\n  });\n}\n\nfunction savePhoto(photo, message) {\n  var chatId = message ? message.chat_id : 0;\n  var messageId = message ? message.id : 0;\n  if (!photo) return;\n  var photoSize = getSize(photo.sizes, PHOTO_BIG_SIZE);\n  if (!photoSize) return;\n  var file = photoSize.photo;\n  if (!file) return;\n  var fileId = file.id;\n  saveOrDownload(file, fileId + '.jpg', message || photo, function () {\n    return FileStore.updatePhotoBlob(chatId, messageId, fileId);\n  });\n}\n\nfunction saveOrDownload(file, fileName, obj, callback) {\n  if (!file) return;\n  if (!fileName) return;\n\n  if (file.arr) {\n    saveData(file.arr, fileName);\n    return;\n  }\n\n  var blob = FileStore.getBlob(file.id) || file.blob;\n\n  if (blob) {\n    saveBlob(blob, fileName);\n    return;\n  }\n\n  download(file, obj, function () {\n    if (callback) callback();\n    blob = FileStore.getBlob(file.id) || file.blob;\n\n    if (blob) {\n      saveBlob(blob, fileName);\n    }\n  });\n}\n\nfunction download(file, obj, callback) {\n  if (!file) return;\n  var id = file.id,\n      local = file.local;\n  var blob = FileStore.getBlob(id);\n\n  if (blob) {\n    return;\n  }\n\n  if (local.is_downloading_completed) {\n    var store = FileStore.getStore();\n    FileStore.getLocalFile(store, file, null, callback, function () {\n      if (local.can_be_downloaded) {\n        FileStore.getRemoteFile(file.id, FILE_PRIORITY, obj);\n      }\n    });\n    return;\n  }\n\n  if (local.can_be_downloaded) {\n    FileStore.getRemoteFile(id, FILE_PRIORITY, obj);\n  }\n}\n\nfunction getViewerThumbnail(media) {\n  if (!media) return [0, 0, null];\n\n  switch (media['@type']) {\n    case 'animation':\n      {\n        var thumbnail = media.thumbnail;\n\n        if (thumbnail) {\n          return [thumbnail.width, thumbnail.height, thumbnail.photo];\n        }\n\n        break;\n      }\n\n    case 'document':\n      {\n        var _thumbnail = media.thumbnail;\n\n        if (_thumbnail) {\n          return [_thumbnail.width, _thumbnail.height, _thumbnail.photo];\n        }\n\n        break;\n      }\n\n    case 'photo':\n      {\n        return getViewerFile(media, PHOTO_SIZE);\n      }\n\n    case 'video':\n      {\n        var _thumbnail2 = media.thumbnail;\n\n        if (_thumbnail2) {\n          return [_thumbnail2.width, _thumbnail2.height, _thumbnail2.photo];\n        }\n\n        break;\n      }\n\n    default:\n      {\n        return [0, 0, null];\n      }\n  }\n\n  return [0, 0, null];\n}\n\nfunction getMediaPreviewFile(chatId, messageId) {\n  var message = MessageStore.get(chatId, messageId);\n  if (!message) return [0, 0, null];\n  var content = message.content;\n  if (!content) return [0, 0, null];\n\n  switch (content['@type']) {\n    case 'messageAnimation':\n      {\n        var animation = content.animation;\n\n        if (animation && animation.thumbnail) {\n          return [animation.thumbnail.width, animation.thumbnail.height, animation.thumbnail.photo];\n        }\n\n        break;\n      }\n\n    case 'messageChatChangePhoto':\n      {\n        return getMediaFile(chatId, messageId, PHOTO_SIZE);\n      }\n\n    case 'messageDocument':\n      {\n        var _document5 = content.document;\n\n        if (_document5) {\n          return [50, 50, _document5.document];\n        }\n\n        break;\n      }\n\n    case 'messagePhoto':\n      {\n        return getMediaFile(chatId, messageId, PHOTO_SIZE);\n      }\n\n    case 'messageText':\n      {\n        var web_page = content.web_page;\n\n        if (web_page) {\n          var _animation3 = web_page.animation,\n              _document6 = web_page.document,\n              video = web_page.video,\n              photo = web_page.photo;\n\n          if (_animation3 && _animation3.thumbnail) {\n            return [_animation3.thumbnail.width, _animation3.thumbnail.height, _animation3.thumbnail.photo];\n          }\n\n          if (_document6) {\n            return [50, 50, _document6.document];\n          }\n\n          if (video && video.thumbnail) {\n            return [video.thumbnail.width, video.thumbnail.height, video.thumbnail.photo];\n          }\n\n          if (photo) {\n            return getMediaFile(chatId, messageId, PHOTO_SIZE);\n          }\n        }\n\n        break;\n      }\n\n    case 'messageVideo':\n      {\n        var _video3 = content.video;\n\n        if (_video3.thumbnail) {\n          return [_video3.thumbnail.width, _video3.thumbnail.height, _video3.thumbnail.photo];\n        }\n\n        break;\n      }\n\n    default:\n      {\n        return [0, 0, null];\n      }\n  }\n\n  return [0, 0, null];\n}\n\nfunction getViewerFile(media, size) {\n  if (!size) return [0, 0, null, ''];\n\n  switch (media['@type']) {\n    case 'animation':\n      {\n        return [media.width, media.height, media.animation, media.mime_type];\n      }\n\n    case 'photo':\n      {\n        var photoSize = getSize(media.sizes, size);\n\n        if (photoSize) {\n          return [photoSize.width, photoSize.height, photoSize.photo, ''];\n        }\n\n        break;\n      }\n\n    case 'document':\n      {\n        return [50, 50, document.document, document.mime_type];\n      }\n\n    case 'video':\n      {\n        return [media.width, media.height, media.video, media.mime_type];\n      }\n\n    default:\n      {}\n  }\n\n  return [0, 0, null, ''];\n}\n\nfunction getMediaFile(chatId, messageId, size) {\n  if (!size) return [0, 0, null];\n  var message = MessageStore.get(chatId, messageId);\n  if (!message) return [0, 0, null, ''];\n  var content = message.content;\n  if (!content) return [0, 0, null, ''];\n\n  switch (content['@type']) {\n    case 'messageAnimation':\n      {\n        var animation = content.animation;\n\n        if (animation) {\n          var width = animation.width,\n              height = animation.height,\n              file = animation.animation,\n              mime_type = animation.mime_type;\n          return [width, height, file, mime_type];\n        }\n\n        break;\n      }\n\n    case 'messageChatChangePhoto':\n      {\n        var photo = content.photo;\n\n        if (photo) {\n          var photoSize = getSize(photo.sizes, size);\n\n          if (photoSize) {\n            var _width = photoSize.width,\n                _height = photoSize.height,\n                _file21 = photoSize.photo;\n            return [_width, _height, _file21, ''];\n          }\n        }\n\n        break;\n      }\n\n    case 'messageDocument':\n      {\n        var _document7 = content.document;\n\n        if (_document7) {\n          var _file22 = _document7.document,\n              _mime_type = _document7.mime_type;\n          return [50, 50, _file22, _mime_type];\n        }\n\n        break;\n      }\n\n    case 'messagePhoto':\n      {\n        var _photo5 = content.photo;\n\n        if (_photo5) {\n          var _photoSize = getSize(_photo5.sizes, size);\n\n          if (_photoSize) {\n            var _width2 = _photoSize.width,\n                _height2 = _photoSize.height,\n                _file23 = _photoSize.photo;\n            return [_width2, _height2, _file23, ''];\n          }\n        }\n\n        break;\n      }\n\n    case 'messageText':\n      {\n        var web_page = content.web_page;\n\n        if (web_page) {\n          var _animation4 = web_page.animation,\n              _document8 = web_page.document,\n              _photo6 = web_page.photo,\n              video = web_page.video;\n\n          if (_animation4) {\n            var _width3 = _animation4.width,\n                _height3 = _animation4.height,\n                _file24 = _animation4.animation,\n                _mime_type2 = _animation4.mime_type;\n            return [_width3, _height3, _file24, _mime_type2];\n          }\n\n          if (_document8) {\n            var _file25 = _document8.document,\n                _mime_type3 = _document8.mime_type;\n            return [50, 50, _file25, _mime_type3];\n          }\n\n          if (_photo6) {\n            var _photoSize2 = getSize(_photo6.sizes, size);\n\n            if (_photoSize2) {\n              var _width4 = _photoSize2.width,\n                  _height4 = _photoSize2.height,\n                  _file26 = _photoSize2.photo;\n              return [_width4, _height4, _file26, ''];\n            }\n\n            break;\n          }\n\n          if (video) {\n            var _width5 = video.width,\n                _height5 = video.height,\n                _file27 = video.video,\n                _mime_type4 = video.mime_type;\n            return [_width5, _height5, _file27, _mime_type4];\n          }\n        }\n\n        break;\n      }\n\n    case 'messageVideo':\n      {\n        var _video4 = content.video;\n\n        if (_video4) {\n          var _width6 = _video4.width,\n              _height6 = _video4.height,\n              _file28 = _video4.video,\n              _mime_type5 = _video4.mime_type;\n          return [_width6, _height6, _file28, _mime_type5];\n        }\n\n        break;\n      }\n\n    default:\n      {}\n  }\n\n  return [0, 0, null, ''];\n}\n\nexport function cancelLoadIVMediaViewerContent(blocks) {\n  if (!blocks) return;\n  if (!blocks.length) return;\n\n  for (var i = 0; i < blocks.length; i++) {\n    var content = blocks[i];\n\n    if (content) {\n      switch (content['@type']) {\n        case 'pageBlockAnimation':\n          {\n            var animation = content.animation;\n            if (!animation) break;\n            cancelLoadAnimationThumbnailContent(animation);\n            cancelLoadAnimationContent(animation);\n            break;\n          }\n\n        case 'pageBlockPhoto':\n          {\n            var photo = content.photo;\n            if (!photo) break;\n            cancelLoadBigPhotoContent(photo);\n            break;\n          }\n\n        case 'pageBlockVideo':\n          {\n            var video = content.video;\n            if (!video) break;\n            cancelLoadVideoThumbnailContent(video);\n            cancelLoadVideoContent(video);\n            break;\n          }\n      }\n    }\n  }\n}\n\nfunction cancelLoadMediaViewerContent(messages) {\n  if (!messages) return;\n  if (!messages.length) return;\n\n  for (var i = 0; i < messages.length; i++) {\n    var message = messages[i];\n    var content = message.content;\n\n    if (content) {\n      switch (content['@type']) {\n        case 'messageAnimation':\n          {\n            var animation = content.animation;\n            if (!animation) break;\n            cancelLoadAnimationThumbnailContent(animation);\n            cancelLoadAnimationContent(animation);\n            break;\n          }\n\n        case 'messagePhoto':\n          {\n            var photo = content.photo;\n            if (!photo) break;\n            cancelLoadBigPhotoContent(photo);\n            break;\n          }\n\n        case 'messageVideo':\n          {\n            var video = content.video;\n            if (!video) break;\n            cancelLoadVideoThumbnailContent(video);\n            cancelLoadVideoContent(video);\n            break;\n          }\n\n        case 'messageText':\n          {\n            var web_page = message.content.web_page;\n\n            if (web_page) {\n              var _animation5 = web_page.animation,\n                  _photo7 = web_page.photo,\n                  _video5 = web_page.video;\n\n              if (_animation5) {\n                cancelLoadAnimationThumbnailContent(_animation5);\n                cancelLoadAnimationContent(_animation5);\n              }\n\n              if (_photo7) {\n                cancelLoadBigPhotoContent(_photo7);\n              }\n\n              if (_video5) {\n                cancelLoadVideoThumbnailContent(_video5);\n                cancelLoadVideoContent(_video5);\n              }\n            }\n\n            break;\n          }\n      }\n    }\n  }\n}\n\nexport function loadIVMediaViewerContent(blocks) {\n  var useSizeLimit = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n  if (!blocks) return;\n  if (!blocks.length) return;\n  var store = FileStore.getStore();\n\n  for (var i = 0; i < blocks.length; i++) {\n    var content = blocks[i];\n\n    if (content) {\n      switch (content['@type']) {\n        case 'pageBlockAnimation':\n          {\n            var animation = content.animation;\n            loadAnimationContent(store, animation, null, useSizeLimit);\n            loadAnimationThumbnailContent(store, animation, null);\n            break;\n          }\n\n        case 'pageBlockPhoto':\n          {\n            var photo = content.photo;\n            loadBigPhotoContent(store, photo, null);\n            break;\n          }\n\n        case 'pageBlockVideo':\n          {\n            var video = content.video;\n            loadVideoThumbnailContent(store, video, null);\n            loadVideoContent(store, video, null, useSizeLimit);\n            break;\n          }\n      }\n    }\n  }\n}\n\nfunction loadMediaViewerContent(messages) {\n  var useSizeLimit = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n  if (!messages) return;\n  if (!messages.length) return;\n  var store = FileStore.getStore();\n\n  for (var i = 0; i < messages.length; i++) {\n    var message = messages[i];\n    var content = message.content;\n\n    if (content) {\n      switch (content['@type']) {\n        case 'messageAnimation':\n          {\n            var animation = content.animation;\n            loadAnimationContent(store, animation, message, useSizeLimit);\n            loadAnimationThumbnailContent(store, animation, message);\n            break;\n          }\n\n        case 'messageChatChangePhoto':\n          {\n            var photo = content.photo;\n            loadBigPhotoContent(store, photo, message);\n            break;\n          }\n\n        case 'messageDocument':\n          {\n            var _document9 = content.document;\n            loadDocumentContent(store, _document9, message, useSizeLimit);\n            break;\n          }\n\n        case 'messagePhoto':\n          {\n            var _photo8 = content.photo;\n            loadBigPhotoContent(store, _photo8, message);\n            break;\n          }\n\n        case 'messageText':\n          {\n            var web_page = message.content.web_page;\n\n            if (!web_page) {\n              break;\n            }\n\n            var _animation6 = web_page.animation,\n                _document10 = web_page.document,\n                _photo9 = web_page.photo,\n                video = web_page.video;\n            var loadPhoto = true;\n\n            if (_animation6) {\n              loadAnimationContent(store, _animation6, message, useSizeLimit);\n              loadPhoto = !loadAnimationThumbnailContent(store, _animation6, message);\n            }\n\n            if (_document10) {\n              loadDocumentContent(store, _document10, message, useSizeLimit);\n              loadPhoto = false;\n            }\n\n            if (video) {\n              loadVideoContent(store, video, message, useSizeLimit);\n              loadPhoto = !loadVideoThumbnailContent(store, video, message);\n            }\n\n            if (loadPhoto) {\n              loadBigPhotoContent(store, _photo9, message);\n            }\n\n            break;\n          }\n\n        case 'messageVideo':\n          {\n            var _video6 = content.video;\n            loadVideoThumbnailContent(store, _video6, message);\n            loadVideoContent(store, _video6, message, useSizeLimit);\n            break;\n          }\n      }\n    }\n  }\n}\n\nexport function cancelPreloadIVMediaViewerContent(index, blocks) {\n  if (!blocks.length) return;\n  var preload = [];\n\n  if (index > 0) {\n    preload.push(blocks[index - 1]);\n  }\n\n  if (index < blocks.length - 1) {\n    preload.push(blocks[index + 1]);\n  }\n\n  cancelLoadIVMediaViewerContent([blocks[index]]);\n  cancelLoadIVMediaViewerContent(blocks);\n}\n\nfunction cancelPreloadMediaViewerContent(index, history) {\n  if (!history.length) return;\n  var messages = [];\n\n  if (index > 0) {\n    messages.push(history[index - 1]);\n  }\n\n  if (index < history.length - 1) {\n    messages.push(history[index + 1]);\n  }\n\n  cancelLoadMediaViewerContent([history[index]]);\n  cancelLoadMediaViewerContent(messages);\n}\n\nfunction preloadMediaViewerContent(index, history) {\n  if (!history.length) return;\n  var messages = [];\n\n  if (index > 0) {\n    messages.push(history[index - 1]);\n  }\n\n  if (index < history.length - 1) {\n    messages.push(history[index + 1]);\n  }\n\n  loadMediaViewerContent([history[index]], false);\n  loadMediaViewerContent(messages, true);\n}\n\nexport function preloadIVMediaViewerContent(index, blocks) {\n  if (!blocks.length) return;\n  var preload = [];\n\n  if (index > 0) {\n    preload.push(blocks[index - 1]);\n  }\n\n  if (index < blocks.length - 1) {\n    preload.push(blocks[index + 1]);\n  }\n\n  loadIVMediaViewerContent([blocks[index]], false);\n  loadIVMediaViewerContent(preload, true);\n}\n\nfunction loadUserFileContent(store, file, userId) {\n  if (!file) return;\n  var _file29 = file,\n      id = _file29.id;\n  file = FileStore.get(id) || file;\n  var user = UserStore.get(userId);\n  if (!user) return;\n  var blob = file.blob || FileStore.getBlob(id);\n  if (blob) return;\n  FileStore.getLocalFile(store, file, null, function () {\n    return FileStore.updateUserPhotoBlob(userId, id);\n  }, function () {\n    return FileStore.getRemoteFile(id, THUMBNAIL_PRIORITY, user);\n  });\n}\n\nfunction loadChatFileContent(store, file, chatId) {\n  if (!file) return;\n  var _file30 = file,\n      id = _file30.id;\n  file = FileStore.get(id) || file;\n  var chat = ChatStore.get(chatId);\n  if (!chat) return;\n  var dataUrl = FileStore.getDataUrl(id);\n  if (dataUrl) return;\n  var blob = file.blob || FileStore.getBlob(id);\n  if (blob) return;\n  FileStore.getLocalFile(store, file, null, function () {\n    return FileStore.updateChatPhotoBlob(chatId, id);\n  }, function () {\n    return FileStore.getRemoteFile(id, THUMBNAIL_PRIORITY, chat);\n  });\n}\n\nfunction loadProfileMediaViewerContent(chatId, photos) {\n  if (!photos) return;\n  var store = FileStore.getStore();\n  photos.forEach(function (photo) {\n    switch (photo['@type']) {\n      case 'chatPhoto':\n        {\n          var _photo10 = photo,\n              small = _photo10.small,\n              big = _photo10.big;\n          loadChatFileContent(store, small, chatId);\n          loadChatFileContent(store, big, chatId);\n          break;\n        }\n\n      case 'profilePhoto':\n        {\n          var userId = getChatUserId(chatId);\n          var _photo11 = photo,\n              _small = _photo11.small,\n              _big = _photo11.big;\n          loadUserFileContent(store, _small, userId);\n          loadUserFileContent(store, _big, userId);\n          break;\n        }\n\n      case 'userProfilePhoto':\n        {\n          photo = getProfilePhoto(photo);\n          if (!photo) break;\n\n          var _userId = getChatUserId(chatId);\n\n          var _photo12 = photo,\n              _small2 = _photo12.small,\n              _big2 = _photo12.big;\n          loadUserFileContent(store, _small2, _userId);\n          loadUserFileContent(store, _big2, _userId);\n          break;\n        }\n    }\n  });\n}\n\nfunction preloadProfileMediaViewerContent(chatId, index, history) {\n  if (!history.length) return;\n  var items = [];\n\n  if (index > 0) {\n    items.push(history[index - 1]);\n  }\n\n  if (index < history.length - 1) {\n    items.push(history[index + 1]);\n  }\n\n  if (index >= 0 && index < history.length) {\n    items.push(history[index]);\n  }\n\n  loadProfileMediaViewerContent(chatId, items);\n}\n\nfunction loadUserContent(store, userId) {\n  var user = UserStore.get(userId);\n  if (!user) return;\n  var profile_photo = user.profile_photo;\n  if (!profile_photo) return;\n  var file = profile_photo.small;\n  loadUserFileContent(store, file, userId);\n}\n\nfunction loadUsersContent(store, ids) {\n  if (!ids) return;\n  ids.forEach(function (id) {\n    return loadUserContent(store, id);\n  });\n}\n\nfunction loadChatContent(store, chatId) {\n  var chat = ChatStore.get(chatId);\n  if (!chat) return;\n  var photo = chat.photo;\n  loadChatPhotoContent(store, photo, chat.id);\n}\n\nfunction loadChatPhotoContent(store, photo, chatId) {\n  if (!photo) return;\n  var file = photo.small;\n  loadChatFileContent(store, file, chatId);\n}\n\nfunction loadChatsContent(store, ids) {\n  if (!ids) return;\n  ids.forEach(function (id) {\n    return loadChatContent(store, id);\n  });\n}\n\nfunction loadDraftContent(store, chatId) {\n  var chat = ChatStore.get(chatId);\n  if (!chat) return;\n  var draft_message = chat.draft_message;\n  if (!draft_message) return;\n  var reply_to_message_id = draft_message.reply_to_message_id;\n  if (!reply_to_message_id) return;\n  loadReplies(store, chatId, [reply_to_message_id]);\n}\n\nexport function loadRecentStickersContent(store, recent) {\n  if (!recent) return;\n  var stickers = recent.stickers;\n  loadStickersContent(store, stickers);\n}\n\nfunction loadStickerSetContent(store, stickerSet) {\n  if (!stickerSet) return;\n  var stickers = stickerSet.stickers;\n  loadStickersContent(store, stickers);\n}\n\nexport function loadBackgroundsContent(store, backgrounds) {\n  if (!backgrounds) return;\n  backgrounds.forEach(function (background) {\n    loadBackgroundContent(store, background, false);\n  });\n}\nexport function loadBackgroundContent(store, background) {\n  var full = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n  if (!background) return;\n\n  switch (background.type['@type']) {\n    case 'backgroundTypeFill':\n      {\n        break;\n      }\n\n    case 'backgroundTypePattern':\n      {\n        var _document11 = background.document;\n\n        if (_document11) {\n          loadDocumentThumbnailContent(store, _document11, null);\n          if (full) loadDocumentContent(store, _document11, null, false);\n        }\n\n        break;\n      }\n\n    case 'backgroundTypeWallpaper':\n      {\n        var _document12 = background.document;\n\n        if (_document12) {\n          loadDocumentThumbnailContent(store, _document12, null);\n          if (full) loadDocumentContent(store, _document12, null, false);\n        }\n\n        break;\n      }\n  }\n}\n\nfunction loadStickersContent(store, stickers) {\n  if (!stickers) return;\n  stickers.forEach(function (sticker) {\n    loadStickerThumbnailContent(store, sticker, null);\n\n    if (sticker.is_animated) {\n      loadStickerContent(store, sticker, null);\n    }\n  });\n}\n\nfunction isGifMimeType(mimeType) {\n  return mimeType && mimeType.toLowerCase() === 'image/gif';\n}\n\nfunction getSrc(file) {\n  var dataUrl = file && FileStore.getDataUrl(file.id);\n  if (dataUrl) return dataUrl;\n  var blob = getBlob(file);\n  return FileStore.getBlobUrl(blob) || '';\n}\n\nfunction getBlob(file) {\n  return file ? FileStore.getBlob(file.id) || file.blob : null;\n}\n\nfunction getDownloadedSize(file) {\n  if (!file) return '0';\n  if (!file.local) return '0';\n  if (!file.local.is_downloading_active) return '0';\n  return getSizeString(file.local.downloaded_size);\n}\n\nfunction getUploadedSize(file) {\n  if (!file) return '0';\n  if (!file.remote) return '0';\n  if (!file.remote.is_uploading_active) return '0';\n  return getSizeString(file.remote.uploaded_size);\n}\n\nfunction getExtension(fileName) {\n  if (!fileName) {\n    return '';\n  }\n\n  var parts = fileName.split('.');\n\n  if (parts.length === 1 || parts[0] === '' && parts.length === 2) {\n    return '';\n  }\n\n  return parts.pop().toLowerCase();\n}\n\nfunction loadInstantViewContent(instantView) {\n  if (!instantView) return;\n  var page_blocks = instantView.page_blocks;\n  if (!page_blocks) return;\n  var store = FileStore.getStore();\n  page_blocks.forEach(function (pageBlock) {\n    return loadPageBlockContent(store, pageBlock);\n  });\n}\n\nfunction loadPageBlockContent(store, b) {\n  if (!b) return;\n\n  switch (b['@type']) {\n    case 'pageBlockAnchor':\n      {\n        break;\n      }\n\n    case 'pageBlockAnimation':\n      {\n        var animation = b.animation,\n            caption = b.caption;\n        loadAnimationThumbnailContent(store, animation, null);\n        loadAnimationContent(store, animation, null);\n        loadPageBlockContent(store, caption);\n        break;\n      }\n\n    case 'pageBlockAudio':\n      {\n        var audio = b.audio,\n            _caption = b.caption;\n        loadAudioThumbnailContent(store, audio, null);\n        loadAudioContent(store, audio, null);\n        loadPageBlockContent(store, _caption);\n        break;\n      }\n\n    case 'pageBlockAuthorDate':\n      {\n        var author = b.author;\n        loadRichTextContent(store, author);\n        break;\n      }\n\n    case 'pageBlockBlockQuote':\n      {\n        var text = b.text,\n            credit = b.credit;\n        loadRichTextContent(store, text);\n        loadRichTextContent(store, credit);\n        break;\n      }\n    // actually not a pageBlock child but load content in the same way\n\n    case 'pageBlockCaption':\n      {\n        var _text = b.text,\n            _credit = b.credit;\n        loadRichTextContent(store, _text);\n        loadRichTextContent(store, _credit);\n        break;\n      }\n\n    case 'pageBlockChatLink':\n      {\n        var photo = b.photo;\n        loadChatPhotoContent(store, photo, 0);\n        break;\n      }\n\n    case 'pageBlockCollage':\n      {\n        var page_blocks = b.page_blocks,\n            _caption2 = b.caption;\n        loadPageBlockContent(store, _caption2);\n        page_blocks.forEach(function (x) {\n          return loadPageBlockContent(store, x);\n        });\n        break;\n      }\n\n    case 'pageBlockCover':\n      {\n        var cover = b.cover;\n        loadPageBlockContent(store, cover);\n        break;\n      }\n\n    case 'pageBlockDetails':\n      {\n        var header = b.header,\n            _page_blocks = b.page_blocks;\n        loadPageBlockContent(store, header);\n\n        _page_blocks.forEach(function (x) {\n          return loadPageBlockContent(store, x);\n        });\n\n        break;\n      }\n\n    case 'pageBlockDivider':\n      {\n        break;\n      }\n\n    case 'pageBlockEmbedded':\n      {\n        var poster_photo = b.poster_photo,\n            _caption3 = b.caption;\n        loadPhotoContent(store, poster_photo, null);\n        loadPageBlockContent(store, _caption3);\n        break;\n      }\n\n    case 'pageBlockEmbeddedPost':\n      {\n        var author_photo = b.author_photo,\n            _page_blocks2 = b.page_blocks,\n            _caption4 = b.caption;\n        loadPhotoContent(store, author_photo, null);\n\n        _page_blocks2.forEach(function (x) {\n          return loadPageBlockContent(store, x);\n        });\n\n        loadPageBlockContent(store, _caption4);\n        break;\n      }\n\n    case 'pageBlockFooter':\n      {\n        var footer = b.footer;\n        loadRichTextContent(store, footer);\n        break;\n      }\n\n    case 'pageBlockHeader':\n      {\n        var _header = b.header;\n        loadRichTextContent(store, _header);\n        break;\n      }\n\n    case 'pageBlockKicker':\n      {\n        var kicker = b.kicker;\n        loadRichTextContent(store, kicker);\n        break;\n      }\n\n    case 'pageBlockList':\n      {\n        var items = b.items;\n        items.forEach(function (x) {\n          return loadPageBlockContent(store, x);\n        });\n        break;\n      }\n    // actually not a pageBlock child but load content in the same way\n\n    case 'pageBlockListItem':\n      {\n        var _page_blocks3 = b.page_blocks;\n\n        _page_blocks3.forEach(function (x) {\n          return loadPageBlockContent(store, x);\n        });\n\n        break;\n      }\n\n    case 'pageBlockMap':\n      {\n        var _caption5 = b.caption;\n        loadPageBlockMapContent(store, b, null);\n        loadPageBlockContent(store, _caption5);\n        break;\n      }\n\n    case 'pageBlockParagraph':\n      {\n        var _text2 = b.text;\n        loadRichTextContent(store, _text2);\n        break;\n      }\n\n    case 'pageBlockPhoto':\n      {\n        var _photo13 = b.photo,\n            _caption6 = b.caption;\n        loadPhotoContent(store, _photo13, null, IV_PHOTO_SIZE);\n        loadPageBlockContent(store, _caption6);\n        break;\n      }\n\n    case 'pageBlockPreformatted':\n      {\n        var _text3 = b.text;\n        loadRichTextContent(store, _text3);\n        break;\n      }\n\n    case 'pageBlockPullQuote':\n      {\n        var _text4 = b.text,\n            _credit2 = b.credit;\n        loadRichTextContent(store, _text4);\n        loadRichTextContent(store, _credit2);\n        break;\n      }\n\n    case 'pageBlockRelatedArticles':\n      {\n        var _header2 = b.header,\n            articles = b.articles;\n        loadRichTextContent(store, _header2);\n        articles.forEach(function (x) {\n          return loadPageBlockContent(store, x);\n        });\n        break;\n      }\n    // actually not a pageBlock child but load content in the same way\n\n    case 'pageBlockRelatedArticle':\n      {\n        var _photo14 = b.photo;\n        loadPhotoContent(store, _photo14, null);\n        break;\n      }\n\n    case 'pageBlockSlideshow':\n      {\n        var _page_blocks4 = b.page_blocks,\n            _caption7 = b.caption;\n        loadPageBlockContent(store, _caption7);\n\n        _page_blocks4.forEach(function (x) {\n          return loadPageBlockContent(store, x);\n        });\n\n        break;\n      }\n\n    case 'pageBlockSubheader':\n      {\n        var subheader = b.subheader;\n        loadRichTextContent(store, subheader);\n        break;\n      }\n\n    case 'pageBlockSubtitle':\n      {\n        var subtitle = b.subtitle;\n        loadRichTextContent(store, subtitle);\n        break;\n      }\n\n    case 'pageBlockTable':\n      {\n        var _caption8 = b.caption,\n            cells = b.cells;\n        loadRichTextContent(store, _caption8);\n        cells.forEach(function (row) {\n          return row.forEach(function (x) {\n            return loadPageBlockContent(store, x);\n          });\n        });\n        break;\n      }\n    // actually not a pageBlock child but load content in the same way\n\n    case 'pageBlockTableCell':\n      {\n        var _text5 = b.text;\n        loadRichTextContent(store, _text5);\n        break;\n      }\n\n    case 'pageBlockTitle':\n      {\n        var title = b.title;\n        loadRichTextContent(store, title);\n        break;\n      }\n\n    case 'pageBlockVideo':\n      {\n        var video = b.video,\n            _caption9 = b.caption;\n        loadVideoThumbnailContent(store, video, null);\n        loadVideoContent(store, video, null);\n        loadPageBlockContent(store, _caption9);\n        break;\n      }\n  }\n}\n\nfunction loadRichTextContent(store, t) {\n  if (!t) return;\n\n  switch (t['@type']) {\n    case 'richTextAnchor':\n      {\n        var text = t.text;\n        loadRichTextContent(store, text);\n        break;\n      }\n\n    case 'richTextBold':\n      {\n        var _text6 = t.text;\n        loadRichTextContent(store, _text6);\n        break;\n      }\n\n    case 'richTextEmailAddress':\n      {\n        var _text7 = t.text;\n        loadRichTextContent(store, _text7);\n        break;\n      }\n\n    case 'richTextFixed':\n      {\n        var _text8 = t.text;\n        loadRichTextContent(store, _text8);\n        break;\n      }\n\n    case 'richTextIcon':\n      {\n        var _document13 = t.document;\n        loadDocumentThumbnailContent(store, _document13, null);\n        loadDocumentContent(store, _document13, null, false);\n        break;\n      }\n\n    case 'richTextItalic':\n      {\n        var _text9 = t.text;\n        loadRichTextContent(store, _text9);\n        break;\n      }\n\n    case 'richTextMarked':\n      {\n        var _text10 = t.text;\n        loadRichTextContent(store, _text10);\n        break;\n      }\n\n    case 'richTextPhoneNumber':\n      {\n        var _text11 = t.text;\n        loadRichTextContent(store, _text11);\n        break;\n      }\n\n    case 'richTextPlain':\n      {\n        var _text12 = t.text;\n        loadRichTextContent(store, _text12);\n        break;\n      }\n\n    case 'richTexts':\n      {\n        var texts = t.texts;\n        texts.forEach(function (x) {\n          return loadRichTextContent(store, x);\n        });\n        break;\n      }\n\n    case 'richTextStrikethrough':\n      {\n        var _text13 = t.text;\n        loadRichTextContent(store, _text13);\n        break;\n      }\n\n    case 'richTextSubscript':\n      {\n        var _text14 = t.text;\n        loadRichTextContent(store, _text14);\n        break;\n      }\n\n    case 'richTextSuperscript':\n      {\n        var _text15 = t.text;\n        loadRichTextContent(store, _text15);\n        break;\n      }\n\n    case 'richTextUnderline':\n      {\n        var _text16 = t.text;\n        loadRichTextContent(store, _text16);\n        break;\n      }\n\n    case 'richTextUrl':\n      {\n        var _text17 = t.text;\n        loadRichTextContent(store, _text17);\n        break;\n      }\n  }\n}\n\nfunction getAnimationData(file) {\n  return new Promise(function (resolve) {\n    if (!file) {\n      resolve(null);\n      return;\n    }\n\n    var blob = FileStore.getBlob(file.id);\n\n    if (!blob) {\n      resolve(null);\n      return;\n    }\n\n    var fileReader = new FileReader();\n\n    fileReader.onload = function (event) {\n      return resolve(JSON.parse(event.target.result));\n    };\n\n    fileReader.onerror = function () {\n      return resolve(null);\n    };\n\n    fileReader.onabort = function () {\n      return resolve(null);\n    };\n\n    fileReader.readAsText(blob);\n  });\n}\n\nexport { getFileSize, getSizeString, saveData, saveBlob, loadMessageContents, loadMediaViewerContent, preloadMediaViewerContent, cancelLoadMediaViewerContent, cancelPreloadMediaViewerContent, loadProfileMediaViewerContent, preloadProfileMediaViewerContent, loadChatContent, loadChatsContent, loadDraftContent, loadInstantViewContent, loadStickerContent, loadStickersContent, loadStickerSetContent, loadStickerThumbnailContent, loadUserContent, loadUsersContent, saveOrDownload, download, getMediaFile, getMediaPreviewFile, isGifMimeType, getSrc, getBlob, getDownloadedSize, getUploadedSize, getExtension, getViewerFile, getViewerThumbnail, getAnimationData };","map":{"version":3,"sources":["/Users/wubenqi/nebula-chat/telegram-react/src/Utils/File.js"],"names":["getPhotoSize","getPhotoThumbnailSize","getSize","getChatUserId","getProfilePhoto","getLocationId","FILE_PRIORITY","IV_LOCATION_HEIGHT","IV_LOCATION_WIDTH","IV_PHOTO_SIZE","LOCATION_HEIGHT","LOCATION_SCALE","LOCATION_WIDTH","LOCATION_ZOOM","PHOTO_BIG_SIZE","PHOTO_SIZE","PRELOAD_ANIMATION_SIZE","PRELOAD_AUDIO_SIZE","PRELOAD_DOCUMENT_SIZE","PRELOAD_STICKER_SIZE","PRELOAD_VIDEO_SIZE","PRELOAD_VIDEONOTE_SIZE","PRELOAD_VOICENOTE_SIZE","THUMBNAIL_PRIORITY","ChatStore","FileStore","MessageStore","UserStore","TdLibController","getSizeString","size","toFixed","getFileSize","file","getBigPhoto","photo","big","saveData","data","filename","mime","blob","Blob","type","window","navigator","msSaveBlob","blobURL","URL","createObjectURL","tempLink","document","createElement","style","display","href","setAttribute","download","body","appendChild","click","removeChild","revokeObjectURL","saveBlob","loadReplies","store","chatId","messageIds","length","send","chat_id","message_ids","result","messages","map","message","i","id","content","setItems","emit","get","getStore","loadReplyContents","animation","loadAnimationThumbnailContent","audio","loadAudioThumbnailContent","loadPhotoContent","loadDocumentThumbnailContent","game","loadGameThumbnailContent","sticker","loadStickerThumbnailContent","web_page","video","video_note","loadVideoThumbnailContent","loadVideoNoteThumbnailContent","loadAudioContent","useFileSize","getBlob","messageId","getLocalFile","updateAudioBlob","getRemoteFile","photoSize","album_cover_thumbnail","updateAudioThumbnailBlob","cancelLoadAnimationContent","cancelGetRemoteFile","loadAnimationContent","updateAnimationBlob","cancelLoadAnimationThumbnailContent","thumbnail","updateAnimationThumbnailBlob","loadContactContent","contact","user_id","user","loadUserContent","loadDocumentContent","updateDocumentBlob","updateDocumentThumbnailBlob","loadGameContent","loadPageBlockMapContent","pageBlockMap","location","locationId","getLocationFile","width","height","zoom","scale","setLocationFile","updateLocationBlob","loadLocationContent","cancelLoadBigPhotoContent","sizes","loadBigPhotoContent","updatePhotoBlob","displaySize","loadPhotoThumbnailContent","thumbSize","loadStickerContent","updateStickerBlob","updateStickerThumbnailBlob","cancelLoadVideoContent","loadVideoContent","updateVideoBlob","cancelLoadVideoThumbnailContent","updateVideoThumbnailBlob","loadVideoNoteContent","videoNote","updateVideoNoteBlob","updateVideoNoteThumbnailBlob","loadVoiceNoteContent","voiceNote","voice","updateVoiceNoteBlob","loadMessageContents","users","Map","replies","sender_user_id","reply_to_message_id","set","voice_note","loadPhoto","venue","loadUsersContent","keys","saveMedia","media","saveAnimation","saveDocument","savePhoto","saveVideo","file_name","fileId","saveOrDownload","fileName","obj","callback","arr","local","is_downloading_completed","can_be_downloaded","getViewerThumbnail","getViewerFile","getMediaPreviewFile","getMediaFile","mime_type","cancelLoadIVMediaViewerContent","blocks","cancelLoadMediaViewerContent","loadIVMediaViewerContent","useSizeLimit","loadMediaViewerContent","cancelPreloadIVMediaViewerContent","index","preload","push","cancelPreloadMediaViewerContent","history","preloadMediaViewerContent","preloadIVMediaViewerContent","loadUserFileContent","userId","updateUserPhotoBlob","loadChatFileContent","chat","dataUrl","getDataUrl","updateChatPhotoBlob","loadProfileMediaViewerContent","photos","forEach","small","preloadProfileMediaViewerContent","items","profile_photo","ids","loadChatContent","loadChatPhotoContent","loadChatsContent","loadDraftContent","draft_message","loadRecentStickersContent","recent","stickers","loadStickersContent","loadStickerSetContent","stickerSet","loadBackgroundsContent","backgrounds","background","loadBackgroundContent","full","is_animated","isGifMimeType","mimeType","toLowerCase","getSrc","getBlobUrl","getDownloadedSize","is_downloading_active","downloaded_size","getUploadedSize","remote","is_uploading_active","uploaded_size","getExtension","parts","split","pop","loadInstantViewContent","instantView","page_blocks","pageBlock","loadPageBlockContent","b","caption","author","loadRichTextContent","text","credit","x","cover","header","poster_photo","author_photo","footer","kicker","articles","subheader","subtitle","cells","row","title","t","texts","getAnimationData","Promise","resolve","fileReader","FileReader","onload","event","JSON","parse","target","onerror","onabort","readAsText"],"mappings":";;;;AAAA;;;;;;AAOA,SAASA,YAAT,EAAuBC,qBAAvB,EAA8CC,OAA9C,QAA6D,UAA7D;AACA,SAASC,aAAT,QAA8B,QAA9B;AACA,SAASC,eAAT,QAAgC,QAAhC;AACA,SAASC,aAAT,QAA8B,WAA9B;AACA,SACIC,aADJ,EAEIC,kBAFJ,EAGIC,iBAHJ,EAIIC,aAJJ,EAKIC,eALJ,EAMIC,cANJ,EAOIC,cAPJ,EAQIC,aARJ,EASIC,cATJ,EAUIC,UAVJ,EAWIC,sBAXJ,EAYIC,kBAZJ,EAaIC,qBAbJ,EAcIC,oBAdJ,EAeIC,kBAfJ,EAgBIC,sBAhBJ,EAiBIC,sBAjBJ,EAkBIC,kBAlBJ,QAmBO,cAnBP;AAoBA,OAAOC,SAAP,MAAsB,qBAAtB;AACA,OAAOC,SAAP,MAAsB,qBAAtB;AACA,OAAOC,YAAP,MAAyB,wBAAzB;AACA,OAAOC,SAAP,MAAsB,qBAAtB;AACA,OAAOC,eAAP,MAA4B,gCAA5B;;AAEA,SAASC,aAAT,CAAuBC,IAAvB,EAA6B;AACzB,MAAI,CAACA,IAAL,EAAW;;AAEX,MAAIA,IAAI,GAAG,IAAX,EAAiB;AACb,qBAAUA,IAAV;AACH;;AAED,MAAIA,IAAI,GAAG,OAAO,IAAlB,EAAwB;AACpB,qBAAU,CAACA,IAAI,GAAG,IAAR,EAAcC,OAAd,CAAsB,CAAtB,CAAV;AACH;;AAED,MAAID,IAAI,GAAG,OAAO,IAAP,GAAc,IAAzB,EAA+B;AAC3B,qBAAU,CAACA,IAAI,GAAG,IAAP,GAAc,IAAf,EAAqBC,OAArB,CAA6B,CAA7B,CAAV;AACH;;AAED,mBAAU,CAACD,IAAI,GAAG,IAAP,GAAc,IAAd,GAAqB,IAAtB,EAA4BC,OAA5B,CAAoC,CAApC,CAAV;AACH;;AAED,SAASC,WAAT,CAAqBC,IAArB,EAA2B;AACvB,MAAI,CAACA,IAAL,EAAW,OAAO,EAAP;AAEX,MAAIH,IAAI,GAAGG,IAAI,CAACH,IAAhB;AACA,MAAI,CAACA,IAAL,EAAW,OAAO,EAAP;AAEX,SAAOD,aAAa,CAACC,IAAD,CAApB;AACH;;AAED,SAASI,WAAT,CAAqBC,KAArB,EAA4B;AACxB,MAAI,CAACA,KAAL,EAAY,OAAO,IAAP;AAEZ,SAAOA,KAAK,CAACC,GAAb;AACH;;AAED,SAASC,QAAT,CAAkBC,IAAlB,EAAwBC,QAAxB,EAAkCC,IAAlC,EAAwC;AACpC,MAAIC,IAAI,GAAG,IAAIC,IAAJ,CAAS,CAACJ,IAAD,CAAT,EAAiB;AAAEK,IAAAA,IAAI,EAAEH,IAAI,IAAI;AAAhB,GAAjB,CAAX;;AACA,MAAI,OAAOI,MAAM,CAACC,SAAP,CAAiBC,UAAxB,KAAuC,WAA3C,EAAwD;AACpD;AACA;AACA;AACA;AACAF,IAAAA,MAAM,CAACC,SAAP,CAAiBC,UAAjB,CAA4BL,IAA5B,EAAkCF,QAAlC;AACH,GAND,MAMO;AACH,QAAIQ,OAAO,GAAGH,MAAM,CAACI,GAAP,CAAWC,eAAX,CAA2BR,IAA3B,CAAd;AACA,QAAIS,QAAQ,GAAGC,QAAQ,CAACC,aAAT,CAAuB,GAAvB,CAAf;AACAF,IAAAA,QAAQ,CAACG,KAAT,CAAeC,OAAf,GAAyB,MAAzB;AACAJ,IAAAA,QAAQ,CAACK,IAAT,GAAgBR,OAAhB;AACAG,IAAAA,QAAQ,CAACM,YAAT,CAAsB,UAAtB,EAAkCjB,QAAlC,EALG,CAOH;AACA;AACA;AACA;;AACA,QAAI,OAAOW,QAAQ,CAACO,QAAhB,KAA6B,WAAjC,EAA8C;AAC1CP,MAAAA,QAAQ,CAACM,YAAT,CAAsB,QAAtB,EAAgC,QAAhC;AACH;;AAEDL,IAAAA,QAAQ,CAACO,IAAT,CAAcC,WAAd,CAA0BT,QAA1B;AACAA,IAAAA,QAAQ,CAACU,KAAT;AACAT,IAAAA,QAAQ,CAACO,IAAT,CAAcG,WAAd,CAA0BX,QAA1B;AACAN,IAAAA,MAAM,CAACI,GAAP,CAAWc,eAAX,CAA2Bf,OAA3B;AACH;AACJ;;AAED,SAASgB,QAAT,CAAkBtB,IAAlB,EAAwBF,QAAxB,EAAkC;AAC9B,MAAI,OAAOK,MAAM,CAACC,SAAP,CAAiBC,UAAxB,KAAuC,WAA3C,EAAwD;AACpD;AACA;AACA;AACA;AACAF,IAAAA,MAAM,CAACC,SAAP,CAAiBC,UAAjB,CAA4BL,IAA5B,EAAkCF,QAAlC;AACH,GAND,MAMO;AACH,QAAIQ,OAAO,GAAGH,MAAM,CAACI,GAAP,CAAWC,eAAX,CAA2BR,IAA3B,CAAd;AACA,QAAIS,QAAQ,GAAGC,QAAQ,CAACC,aAAT,CAAuB,GAAvB,CAAf;AACAF,IAAAA,QAAQ,CAACG,KAAT,CAAeC,OAAf,GAAyB,MAAzB;AACAJ,IAAAA,QAAQ,CAACK,IAAT,GAAgBR,OAAhB;AACAG,IAAAA,QAAQ,CAACM,YAAT,CAAsB,UAAtB,EAAkCjB,QAAlC,EALG,CAOH;AACA;AACA;AACA;;AACA,QAAI,OAAOW,QAAQ,CAACO,QAAhB,KAA6B,WAAjC,EAA8C;AAC1CP,MAAAA,QAAQ,CAACM,YAAT,CAAsB,QAAtB,EAAgC,QAAhC;AACH;;AAEDL,IAAAA,QAAQ,CAACO,IAAT,CAAcC,WAAd,CAA0BT,QAA1B;AACAA,IAAAA,QAAQ,CAACU,KAAT;AACAT,IAAAA,QAAQ,CAACO,IAAT,CAAcG,WAAd,CAA0BX,QAA1B;AACAN,IAAAA,MAAM,CAACI,GAAP,CAAWc,eAAX,CAA2Bf,OAA3B;AACH;AACJ;;SAEciB,W;;;;;;;2BAAf,iBAA2BC,KAA3B,EAAkCC,MAAlC,EAA0CC,UAA1C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBACSD,MADT;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA,gBAESC,UAFT;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA,gBAGSA,UAAU,CAACC,MAHpB;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA,mBAKyBxC,eAAe,CAACyC,IAAhB,CAAqB;AACtC,uBAAS,aAD6B;AAEtCC,cAAAA,OAAO,EAAEJ,MAF6B;AAGtCK,cAAAA,WAAW,EAAEJ;AAHyB,aAArB,CALzB;;AAAA;AAKUK,YAAAA,MALV;AAWIA,YAAAA,MAAM,CAACC,QAAP,GAAkBD,MAAM,CAACC,QAAP,CAAgBC,GAAhB,CAAoB,UAACC,OAAD,EAAUC,CAAV,EAAgB;AAClD,qBACID,OAAO,IAAI;AACP,yBAAS,gBADF;AAEPL,gBAAAA,OAAO,EAAEJ,MAFF;AAGPW,gBAAAA,EAAE,EAAEV,UAAU,CAACS,CAAD,CAHP;AAIPE,gBAAAA,OAAO,EAAE;AAJF,eADf;AAQH,aATiB,CAAlB;AAWApD,YAAAA,YAAY,CAACqD,QAAb,CAAsBP,MAAM,CAACC,QAA7B;;AAEA,iBAASG,CAAT,GAAaT,UAAU,CAACC,MAAX,GAAoB,CAAjC,EAAoCQ,CAAC,IAAI,CAAzC,EAA4CA,CAAC,EAA7C,EAAiD;AAC7ClD,cAAAA,YAAY,CAACsD,IAAb,CAAkB,kBAAlB,EAAsCtD,YAAY,CAACuD,GAAb,CAAiBf,MAAjB,EAAyBC,UAAU,CAACS,CAAD,CAAnC,CAAtC;AACH;;AAEDX,YAAAA,KAAK,GAAGxC,SAAS,CAACyD,QAAV,EAAR;AAEAC,YAAAA,iBAAiB,CAAClB,KAAD,EAAQO,MAAM,CAACC,QAAf,CAAjB;;AA9BJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;AAiCA,SAASU,iBAAT,CAA2BlB,KAA3B,EAAkCQ,QAAlC,EAA4C;AACxC,OAAK,IAAIG,CAAC,GAAGH,QAAQ,CAACL,MAAT,GAAkB,CAA/B,EAAkCQ,CAAC,IAAI,CAAvC,EAA0CA,CAAC,EAA3C,EAA+C;AAC3C,QAAMD,OAAO,GAAGF,QAAQ,CAACG,CAAD,CAAxB;;AACA,QAAI,CAACD,OAAL,EAAc;AACV;AACH;;AAJ0C,QAMnCG,OANmC,GAMvBH,OANuB,CAMnCG,OANmC;;AAO3C,QAAIA,OAAJ,EAAa;AACT,cAAQA,OAAO,CAAC,OAAD,CAAf;AACI,aAAK,kBAAL;AAAyB;AAAA,gBACbM,SADa,GACCN,OADD,CACbM,SADa;AAGrBC,YAAAA,6BAA6B,CAACpB,KAAD,EAAQmB,SAAR,EAAmBT,OAAnB,CAA7B;AACA;AACH;;AACD,aAAK,cAAL;AAAqB;AAAA,gBACTW,KADS,GACCR,OADD,CACTQ,KADS;AAGjBC,YAAAA,yBAAyB,CAACtB,KAAD,EAAQqB,KAAR,EAAeX,OAAf,CAAzB;AACA;AACH;;AACD,aAAK,wBAAL;AAA+B;AAAA,gBACnBxC,KADmB,GACT2C,OADS,CACnB3C,KADmB;AAG3BqD,YAAAA,gBAAgB,CAACvB,KAAD,EAAQ9B,KAAR,EAAewC,OAAf,CAAhB;AACA;AACH;;AACD,aAAK,iBAAL;AAAwB;AAAA,gBACZxB,SADY,GACC2B,OADD,CACZ3B,QADY;AAGpBsC,YAAAA,4BAA4B,CAACxB,KAAD,EAAQd,SAAR,EAAkBwB,OAAlB,CAA5B;AACA;AACH;;AACD,aAAK,aAAL;AAAoB;AAAA,gBACRe,IADQ,GACCZ,OADD,CACRY,IADQ;AAGhBC,YAAAA,wBAAwB,CAAC1B,KAAD,EAAQyB,IAAR,EAAcf,OAAd,CAAxB;AACA;AACH;;AACD,aAAK,cAAL;AAAqB;AAAA,gBACTxC,MADS,GACC2C,OADD,CACT3C,KADS;AAGjBqD,YAAAA,gBAAgB,CAACvB,KAAD,EAAQ9B,MAAR,EAAewC,OAAf,CAAhB;AACA;AACH;;AACD,aAAK,gBAAL;AAAuB;AAAA,gBACXiB,OADW,GACCd,OADD,CACXc,OADW;AAGnBC,YAAAA,2BAA2B,CAAC5B,KAAD,EAAQ2B,OAAR,EAAiBjB,OAAjB,CAA3B;AACA;AACH;;AACD,aAAK,aAAL;AAAoB;AAAA,gBACRmB,QADQ,GACKhB,OADL,CACRgB,QADQ;AAEhB,gBAAI,CAACA,QAAL,EAAe;AAFC,gBAIRV,UAJQ,GAI0DU,QAJ1D,CAIRV,SAJQ;AAAA,gBAIGE,MAJH,GAI0DQ,QAJ1D,CAIGR,KAJH;AAAA,gBAIUnC,UAJV,GAI0D2C,QAJ1D,CAIU3C,QAJV;AAAA,gBAIoBhB,OAJpB,GAI0D2D,QAJ1D,CAIoB3D,KAJpB;AAAA,gBAI2ByD,QAJ3B,GAI0DE,QAJ1D,CAI2BF,OAJ3B;AAAA,gBAIoCG,KAJpC,GAI0DD,QAJ1D,CAIoCC,KAJpC;AAAA,gBAI2CC,UAJ3C,GAI0DF,QAJ1D,CAI2CE,UAJ3C;;AAMhB,gBAAI7D,OAAJ,EAAW;AACPqD,cAAAA,gBAAgB,CAACvB,KAAD,EAAQ9B,OAAR,EAAewC,OAAf,CAAhB;AACA;AACH;;AAED,gBAAIS,UAAJ,EAAe;AACXC,cAAAA,6BAA6B,CAACpB,KAAD,EAAQmB,UAAR,EAAmBT,OAAnB,CAA7B;AACA;AACH;;AAED,gBAAIW,MAAJ,EAAW;AACPC,cAAAA,yBAAyB,CAACtB,KAAD,EAAQqB,MAAR,EAAeX,OAAf,CAAzB;AACA;AACH;;AAED,gBAAIxB,UAAJ,EAAc;AACVsC,cAAAA,4BAA4B,CAACxB,KAAD,EAAQd,UAAR,EAAkBwB,OAAlB,CAA5B;AACA;AACH;;AAED,gBAAIiB,QAAJ,EAAa;AACTC,cAAAA,2BAA2B,CAAC5B,KAAD,EAAQ2B,QAAR,EAAiBjB,OAAjB,CAA3B;AACA;AACH;;AAED,gBAAIoB,KAAJ,EAAW;AACPE,cAAAA,yBAAyB,CAAChC,KAAD,EAAQ8B,KAAR,EAAepB,OAAf,CAAzB;AACA;AACH;;AAED,gBAAIqB,UAAJ,EAAgB;AACZE,cAAAA,6BAA6B,CAACjC,KAAD,EAAQ+B,UAAR,EAAoBrB,OAApB,CAA7B;AACA;AACH;;AAED;AACH;;AACD,aAAK,cAAL;AAAqB;AAAA,gBACToB,MADS,GACCjB,OADD,CACTiB,KADS;AAGjBE,YAAAA,yBAAyB,CAAChC,KAAD,EAAQ8B,MAAR,EAAepB,OAAf,CAAzB;AACA;AACH;;AACD,aAAK,kBAAL;AAAyB;AAAA,gBACbqB,WADa,GACElB,OADF,CACbkB,UADa;AAGrBE,YAAAA,6BAA6B,CAACjC,KAAD,EAAQ+B,WAAR,EAAoBrB,OAApB,CAA7B;AACA;AACH;AAjGL;AAmGH;AACJ;AACJ;;AAED,SAASwB,gBAAT,CAA0BlC,KAA1B,EAAiCqB,KAAjC,EAAwCX,OAAxC,EAAqE;AAAA,MAApByB,WAAoB,uEAAN,IAAM;AACjE,MAAI,CAACd,KAAL,EAAY;AADqD,MAGpDrD,IAHoD,GAG3CqD,KAH2C,CAG3DA,KAH2D;AAIjE,MAAI,CAACrD,IAAL,EAAW;AAEXA,EAAAA,IAAI,GAAGR,SAAS,CAACwD,GAAV,CAAchD,IAAI,CAAC4C,EAAnB,KAA0B5C,IAAjC;AANiE,cAO5CA,IAP4C;AAAA,MAOzD4C,EAPyD,SAOzDA,EAPyD;AAAA,MAOrD/C,IAPqD,SAOrDA,IAPqD;AASjE,MAAMW,IAAI,GAAGhB,SAAS,CAAC4E,OAAV,CAAkBxB,EAAlB,CAAb;AACA,MAAIpC,IAAJ,EAAU;AAEV,MAAMyB,MAAM,GAAGS,OAAO,GAAGA,OAAO,CAACL,OAAX,GAAqB,CAA3C;AACA,MAAMgC,SAAS,GAAG3B,OAAO,GAAGA,OAAO,CAACE,EAAX,GAAgB,CAAzC;AAEApD,EAAAA,SAAS,CAAC8E,YAAV,CACItC,KADJ,EAEIhC,IAFJ,EAGI,IAHJ,EAII;AAAA,WAAMR,SAAS,CAAC+E,eAAV,CAA0BtC,MAA1B,EAAkCoC,SAAlC,EAA6CzB,EAA7C,CAAN;AAAA,GAJJ,EAKI,YAAM;AACF,QAAI,CAACuB,WAAD,IAAiBtE,IAAI,IAAIA,IAAI,GAAGb,kBAApC,EAAyD;AACrDQ,MAAAA,SAAS,CAACgF,aAAV,CAAwB5B,EAAxB,EAA4BvE,aAA5B,EAA2CqE,OAAO,IAAIW,KAAtD;AACH;AACJ,GATL;AAWH;;AAED,SAASC,yBAAT,CAAmCtB,KAAnC,EAA0CqB,KAA1C,EAAiDX,OAAjD,EAA0D;AACtD,MAAI,CAACW,KAAL,EAAY,OAAO,KAAP;AAD0C,MAGvBoB,SAHuB,GAGTpB,KAHS,CAG9CqB,qBAH8C;AAItD,MAAI,CAACD,SAAL,EAAgB,OAAO,KAAP;AAJsC,MAMzCzE,IANyC,GAMhCyE,SANgC,CAMhDvE,KANgD;AAOtD,MAAI,CAACF,IAAL,EAAW,OAAO,KAAP;AAEXA,EAAAA,IAAI,GAAGR,SAAS,CAACwD,GAAV,CAAchD,IAAI,CAAC4C,EAAnB,KAA0B5C,IAAjC;AATsD,eAUvCA,IAVuC;AAAA,MAU9C4C,EAV8C,UAU9CA,EAV8C;AAYtD,MAAMpC,IAAI,GAAGhB,SAAS,CAAC4E,OAAV,CAAkBpE,IAAI,CAAC4C,EAAvB,CAAb;AACA,MAAIpC,IAAJ,EAAU,OAAO,IAAP;AAEV,MAAMyB,MAAM,GAAGS,OAAO,GAAGA,OAAO,CAACL,OAAX,GAAqB,CAA3C;AACA,MAAMgC,SAAS,GAAG3B,OAAO,GAAGA,OAAO,CAACE,EAAX,GAAgB,CAAzC;AAEApD,EAAAA,SAAS,CAAC8E,YAAV,CACItC,KADJ,EAEIhC,IAFJ,EAGI,IAHJ,EAII;AAAA,WAAMR,SAAS,CAACmF,wBAAV,CAAmC1C,MAAnC,EAA2CoC,SAA3C,EAAsDzB,EAAtD,CAAN;AAAA,GAJJ,EAKI;AAAA,WAAMpD,SAAS,CAACgF,aAAV,CAAwB5B,EAAxB,EAA4BtD,kBAA5B,EAAgDoD,OAAO,IAAIW,KAA3D,CAAN;AAAA,GALJ;AAQA,SAAO,IAAP;AACH;;AAED,SAASuB,0BAAT,CAAoCzB,SAApC,EAA+C;AAAA,MACxBnD,IADwB,GACfmD,SADe,CACnCA,SADmC;AAE3C,MAAI,CAACnD,IAAL,EAAW;AAFgC,MAInC4C,EAJmC,GAI5B5C,IAJ4B,CAInC4C,EAJmC;AAM3C,MAAMpC,IAAI,GAAGR,IAAI,CAACQ,IAAL,IAAahB,SAAS,CAAC4E,OAAV,CAAkBxB,EAAlB,CAA1B;AACA,MAAIpC,IAAJ,EAAU;AAEVhB,EAAAA,SAAS,CAACqF,mBAAV,CAA8BjC,EAA9B;AACH;;AAED,SAASkC,oBAAT,CAA8B9C,KAA9B,EAAqCmB,SAArC,EAAgDT,OAAhD,EAA6E;AAAA,MAApByB,WAAoB,uEAAN,IAAM;AACzE,MAAI,CAAChB,SAAL,EAAgB;AADyD,MAGxDnD,IAHwD,GAG/CmD,SAH+C,CAGnEA,SAHmE;AAIzE,MAAI,CAACnD,IAAL,EAAW;AAEXA,EAAAA,IAAI,GAAGR,SAAS,CAACwD,GAAV,CAAchD,IAAI,CAAC4C,EAAnB,KAA0B5C,IAAjC;AANyE,eAOpDA,IAPoD;AAAA,MAOjE4C,EAPiE,UAOjEA,EAPiE;AAAA,MAO7D/C,IAP6D,UAO7DA,IAP6D;AASzE,MAAMW,IAAI,GAAGhB,SAAS,CAAC4E,OAAV,CAAkBxB,EAAlB,CAAb;AACA,MAAIpC,IAAJ,EAAU;AAEV,MAAMyB,MAAM,GAAGS,OAAO,GAAGA,OAAO,CAACL,OAAX,GAAqB,CAA3C;AACA,MAAMgC,SAAS,GAAG3B,OAAO,GAAGA,OAAO,CAACE,EAAX,GAAgB,CAAzC;AAEApD,EAAAA,SAAS,CAAC8E,YAAV,CACItC,KADJ,EAEIhC,IAFJ,EAGI,IAHJ,EAII;AAAA,WAAMR,SAAS,CAACuF,mBAAV,CAA8B9C,MAA9B,EAAsCoC,SAAtC,EAAiDzB,EAAjD,CAAN;AAAA,GAJJ,EAKI,YAAM;AACF,QAAI,CAACuB,WAAD,IAAiBtE,IAAI,IAAIA,IAAI,GAAGd,sBAApC,EAA6D;AACzDS,MAAAA,SAAS,CAACgF,aAAV,CAAwB5B,EAAxB,EAA4BvE,aAA5B,EAA2CqE,OAAO,IAAIS,SAAtD;AACH;AACJ,GATL;AAWH;;AAED,SAAS6B,mCAAT,CAA6C7B,SAA7C,EAAuD;AACnD,MAAI,CAACA,SAAL,EAAgB;AADmC,MAGhCsB,SAHgC,GAGlBtB,SAHkB,CAG3C8B,SAH2C;AAInD,MAAI,CAACR,SAAL,EAAgB;AAJmC,MAMtCzE,IANsC,GAM7ByE,SAN6B,CAM7CvE,KAN6C;AAOnD,MAAI,CAACF,IAAL,EAAW;AAEXA,EAAAA,IAAI,GAAGR,SAAS,CAACwD,GAAV,CAAchD,IAAI,CAAC4C,EAAnB,KAA0B5C,IAAjC;AATmD,eAUpCA,IAVoC;AAAA,MAU3C4C,EAV2C,UAU3CA,EAV2C;AAYnD,MAAMpC,IAAI,GAAGhB,SAAS,CAAC4E,OAAV,CAAkBxB,EAAlB,CAAb;AACA,MAAIpC,IAAJ,EAAU;AAEVhB,EAAAA,SAAS,CAACqF,mBAAV,CAA8BjC,EAA9B;AACH;;AAED,SAASQ,6BAAT,CAAuCpB,KAAvC,EAA8CmB,SAA9C,EAAyDT,OAAzD,EAAkE;AAC9D,MAAI,CAACS,SAAL,EAAgB,OAAO,KAAP;AAD8C,MAG3CsB,SAH2C,GAG7BtB,SAH6B,CAGtD8B,SAHsD;AAI9D,MAAI,CAACR,SAAL,EAAgB,OAAO,KAAP;AAJ8C,MAMjDzE,IANiD,GAMxCyE,SANwC,CAMxDvE,KANwD;AAO9D,MAAI,CAACF,IAAL,EAAW,OAAO,KAAP;AAEXA,EAAAA,IAAI,GAAGR,SAAS,CAACwD,GAAV,CAAchD,IAAI,CAAC4C,EAAnB,KAA0B5C,IAAjC;AAT8D,eAU/CA,IAV+C;AAAA,MAUtD4C,EAVsD,UAUtDA,EAVsD;AAY9D,MAAMpC,IAAI,GAAGhB,SAAS,CAAC4E,OAAV,CAAkBpE,IAAI,CAAC4C,EAAvB,CAAb;AACA,MAAIpC,IAAJ,EAAU,OAAO,IAAP;AAEV,MAAMyB,MAAM,GAAGS,OAAO,GAAGA,OAAO,CAACL,OAAX,GAAqB,CAA3C;AACA,MAAMgC,SAAS,GAAG3B,OAAO,GAAGA,OAAO,CAACE,EAAX,GAAgB,CAAzC;AAEApD,EAAAA,SAAS,CAAC8E,YAAV,CACItC,KADJ,EAEIhC,IAFJ,EAGI,IAHJ,EAII;AAAA,WAAMR,SAAS,CAAC0F,4BAAV,CAAuCjD,MAAvC,EAA+CoC,SAA/C,EAA0DzB,EAA1D,CAAN;AAAA,GAJJ,EAKI;AAAA,WAAMpD,SAAS,CAACgF,aAAV,CAAwB5B,EAAxB,EAA4BtD,kBAA5B,EAAgDoD,OAAO,IAAIS,SAA3D,CAAN;AAAA,GALJ;AAQA,SAAO,IAAP;AACH;;AAED,SAASgC,kBAAT,CAA4BnD,KAA5B,EAAmCoD,OAAnC,EAA4C1C,OAA5C,EAAqD;AACjD,MAAI,CAAC0C,OAAL,EAAc;AACd,MAAI,CAAC1C,OAAL,EAAc;AAFmC,MAIzC2C,OAJyC,GAI7BD,OAJ6B,CAIzCC,OAJyC;AAKjD,MAAMC,IAAI,GAAG5F,SAAS,CAACsD,GAAV,CAAcqC,OAAd,CAAb;AACA,MAAI,CAACC,IAAL,EAAW;AAEXC,EAAAA,eAAe,CAACvD,KAAD,EAAQsD,IAAR,CAAf;AACH;;AAED,SAASE,mBAAT,CAA6BxD,KAA7B,EAAoCd,QAApC,EAA8CwB,OAA9C,EAA2E;AAAA,MAApByB,WAAoB,uEAAN,IAAM;AACvE,MAAI,CAACjD,QAAL,EAAe;AADwD,MAGvDlB,IAHuD,GAG9CkB,QAH8C,CAGjEA,QAHiE;AAIvE,MAAI,CAAClB,IAAL,EAAW;AAEXA,EAAAA,IAAI,GAAGR,SAAS,CAACwD,GAAV,CAAchD,IAAI,CAAC4C,EAAnB,KAA0B5C,IAAjC;AANuE,eAOlDA,IAPkD;AAAA,MAO/D4C,EAP+D,UAO/DA,EAP+D;AAAA,MAO3D/C,IAP2D,UAO3DA,IAP2D;AASvE,MAAMW,IAAI,GAAGhB,SAAS,CAAC4E,OAAV,CAAkBxB,EAAlB,CAAb;AACA,MAAIpC,IAAJ,EAAU;AAEV,MAAMyB,MAAM,GAAGS,OAAO,GAAGA,OAAO,CAACL,OAAX,GAAqB,CAA3C;AACA,MAAMgC,SAAS,GAAG3B,OAAO,GAAGA,OAAO,CAACE,EAAX,GAAgB,CAAzC;AAEApD,EAAAA,SAAS,CAAC8E,YAAV,CACItC,KADJ,EAEIhC,IAFJ,EAGI,IAHJ,EAII;AAAA,WAAMR,SAAS,CAACiG,kBAAV,CAA6BxD,MAA7B,EAAqCoC,SAArC,EAAgDzB,EAAhD,CAAN;AAAA,GAJJ,EAKI,YAAM;AACF,QAAI,CAACuB,WAAD,IAAiBtE,IAAI,IAAIA,IAAI,GAAGZ,qBAApC,EAA4D;AACxDO,MAAAA,SAAS,CAACgF,aAAV,CAAwB5B,EAAxB,EAA4BvE,aAA5B,EAA2CqE,OAAO,IAAIxB,QAAtD;AACH;AACJ,GATL;AAWH;;AAED,SAASsC,4BAAT,CAAsCxB,KAAtC,EAA6Cd,QAA7C,EAAuDwB,OAAvD,EAAgE;AAC5D,MAAI,CAACxB,QAAL,EAAe,OAAO,KAAP;AAD6C,MAGzCuD,SAHyC,GAG3BvD,QAH2B,CAGpD+D,SAHoD;AAI5D,MAAI,CAACR,SAAL,EAAgB,OAAO,KAAP;AAJ4C,MAM/CzE,IAN+C,GAMtCyE,SANsC,CAMtDvE,KANsD;AAO5D,MAAI,CAACF,IAAL,EAAW,OAAO,KAAP;AAEXA,EAAAA,IAAI,GAAGR,SAAS,CAACwD,GAAV,CAAchD,IAAI,CAAC4C,EAAnB,KAA0B5C,IAAjC;AAT4D,eAU7CA,IAV6C;AAAA,MAUpD4C,EAVoD,UAUpDA,EAVoD;AAY5D,MAAMpC,IAAI,GAAGhB,SAAS,CAAC4E,OAAV,CAAkBpE,IAAI,CAAC4C,EAAvB,CAAb;AACA,MAAIpC,IAAJ,EAAU,OAAO,IAAP;AAEV,MAAMyB,MAAM,GAAGS,OAAO,GAAGA,OAAO,CAACL,OAAX,GAAqB,CAA3C;AACA,MAAMgC,SAAS,GAAG3B,OAAO,GAAGA,OAAO,CAACE,EAAX,GAAgB,CAAzC;AAEApD,EAAAA,SAAS,CAAC8E,YAAV,CACItC,KADJ,EAEIhC,IAFJ,EAGI,IAHJ,EAII;AAAA,WAAMR,SAAS,CAACkG,2BAAV,CAAsCzD,MAAtC,EAA8CoC,SAA9C,EAAyDzB,EAAzD,CAAN;AAAA,GAJJ,EAKI;AAAA,WAAMpD,SAAS,CAACgF,aAAV,CAAwB5B,EAAxB,EAA4BtD,kBAA5B,EAAgDoD,OAAO,IAAIxB,QAA3D,CAAN;AAAA,GALJ;AAQA,SAAO,IAAP;AACH;;AAED,SAASyE,eAAT,CAAyB3D,KAAzB,EAAgCyB,IAAhC,EAAsCf,OAAtC,EAAmE;AAAA,MAApByB,WAAoB,uEAAN,IAAM;AAC/D,MAAI,CAACV,IAAL,EAAW;AADoD,MAGvDN,SAHuD,GAGzCM,IAHyC,CAGvDN,SAHuD;AAK/D2B,EAAAA,oBAAoB,CAAC9C,KAAD,EAAQmB,SAAR,EAAmBT,OAAnB,EAA4ByB,WAA5B,CAApB;AACH;;AAED,SAAST,wBAAT,CAAkC1B,KAAlC,EAAyCyB,IAAzC,EAA+Cf,OAA/C,EAAwD;AACpD,MAAI,CAACe,IAAL,EAAW,OAAO,KAAP;AADyC,MAG5CvD,KAH4C,GAGvBuD,IAHuB,CAG5CvD,KAH4C;AAAA,MAGrCiD,SAHqC,GAGvBM,IAHuB,CAGrCN,SAHqC;;AAIpD,MAAIC,6BAA6B,CAACpB,KAAD,EAAQmB,SAAR,EAAmBT,OAAnB,CAAjC,EAA8D;AAC1D,WAAO,IAAP;AACH;;AAEDa,EAAAA,gBAAgB,CAACvB,KAAD,EAAQ9B,KAAR,EAAewC,OAAf,CAAhB;AACA,SAAO,IAAP;AACH;;SAEckD,uB;;;;;;;2BAAf,kBAAuC5D,KAAvC,EAA8C6D,YAA9C,EAA4DnD,OAA5D;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,gBACSmD,YADT;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAGYC,YAAAA,QAHZ,GAGyBD,YAHzB,CAGYC,QAHZ;AAIUC,YAAAA,UAJV,GAIuB3H,aAAa,CAAC0H,QAAD,EAAWvH,iBAAX,EAA8BD,kBAA9B,CAJpC;;AAAA,gBAKSyH,UALT;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAOQ/F,YAAAA,IAPR,GAOeR,SAAS,CAACwG,eAAV,CAA0BD,UAA1B,CAPf;;AAAA,gBAQS/F,IART;AAAA;AAAA;AAAA;;AAAA;AAAA,mBASqBL,eAAe,CAACyC,IAAhB,CAAqB;AAC9B,uBAAS,qBADqB;AAE9B0D,cAAAA,QAAQ,EAARA,QAF8B;AAG9BG,cAAAA,KAAK,EAAE1H,iBAHuB;AAI9B2H,cAAAA,MAAM,EAAE5H,kBAJsB;AAK9B6H,cAAAA,IAAI,EAAEvH,aALwB;AAM9BwH,cAAAA,KAAK,EAAE1H,cANuB;AAO9B2D,cAAAA,OAAO,EAAEK,OAAO,GAAGA,OAAO,CAACL,OAAX,GAAqB;AAPP,aAArB,CATrB;;AAAA;AASQrC,YAAAA,IATR;AAkBQR,YAAAA,SAAS,CAAC6G,eAAV,CAA0BN,UAA1B,EAAsC/F,IAAtC;AAEAgC,YAAAA,KAAK,GAAGxC,SAAS,CAACyD,QAAV,EAAR;;AApBR;AAuBIjD,YAAAA,IAAI,GAAGR,SAAS,CAACwD,GAAV,CAAchD,IAAI,CAAC4C,EAAnB,KAA0B5C,IAAjC;AAvBJ,sBAwBmBA,IAxBnB,EAwBY4C,EAxBZ,WAwBYA,EAxBZ;AA0BUpC,YAAAA,IA1BV,GA0BiBhB,SAAS,CAAC4E,OAAV,CAAkBpE,IAAI,CAAC4C,EAAvB,CA1BjB;;AAAA,iBA2BQpC,IA3BR;AAAA;AAAA;AAAA;;AAAA;;AAAA;AA6BUyB,YAAAA,MA7BV,GA6BmBS,OAAO,GAAGA,OAAO,CAACL,OAAX,GAAqB,CA7B/C;AA8BUgC,YAAAA,SA9BV,GA8BsB3B,OAAO,GAAGA,OAAO,CAACE,EAAX,GAAgB,CA9B7C;AAgCIpD,YAAAA,SAAS,CAAC8E,YAAV,CACItC,KADJ,EAEIhC,IAFJ,EAGI,IAHJ,EAII;AAAA,qBAAMR,SAAS,CAAC8G,kBAAV,CAA6BrE,MAA7B,EAAqCoC,SAArC,EAAgDzB,EAAhD,CAAN;AAAA,aAJJ,EAKI;AAAA,qBAAMpD,SAAS,CAACgF,aAAV,CAAwB5B,EAAxB,EAA4BvE,aAA5B,EAA2CqE,OAAO,IAAImD,YAAtD,CAAN;AAAA,aALJ;;AAhCJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;SAyCeU,mB;;;;;;;2BAAf,kBAAmCvE,KAAnC,EAA0C8D,QAA1C,EAAoDpD,OAApD;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,gBACSoD,QADT;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAGUC,YAAAA,UAHV,GAGuB3H,aAAa,CAAC0H,QAAD,CAHpC;;AAAA,gBAISC,UAJT;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAMQ/F,YAAAA,IANR,GAMeR,SAAS,CAACwG,eAAV,CAA0BD,UAA1B,CANf;;AAAA,gBAOS/F,IAPT;AAAA;AAAA;AAAA;;AAAA;AAAA,mBAQqBL,eAAe,CAACyC,IAAhB,CAAqB;AAC9B,uBAAS,qBADqB;AAE9B0D,cAAAA,QAAQ,EAARA,QAF8B;AAG9BG,cAAAA,KAAK,EAAEtH,cAHuB;AAI9BuH,cAAAA,MAAM,EAAEzH,eAJsB;AAK9B0H,cAAAA,IAAI,EAAEvH,aALwB;AAM9BwH,cAAAA,KAAK,EAAE1H,cANuB;AAO9B2D,cAAAA,OAAO,EAAEK,OAAO,GAAGA,OAAO,CAACL,OAAX,GAAqB;AAPP,aAArB,CARrB;;AAAA;AAQQrC,YAAAA,IARR;AAiBQR,YAAAA,SAAS,CAAC6G,eAAV,CAA0BN,UAA1B,EAAsC/F,IAAtC;AAEAgC,YAAAA,KAAK,GAAGxC,SAAS,CAACyD,QAAV,EAAR;;AAnBR;AAsBIjD,YAAAA,IAAI,GAAGR,SAAS,CAACwD,GAAV,CAAchD,IAAI,CAAC4C,EAAnB,KAA0B5C,IAAjC;AAtBJ,sBAuBmBA,IAvBnB,EAuBY4C,EAvBZ,WAuBYA,EAvBZ;AAyBUpC,YAAAA,IAzBV,GAyBiBhB,SAAS,CAAC4E,OAAV,CAAkBpE,IAAI,CAAC4C,EAAvB,CAzBjB;;AAAA,iBA0BQpC,IA1BR;AAAA;AAAA;AAAA;;AAAA;;AAAA;AA4BUyB,YAAAA,MA5BV,GA4BmBS,OAAO,GAAGA,OAAO,CAACL,OAAX,GAAqB,CA5B/C;AA6BUgC,YAAAA,SA7BV,GA6BsB3B,OAAO,GAAGA,OAAO,CAACE,EAAX,GAAgB,CA7B7C;AA+BIpD,YAAAA,SAAS,CAAC8E,YAAV,CACItC,KADJ,EAEIhC,IAFJ,EAGI,IAHJ,EAII;AAAA,qBAAMR,SAAS,CAAC8G,kBAAV,CAA6BrE,MAA7B,EAAqCoC,SAArC,EAAgDzB,EAAhD,CAAN;AAAA,aAJJ,EAKI;AAAA,qBAAMpD,SAAS,CAACgF,aAAV,CAAwB5B,EAAxB,EAA4BvE,aAA5B,EAA2CqE,OAAO,IAAIoD,QAAtD,CAAN;AAAA,aALJ;;AA/BJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;AAwCA,SAASU,yBAAT,CAAmCtG,KAAnC,EAA0C;AACtC,MAAI,CAACA,KAAL,EAAY;AAD0B,MAG9BuG,KAH8B,GAGpBvG,KAHoB,CAG9BuG,KAH8B;AAItC,MAAI,CAACA,KAAL,EAAY;AAEZ,MAAMhC,SAAS,GAAGxG,OAAO,CAACwI,KAAD,EAAQ5H,cAAR,CAAzB;AACA,MAAI,CAAC4F,SAAL,EAAgB;AAPsB,MASzBzE,IATyB,GAShByE,SATgB,CAShCvE,KATgC;AAUtC,MAAI,CAACF,IAAL,EAAW;AAEXA,EAAAA,IAAI,GAAGR,SAAS,CAACwD,GAAV,CAAchD,IAAI,CAAC4C,EAAnB,KAA0B5C,IAAjC;AAZsC,eAavBA,IAbuB;AAAA,MAa9B4C,EAb8B,UAa9BA,EAb8B;AAetC,MAAMpC,IAAI,GAAGhB,SAAS,CAAC4E,OAAV,CAAkBxB,EAAlB,CAAb;AACA,MAAIpC,IAAJ,EAAU;AAEVhB,EAAAA,SAAS,CAACqF,mBAAV,CAA8BjC,EAA9B;AACH;;AAED,SAAS8D,mBAAT,CAA6B1E,KAA7B,EAAoC9B,KAApC,EAA2CwC,OAA3C,EAAoD;AAChD,MAAI,CAACxC,KAAL,EAAY;AADoC,MAGxCuG,KAHwC,GAG9BvG,KAH8B,CAGxCuG,KAHwC;AAIhD,MAAI,CAACA,KAAL,EAAY;AAEZ,MAAMhC,SAAS,GAAGxG,OAAO,CAACwI,KAAD,EAAQ5H,cAAR,CAAzB;AACA,MAAI,CAAC4F,SAAL,EAAgB;AAPgC,MASnCzE,IATmC,GAS1ByE,SAT0B,CAS1CvE,KAT0C;AAUhD,MAAI,CAACF,IAAL,EAAW;AAEXA,EAAAA,IAAI,GAAGR,SAAS,CAACwD,GAAV,CAAchD,IAAI,CAAC4C,EAAnB,KAA0B5C,IAAjC;AAZgD,eAajCA,IAbiC;AAAA,MAaxC4C,EAbwC,UAaxCA,EAbwC;AAehD,MAAMpC,IAAI,GAAGhB,SAAS,CAAC4E,OAAV,CAAkBxB,EAAlB,CAAb;AACA,MAAIpC,IAAJ,EAAU;AAEV,MAAMyB,MAAM,GAAGS,OAAO,GAAGA,OAAO,CAACL,OAAX,GAAqB,CAA3C;AACA,MAAMgC,SAAS,GAAG3B,OAAO,GAAGA,OAAO,CAACE,EAAX,GAAgB,CAAzC;AAEApD,EAAAA,SAAS,CAAC8E,YAAV,CACItC,KADJ,EAEIhC,IAFJ,EAGI,IAHJ,EAII;AAAA,WAAMR,SAAS,CAACmH,eAAV,CAA0B1E,MAA1B,EAAkCoC,SAAlC,EAA6CzB,EAA7C,CAAN;AAAA,GAJJ,EAKI;AAAA,WAAMpD,SAAS,CAACgF,aAAV,CAAwB5B,EAAxB,EAA4BvE,aAA5B,EAA2CqE,OAAO,IAAIxC,KAAtD,CAAN;AAAA,GALJ;AAOH;;AAED,SAASqD,gBAAT,CAA0BvB,KAA1B,EAAiC9B,KAAjC,EAAwCwC,OAAxC,EAA2E;AAAA,MAA1BkE,WAA0B,uEAAZ9H,UAAY;AACvE,MAAI,CAACoB,KAAL,EAAY;AAD2D,MAG/DuG,KAH+D,GAGrDvG,KAHqD,CAG/DuG,KAH+D;AAIvE,MAAI,CAACA,KAAL,EAAY;AAEZ,MAAMhC,SAAS,GAAG1G,YAAY,CAAC0I,KAAD,EAAQG,WAAR,CAA9B;AACA,MAAI,CAACnC,SAAL,EAAgB;AAPuD,MAS1DzE,IAT0D,GASjDyE,SATiD,CASjEvE,KATiE;AAUvE,MAAI,CAACF,IAAL,EAAW;AAEXA,EAAAA,IAAI,GAAGR,SAAS,CAACwD,GAAV,CAAchD,IAAI,CAAC4C,EAAnB,KAA0B5C,IAAjC;AAZuE,gBAaxDA,IAbwD;AAAA,MAa/D4C,EAb+D,WAa/DA,EAb+D;AAevE,MAAMpC,IAAI,GAAGhB,SAAS,CAAC4E,OAAV,CAAkBxB,EAAlB,CAAb;AACA,MAAIpC,IAAJ,EAAU;AAEV,MAAMyB,MAAM,GAAGS,OAAO,GAAGA,OAAO,CAACL,OAAX,GAAqB,CAA3C;AACA,MAAMgC,SAAS,GAAG3B,OAAO,GAAGA,OAAO,CAACE,EAAX,GAAgB,CAAzC;AAEApD,EAAAA,SAAS,CAAC8E,YAAV,CACItC,KADJ,EAEIhC,IAFJ,EAGI,IAHJ,EAII;AAAA,WAAMR,SAAS,CAACmH,eAAV,CAA0B1E,MAA1B,EAAkCoC,SAAlC,EAA6CzB,EAA7C,CAAN;AAAA,GAJJ,EAKI;AAAA,WAAMpD,SAAS,CAACgF,aAAV,CAAwB5B,EAAxB,EAA4BvE,aAA5B,EAA2CqE,OAAO,IAAIxC,KAAtD,CAAN;AAAA,GALJ;AAOH;;AAED,SAAS2G,yBAAT,CAAmC7E,KAAnC,EAA0C9B,KAA1C,EAAiDwC,OAAjD,EAA0D;AACtD,MAAI,CAACxC,KAAL,EAAY,OAAO,KAAP;AACZ,MAAI,CAACwC,OAAL,EAAc,OAAO,KAAP;AAEd,MAAMoE,SAAS,GAAG9I,qBAAqB,CAACkC,KAAK,CAACuG,KAAP,CAAvC;AACA,MAAI,CAACK,SAAL,EAAgB,OAAO,KAAP;AAEhB,MAAMrC,SAAS,GAAG1G,YAAY,CAACmC,KAAK,CAACuG,KAAP,CAA9B;AACA,MAAIhC,SAAS,KAAKqC,SAAlB,EAA6B;AARyB,MAUzC9G,IAVyC,GAUhC8G,SAVgC,CAUhD5G,KAVgD;AAWtD,MAAI,CAACF,IAAL,EAAW,OAAO,KAAP;AAEXA,EAAAA,IAAI,GAAGR,SAAS,CAACwD,GAAV,CAAchD,IAAI,CAAC4C,EAAnB,KAA0B5C,IAAjC;AAbsD,gBAcvCA,IAduC;AAAA,MAc9C4C,EAd8C,WAc9CA,EAd8C;AAgBtD,MAAMpC,IAAI,GAAGhB,SAAS,CAAC4E,OAAV,CAAkBxB,EAAlB,CAAb;AACA,MAAIpC,IAAJ,EAAU,OAAO,IAAP;AAEVhB,EAAAA,SAAS,CAAC8E,YAAV,CACItC,KADJ,EAEIhC,IAFJ,EAGI,IAHJ,EAII;AAAA,WAAMR,SAAS,CAACmH,eAAV,CAA0BjE,OAAO,CAACL,OAAlC,EAA2CK,OAAO,CAACE,EAAnD,EAAuDA,EAAvD,CAAN;AAAA,GAJJ,EAKI;AAAA,WAAMpD,SAAS,CAACgF,aAAV,CAAwB5B,EAAxB,EAA4BtD,kBAA5B,EAAgDoD,OAAhD,CAAN;AAAA,GALJ;AAQA,SAAO,IAAP;AACH;;AAED,SAASqE,kBAAT,CAA4B/E,KAA5B,EAAmC2B,OAAnC,EAA4CjB,OAA5C,EAAyE;AAAA,MAApByB,WAAoB,uEAAN,IAAM;AACrE,MAAI,CAACR,OAAL,EAAc;AADuD,MAGtD3D,IAHsD,GAG7C2D,OAH6C,CAG/DA,OAH+D;AAIrE,MAAI,CAAC3D,IAAL,EAAW;AAEXA,EAAAA,IAAI,GAAGR,SAAS,CAACwD,GAAV,CAAchD,IAAI,CAAC4C,EAAnB,KAA0B5C,IAAjC;AANqE,gBAOhDA,IAPgD;AAAA,MAO7D4C,EAP6D,WAO7DA,EAP6D;AAAA,MAOzD/C,IAPyD,WAOzDA,IAPyD;AASrE,MAAMW,IAAI,GAAGhB,SAAS,CAAC4E,OAAV,CAAkBxB,EAAlB,CAAb;AACA,MAAIpC,IAAJ,EAAU;AAEV,MAAMyB,MAAM,GAAGS,OAAO,GAAGA,OAAO,CAACL,OAAX,GAAqB,CAA3C;AACA,MAAMgC,SAAS,GAAG3B,OAAO,GAAGA,OAAO,CAACE,EAAX,GAAgB,CAAzC;AAEApD,EAAAA,SAAS,CAAC8E,YAAV,CACItC,KADJ,EAEIhC,IAFJ,EAGI,IAHJ,EAII;AAAA,WAAMR,SAAS,CAACwH,iBAAV,CAA4B/E,MAA5B,EAAoCoC,SAApC,EAA+CzB,EAA/C,CAAN;AAAA,GAJJ,EAKI,YAAM;AACF,QAAI,CAACuB,WAAD,IAAiBtE,IAAI,IAAIA,IAAI,GAAGX,oBAApC,EAA2D;AACvDM,MAAAA,SAAS,CAACgF,aAAV,CAAwB5B,EAAxB,EAA4BvE,aAA5B,EAA2CqE,OAAO,IAAIiB,OAAtD;AACH;AACJ,GATL;AAWH;;AAED,SAASC,2BAAT,CAAqC5B,KAArC,EAA4C2B,OAA5C,EAAqDjB,OAArD,EAA8D;AAC1D,MAAI,CAACiB,OAAL,EAAc,OAAO,KAAP;AAD4C,MAGvCc,SAHuC,GAGzBd,OAHyB,CAGlDsB,SAHkD;AAI1D,MAAI,CAACR,SAAL,EAAgB,OAAO,KAAP;AAJ0C,MAM7CzE,IAN6C,GAMpCyE,SANoC,CAMpDvE,KANoD;AAO1D,MAAI,CAACF,IAAL,EAAW,OAAO,KAAP;AAEXA,EAAAA,IAAI,GAAGR,SAAS,CAACwD,GAAV,CAAchD,IAAI,CAAC4C,EAAnB,KAA0B5C,IAAjC;AAT0D,gBAU3CA,IAV2C;AAAA,MAUlD4C,EAVkD,WAUlDA,EAVkD;AAY1D,MAAMpC,IAAI,GAAGhB,SAAS,CAAC4E,OAAV,CAAkBxB,EAAlB,CAAb;AACA,MAAIpC,IAAJ,EAAU,OAAO,IAAP;AAEV,MAAMyB,MAAM,GAAGS,OAAO,GAAGA,OAAO,CAACL,OAAX,GAAqB,CAA3C;AACA,MAAMgC,SAAS,GAAG3B,OAAO,GAAGA,OAAO,CAACE,EAAX,GAAgB,CAAzC;AAEApD,EAAAA,SAAS,CAAC8E,YAAV,CACItC,KADJ,EAEIhC,IAFJ,EAGI,IAHJ,EAII;AAAA,WAAMR,SAAS,CAACyH,0BAAV,CAAqChF,MAArC,EAA6CoC,SAA7C,EAAwDzB,EAAxD,CAAN;AAAA,GAJJ,EAKI;AAAA,WAAMpD,SAAS,CAACgF,aAAV,CAAwB5B,EAAxB,EAA4BtD,kBAA5B,EAAgDoD,OAAO,IAAIiB,OAA3D,CAAN;AAAA,GALJ;AAQA,SAAO,IAAP;AACH;;AAED,SAASuD,sBAAT,CAAgCpD,KAAhC,EAAuC;AACnC,MAAI,CAACA,KAAL,EAAY;AADuB,MAGtB9D,IAHsB,GAGb8D,KAHa,CAG7BA,KAH6B;AAInC,MAAI,CAAC9D,IAAL,EAAW;AAEXA,EAAAA,IAAI,GAAGR,SAAS,CAACwD,GAAV,CAAchD,IAAI,CAAC4C,EAAnB,KAA0B5C,IAAjC;AANmC,gBAOpBA,IAPoB;AAAA,MAO3B4C,EAP2B,WAO3BA,EAP2B;AASnC,MAAMpC,IAAI,GAAGhB,SAAS,CAAC4E,OAAV,CAAkBxB,EAAlB,CAAb;AACA,MAAIpC,IAAJ,EAAU;AAEVhB,EAAAA,SAAS,CAACqF,mBAAV,CAA8BjC,EAA9B;AACH;;AAED,SAASuE,gBAAT,CAA0BnF,KAA1B,EAAiC8B,KAAjC,EAAwCpB,OAAxC,EAAqE;AAAA,MAApByB,WAAoB,uEAAN,IAAM;AACjE,MAAI,CAACL,KAAL,EAAY;AADqD,MAGpD9D,IAHoD,GAG3C8D,KAH2C,CAG3DA,KAH2D;AAIjE,MAAI,CAAC9D,IAAL,EAAW;AAEXA,EAAAA,IAAI,GAAGR,SAAS,CAACwD,GAAV,CAAchD,IAAI,CAAC4C,EAAnB,KAA0B5C,IAAjC;AANiE,gBAO5CA,IAP4C;AAAA,MAOzD4C,EAPyD,WAOzDA,EAPyD;AAAA,MAOrD/C,IAPqD,WAOrDA,IAPqD;AASjE,MAAMW,IAAI,GAAGhB,SAAS,CAAC4E,OAAV,CAAkBxB,EAAlB,CAAb;AACA,MAAIpC,IAAJ,EAAU;AAEV,MAAMyB,MAAM,GAAGS,OAAO,GAAGA,OAAO,CAACL,OAAX,GAAqB,CAA3C;AACA,MAAMgC,SAAS,GAAG3B,OAAO,GAAGA,OAAO,CAACE,EAAX,GAAgB,CAAzC;AAEApD,EAAAA,SAAS,CAAC8E,YAAV,CACItC,KADJ,EAEIhC,IAFJ,EAGI,IAHJ,EAII;AAAA,WAAMR,SAAS,CAAC4H,eAAV,CAA0BnF,MAA1B,EAAkCoC,SAAlC,EAA6CzB,EAA7C,CAAN;AAAA,GAJJ,EAKI,YAAM;AACF,QAAI,CAACuB,WAAD,IAAiBtE,IAAI,IAAIA,IAAI,GAAGV,kBAApC,EAAyD;AACrDK,MAAAA,SAAS,CAACgF,aAAV,CAAwB5B,EAAxB,EAA4BvE,aAA5B,EAA2CqE,OAAO,IAAIoB,KAAtD;AACH;AACJ,GATL;AAWH;;AAED,SAASuD,+BAAT,CAAyCvD,KAAzC,EAAgD;AAC5C,MAAI,CAACA,KAAL,EAAY;AADgC,MAGzBW,SAHyB,GAGXX,KAHW,CAGpCmB,SAHoC;AAI5C,MAAI,CAACR,SAAL,EAAgB,OAAO,KAAP;AAJ4B,MAM/BzE,IAN+B,GAMtByE,SANsB,CAMtCvE,KANsC;AAO5C,MAAI,CAACF,IAAL,EAAW,OAAO,KAAP;AAEXA,EAAAA,IAAI,GAAGR,SAAS,CAACwD,GAAV,CAAchD,IAAI,CAAC4C,EAAnB,KAA0B5C,IAAjC;AAT4C,gBAU7BA,IAV6B;AAAA,MAUpC4C,EAVoC,WAUpCA,EAVoC;AAY5C,MAAMpC,IAAI,GAAGhB,SAAS,CAAC4E,OAAV,CAAkBxB,EAAlB,CAAb;AACA,MAAIpC,IAAJ,EAAU,OAAO,IAAP;AAEVhB,EAAAA,SAAS,CAACqF,mBAAV,CAA8BjC,EAA9B;AACH;;AAED,SAASoB,yBAAT,CAAmChC,KAAnC,EAA0C8B,KAA1C,EAAiDpB,OAAjD,EAA0D;AACtD,MAAI,CAACoB,KAAL,EAAY,OAAO,KAAP;AAD0C,MAGnCW,SAHmC,GAGrBX,KAHqB,CAG9CmB,SAH8C;AAItD,MAAI,CAACR,SAAL,EAAgB,OAAO,KAAP;AAJsC,MAMzCzE,IANyC,GAMhCyE,SANgC,CAMhDvE,KANgD;AAOtD,MAAI,CAACF,IAAL,EAAW,OAAO,KAAP;AAEXA,EAAAA,IAAI,GAAGR,SAAS,CAACwD,GAAV,CAAchD,IAAI,CAAC4C,EAAnB,KAA0B5C,IAAjC;AATsD,gBAUvCA,IAVuC;AAAA,MAU9C4C,EAV8C,WAU9CA,EAV8C;AAYtD,MAAMpC,IAAI,GAAGhB,SAAS,CAAC4E,OAAV,CAAkBxB,EAAlB,CAAb;AACA,MAAIpC,IAAJ,EAAU,OAAO,IAAP;AAEV,MAAMyB,MAAM,GAAGS,OAAO,GAAGA,OAAO,CAACL,OAAX,GAAqB,CAA3C;AACA,MAAMgC,SAAS,GAAG3B,OAAO,GAAGA,OAAO,CAACE,EAAX,GAAgB,CAAzC;AAEApD,EAAAA,SAAS,CAAC8E,YAAV,CACItC,KADJ,EAEIhC,IAFJ,EAGI,IAHJ,EAII;AAAA,WAAMR,SAAS,CAAC8H,wBAAV,CAAmCrF,MAAnC,EAA2CoC,SAA3C,EAAsDzB,EAAtD,CAAN;AAAA,GAJJ,EAKI;AAAA,WAAMpD,SAAS,CAACgF,aAAV,CAAwB5B,EAAxB,EAA4BtD,kBAA5B,EAAgDoD,OAAO,IAAIoB,KAA3D,CAAN;AAAA,GALJ;AAQA,SAAO,IAAP;AACH;;AAED,SAASyD,oBAAT,CAA8BvF,KAA9B,EAAqCwF,SAArC,EAAgD9E,OAAhD,EAA6E;AAAA,MAApByB,WAAoB,uEAAN,IAAM;AACzE,MAAI,CAACqD,SAAL,EAAgB;AADyD,MAG5DxH,IAH4D,GAGnDwH,SAHmD,CAGnE1D,KAHmE;AAIzE,MAAI,CAAC9D,IAAL,EAAW;AAEXA,EAAAA,IAAI,GAAGR,SAAS,CAACwD,GAAV,CAAchD,IAAI,CAAC4C,EAAnB,KAA0B5C,IAAjC;AANyE,gBAOpDA,IAPoD;AAAA,MAOjE4C,EAPiE,WAOjEA,EAPiE;AAAA,MAO7D/C,IAP6D,WAO7DA,IAP6D;AASzE,MAAMW,IAAI,GAAGhB,SAAS,CAAC4E,OAAV,CAAkBxB,EAAlB,CAAb;AACA,MAAIpC,IAAJ,EAAU;AAEV,MAAMyB,MAAM,GAAGS,OAAO,GAAGA,OAAO,CAACL,OAAX,GAAqB,CAA3C;AACA,MAAMgC,SAAS,GAAG3B,OAAO,GAAGA,OAAO,CAACE,EAAX,GAAgB,CAAzC;AAEApD,EAAAA,SAAS,CAAC8E,YAAV,CACItC,KADJ,EAEIhC,IAFJ,EAGI,IAHJ,EAII;AAAA,WAAMR,SAAS,CAACiI,mBAAV,CAA8BxF,MAA9B,EAAsCoC,SAAtC,EAAiDzB,EAAjD,CAAN;AAAA,GAJJ,EAKI,YAAM;AACF,QAAI,CAACuB,WAAD,IAAiBtE,IAAI,IAAIA,IAAI,GAAGT,sBAApC,EAA6D;AACzDI,MAAAA,SAAS,CAACgF,aAAV,CAAwB5B,EAAxB,EAA4BvE,aAA5B,EAA2CqE,OAAO,IAAI8E,SAAtD;AACH;AACJ,GATL;AAWH;;AAED,SAASvD,6BAAT,CAAuCjC,KAAvC,EAA8CwF,SAA9C,EAAyD9E,OAAzD,EAAkE;AAC9D,MAAI,CAAC8E,SAAL,EAAgB,OAAO,KAAP;AAD8C,MAG3C/C,SAH2C,GAG7B+C,SAH6B,CAGtDvC,SAHsD;AAI9D,MAAI,CAACR,SAAL,EAAgB,OAAO,KAAP;AAJ8C,MAMjDzE,IANiD,GAMxCyE,SANwC,CAMxDvE,KANwD;AAO9D,MAAI,CAACF,IAAL,EAAW,OAAO,KAAP;AAEXA,EAAAA,IAAI,GAAGR,SAAS,CAACwD,GAAV,CAAchD,IAAI,CAAC4C,EAAnB,KAA0B5C,IAAjC;AAT8D,gBAU/CA,IAV+C;AAAA,MAUtD4C,EAVsD,WAUtDA,EAVsD;AAY9D,MAAMpC,IAAI,GAAGhB,SAAS,CAAC4E,OAAV,CAAkBxB,EAAlB,CAAb;AACA,MAAIpC,IAAJ,EAAU,OAAO,IAAP;AAEV,MAAMyB,MAAM,GAAGS,OAAO,GAAGA,OAAO,CAACL,OAAX,GAAqB,CAA3C;AACA,MAAMgC,SAAS,GAAG3B,OAAO,GAAGA,OAAO,CAACE,EAAX,GAAgB,CAAzC;AAEApD,EAAAA,SAAS,CAAC8E,YAAV,CACItC,KADJ,EAEIhC,IAFJ,EAGI,IAHJ,EAII;AAAA,WAAMR,SAAS,CAACkI,4BAAV,CAAuCzF,MAAvC,EAA+CoC,SAA/C,EAA0DzB,EAA1D,CAAN;AAAA,GAJJ,EAKI;AAAA,WAAMpD,SAAS,CAACgF,aAAV,CAAwB5B,EAAxB,EAA4BtD,kBAA5B,EAAgDoD,OAAO,IAAI8E,SAA3D,CAAN;AAAA,GALJ;AAQA,SAAO,IAAP;AACH;;AAED,SAASG,oBAAT,CAA8B3F,KAA9B,EAAqC4F,SAArC,EAAgDlF,OAAhD,EAA6E;AAAA,MAApByB,WAAoB,uEAAN,IAAM;AACzE,MAAI,CAACyD,SAAL,EAAgB;AADyD,MAG5D5H,IAH4D,GAGnD4H,SAHmD,CAGnEC,KAHmE;AAIzE,MAAI,CAAC7H,IAAL,EAAW;AAEXA,EAAAA,IAAI,GAAGR,SAAS,CAACwD,GAAV,CAAchD,IAAI,CAAC4C,EAAnB,KAA0B5C,IAAjC;AANyE,gBAOpDA,IAPoD;AAAA,MAOjE4C,EAPiE,WAOjEA,EAPiE;AAAA,MAO7D/C,IAP6D,WAO7DA,IAP6D;AASzE,MAAMW,IAAI,GAAGhB,SAAS,CAAC4E,OAAV,CAAkBxB,EAAlB,CAAb;AACA,MAAIpC,IAAJ,EAAU;AAEV,MAAMyB,MAAM,GAAGS,OAAO,GAAGA,OAAO,CAACL,OAAX,GAAqB,CAA3C;AACA,MAAMgC,SAAS,GAAG3B,OAAO,GAAGA,OAAO,CAACE,EAAX,GAAgB,CAAzC;AAEApD,EAAAA,SAAS,CAAC8E,YAAV,CACItC,KADJ,EAEIhC,IAFJ,EAGI,IAHJ,EAII;AAAA,WAAMR,SAAS,CAACsI,mBAAV,CAA8B7F,MAA9B,EAAsCoC,SAAtC,EAAiDzB,EAAjD,CAAN;AAAA,GAJJ,EAKI,YAAM;AACF,QAAI,CAACuB,WAAD,IAAiBtE,IAAI,IAAIA,IAAI,GAAGR,sBAApC,EAA6D;AACzDG,MAAAA,SAAS,CAACgF,aAAV,CAAwB5B,EAAxB,EAA4BvE,aAA5B,EAA2CqE,OAAO,IAAIkF,SAAtD;AACH;AACJ,GATL;AAWH;;AAED,SAASG,mBAAT,CAA6B/F,KAA7B,EAAoCQ,QAApC,EAA8C;AAC1C,MAAMwF,KAAK,GAAG,IAAIC,GAAJ,EAAd;AACA,MAAIhG,MAAM,GAAG,CAAb;AACA,MAAMiG,OAAO,GAAG,IAAID,GAAJ,EAAhB;;AAEA,OAAK,IAAItF,CAAC,GAAGH,QAAQ,CAACL,MAAT,GAAkB,CAA/B,EAAkCQ,CAAC,IAAI,CAAvC,EAA0CA,CAAC,EAA3C,EAA+C;AAC3C,QAAMD,OAAO,GAAGF,QAAQ,CAACG,CAAD,CAAxB;;AACA,QAAI,CAACD,OAAL,EAAc;AACV;AACH;;AAJ0C,QAMnCL,OANmC,GAMuBK,OANvB,CAMnCL,OANmC;AAAA,QAM1BQ,OAN0B,GAMuBH,OANvB,CAM1BG,OAN0B;AAAA,QAMjBsF,cANiB,GAMuBzF,OANvB,CAMjByF,cANiB;AAAA,QAMDC,mBANC,GAMuB1F,OANvB,CAMD0F,mBANC;;AAQ3C,QAAID,cAAJ,EAAoB;AAChBH,MAAAA,KAAK,CAACK,GAAN,CAAUF,cAAV,EAA0BA,cAA1B;AACH;;AAED,QAAIC,mBAAJ,EAAyB;AACrBnG,MAAAA,MAAM,GAAGI,OAAT;AACA6F,MAAAA,OAAO,CAACG,GAAR,CAAYD,mBAAZ,EAAiCA,mBAAjC;AACH;;AAED,QAAIvF,OAAJ,EAAa;AACT,cAAQA,OAAO,CAAC,OAAD,CAAf;AACI,aAAK,kBAAL;AAAyB;AAAA,gBACbM,SADa,GACCN,OADD,CACbM,SADa;AAGrB2B,YAAAA,oBAAoB,CAAC9C,KAAD,EAAQmB,SAAR,EAAmBT,OAAnB,CAApB;AACAU,YAAAA,6BAA6B,CAACpB,KAAD,EAAQmB,SAAR,EAAmBT,OAAnB,CAA7B;AACA;AACH;;AACD,aAAK,cAAL;AAAqB;AAAA,gBACTW,KADS,GACCR,OADD,CACTQ,KADS;AAGjBa,YAAAA,gBAAgB,CAAClC,KAAD,EAAQqB,KAAR,EAAeX,OAAf,CAAhB;AACAY,YAAAA,yBAAyB,CAACtB,KAAD,EAAQqB,KAAR,EAAeX,OAAf,CAAzB;AACA;AACH;;AACD,aAAK,wBAAL;AAA+B;AAAA,gBACnBxC,KADmB,GACT2C,OADS,CACnB3C,KADmB;AAG3BqD,YAAAA,gBAAgB,CAACvB,KAAD,EAAQ9B,KAAR,EAAewC,OAAf,CAAhB;AACAgE,YAAAA,mBAAmB,CAAC1E,KAAD,EAAQ9B,KAAR,EAAewC,OAAf,CAAnB;AACA;AACH;;AACD,aAAK,gBAAL;AAAuB;AAAA,gBACX0C,OADW,GACCvC,OADD,CACXuC,OADW;AAGnBD,YAAAA,kBAAkB,CAACnD,KAAD,EAAQoD,OAAR,EAAiB1C,OAAjB,CAAlB;AACA;AACH;;AACD,aAAK,iBAAL;AAAwB;AAAA,gBACZxB,UADY,GACC2B,OADD,CACZ3B,QADY;AAGpBsE,YAAAA,mBAAmB,CAACxD,KAAD,EAAQd,UAAR,EAAkBwB,OAAlB,CAAnB;AACAc,YAAAA,4BAA4B,CAACxB,KAAD,EAAQd,UAAR,EAAkBwB,OAAlB,CAA5B;AACA;AACH;;AACD,aAAK,aAAL;AAAoB;AAAA,gBACRe,IADQ,GACCZ,OADD,CACRY,IADQ;AAGhBkC,YAAAA,eAAe,CAAC3D,KAAD,EAAQyB,IAAR,EAAcf,OAAd,CAAf;AACAgB,YAAAA,wBAAwB,CAAC1B,KAAD,EAAQyB,IAAR,EAAcf,OAAd,CAAxB;AACA;AACH;;AACD,aAAK,iBAAL;AAAwB;AAAA,gBACZoD,QADY,GACCjD,OADD,CACZiD,QADY;AAGpBS,YAAAA,mBAAmB,CAACvE,KAAD,EAAQ8D,QAAR,EAAkBpD,OAAlB,CAAnB;AACA;AACH;;AACD,aAAK,aAAL;AAAoB;AAAA,gBACRmB,QADQ,GACKhB,OADL,CACRgB,QADQ;;AAEhB,gBAAI,CAACA,QAAL,EAAe;AACX;AACH;;AAJe,gBAMRV,WANQ,GAMsEU,QANtE,CAMRV,SANQ;AAAA,gBAMGE,OANH,GAMsEQ,QANtE,CAMGR,KANH;AAAA,gBAMUnC,UANV,GAMsE2C,QANtE,CAMU3C,QANV;AAAA,gBAMoBhB,OANpB,GAMsE2D,QANtE,CAMoB3D,KANpB;AAAA,gBAM2ByD,OAN3B,GAMsEE,QANtE,CAM2BF,OAN3B;AAAA,gBAMoCG,KANpC,GAMsED,QANtE,CAMoCC,KANpC;AAAA,gBAM2CC,UAN3C,GAMsEF,QANtE,CAM2CE,UAN3C;AAAA,gBAMuDuE,UANvD,GAMsEzE,QANtE,CAMuDyE,UANvD;AAOhB,gBAAIC,SAAS,GAAG,IAAhB;;AAEA,gBAAIpF,WAAJ,EAAe;AACX2B,cAAAA,oBAAoB,CAAC9C,KAAD,EAAQmB,WAAR,EAAmBT,OAAnB,CAApB;AACA6F,cAAAA,SAAS,GAAG,CAACnF,6BAA6B,CAACpB,KAAD,EAAQmB,WAAR,EAAmBT,OAAnB,CAA1C;AACH;;AAED,gBAAIW,OAAJ,EAAW;AACPa,cAAAA,gBAAgB,CAAClC,KAAD,EAAQqB,OAAR,EAAeX,OAAf,CAAhB;AACA6F,cAAAA,SAAS,GAAG,CAACjF,yBAAyB,CAACtB,KAAD,EAAQqB,OAAR,EAAeX,OAAf,CAAtC;AACH;;AAED,gBAAIxB,UAAJ,EAAc;AACVsE,cAAAA,mBAAmB,CAACxD,KAAD,EAAQd,UAAR,EAAkBwB,OAAlB,CAAnB;AACA6F,cAAAA,SAAS,GAAG,CAAC/E,4BAA4B,CAACxB,KAAD,EAAQd,UAAR,EAAkBwB,OAAlB,CAAzC;AACH;;AAED,gBAAIiB,OAAJ,EAAa;AACToD,cAAAA,kBAAkB,CAAC/E,KAAD,EAAQ2B,OAAR,EAAiBjB,OAAjB,CAAlB;AACA6F,cAAAA,SAAS,GAAG,CAAC3E,2BAA2B,CAAC5B,KAAD,EAAQ2B,OAAR,EAAiBjB,OAAjB,CAAxC;AACH;;AAED,gBAAIoB,KAAJ,EAAW;AACP;AACAyE,cAAAA,SAAS,GAAG,CAACvE,yBAAyB,CAAChC,KAAD,EAAQ8B,KAAR,EAAepB,OAAf,CAAtC;AACH;;AAED,gBAAIqB,UAAJ,EAAgB;AACZwD,cAAAA,oBAAoB,CAACvF,KAAD,EAAQ+B,UAAR,EAAoBrB,OAApB,CAApB;AACA6F,cAAAA,SAAS,GAAG,CAACtE,6BAA6B,CAACjC,KAAD,EAAQ+B,UAAR,EAAoBrB,OAApB,CAA1C;AACH;;AAED,gBAAI4F,UAAJ,EAAgB;AACZX,cAAAA,oBAAoB,CAAC3F,KAAD,EAAQsG,UAAR,EAAoB5F,OAApB,CAApB;AACH;;AAED,gBAAI6F,SAAJ,EAAe;AACX7B,cAAAA,mBAAmB,CAAC1E,KAAD,EAAQ9B,OAAR,EAAewC,OAAf,CAAnB;AACAa,cAAAA,gBAAgB,CAACvB,KAAD,EAAQ9B,OAAR,EAAewC,OAAf,CAAhB;AACAmE,cAAAA,yBAAyB,CAAC7E,KAAD,EAAQ9B,OAAR,EAAewC,OAAf,CAAzB;AACH;;AACD;AACH;;AACD,aAAK,cAAL;AAAqB;AAAA,gBACTxC,OADS,GACC2C,OADD,CACT3C,KADS;AAGjBwG,YAAAA,mBAAmB,CAAC1E,KAAD,EAAQ9B,OAAR,EAAewC,OAAf,CAAnB;AACAa,YAAAA,gBAAgB,CAACvB,KAAD,EAAQ9B,OAAR,EAAewC,OAAf,CAAhB;AACAmE,YAAAA,yBAAyB,CAAC7E,KAAD,EAAQ9B,OAAR,EAAewC,OAAf,CAAzB;AACA;AACH;;AACD,aAAK,gBAAL;AAAuB;AAAA,gBACXiB,SADW,GACCd,OADD,CACXc,OADW;AAGnBoD,YAAAA,kBAAkB,CAAC/E,KAAD,EAAQ2B,SAAR,EAAiBjB,OAAjB,CAAlB;AACAkB,YAAAA,2BAA2B,CAAC5B,KAAD,EAAQ2B,SAAR,EAAiBjB,OAAjB,CAA3B;AACA;AACH;;AACD,aAAK,cAAL;AAAqB;AAAA,gBACT8F,KADS,GACC3F,OADD,CACT2F,KADS;AAAA,gBAET1C,SAFS,GAEI0C,KAFJ,CAET1C,QAFS;AAIjBS,YAAAA,mBAAmB,CAACvE,KAAD,EAAQ8D,SAAR,EAAkBpD,OAAlB,CAAnB;AACA;AACH;;AACD,aAAK,cAAL;AAAqB;AAAA,gBACToB,OADS,GACCjB,OADD,CACTiB,KADS,EAGjB;;AACAE,YAAAA,yBAAyB,CAAChC,KAAD,EAAQ8B,OAAR,EAAepB,OAAf,CAAzB;AACA;AACH;;AACD,aAAK,kBAAL;AAAyB;AAAA,gBACbqB,YADa,GACElB,OADF,CACbkB,UADa;AAGrBwD,YAAAA,oBAAoB,CAACvF,KAAD,EAAQ+B,YAAR,EAAoBrB,OAApB,CAApB;AACAuB,YAAAA,6BAA6B,CAACjC,KAAD,EAAQ+B,YAAR,EAAoBrB,OAApB,CAA7B;AACA;AACH;;AACD,aAAK,kBAAL;AAAyB;AAAA,gBACb4F,WADa,GACEzF,OADF,CACbyF,UADa;AAGrBX,YAAAA,oBAAoB,CAAC3F,KAAD,EAAQsG,WAAR,EAAoB5F,OAApB,CAApB;AACA;AACH;;AACD;AAAS;AACL;AACH;AA9IL;AAgJH;AACJ;;AAED+F,EAAAA,gBAAgB,CAACzG,KAAD,qBAAYgG,KAAK,CAACU,IAAN,EAAZ,EAAhB;AACA3G,EAAAA,WAAW,CAACC,KAAD,EAAQC,MAAR,qBAAoBiG,OAAO,CAACQ,IAAR,EAApB,EAAX;AACH;;AAED,OAAO,SAASC,SAAT,CAAmBC,KAAnB,EAA0BlG,OAA1B,EAAmC;AACtC,MAAI,CAACkG,KAAL,EAAY;;AAEZ,UAAQA,KAAK,CAAC,OAAD,CAAb;AACI,SAAK,WAAL;AAAkB;AACdC,QAAAA,aAAa,CAACD,KAAD,EAAQlG,OAAR,CAAb;AACA;AACH;;AACD,SAAK,UAAL;AAAiB;AACboG,QAAAA,YAAY,CAACF,KAAD,EAAQlG,OAAR,CAAZ;AACA;AACH;;AACD,SAAK,OAAL;AAAc;AACVqG,QAAAA,SAAS,CAACH,KAAD,EAAQlG,OAAR,CAAT;AACA;AACH;;AACD,SAAK,OAAL;AAAc;AACVsG,QAAAA,SAAS,CAACJ,KAAD,EAAQlG,OAAR,CAAT;AACA;AACH;AAhBL;AAkBH;;AAED,SAASmG,aAAT,CAAuB1F,SAAvB,EAAkCT,OAAlC,EAA2C;AACvC,MAAMT,MAAM,GAAGS,OAAO,GAAGA,OAAO,CAACL,OAAX,GAAqB,CAA3C;AACA,MAAMgC,SAAS,GAAG3B,OAAO,GAAGA,OAAO,CAACE,EAAX,GAAgB,CAAzC;AAEA,MAAI,CAACO,SAAL,EAAgB;AAJuB,MAMpBnD,IANoB,GAMAmD,SANA,CAM/BA,SAN+B;AAAA,MAMd8F,SANc,GAMA9F,SANA,CAMd8F,SANc;AAOvC,MAAI,CAACjJ,IAAL,EAAW;AAP4B,MAS3BkJ,MAT2B,GAShBlJ,IATgB,CAS/B4C,EAT+B;AAWvCuG,EAAAA,cAAc,CAACnJ,IAAD,EAAOiJ,SAAS,IAAIC,MAApB,EAA4BxG,OAAO,IAAIS,SAAvC,EAAkD;AAAA,WAC5D3D,SAAS,CAACuF,mBAAV,CAA8B9C,MAA9B,EAAsCoC,SAAtC,EAAiD6E,MAAjD,CAD4D;AAAA,GAAlD,CAAd;AAGH;;AAED,SAASJ,YAAT,CAAsB5H,QAAtB,EAAgCwB,OAAhC,EAAyC;AACrC,MAAMT,MAAM,GAAGS,OAAO,GAAGA,OAAO,CAACL,OAAX,GAAqB,CAA3C;AACA,MAAMgC,SAAS,GAAG3B,OAAO,GAAGA,OAAO,CAACE,EAAX,GAAgB,CAAzC;AAEA,MAAI,CAAC1B,QAAL,EAAe;AAJsB,MAMnBlB,IANmB,GAMCkB,QAND,CAM7BA,QAN6B;AAAA,MAMb+H,SANa,GAMC/H,QAND,CAMb+H,SANa;AAOrC,MAAI,CAACjJ,IAAL,EAAW;AAP0B,MASzBkJ,MATyB,GASdlJ,IATc,CAS7B4C,EAT6B;AAWrCuG,EAAAA,cAAc,CAACnJ,IAAD,EAAOiJ,SAAS,IAAIC,MAApB,EAA4BxG,OAAO,IAAIxB,QAAvC,EAAiD;AAAA,WAC3D1B,SAAS,CAACiG,kBAAV,CAA6BxD,MAA7B,EAAqCoC,SAArC,EAAgD6E,MAAhD,CAD2D;AAAA,GAAjD,CAAd;AAGH;;AAED,SAASF,SAAT,CAAmBlF,KAAnB,EAA0BpB,OAA1B,EAAmC;AAC/B,MAAMT,MAAM,GAAGS,OAAO,GAAGA,OAAO,CAACL,OAAX,GAAqB,CAA3C;AACA,MAAMgC,SAAS,GAAG3B,OAAO,GAAGA,OAAO,CAACE,EAAX,GAAgB,CAAzC;AAEA,MAAI,CAACkB,KAAL,EAAY;AAJmB,MAMhB9D,IANgB,GAMI8D,KANJ,CAMvBA,KANuB;AAAA,MAMVmF,SANU,GAMInF,KANJ,CAMVmF,SANU;AAO/B,MAAI,CAACjJ,IAAL,EAAW;AAPoB,MASnBkJ,MATmB,GASRlJ,IATQ,CASvB4C,EATuB;AAW/BuG,EAAAA,cAAc,CAACnJ,IAAD,EAAOiJ,SAAS,IAAIC,MAApB,EAA4BxG,OAAO,IAAIoB,KAAvC,EAA8C;AAAA,WACxDtE,SAAS,CAAC4H,eAAV,CAA0BnF,MAA1B,EAAkCoC,SAAlC,EAA6C6E,MAA7C,CADwD;AAAA,GAA9C,CAAd;AAGH;;AAED,SAASH,SAAT,CAAmB7I,KAAnB,EAA0BwC,OAA1B,EAAmC;AAC/B,MAAMT,MAAM,GAAGS,OAAO,GAAGA,OAAO,CAACL,OAAX,GAAqB,CAA3C;AACA,MAAMgC,SAAS,GAAG3B,OAAO,GAAGA,OAAO,CAACE,EAAX,GAAgB,CAAzC;AAEA,MAAI,CAAC1C,KAAL,EAAY;AAEZ,MAAMuE,SAAS,GAAGxG,OAAO,CAACiC,KAAK,CAACuG,KAAP,EAAc5H,cAAd,CAAzB;AACA,MAAI,CAAC4F,SAAL,EAAgB;AAPe,MAShBzE,IATgB,GASPyE,SATO,CASvBvE,KATuB;AAU/B,MAAI,CAACF,IAAL,EAAW;AAVoB,MAYnBkJ,MAZmB,GAYRlJ,IAZQ,CAYvB4C,EAZuB;AAc/BuG,EAAAA,cAAc,CAACnJ,IAAD,EAAOkJ,MAAM,GAAG,MAAhB,EAAwBxG,OAAO,IAAIxC,KAAnC,EAA0C;AAAA,WAAMV,SAAS,CAACmH,eAAV,CAA0B1E,MAA1B,EAAkCoC,SAAlC,EAA6C6E,MAA7C,CAAN;AAAA,GAA1C,CAAd;AACH;;AAED,SAASC,cAAT,CAAwBnJ,IAAxB,EAA8BoJ,QAA9B,EAAwCC,GAAxC,EAA6CC,QAA7C,EAAuD;AACnD,MAAI,CAACtJ,IAAL,EAAW;AACX,MAAI,CAACoJ,QAAL,EAAe;;AAEf,MAAIpJ,IAAI,CAACuJ,GAAT,EAAc;AACVnJ,IAAAA,QAAQ,CAACJ,IAAI,CAACuJ,GAAN,EAAWH,QAAX,CAAR;AACA;AACH;;AAED,MAAI5I,IAAI,GAAGhB,SAAS,CAAC4E,OAAV,CAAkBpE,IAAI,CAAC4C,EAAvB,KAA8B5C,IAAI,CAACQ,IAA9C;;AACA,MAAIA,IAAJ,EAAU;AACNsB,IAAAA,QAAQ,CAACtB,IAAD,EAAO4I,QAAP,CAAR;AACA;AACH;;AAED5H,EAAAA,QAAQ,CAACxB,IAAD,EAAOqJ,GAAP,EAAY,YAAM;AACtB,QAAIC,QAAJ,EAAcA,QAAQ;AAEtB9I,IAAAA,IAAI,GAAGhB,SAAS,CAAC4E,OAAV,CAAkBpE,IAAI,CAAC4C,EAAvB,KAA8B5C,IAAI,CAACQ,IAA1C;;AACA,QAAIA,IAAJ,EAAU;AACNsB,MAAAA,QAAQ,CAACtB,IAAD,EAAO4I,QAAP,CAAR;AACH;AACJ,GAPO,CAAR;AAQH;;AAED,SAAS5H,QAAT,CAAkBxB,IAAlB,EAAwBqJ,GAAxB,EAA6BC,QAA7B,EAAuC;AACnC,MAAI,CAACtJ,IAAL,EAAW;AADwB,MAE3B4C,EAF2B,GAEb5C,IAFa,CAE3B4C,EAF2B;AAAA,MAEvB4G,KAFuB,GAEbxJ,IAFa,CAEvBwJ,KAFuB;AAInC,MAAMhJ,IAAI,GAAGhB,SAAS,CAAC4E,OAAV,CAAkBxB,EAAlB,CAAb;;AACA,MAAIpC,IAAJ,EAAU;AACN;AACH;;AAED,MAAIgJ,KAAK,CAACC,wBAAV,EAAoC;AAChC,QAAMzH,KAAK,GAAGxC,SAAS,CAACyD,QAAV,EAAd;AAEAzD,IAAAA,SAAS,CAAC8E,YAAV,CAAuBtC,KAAvB,EAA8BhC,IAA9B,EAAoC,IAApC,EAA0CsJ,QAA1C,EAAoD,YAAM;AACtD,UAAIE,KAAK,CAACE,iBAAV,EAA6B;AACzBlK,QAAAA,SAAS,CAACgF,aAAV,CAAwBxE,IAAI,CAAC4C,EAA7B,EAAiCvE,aAAjC,EAAgDgL,GAAhD;AACH;AACJ,KAJD;AAKA;AACH;;AAED,MAAIG,KAAK,CAACE,iBAAV,EAA6B;AACzBlK,IAAAA,SAAS,CAACgF,aAAV,CAAwB5B,EAAxB,EAA4BvE,aAA5B,EAA2CgL,GAA3C;AACH;AACJ;;AAED,SAASM,kBAAT,CAA4Bf,KAA5B,EAAmC;AAC/B,MAAI,CAACA,KAAL,EAAY,OAAO,CAAC,CAAD,EAAI,CAAJ,EAAO,IAAP,CAAP;;AAEZ,UAAQA,KAAK,CAAC,OAAD,CAAb;AACI,SAAK,WAAL;AAAkB;AAAA,YACN3D,SADM,GACQ2D,KADR,CACN3D,SADM;;AAEd,YAAIA,SAAJ,EAAe;AACX,iBAAO,CAACA,SAAS,CAACgB,KAAX,EAAkBhB,SAAS,CAACiB,MAA5B,EAAoCjB,SAAS,CAAC/E,KAA9C,CAAP;AACH;;AACD;AACH;;AACD,SAAK,UAAL;AAAiB;AAAA,YACL+E,UADK,GACS2D,KADT,CACL3D,SADK;;AAEb,YAAIA,UAAJ,EAAe;AACX,iBAAO,CAACA,UAAS,CAACgB,KAAX,EAAkBhB,UAAS,CAACiB,MAA5B,EAAoCjB,UAAS,CAAC/E,KAA9C,CAAP;AACH;;AACD;AACH;;AACD,SAAK,OAAL;AAAc;AACV,eAAO0J,aAAa,CAAChB,KAAD,EAAQ9J,UAAR,CAApB;AACH;;AACD,SAAK,OAAL;AAAc;AAAA,YACFmG,WADE,GACY2D,KADZ,CACF3D,SADE;;AAEV,YAAIA,WAAJ,EAAe;AACX,iBAAO,CAACA,WAAS,CAACgB,KAAX,EAAkBhB,WAAS,CAACiB,MAA5B,EAAoCjB,WAAS,CAAC/E,KAA9C,CAAP;AACH;;AACD;AACH;;AACD;AAAS;AACL,eAAO,CAAC,CAAD,EAAI,CAAJ,EAAO,IAAP,CAAP;AACH;AA3BL;;AA8BA,SAAO,CAAC,CAAD,EAAI,CAAJ,EAAO,IAAP,CAAP;AACH;;AAED,SAAS2J,mBAAT,CAA6B5H,MAA7B,EAAqCoC,SAArC,EAAgD;AAC5C,MAAM3B,OAAO,GAAGjD,YAAY,CAACuD,GAAb,CAAiBf,MAAjB,EAAyBoC,SAAzB,CAAhB;AACA,MAAI,CAAC3B,OAAL,EAAc,OAAO,CAAC,CAAD,EAAI,CAAJ,EAAO,IAAP,CAAP;AAF8B,MAIpCG,OAJoC,GAIxBH,OAJwB,CAIpCG,OAJoC;AAK5C,MAAI,CAACA,OAAL,EAAc,OAAO,CAAC,CAAD,EAAI,CAAJ,EAAO,IAAP,CAAP;;AAEd,UAAQA,OAAO,CAAC,OAAD,CAAf;AACI,SAAK,kBAAL;AAAyB;AAAA,YACbM,SADa,GACCN,OADD,CACbM,SADa;;AAErB,YAAIA,SAAS,IAAIA,SAAS,CAAC8B,SAA3B,EAAsC;AAClC,iBAAO,CAAC9B,SAAS,CAAC8B,SAAV,CAAoBgB,KAArB,EAA4B9C,SAAS,CAAC8B,SAAV,CAAoBiB,MAAhD,EAAwD/C,SAAS,CAAC8B,SAAV,CAAoB/E,KAA5E,CAAP;AACH;;AACD;AACH;;AACD,SAAK,wBAAL;AAA+B;AAC3B,eAAO4J,YAAY,CAAC7H,MAAD,EAASoC,SAAT,EAAoBvF,UAApB,CAAnB;AACH;;AACD,SAAK,iBAAL;AAAwB;AAAA,YACZoC,UADY,GACC2B,OADD,CACZ3B,QADY;;AAEpB,YAAIA,UAAJ,EAAc;AACV,iBAAO,CAAC,EAAD,EAAK,EAAL,EAASA,UAAQ,CAACA,QAAlB,CAAP;AACH;;AACD;AACH;;AACD,SAAK,cAAL;AAAqB;AACjB,eAAO4I,YAAY,CAAC7H,MAAD,EAASoC,SAAT,EAAoBvF,UAApB,CAAnB;AACH;;AACD,SAAK,aAAL;AAAoB;AAAA,YACR+E,QADQ,GACKhB,OADL,CACRgB,QADQ;;AAEhB,YAAIA,QAAJ,EAAc;AAAA,cACFV,WADE,GACoCU,QADpC,CACFV,SADE;AAAA,cACSjC,UADT,GACoC2C,QADpC,CACS3C,QADT;AAAA,cACmB4C,KADnB,GACoCD,QADpC,CACmBC,KADnB;AAAA,cAC0B5D,KAD1B,GACoC2D,QADpC,CAC0B3D,KAD1B;;AAGV,cAAIiD,WAAS,IAAIA,WAAS,CAAC8B,SAA3B,EAAsC;AAClC,mBAAO,CAAC9B,WAAS,CAAC8B,SAAV,CAAoBgB,KAArB,EAA4B9C,WAAS,CAAC8B,SAAV,CAAoBiB,MAAhD,EAAwD/C,WAAS,CAAC8B,SAAV,CAAoB/E,KAA5E,CAAP;AACH;;AAED,cAAIgB,UAAJ,EAAc;AACV,mBAAO,CAAC,EAAD,EAAK,EAAL,EAASA,UAAQ,CAACA,QAAlB,CAAP;AACH;;AAED,cAAI4C,KAAK,IAAIA,KAAK,CAACmB,SAAnB,EAA8B;AAC1B,mBAAO,CAACnB,KAAK,CAACmB,SAAN,CAAgBgB,KAAjB,EAAwBnC,KAAK,CAACmB,SAAN,CAAgBiB,MAAxC,EAAgDpC,KAAK,CAACmB,SAAN,CAAgB/E,KAAhE,CAAP;AACH;;AAED,cAAIA,KAAJ,EAAW;AACP,mBAAO4J,YAAY,CAAC7H,MAAD,EAASoC,SAAT,EAAoBvF,UAApB,CAAnB;AACH;AACJ;;AACD;AACH;;AACD,SAAK,cAAL;AAAqB;AAAA,YACTgF,OADS,GACCjB,OADD,CACTiB,KADS;;AAEjB,YAAIA,OAAK,CAACmB,SAAV,EAAqB;AACjB,iBAAO,CAACnB,OAAK,CAACmB,SAAN,CAAgBgB,KAAjB,EAAwBnC,OAAK,CAACmB,SAAN,CAAgBiB,MAAxC,EAAgDpC,OAAK,CAACmB,SAAN,CAAgB/E,KAAhE,CAAP;AACH;;AACD;AACH;;AACD;AAAS;AACL,eAAO,CAAC,CAAD,EAAI,CAAJ,EAAO,IAAP,CAAP;AACH;AArDL;;AAwDA,SAAO,CAAC,CAAD,EAAI,CAAJ,EAAO,IAAP,CAAP;AACH;;AAED,SAAS0J,aAAT,CAAuBhB,KAAvB,EAA8B/I,IAA9B,EAAoC;AAChC,MAAI,CAACA,IAAL,EAAW,OAAO,CAAC,CAAD,EAAI,CAAJ,EAAO,IAAP,EAAa,EAAb,CAAP;;AAEX,UAAQ+I,KAAK,CAAC,OAAD,CAAb;AACI,SAAK,WAAL;AAAkB;AACd,eAAO,CAACA,KAAK,CAAC3C,KAAP,EAAc2C,KAAK,CAAC1C,MAApB,EAA4B0C,KAAK,CAACzF,SAAlC,EAA6CyF,KAAK,CAACmB,SAAnD,CAAP;AACH;;AACD,SAAK,OAAL;AAAc;AACV,YAAMtF,SAAS,GAAGxG,OAAO,CAAC2K,KAAK,CAACnC,KAAP,EAAc5G,IAAd,CAAzB;;AACA,YAAI4E,SAAJ,EAAe;AACX,iBAAO,CAACA,SAAS,CAACwB,KAAX,EAAkBxB,SAAS,CAACyB,MAA5B,EAAoCzB,SAAS,CAACvE,KAA9C,EAAqD,EAArD,CAAP;AACH;;AACD;AACH;;AACD,SAAK,UAAL;AAAiB;AACb,eAAO,CAAC,EAAD,EAAK,EAAL,EAASgB,QAAQ,CAACA,QAAlB,EAA4BA,QAAQ,CAAC6I,SAArC,CAAP;AACH;;AACD,SAAK,OAAL;AAAc;AACV,eAAO,CAACnB,KAAK,CAAC3C,KAAP,EAAc2C,KAAK,CAAC1C,MAApB,EAA4B0C,KAAK,CAAC9E,KAAlC,EAAyC8E,KAAK,CAACmB,SAA/C,CAAP;AACH;;AACD;AAAS,OACR;AAlBL;;AAqBA,SAAO,CAAC,CAAD,EAAI,CAAJ,EAAO,IAAP,EAAa,EAAb,CAAP;AACH;;AAED,SAASD,YAAT,CAAsB7H,MAAtB,EAA8BoC,SAA9B,EAAyCxE,IAAzC,EAA+C;AAC3C,MAAI,CAACA,IAAL,EAAW,OAAO,CAAC,CAAD,EAAI,CAAJ,EAAO,IAAP,CAAP;AACX,MAAM6C,OAAO,GAAGjD,YAAY,CAACuD,GAAb,CAAiBf,MAAjB,EAAyBoC,SAAzB,CAAhB;AACA,MAAI,CAAC3B,OAAL,EAAc,OAAO,CAAC,CAAD,EAAI,CAAJ,EAAO,IAAP,EAAa,EAAb,CAAP;AAH6B,MAKnCG,OALmC,GAKvBH,OALuB,CAKnCG,OALmC;AAM3C,MAAI,CAACA,OAAL,EAAc,OAAO,CAAC,CAAD,EAAI,CAAJ,EAAO,IAAP,EAAa,EAAb,CAAP;;AAEd,UAAQA,OAAO,CAAC,OAAD,CAAf;AACI,SAAK,kBAAL;AAAyB;AAAA,YACbM,SADa,GACCN,OADD,CACbM,SADa;;AAErB,YAAIA,SAAJ,EAAe;AAAA,cACH8C,KADG,GAC2C9C,SAD3C,CACH8C,KADG;AAAA,cACIC,MADJ,GAC2C/C,SAD3C,CACI+C,MADJ;AAAA,cACuBlG,IADvB,GAC2CmD,SAD3C,CACYA,SADZ;AAAA,cAC6B4G,SAD7B,GAC2C5G,SAD3C,CAC6B4G,SAD7B;AAEX,iBAAO,CAAC9D,KAAD,EAAQC,MAAR,EAAgBlG,IAAhB,EAAsB+J,SAAtB,CAAP;AACH;;AACD;AACH;;AACD,SAAK,wBAAL;AAA+B;AAAA,YACnB7J,KADmB,GACT2C,OADS,CACnB3C,KADmB;;AAE3B,YAAIA,KAAJ,EAAW;AACP,cAAMuE,SAAS,GAAGxG,OAAO,CAACiC,KAAK,CAACuG,KAAP,EAAc5G,IAAd,CAAzB;;AACA,cAAI4E,SAAJ,EAAe;AAAA,gBACHwB,MADG,GAC4BxB,SAD5B,CACHwB,KADG;AAAA,gBACIC,OADJ,GAC4BzB,SAD5B,CACIyB,MADJ;AAAA,gBACmBlG,OADnB,GAC4ByE,SAD5B,CACYvE,KADZ;AAEX,mBAAO,CAAC+F,MAAD,EAAQC,OAAR,EAAgBlG,OAAhB,EAAsB,EAAtB,CAAP;AACH;AACJ;;AACD;AACH;;AACD,SAAK,iBAAL;AAAwB;AAAA,YACZkB,UADY,GACC2B,OADD,CACZ3B,QADY;;AAEpB,YAAIA,UAAJ,EAAc;AAAA,cACQlB,OADR,GAC4BkB,UAD5B,CACFA,QADE;AAAA,cACc6I,UADd,GAC4B7I,UAD5B,CACc6I,SADd;AAEV,iBAAO,CAAC,EAAD,EAAK,EAAL,EAAS/J,OAAT,EAAe+J,UAAf,CAAP;AACH;;AACD;AACH;;AACD,SAAK,cAAL;AAAqB;AAAA,YACT7J,OADS,GACC2C,OADD,CACT3C,KADS;;AAEjB,YAAIA,OAAJ,EAAW;AACP,cAAMuE,UAAS,GAAGxG,OAAO,CAACiC,OAAK,CAACuG,KAAP,EAAc5G,IAAd,CAAzB;;AACA,cAAI4E,UAAJ,EAAe;AAAA,gBACHwB,OADG,GAC4BxB,UAD5B,CACHwB,KADG;AAAA,gBACIC,QADJ,GAC4BzB,UAD5B,CACIyB,MADJ;AAAA,gBACmBlG,OADnB,GAC4ByE,UAD5B,CACYvE,KADZ;AAEX,mBAAO,CAAC+F,OAAD,EAAQC,QAAR,EAAgBlG,OAAhB,EAAsB,EAAtB,CAAP;AACH;AACJ;;AACD;AACH;;AACD,SAAK,aAAL;AAAoB;AAAA,YACR6D,QADQ,GACKhB,OADL,CACRgB,QADQ;;AAEhB,YAAIA,QAAJ,EAAc;AAAA,cACFV,WADE,GACoCU,QADpC,CACFV,SADE;AAAA,cACSjC,UADT,GACoC2C,QADpC,CACS3C,QADT;AAAA,cACmBhB,OADnB,GACoC2D,QADpC,CACmB3D,KADnB;AAAA,cAC0B4D,KAD1B,GACoCD,QADpC,CAC0BC,KAD1B;;AAEV,cAAIX,WAAJ,EAAe;AAAA,gBACH8C,OADG,GAC2C9C,WAD3C,CACH8C,KADG;AAAA,gBACIC,QADJ,GAC2C/C,WAD3C,CACI+C,MADJ;AAAA,gBACuBlG,OADvB,GAC2CmD,WAD3C,CACYA,SADZ;AAAA,gBAC6B4G,WAD7B,GAC2C5G,WAD3C,CAC6B4G,SAD7B;AAEX,mBAAO,CAAC9D,OAAD,EAAQC,QAAR,EAAgBlG,OAAhB,EAAsB+J,WAAtB,CAAP;AACH;;AAED,cAAI7I,UAAJ,EAAc;AAAA,gBACQlB,OADR,GAC4BkB,UAD5B,CACFA,QADE;AAAA,gBACc6I,WADd,GAC4B7I,UAD5B,CACc6I,SADd;AAEV,mBAAO,CAAC,EAAD,EAAK,EAAL,EAAS/J,OAAT,EAAe+J,WAAf,CAAP;AACH;;AAED,cAAI7J,OAAJ,EAAW;AACP,gBAAMuE,WAAS,GAAGxG,OAAO,CAACiC,OAAK,CAACuG,KAAP,EAAc5G,IAAd,CAAzB;;AACA,gBAAI4E,WAAJ,EAAe;AAAA,kBACHwB,OADG,GAC4BxB,WAD5B,CACHwB,KADG;AAAA,kBACIC,QADJ,GAC4BzB,WAD5B,CACIyB,MADJ;AAAA,kBACmBlG,OADnB,GAC4ByE,WAD5B,CACYvE,KADZ;AAEX,qBAAO,CAAC+F,OAAD,EAAQC,QAAR,EAAgBlG,OAAhB,EAAsB,EAAtB,CAAP;AACH;;AACD;AACH;;AAED,cAAI8D,KAAJ,EAAW;AAAA,gBACCmC,OADD,GAC2CnC,KAD3C,CACCmC,KADD;AAAA,gBACQC,QADR,GAC2CpC,KAD3C,CACQoC,MADR;AAAA,gBACuBlG,OADvB,GAC2C8D,KAD3C,CACgBA,KADhB;AAAA,gBAC6BiG,WAD7B,GAC2CjG,KAD3C,CAC6BiG,SAD7B;AAEP,mBAAO,CAAC9D,OAAD,EAAQC,QAAR,EAAgBlG,OAAhB,EAAsB+J,WAAtB,CAAP;AACH;AACJ;;AACD;AACH;;AACD,SAAK,cAAL;AAAqB;AAAA,YACTjG,OADS,GACCjB,OADD,CACTiB,KADS;;AAEjB,YAAIA,OAAJ,EAAW;AAAA,cACCmC,OADD,GAC2CnC,OAD3C,CACCmC,KADD;AAAA,cACQC,QADR,GAC2CpC,OAD3C,CACQoC,MADR;AAAA,cACuBlG,OADvB,GAC2C8D,OAD3C,CACgBA,KADhB;AAAA,cAC6BiG,WAD7B,GAC2CjG,OAD3C,CAC6BiG,SAD7B;AAEP,iBAAO,CAAC9D,OAAD,EAAQC,QAAR,EAAgBlG,OAAhB,EAAsB+J,WAAtB,CAAP;AACH;;AACD;AACH;;AACD;AAAS,OACR;AA9EL;;AAiFA,SAAO,CAAC,CAAD,EAAI,CAAJ,EAAO,IAAP,EAAa,EAAb,CAAP;AACH;;AAED,OAAO,SAASC,8BAAT,CAAwCC,MAAxC,EAAgD;AACnD,MAAI,CAACA,MAAL,EAAa;AACb,MAAI,CAACA,MAAM,CAAC9H,MAAZ,EAAoB;;AAEpB,OAAK,IAAIQ,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGsH,MAAM,CAAC9H,MAA3B,EAAmCQ,CAAC,EAApC,EAAwC;AACpC,QAAME,OAAO,GAAGoH,MAAM,CAACtH,CAAD,CAAtB;;AACA,QAAIE,OAAJ,EAAa;AACT,cAAQA,OAAO,CAAC,OAAD,CAAf;AACI,aAAK,oBAAL;AAA2B;AAAA,gBACfM,SADe,GACDN,OADC,CACfM,SADe;AAEvB,gBAAI,CAACA,SAAL,EAAgB;AAEhB6B,YAAAA,mCAAmC,CAAC7B,SAAD,CAAnC;AACAyB,YAAAA,0BAA0B,CAACzB,SAAD,CAA1B;AACA;AACH;;AACD,aAAK,gBAAL;AAAuB;AAAA,gBACXjD,KADW,GACD2C,OADC,CACX3C,KADW;AAEnB,gBAAI,CAACA,KAAL,EAAY;AAEZsG,YAAAA,yBAAyB,CAACtG,KAAD,CAAzB;AACA;AACH;;AACD,aAAK,gBAAL;AAAuB;AAAA,gBACX4D,KADW,GACDjB,OADC,CACXiB,KADW;AAEnB,gBAAI,CAACA,KAAL,EAAY;AAEZuD,YAAAA,+BAA+B,CAACvD,KAAD,CAA/B;AACAoD,YAAAA,sBAAsB,CAACpD,KAAD,CAAtB;AACA;AACH;AAvBL;AAyBH;AACJ;AACJ;;AAED,SAASoG,4BAAT,CAAsC1H,QAAtC,EAAgD;AAC5C,MAAI,CAACA,QAAL,EAAe;AACf,MAAI,CAACA,QAAQ,CAACL,MAAd,EAAsB;;AAEtB,OAAK,IAAIQ,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGH,QAAQ,CAACL,MAA7B,EAAqCQ,CAAC,EAAtC,EAA0C;AACtC,QAAID,OAAO,GAAGF,QAAQ,CAACG,CAAD,CAAtB;AADsC,QAE9BE,OAF8B,GAElBH,OAFkB,CAE9BG,OAF8B;;AAGtC,QAAIA,OAAJ,EAAa;AACT,cAAQA,OAAO,CAAC,OAAD,CAAf;AACI,aAAK,kBAAL;AAAyB;AAAA,gBACbM,SADa,GACCN,OADD,CACbM,SADa;AAErB,gBAAI,CAACA,SAAL,EAAgB;AAEhB6B,YAAAA,mCAAmC,CAAC7B,SAAD,CAAnC;AACAyB,YAAAA,0BAA0B,CAACzB,SAAD,CAA1B;AACA;AACH;;AACD,aAAK,cAAL;AAAqB;AAAA,gBACTjD,KADS,GACC2C,OADD,CACT3C,KADS;AAEjB,gBAAI,CAACA,KAAL,EAAY;AAEZsG,YAAAA,yBAAyB,CAACtG,KAAD,CAAzB;AACA;AACH;;AACD,aAAK,cAAL;AAAqB;AAAA,gBACT4D,KADS,GACCjB,OADD,CACTiB,KADS;AAEjB,gBAAI,CAACA,KAAL,EAAY;AAEZuD,YAAAA,+BAA+B,CAACvD,KAAD,CAA/B;AACAoD,YAAAA,sBAAsB,CAACpD,KAAD,CAAtB;AACA;AACH;;AACD,aAAK,aAAL;AAAoB;AAAA,gBACRD,QADQ,GACKnB,OAAO,CAACG,OADb,CACRgB,QADQ;;AAEhB,gBAAIA,QAAJ,EAAc;AAAA,kBACFV,WADE,GAC0BU,QAD1B,CACFV,SADE;AAAA,kBACSjD,OADT,GAC0B2D,QAD1B,CACS3D,KADT;AAAA,kBACgB4D,OADhB,GAC0BD,QAD1B,CACgBC,KADhB;;AAGV,kBAAIX,WAAJ,EAAe;AACX6B,gBAAAA,mCAAmC,CAAC7B,WAAD,CAAnC;AACAyB,gBAAAA,0BAA0B,CAACzB,WAAD,CAA1B;AACH;;AAED,kBAAIjD,OAAJ,EAAW;AACPsG,gBAAAA,yBAAyB,CAACtG,OAAD,CAAzB;AACH;;AAED,kBAAI4D,OAAJ,EAAW;AACPuD,gBAAAA,+BAA+B,CAACvD,OAAD,CAA/B;AACAoD,gBAAAA,sBAAsB,CAACpD,OAAD,CAAtB;AACH;AACJ;;AAED;AACH;AA7CL;AA+CH;AACJ;AACJ;;AAED,OAAO,SAASqG,wBAAT,CAAkCF,MAAlC,EAAgE;AAAA,MAAtBG,YAAsB,uEAAP,KAAO;AACnE,MAAI,CAACH,MAAL,EAAa;AACb,MAAI,CAACA,MAAM,CAAC9H,MAAZ,EAAoB;AAEpB,MAAMH,KAAK,GAAGxC,SAAS,CAACyD,QAAV,EAAd;;AAEA,OAAK,IAAIN,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGsH,MAAM,CAAC9H,MAA3B,EAAmCQ,CAAC,EAApC,EAAwC;AACpC,QAAME,OAAO,GAAGoH,MAAM,CAACtH,CAAD,CAAtB;;AACA,QAAIE,OAAJ,EAAa;AACT,cAAQA,OAAO,CAAC,OAAD,CAAf;AACI,aAAK,oBAAL;AAA2B;AAAA,gBACfM,SADe,GACDN,OADC,CACfM,SADe;AAGvB2B,YAAAA,oBAAoB,CAAC9C,KAAD,EAAQmB,SAAR,EAAmB,IAAnB,EAAyBiH,YAAzB,CAApB;AACAhH,YAAAA,6BAA6B,CAACpB,KAAD,EAAQmB,SAAR,EAAmB,IAAnB,CAA7B;AACA;AACH;;AACD,aAAK,gBAAL;AAAuB;AAAA,gBACXjD,KADW,GACD2C,OADC,CACX3C,KADW;AAGnBwG,YAAAA,mBAAmB,CAAC1E,KAAD,EAAQ9B,KAAR,EAAe,IAAf,CAAnB;AACA;AACH;;AACD,aAAK,gBAAL;AAAuB;AAAA,gBACX4D,KADW,GACDjB,OADC,CACXiB,KADW;AAGnBE,YAAAA,yBAAyB,CAAChC,KAAD,EAAQ8B,KAAR,EAAe,IAAf,CAAzB;AACAqD,YAAAA,gBAAgB,CAACnF,KAAD,EAAQ8B,KAAR,EAAe,IAAf,EAAqBsG,YAArB,CAAhB;AACA;AACH;AApBL;AAsBH;AACJ;AACJ;;AAED,SAASC,sBAAT,CAAgC7H,QAAhC,EAAgE;AAAA,MAAtB4H,YAAsB,uEAAP,KAAO;AAC5D,MAAI,CAAC5H,QAAL,EAAe;AACf,MAAI,CAACA,QAAQ,CAACL,MAAd,EAAsB;AAEtB,MAAMH,KAAK,GAAGxC,SAAS,CAACyD,QAAV,EAAd;;AAEA,OAAK,IAAIN,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGH,QAAQ,CAACL,MAA7B,EAAqCQ,CAAC,EAAtC,EAA0C;AACtC,QAAID,OAAO,GAAGF,QAAQ,CAACG,CAAD,CAAtB;AADsC,QAE9BE,OAF8B,GAElBH,OAFkB,CAE9BG,OAF8B;;AAGtC,QAAIA,OAAJ,EAAa;AACT,cAAQA,OAAO,CAAC,OAAD,CAAf;AACI,aAAK,kBAAL;AAAyB;AAAA,gBACbM,SADa,GACCN,OADD,CACbM,SADa;AAGrB2B,YAAAA,oBAAoB,CAAC9C,KAAD,EAAQmB,SAAR,EAAmBT,OAAnB,EAA4B0H,YAA5B,CAApB;AACAhH,YAAAA,6BAA6B,CAACpB,KAAD,EAAQmB,SAAR,EAAmBT,OAAnB,CAA7B;AACA;AACH;;AACD,aAAK,wBAAL;AAA+B;AAAA,gBACnBxC,KADmB,GACT2C,OADS,CACnB3C,KADmB;AAG3BwG,YAAAA,mBAAmB,CAAC1E,KAAD,EAAQ9B,KAAR,EAAewC,OAAf,CAAnB;AACA;AACH;;AACD,aAAK,iBAAL;AAAwB;AAAA,gBACZxB,UADY,GACC2B,OADD,CACZ3B,QADY;AAGpBsE,YAAAA,mBAAmB,CAACxD,KAAD,EAAQd,UAAR,EAAkBwB,OAAlB,EAA2B0H,YAA3B,CAAnB;AACA;AACH;;AACD,aAAK,cAAL;AAAqB;AAAA,gBACTlK,OADS,GACC2C,OADD,CACT3C,KADS;AAGjBwG,YAAAA,mBAAmB,CAAC1E,KAAD,EAAQ9B,OAAR,EAAewC,OAAf,CAAnB;AACA;AACH;;AACD,aAAK,aAAL;AAAoB;AAAA,gBACRmB,QADQ,GACKnB,OAAO,CAACG,OADb,CACRgB,QADQ;;AAEhB,gBAAI,CAACA,QAAL,EAAe;AACX;AACH;;AAJe,gBAMRV,WANQ,GAM8BU,QAN9B,CAMRV,SANQ;AAAA,gBAMGjC,WANH,GAM8B2C,QAN9B,CAMG3C,QANH;AAAA,gBAMahB,OANb,GAM8B2D,QAN9B,CAMa3D,KANb;AAAA,gBAMoB4D,KANpB,GAM8BD,QAN9B,CAMoBC,KANpB;AAOhB,gBAAIyE,SAAS,GAAG,IAAhB;;AAEA,gBAAIpF,WAAJ,EAAe;AACX2B,cAAAA,oBAAoB,CAAC9C,KAAD,EAAQmB,WAAR,EAAmBT,OAAnB,EAA4B0H,YAA5B,CAApB;AACA7B,cAAAA,SAAS,GAAG,CAACnF,6BAA6B,CAACpB,KAAD,EAAQmB,WAAR,EAAmBT,OAAnB,CAA1C;AACH;;AAED,gBAAIxB,WAAJ,EAAc;AACVsE,cAAAA,mBAAmB,CAACxD,KAAD,EAAQd,WAAR,EAAkBwB,OAAlB,EAA2B0H,YAA3B,CAAnB;AACA7B,cAAAA,SAAS,GAAG,KAAZ;AACH;;AAED,gBAAIzE,KAAJ,EAAW;AACPqD,cAAAA,gBAAgB,CAACnF,KAAD,EAAQ8B,KAAR,EAAepB,OAAf,EAAwB0H,YAAxB,CAAhB;AACA7B,cAAAA,SAAS,GAAG,CAACvE,yBAAyB,CAAChC,KAAD,EAAQ8B,KAAR,EAAepB,OAAf,CAAtC;AACH;;AAED,gBAAI6F,SAAJ,EAAe;AACX7B,cAAAA,mBAAmB,CAAC1E,KAAD,EAAQ9B,OAAR,EAAewC,OAAf,CAAnB;AACH;;AAED;AACH;;AACD,aAAK,cAAL;AAAqB;AAAA,gBACToB,OADS,GACCjB,OADD,CACTiB,KADS;AAGjBE,YAAAA,yBAAyB,CAAChC,KAAD,EAAQ8B,OAAR,EAAepB,OAAf,CAAzB;AACAyE,YAAAA,gBAAgB,CAACnF,KAAD,EAAQ8B,OAAR,EAAepB,OAAf,EAAwB0H,YAAxB,CAAhB;AACA;AACH;AA9DL;AAgEH;AACJ;AACJ;;AAED,OAAO,SAASE,iCAAT,CAA2CC,KAA3C,EAAkDN,MAAlD,EAA0D;AAC7D,MAAI,CAACA,MAAM,CAAC9H,MAAZ,EAAoB;AAEpB,MAAMqI,OAAO,GAAG,EAAhB;;AACA,MAAID,KAAK,GAAG,CAAZ,EAAe;AACXC,IAAAA,OAAO,CAACC,IAAR,CAAaR,MAAM,CAACM,KAAK,GAAG,CAAT,CAAnB;AACH;;AACD,MAAIA,KAAK,GAAGN,MAAM,CAAC9H,MAAP,GAAgB,CAA5B,EAA+B;AAC3BqI,IAAAA,OAAO,CAACC,IAAR,CAAaR,MAAM,CAACM,KAAK,GAAG,CAAT,CAAnB;AACH;;AAEDP,EAAAA,8BAA8B,CAAC,CAACC,MAAM,CAACM,KAAD,CAAP,CAAD,CAA9B;AACAP,EAAAA,8BAA8B,CAACC,MAAD,CAA9B;AACH;;AAED,SAASS,+BAAT,CAAyCH,KAAzC,EAAgDI,OAAhD,EAAyD;AACrD,MAAI,CAACA,OAAO,CAACxI,MAAb,EAAqB;AAErB,MAAMK,QAAQ,GAAG,EAAjB;;AACA,MAAI+H,KAAK,GAAG,CAAZ,EAAe;AACX/H,IAAAA,QAAQ,CAACiI,IAAT,CAAcE,OAAO,CAACJ,KAAK,GAAG,CAAT,CAArB;AACH;;AACD,MAAIA,KAAK,GAAGI,OAAO,CAACxI,MAAR,GAAiB,CAA7B,EAAgC;AAC5BK,IAAAA,QAAQ,CAACiI,IAAT,CAAcE,OAAO,CAACJ,KAAK,GAAG,CAAT,CAArB;AACH;;AAEDL,EAAAA,4BAA4B,CAAC,CAACS,OAAO,CAACJ,KAAD,CAAR,CAAD,CAA5B;AACAL,EAAAA,4BAA4B,CAAC1H,QAAD,CAA5B;AACH;;AAED,SAASoI,yBAAT,CAAmCL,KAAnC,EAA0CI,OAA1C,EAAmD;AAC/C,MAAI,CAACA,OAAO,CAACxI,MAAb,EAAqB;AAErB,MAAMK,QAAQ,GAAG,EAAjB;;AACA,MAAI+H,KAAK,GAAG,CAAZ,EAAe;AACX/H,IAAAA,QAAQ,CAACiI,IAAT,CAAcE,OAAO,CAACJ,KAAK,GAAG,CAAT,CAArB;AACH;;AACD,MAAIA,KAAK,GAAGI,OAAO,CAACxI,MAAR,GAAiB,CAA7B,EAAgC;AAC5BK,IAAAA,QAAQ,CAACiI,IAAT,CAAcE,OAAO,CAACJ,KAAK,GAAG,CAAT,CAArB;AACH;;AAEDF,EAAAA,sBAAsB,CAAC,CAACM,OAAO,CAACJ,KAAD,CAAR,CAAD,EAAmB,KAAnB,CAAtB;AACAF,EAAAA,sBAAsB,CAAC7H,QAAD,EAAW,IAAX,CAAtB;AACH;;AAED,OAAO,SAASqI,2BAAT,CAAqCN,KAArC,EAA4CN,MAA5C,EAAoD;AACvD,MAAI,CAACA,MAAM,CAAC9H,MAAZ,EAAoB;AAEpB,MAAMqI,OAAO,GAAG,EAAhB;;AACA,MAAID,KAAK,GAAG,CAAZ,EAAe;AACXC,IAAAA,OAAO,CAACC,IAAR,CAAaR,MAAM,CAACM,KAAK,GAAG,CAAT,CAAnB;AACH;;AACD,MAAIA,KAAK,GAAGN,MAAM,CAAC9H,MAAP,GAAgB,CAA5B,EAA+B;AAC3BqI,IAAAA,OAAO,CAACC,IAAR,CAAaR,MAAM,CAACM,KAAK,GAAG,CAAT,CAAnB;AACH;;AAEDJ,EAAAA,wBAAwB,CAAC,CAACF,MAAM,CAACM,KAAD,CAAP,CAAD,EAAkB,KAAlB,CAAxB;AACAJ,EAAAA,wBAAwB,CAACK,OAAD,EAAU,IAAV,CAAxB;AACH;;AAED,SAASM,mBAAT,CAA6B9I,KAA7B,EAAoChC,IAApC,EAA0C+K,MAA1C,EAAkD;AAC9C,MAAI,CAAC/K,IAAL,EAAW;AADmC,gBAG/BA,IAH+B;AAAA,MAGtC4C,EAHsC,WAGtCA,EAHsC;AAI9C5C,EAAAA,IAAI,GAAGR,SAAS,CAACwD,GAAV,CAAcJ,EAAd,KAAqB5C,IAA5B;AAEA,MAAMsF,IAAI,GAAG5F,SAAS,CAACsD,GAAV,CAAc+H,MAAd,CAAb;AACA,MAAI,CAACzF,IAAL,EAAW;AAEX,MAAM9E,IAAI,GAAGR,IAAI,CAACQ,IAAL,IAAahB,SAAS,CAAC4E,OAAV,CAAkBxB,EAAlB,CAA1B;AACA,MAAIpC,IAAJ,EAAU;AAEVhB,EAAAA,SAAS,CAAC8E,YAAV,CACItC,KADJ,EAEIhC,IAFJ,EAGI,IAHJ,EAII;AAAA,WAAMR,SAAS,CAACwL,mBAAV,CAA8BD,MAA9B,EAAsCnI,EAAtC,CAAN;AAAA,GAJJ,EAKI;AAAA,WAAMpD,SAAS,CAACgF,aAAV,CAAwB5B,EAAxB,EAA4BtD,kBAA5B,EAAgDgG,IAAhD,CAAN;AAAA,GALJ;AAOH;;AAED,SAAS2F,mBAAT,CAA6BjJ,KAA7B,EAAoChC,IAApC,EAA0CiC,MAA1C,EAAkD;AAC9C,MAAI,CAACjC,IAAL,EAAW;AADmC,gBAG/BA,IAH+B;AAAA,MAGtC4C,EAHsC,WAGtCA,EAHsC;AAI9C5C,EAAAA,IAAI,GAAGR,SAAS,CAACwD,GAAV,CAAcJ,EAAd,KAAqB5C,IAA5B;AAEA,MAAMkL,IAAI,GAAG3L,SAAS,CAACyD,GAAV,CAAcf,MAAd,CAAb;AACA,MAAI,CAACiJ,IAAL,EAAW;AAEX,MAAMC,OAAO,GAAG3L,SAAS,CAAC4L,UAAV,CAAqBxI,EAArB,CAAhB;AACA,MAAIuI,OAAJ,EAAa;AAEb,MAAM3K,IAAI,GAAGR,IAAI,CAACQ,IAAL,IAAahB,SAAS,CAAC4E,OAAV,CAAkBxB,EAAlB,CAA1B;AACA,MAAIpC,IAAJ,EAAU;AAEVhB,EAAAA,SAAS,CAAC8E,YAAV,CACItC,KADJ,EAEIhC,IAFJ,EAGI,IAHJ,EAII;AAAA,WAAMR,SAAS,CAAC6L,mBAAV,CAA8BpJ,MAA9B,EAAsCW,EAAtC,CAAN;AAAA,GAJJ,EAKI;AAAA,WAAMpD,SAAS,CAACgF,aAAV,CAAwB5B,EAAxB,EAA4BtD,kBAA5B,EAAgD4L,IAAhD,CAAN;AAAA,GALJ;AAOH;;AAED,SAASI,6BAAT,CAAuCrJ,MAAvC,EAA+CsJ,MAA/C,EAAuD;AACnD,MAAI,CAACA,MAAL,EAAa;AAEb,MAAMvJ,KAAK,GAAGxC,SAAS,CAACyD,QAAV,EAAd;AAEAsI,EAAAA,MAAM,CAACC,OAAP,CAAe,UAAAtL,KAAK,EAAI;AACpB,YAAQA,KAAK,CAAC,OAAD,CAAb;AACI,WAAK,WAAL;AAAkB;AAAA,yBACSA,KADT;AAAA,cACNuL,KADM,YACNA,KADM;AAAA,cACCtL,GADD,YACCA,GADD;AAGd8K,UAAAA,mBAAmB,CAACjJ,KAAD,EAAQyJ,KAAR,EAAexJ,MAAf,CAAnB;AACAgJ,UAAAA,mBAAmB,CAACjJ,KAAD,EAAQ7B,GAAR,EAAa8B,MAAb,CAAnB;AACA;AACH;;AACD,WAAK,cAAL;AAAqB;AACjB,cAAM8I,MAAM,GAAG7M,aAAa,CAAC+D,MAAD,CAA5B;AADiB,yBAGM/B,KAHN;AAAA,cAGTuL,MAHS,YAGTA,KAHS;AAAA,cAGFtL,IAHE,YAGFA,GAHE;AAKjB2K,UAAAA,mBAAmB,CAAC9I,KAAD,EAAQyJ,MAAR,EAAeV,MAAf,CAAnB;AACAD,UAAAA,mBAAmB,CAAC9I,KAAD,EAAQ7B,IAAR,EAAa4K,MAAb,CAAnB;AACA;AACH;;AACD,WAAK,kBAAL;AAAyB;AACrB7K,UAAAA,KAAK,GAAG/B,eAAe,CAAC+B,KAAD,CAAvB;AACA,cAAI,CAACA,KAAL,EAAY;;AAEZ,cAAM6K,OAAM,GAAG7M,aAAa,CAAC+D,MAAD,CAA5B;;AAJqB,yBAME/B,KANF;AAAA,cAMbuL,OANa,YAMbA,KANa;AAAA,cAMNtL,KANM,YAMNA,GANM;AAQrB2K,UAAAA,mBAAmB,CAAC9I,KAAD,EAAQyJ,OAAR,EAAeV,OAAf,CAAnB;AACAD,UAAAA,mBAAmB,CAAC9I,KAAD,EAAQ7B,KAAR,EAAa4K,OAAb,CAAnB;AACA;AACH;AA5BL;AA8BH,GA/BD;AAgCH;;AAED,SAASW,gCAAT,CAA0CzJ,MAA1C,EAAkDsI,KAAlD,EAAyDI,OAAzD,EAAkE;AAC9D,MAAI,CAACA,OAAO,CAACxI,MAAb,EAAqB;AAErB,MAAMwJ,KAAK,GAAG,EAAd;;AACA,MAAIpB,KAAK,GAAG,CAAZ,EAAe;AACXoB,IAAAA,KAAK,CAAClB,IAAN,CAAWE,OAAO,CAACJ,KAAK,GAAG,CAAT,CAAlB;AACH;;AACD,MAAIA,KAAK,GAAGI,OAAO,CAACxI,MAAR,GAAiB,CAA7B,EAAgC;AAC5BwJ,IAAAA,KAAK,CAAClB,IAAN,CAAWE,OAAO,CAACJ,KAAK,GAAG,CAAT,CAAlB;AACH;;AACD,MAAIA,KAAK,IAAI,CAAT,IAAcA,KAAK,GAAGI,OAAO,CAACxI,MAAlC,EAA0C;AACtCwJ,IAAAA,KAAK,CAAClB,IAAN,CAAWE,OAAO,CAACJ,KAAD,CAAlB;AACH;;AAEDe,EAAAA,6BAA6B,CAACrJ,MAAD,EAAS0J,KAAT,CAA7B;AACH;;AAED,SAASpG,eAAT,CAAyBvD,KAAzB,EAAgC+I,MAAhC,EAAwC;AACpC,MAAMzF,IAAI,GAAG5F,SAAS,CAACsD,GAAV,CAAc+H,MAAd,CAAb;AACA,MAAI,CAACzF,IAAL,EAAW;AAFyB,MAI5BsG,aAJ4B,GAIVtG,IAJU,CAI5BsG,aAJ4B;AAKpC,MAAI,CAACA,aAAL,EAAoB;AALgB,MAOrB5L,IAPqB,GAOZ4L,aAPY,CAO5BH,KAP4B;AASpCX,EAAAA,mBAAmB,CAAC9I,KAAD,EAAQhC,IAAR,EAAc+K,MAAd,CAAnB;AACH;;AAED,SAAStC,gBAAT,CAA0BzG,KAA1B,EAAiC6J,GAAjC,EAAsC;AAClC,MAAI,CAACA,GAAL,EAAU;AAEVA,EAAAA,GAAG,CAACL,OAAJ,CAAY,UAAA5I,EAAE;AAAA,WAAI2C,eAAe,CAACvD,KAAD,EAAQY,EAAR,CAAnB;AAAA,GAAd;AACH;;AAED,SAASkJ,eAAT,CAAyB9J,KAAzB,EAAgCC,MAAhC,EAAwC;AACpC,MAAMiJ,IAAI,GAAG3L,SAAS,CAACyD,GAAV,CAAcf,MAAd,CAAb;AACA,MAAI,CAACiJ,IAAL,EAAW;AAFyB,MAI5BhL,KAJ4B,GAIlBgL,IAJkB,CAI5BhL,KAJ4B;AAKpC6L,EAAAA,oBAAoB,CAAC/J,KAAD,EAAQ9B,KAAR,EAAegL,IAAI,CAACtI,EAApB,CAApB;AACH;;AAED,SAASmJ,oBAAT,CAA8B/J,KAA9B,EAAqC9B,KAArC,EAA4C+B,MAA5C,EAAoD;AAChD,MAAI,CAAC/B,KAAL,EAAY;AADoC,MAGjCF,IAHiC,GAGxBE,KAHwB,CAGxCuL,KAHwC;AAKhDR,EAAAA,mBAAmB,CAACjJ,KAAD,EAAQhC,IAAR,EAAciC,MAAd,CAAnB;AACH;;AAED,SAAS+J,gBAAT,CAA0BhK,KAA1B,EAAiC6J,GAAjC,EAAsC;AAClC,MAAI,CAACA,GAAL,EAAU;AAEVA,EAAAA,GAAG,CAACL,OAAJ,CAAY,UAAA5I,EAAE;AAAA,WAAIkJ,eAAe,CAAC9J,KAAD,EAAQY,EAAR,CAAnB;AAAA,GAAd;AACH;;AAED,SAASqJ,gBAAT,CAA0BjK,KAA1B,EAAiCC,MAAjC,EAAyC;AACrC,MAAMiJ,IAAI,GAAG3L,SAAS,CAACyD,GAAV,CAAcf,MAAd,CAAb;AACA,MAAI,CAACiJ,IAAL,EAAW;AAF0B,MAI7BgB,aAJ6B,GAIXhB,IAJW,CAI7BgB,aAJ6B;AAKrC,MAAI,CAACA,aAAL,EAAoB;AALiB,MAO7B9D,mBAP6B,GAOL8D,aAPK,CAO7B9D,mBAP6B;AAQrC,MAAI,CAACA,mBAAL,EAA0B;AAE1BrG,EAAAA,WAAW,CAACC,KAAD,EAAQC,MAAR,EAAgB,CAACmG,mBAAD,CAAhB,CAAX;AACH;;AAED,OAAO,SAAS+D,yBAAT,CAAmCnK,KAAnC,EAA0CoK,MAA1C,EAAkD;AACrD,MAAI,CAACA,MAAL,EAAa;AADwC,MAG7CC,QAH6C,GAGhCD,MAHgC,CAG7CC,QAH6C;AAIrDC,EAAAA,mBAAmB,CAACtK,KAAD,EAAQqK,QAAR,CAAnB;AACH;;AAED,SAASE,qBAAT,CAA+BvK,KAA/B,EAAsCwK,UAAtC,EAAkD;AAC9C,MAAI,CAACA,UAAL,EAAiB;AAD6B,MAGtCH,QAHsC,GAGzBG,UAHyB,CAGtCH,QAHsC;AAI9CC,EAAAA,mBAAmB,CAACtK,KAAD,EAAQqK,QAAR,CAAnB;AACH;;AAED,OAAO,SAASI,sBAAT,CAAgCzK,KAAhC,EAAuC0K,WAAvC,EAAoD;AACvD,MAAI,CAACA,WAAL,EAAkB;AAElBA,EAAAA,WAAW,CAAClB,OAAZ,CAAoB,UAAAmB,UAAU,EAAI;AAC9BC,IAAAA,qBAAqB,CAAC5K,KAAD,EAAQ2K,UAAR,EAAoB,KAApB,CAArB;AACH,GAFD;AAGH;AAED,OAAO,SAASC,qBAAT,CAA+B5K,KAA/B,EAAsC2K,UAAtC,EAAgE;AAAA,MAAdE,IAAc,uEAAP,KAAO;AACnE,MAAI,CAACF,UAAL,EAAiB;;AAEjB,UAAQA,UAAU,CAACjM,IAAX,CAAgB,OAAhB,CAAR;AACI,SAAK,oBAAL;AAA2B;AACvB;AACH;;AACD,SAAK,uBAAL;AAA8B;AAAA,YAClBQ,WADkB,GACLyL,UADK,CAClBzL,QADkB;;AAE1B,YAAIA,WAAJ,EAAc;AACVsC,UAAAA,4BAA4B,CAACxB,KAAD,EAAQd,WAAR,EAAkB,IAAlB,CAA5B;AACA,cAAI2L,IAAJ,EAAUrH,mBAAmB,CAACxD,KAAD,EAAQd,WAAR,EAAkB,IAAlB,EAAwB,KAAxB,CAAnB;AACb;;AACD;AACH;;AACD,SAAK,yBAAL;AAAgC;AAAA,YACpBA,WADoB,GACPyL,UADO,CACpBzL,QADoB;;AAE5B,YAAIA,WAAJ,EAAc;AACVsC,UAAAA,4BAA4B,CAACxB,KAAD,EAAQd,WAAR,EAAkB,IAAlB,CAA5B;AACA,cAAI2L,IAAJ,EAAUrH,mBAAmB,CAACxD,KAAD,EAAQd,WAAR,EAAkB,IAAlB,EAAwB,KAAxB,CAAnB;AACb;;AACD;AACH;AAnBL;AAqBH;;AAED,SAASoL,mBAAT,CAA6BtK,KAA7B,EAAoCqK,QAApC,EAA8C;AAC1C,MAAI,CAACA,QAAL,EAAe;AAEfA,EAAAA,QAAQ,CAACb,OAAT,CAAiB,UAAA7H,OAAO,EAAI;AACxBC,IAAAA,2BAA2B,CAAC5B,KAAD,EAAQ2B,OAAR,EAAiB,IAAjB,CAA3B;;AACA,QAAIA,OAAO,CAACmJ,WAAZ,EAAyB;AACrB/F,MAAAA,kBAAkB,CAAC/E,KAAD,EAAQ2B,OAAR,EAAiB,IAAjB,CAAlB;AACH;AACJ,GALD;AAMH;;AAED,SAASoJ,aAAT,CAAuBC,QAAvB,EAAiC;AAC7B,SAAOA,QAAQ,IAAIA,QAAQ,CAACC,WAAT,OAA2B,WAA9C;AACH;;AAED,SAASC,MAAT,CAAgBlN,IAAhB,EAAsB;AAClB,MAAMmL,OAAO,GAAGnL,IAAI,IAAIR,SAAS,CAAC4L,UAAV,CAAqBpL,IAAI,CAAC4C,EAA1B,CAAxB;AACA,MAAIuI,OAAJ,EAAa,OAAOA,OAAP;AAEb,MAAM3K,IAAI,GAAG4D,OAAO,CAACpE,IAAD,CAApB;AAEA,SAAOR,SAAS,CAAC2N,UAAV,CAAqB3M,IAArB,KAA8B,EAArC;AACH;;AAED,SAAS4D,OAAT,CAAiBpE,IAAjB,EAAuB;AACnB,SAAOA,IAAI,GAAGR,SAAS,CAAC4E,OAAV,CAAkBpE,IAAI,CAAC4C,EAAvB,KAA8B5C,IAAI,CAACQ,IAAtC,GAA6C,IAAxD;AACH;;AAED,SAAS4M,iBAAT,CAA2BpN,IAA3B,EAAiC;AAC7B,MAAI,CAACA,IAAL,EAAW,OAAO,GAAP;AACX,MAAI,CAACA,IAAI,CAACwJ,KAAV,EAAiB,OAAO,GAAP;AACjB,MAAI,CAACxJ,IAAI,CAACwJ,KAAL,CAAW6D,qBAAhB,EAAuC,OAAO,GAAP;AAEvC,SAAOzN,aAAa,CAACI,IAAI,CAACwJ,KAAL,CAAW8D,eAAZ,CAApB;AACH;;AAED,SAASC,eAAT,CAAyBvN,IAAzB,EAA+B;AAC3B,MAAI,CAACA,IAAL,EAAW,OAAO,GAAP;AACX,MAAI,CAACA,IAAI,CAACwN,MAAV,EAAkB,OAAO,GAAP;AAClB,MAAI,CAACxN,IAAI,CAACwN,MAAL,CAAYC,mBAAjB,EAAsC,OAAO,GAAP;AAEtC,SAAO7N,aAAa,CAACI,IAAI,CAACwN,MAAL,CAAYE,aAAb,CAApB;AACH;;AAED,SAASC,YAAT,CAAsBvE,QAAtB,EAAgC;AAC5B,MAAI,CAACA,QAAL,EAAe;AACX,WAAO,EAAP;AACH;;AAED,MAAMwE,KAAK,GAAGxE,QAAQ,CAACyE,KAAT,CAAe,GAAf,CAAd;;AACA,MAAID,KAAK,CAACzL,MAAN,KAAiB,CAAjB,IAAuByL,KAAK,CAAC,CAAD,CAAL,KAAa,EAAb,IAAmBA,KAAK,CAACzL,MAAN,KAAiB,CAA/D,EAAmE;AAC/D,WAAO,EAAP;AACH;;AACD,SAAOyL,KAAK,CAACE,GAAN,GAAYb,WAAZ,EAAP;AACH;;AAED,SAASc,sBAAT,CAAgCC,WAAhC,EAA6C;AACzC,MAAI,CAACA,WAAL,EAAkB;AADuB,MAGjCC,WAHiC,GAGjBD,WAHiB,CAGjCC,WAHiC;AAIzC,MAAI,CAACA,WAAL,EAAkB;AAElB,MAAMjM,KAAK,GAAGxC,SAAS,CAACyD,QAAV,EAAd;AAEAgL,EAAAA,WAAW,CAACzC,OAAZ,CAAoB,UAAA0C,SAAS;AAAA,WAAIC,oBAAoB,CAACnM,KAAD,EAAQkM,SAAR,CAAxB;AAAA,GAA7B;AACH;;AAED,SAASC,oBAAT,CAA8BnM,KAA9B,EAAqCoM,CAArC,EAAwC;AACpC,MAAI,CAACA,CAAL,EAAQ;;AAER,UAAQA,CAAC,CAAC,OAAD,CAAT;AACI,SAAK,iBAAL;AAAwB;AACpB;AACH;;AACD,SAAK,oBAAL;AAA2B;AAAA,YACfjL,SADe,GACQiL,CADR,CACfjL,SADe;AAAA,YACJkL,OADI,GACQD,CADR,CACJC,OADI;AAGvBjL,QAAAA,6BAA6B,CAACpB,KAAD,EAAQmB,SAAR,EAAmB,IAAnB,CAA7B;AACA2B,QAAAA,oBAAoB,CAAC9C,KAAD,EAAQmB,SAAR,EAAmB,IAAnB,CAApB;AACAgL,QAAAA,oBAAoB,CAACnM,KAAD,EAAQqM,OAAR,CAApB;AACA;AACH;;AACD,SAAK,gBAAL;AAAuB;AAAA,YACXhL,KADW,GACQ+K,CADR,CACX/K,KADW;AAAA,YACJgL,QADI,GACQD,CADR,CACJC,OADI;AAGnB/K,QAAAA,yBAAyB,CAACtB,KAAD,EAAQqB,KAAR,EAAe,IAAf,CAAzB;AACAa,QAAAA,gBAAgB,CAAClC,KAAD,EAAQqB,KAAR,EAAe,IAAf,CAAhB;AACA8K,QAAAA,oBAAoB,CAACnM,KAAD,EAAQqM,QAAR,CAApB;AACA;AACH;;AACD,SAAK,qBAAL;AAA4B;AAAA,YAChBC,MADgB,GACLF,CADK,CAChBE,MADgB;AAGxBC,QAAAA,mBAAmB,CAACvM,KAAD,EAAQsM,MAAR,CAAnB;AACA;AACH;;AACD,SAAK,qBAAL;AAA4B;AAAA,YAChBE,IADgB,GACCJ,CADD,CAChBI,IADgB;AAAA,YACVC,MADU,GACCL,CADD,CACVK,MADU;AAGxBF,QAAAA,mBAAmB,CAACvM,KAAD,EAAQwM,IAAR,CAAnB;AACAD,QAAAA,mBAAmB,CAACvM,KAAD,EAAQyM,MAAR,CAAnB;AACA;AACH;AACD;;AACA,SAAK,kBAAL;AAAyB;AAAA,YACbD,KADa,GACIJ,CADJ,CACbI,IADa;AAAA,YACPC,OADO,GACIL,CADJ,CACPK,MADO;AAGrBF,QAAAA,mBAAmB,CAACvM,KAAD,EAAQwM,KAAR,CAAnB;AACAD,QAAAA,mBAAmB,CAACvM,KAAD,EAAQyM,OAAR,CAAnB;AACA;AACH;;AACD,SAAK,mBAAL;AAA0B;AAAA,YACdvO,KADc,GACJkO,CADI,CACdlO,KADc;AAGtB6L,QAAAA,oBAAoB,CAAC/J,KAAD,EAAQ9B,KAAR,EAAe,CAAf,CAApB;AACA;AACH;;AACD,SAAK,kBAAL;AAAyB;AAAA,YACb+N,WADa,GACYG,CADZ,CACbH,WADa;AAAA,YACAI,SADA,GACYD,CADZ,CACAC,OADA;AAGrBF,QAAAA,oBAAoB,CAACnM,KAAD,EAAQqM,SAAR,CAApB;AACAJ,QAAAA,WAAW,CAACzC,OAAZ,CAAoB,UAAAkD,CAAC;AAAA,iBAAIP,oBAAoB,CAACnM,KAAD,EAAQ0M,CAAR,CAAxB;AAAA,SAArB;AACA;AACH;;AACD,SAAK,gBAAL;AAAuB;AAAA,YACXC,KADW,GACDP,CADC,CACXO,KADW;AAGnBR,QAAAA,oBAAoB,CAACnM,KAAD,EAAQ2M,KAAR,CAApB;AACA;AACH;;AACD,SAAK,kBAAL;AAAyB;AAAA,YACbC,MADa,GACWR,CADX,CACbQ,MADa;AAAA,YACLX,YADK,GACWG,CADX,CACLH,WADK;AAGrBE,QAAAA,oBAAoB,CAACnM,KAAD,EAAQ4M,MAAR,CAApB;;AACAX,QAAAA,YAAW,CAACzC,OAAZ,CAAoB,UAAAkD,CAAC;AAAA,iBAAIP,oBAAoB,CAACnM,KAAD,EAAQ0M,CAAR,CAAxB;AAAA,SAArB;;AACA;AACH;;AACD,SAAK,kBAAL;AAAyB;AACrB;AACH;;AACD,SAAK,mBAAL;AAA0B;AAAA,YACdG,YADc,GACYT,CADZ,CACdS,YADc;AAAA,YACAR,SADA,GACYD,CADZ,CACAC,OADA;AAGtB9K,QAAAA,gBAAgB,CAACvB,KAAD,EAAQ6M,YAAR,EAAsB,IAAtB,CAAhB;AACAV,QAAAA,oBAAoB,CAACnM,KAAD,EAAQqM,SAAR,CAApB;AACA;AACH;;AACD,SAAK,uBAAL;AAA8B;AAAA,YAClBS,YADkB,GACqBV,CADrB,CAClBU,YADkB;AAAA,YACJb,aADI,GACqBG,CADrB,CACJH,WADI;AAAA,YACSI,SADT,GACqBD,CADrB,CACSC,OADT;AAG1B9K,QAAAA,gBAAgB,CAACvB,KAAD,EAAQ8M,YAAR,EAAsB,IAAtB,CAAhB;;AACAb,QAAAA,aAAW,CAACzC,OAAZ,CAAoB,UAAAkD,CAAC;AAAA,iBAAIP,oBAAoB,CAACnM,KAAD,EAAQ0M,CAAR,CAAxB;AAAA,SAArB;;AACAP,QAAAA,oBAAoB,CAACnM,KAAD,EAAQqM,SAAR,CAApB;AACA;AACH;;AACD,SAAK,iBAAL;AAAwB;AAAA,YACZU,MADY,GACDX,CADC,CACZW,MADY;AAGpBR,QAAAA,mBAAmB,CAACvM,KAAD,EAAQ+M,MAAR,CAAnB;AACA;AACH;;AACD,SAAK,iBAAL;AAAwB;AAAA,YACZH,OADY,GACDR,CADC,CACZQ,MADY;AAGpBL,QAAAA,mBAAmB,CAACvM,KAAD,EAAQ4M,OAAR,CAAnB;AACA;AACH;;AACD,SAAK,iBAAL;AAAwB;AAAA,YACZI,MADY,GACDZ,CADC,CACZY,MADY;AAGpBT,QAAAA,mBAAmB,CAACvM,KAAD,EAAQgN,MAAR,CAAnB;AACA;AACH;;AACD,SAAK,eAAL;AAAsB;AAAA,YACVrD,KADU,GACAyC,CADA,CACVzC,KADU;AAGlBA,QAAAA,KAAK,CAACH,OAAN,CAAc,UAAAkD,CAAC;AAAA,iBAAIP,oBAAoB,CAACnM,KAAD,EAAQ0M,CAAR,CAAxB;AAAA,SAAf;AACA;AACH;AACD;;AACA,SAAK,mBAAL;AAA0B;AAAA,YACdT,aADc,GACEG,CADF,CACdH,WADc;;AAGtBA,QAAAA,aAAW,CAACzC,OAAZ,CAAoB,UAAAkD,CAAC;AAAA,iBAAIP,oBAAoB,CAACnM,KAAD,EAAQ0M,CAAR,CAAxB;AAAA,SAArB;;AACA;AACH;;AACD,SAAK,cAAL;AAAqB;AAAA,YACTL,SADS,GACGD,CADH,CACTC,OADS;AAGjBzI,QAAAA,uBAAuB,CAAC5D,KAAD,EAAQoM,CAAR,EAAW,IAAX,CAAvB;AACAD,QAAAA,oBAAoB,CAACnM,KAAD,EAAQqM,SAAR,CAApB;AACA;AACH;;AACD,SAAK,oBAAL;AAA2B;AAAA,YACfG,MADe,GACNJ,CADM,CACfI,IADe;AAGvBD,QAAAA,mBAAmB,CAACvM,KAAD,EAAQwM,MAAR,CAAnB;AACA;AACH;;AACD,SAAK,gBAAL;AAAuB;AAAA,YACXtO,QADW,GACQkO,CADR,CACXlO,KADW;AAAA,YACJmO,SADI,GACQD,CADR,CACJC,OADI;AAGnB9K,QAAAA,gBAAgB,CAACvB,KAAD,EAAQ9B,QAAR,EAAe,IAAf,EAAqB1B,aAArB,CAAhB;AACA2P,QAAAA,oBAAoB,CAACnM,KAAD,EAAQqM,SAAR,CAApB;AACA;AACH;;AACD,SAAK,uBAAL;AAA8B;AAAA,YAClBG,MADkB,GACTJ,CADS,CAClBI,IADkB;AAG1BD,QAAAA,mBAAmB,CAACvM,KAAD,EAAQwM,MAAR,CAAnB;AACA;AACH;;AACD,SAAK,oBAAL;AAA2B;AAAA,YACfA,MADe,GACEJ,CADF,CACfI,IADe;AAAA,YACTC,QADS,GACEL,CADF,CACTK,MADS;AAGvBF,QAAAA,mBAAmB,CAACvM,KAAD,EAAQwM,MAAR,CAAnB;AACAD,QAAAA,mBAAmB,CAACvM,KAAD,EAAQyM,QAAR,CAAnB;AACA;AACH;;AACD,SAAK,0BAAL;AAAiC;AAAA,YACrBG,QADqB,GACAR,CADA,CACrBQ,MADqB;AAAA,YACbK,QADa,GACAb,CADA,CACba,QADa;AAG7BV,QAAAA,mBAAmB,CAACvM,KAAD,EAAQ4M,QAAR,CAAnB;AACAK,QAAAA,QAAQ,CAACzD,OAAT,CAAiB,UAAAkD,CAAC;AAAA,iBAAIP,oBAAoB,CAACnM,KAAD,EAAQ0M,CAAR,CAAxB;AAAA,SAAlB;AACA;AACH;AACD;;AACA,SAAK,yBAAL;AAAgC;AAAA,YACpBxO,QADoB,GACVkO,CADU,CACpBlO,KADoB;AAG5BqD,QAAAA,gBAAgB,CAACvB,KAAD,EAAQ9B,QAAR,EAAe,IAAf,CAAhB;AACA;AACH;;AACD,SAAK,oBAAL;AAA2B;AAAA,YACf+N,aADe,GACUG,CADV,CACfH,WADe;AAAA,YACFI,SADE,GACUD,CADV,CACFC,OADE;AAGvBF,QAAAA,oBAAoB,CAACnM,KAAD,EAAQqM,SAAR,CAApB;;AACAJ,QAAAA,aAAW,CAACzC,OAAZ,CAAoB,UAAAkD,CAAC;AAAA,iBAAIP,oBAAoB,CAACnM,KAAD,EAAQ0M,CAAR,CAAxB;AAAA,SAArB;;AACA;AACH;;AACD,SAAK,oBAAL;AAA2B;AAAA,YACfQ,SADe,GACDd,CADC,CACfc,SADe;AAGvBX,QAAAA,mBAAmB,CAACvM,KAAD,EAAQkN,SAAR,CAAnB;AACA;AACH;;AACD,SAAK,mBAAL;AAA0B;AAAA,YACdC,QADc,GACDf,CADC,CACde,QADc;AAGtBZ,QAAAA,mBAAmB,CAACvM,KAAD,EAAQmN,QAAR,CAAnB;AACA;AACH;;AACD,SAAK,gBAAL;AAAuB;AAAA,YACXd,SADW,GACQD,CADR,CACXC,OADW;AAAA,YACFe,KADE,GACQhB,CADR,CACFgB,KADE;AAGnBb,QAAAA,mBAAmB,CAACvM,KAAD,EAAQqM,SAAR,CAAnB;AACAe,QAAAA,KAAK,CAAC5D,OAAN,CAAc,UAAA6D,GAAG;AAAA,iBAAIA,GAAG,CAAC7D,OAAJ,CAAY,UAAAkD,CAAC;AAAA,mBAAIP,oBAAoB,CAACnM,KAAD,EAAQ0M,CAAR,CAAxB;AAAA,WAAb,CAAJ;AAAA,SAAjB;AACA;AACH;AACD;;AACA,SAAK,oBAAL;AAA2B;AAAA,YACfF,MADe,GACNJ,CADM,CACfI,IADe;AAGvBD,QAAAA,mBAAmB,CAACvM,KAAD,EAAQwM,MAAR,CAAnB;AACA;AACH;;AACD,SAAK,gBAAL;AAAuB;AAAA,YACXc,KADW,GACDlB,CADC,CACXkB,KADW;AAGnBf,QAAAA,mBAAmB,CAACvM,KAAD,EAAQsN,KAAR,CAAnB;AACA;AACH;;AACD,SAAK,gBAAL;AAAuB;AAAA,YACXxL,KADW,GACQsK,CADR,CACXtK,KADW;AAAA,YACJuK,SADI,GACQD,CADR,CACJC,OADI;AAGnBrK,QAAAA,yBAAyB,CAAChC,KAAD,EAAQ8B,KAAR,EAAe,IAAf,CAAzB;AACAqD,QAAAA,gBAAgB,CAACnF,KAAD,EAAQ8B,KAAR,EAAe,IAAf,CAAhB;AACAqK,QAAAA,oBAAoB,CAACnM,KAAD,EAAQqM,SAAR,CAApB;AACA;AACH;AAjNL;AAmNH;;AAED,SAASE,mBAAT,CAA6BvM,KAA7B,EAAoCuN,CAApC,EAAuC;AACnC,MAAI,CAACA,CAAL,EAAQ;;AAER,UAAQA,CAAC,CAAC,OAAD,CAAT;AACI,SAAK,gBAAL;AAAuB;AAAA,YACXf,IADW,GACFe,CADE,CACXf,IADW;AAGnBD,QAAAA,mBAAmB,CAACvM,KAAD,EAAQwM,IAAR,CAAnB;AACA;AACH;;AACD,SAAK,cAAL;AAAqB;AAAA,YACTA,MADS,GACAe,CADA,CACTf,IADS;AAGjBD,QAAAA,mBAAmB,CAACvM,KAAD,EAAQwM,MAAR,CAAnB;AACA;AACH;;AACD,SAAK,sBAAL;AAA6B;AAAA,YACjBA,MADiB,GACRe,CADQ,CACjBf,IADiB;AAGzBD,QAAAA,mBAAmB,CAACvM,KAAD,EAAQwM,MAAR,CAAnB;AACA;AACH;;AACD,SAAK,eAAL;AAAsB;AAAA,YACVA,MADU,GACDe,CADC,CACVf,IADU;AAGlBD,QAAAA,mBAAmB,CAACvM,KAAD,EAAQwM,MAAR,CAAnB;AACA;AACH;;AACD,SAAK,cAAL;AAAqB;AAAA,YACTtN,WADS,GACIqO,CADJ,CACTrO,QADS;AAGjBsC,QAAAA,4BAA4B,CAACxB,KAAD,EAAQd,WAAR,EAAkB,IAAlB,CAA5B;AACAsE,QAAAA,mBAAmB,CAACxD,KAAD,EAAQd,WAAR,EAAkB,IAAlB,EAAwB,KAAxB,CAAnB;AACA;AACH;;AACD,SAAK,gBAAL;AAAuB;AAAA,YACXsN,MADW,GACFe,CADE,CACXf,IADW;AAGnBD,QAAAA,mBAAmB,CAACvM,KAAD,EAAQwM,MAAR,CAAnB;AACA;AACH;;AACD,SAAK,gBAAL;AAAuB;AAAA,YACXA,OADW,GACFe,CADE,CACXf,IADW;AAGnBD,QAAAA,mBAAmB,CAACvM,KAAD,EAAQwM,OAAR,CAAnB;AACA;AACH;;AACD,SAAK,qBAAL;AAA4B;AAAA,YAChBA,OADgB,GACPe,CADO,CAChBf,IADgB;AAGxBD,QAAAA,mBAAmB,CAACvM,KAAD,EAAQwM,OAAR,CAAnB;AACA;AACH;;AACD,SAAK,eAAL;AAAsB;AAAA,YACVA,OADU,GACDe,CADC,CACVf,IADU;AAGlBD,QAAAA,mBAAmB,CAACvM,KAAD,EAAQwM,OAAR,CAAnB;AACA;AACH;;AACD,SAAK,WAAL;AAAkB;AAAA,YACNgB,KADM,GACID,CADJ,CACNC,KADM;AAGdA,QAAAA,KAAK,CAAChE,OAAN,CAAc,UAAAkD,CAAC;AAAA,iBAAIH,mBAAmB,CAACvM,KAAD,EAAQ0M,CAAR,CAAvB;AAAA,SAAf;AACA;AACH;;AACD,SAAK,uBAAL;AAA8B;AAAA,YAClBF,OADkB,GACTe,CADS,CAClBf,IADkB;AAG1BD,QAAAA,mBAAmB,CAACvM,KAAD,EAAQwM,OAAR,CAAnB;AACA;AACH;;AACD,SAAK,mBAAL;AAA0B;AAAA,YACdA,OADc,GACLe,CADK,CACdf,IADc;AAGtBD,QAAAA,mBAAmB,CAACvM,KAAD,EAAQwM,OAAR,CAAnB;AACA;AACH;;AACD,SAAK,qBAAL;AAA4B;AAAA,YAChBA,OADgB,GACPe,CADO,CAChBf,IADgB;AAGxBD,QAAAA,mBAAmB,CAACvM,KAAD,EAAQwM,OAAR,CAAnB;AACA;AACH;;AACD,SAAK,mBAAL;AAA0B;AAAA,YACdA,OADc,GACLe,CADK,CACdf,IADc;AAGtBD,QAAAA,mBAAmB,CAACvM,KAAD,EAAQwM,OAAR,CAAnB;AACA;AACH;;AACD,SAAK,aAAL;AAAoB;AAAA,YACRA,OADQ,GACCe,CADD,CACRf,IADQ;AAGhBD,QAAAA,mBAAmB,CAACvM,KAAD,EAAQwM,OAAR,CAAnB;AACA;AACH;AA3FL;AA6FH;;AAED,SAASiB,gBAAT,CAA0BzP,IAA1B,EAAgC;AAC5B,SAAO,IAAI0P,OAAJ,CAAY,UAAAC,OAAO,EAAI;AAC1B,QAAI,CAAC3P,IAAL,EAAW;AACP2P,MAAAA,OAAO,CAAC,IAAD,CAAP;AACA;AACH;;AAED,QAAMnP,IAAI,GAAGhB,SAAS,CAAC4E,OAAV,CAAkBpE,IAAI,CAAC4C,EAAvB,CAAb;;AACA,QAAI,CAACpC,IAAL,EAAW;AACPmP,MAAAA,OAAO,CAAC,IAAD,CAAP;AACA;AACH;;AAED,QAAMC,UAAU,GAAG,IAAIC,UAAJ,EAAnB;;AACAD,IAAAA,UAAU,CAACE,MAAX,GAAoB,UAAAC,KAAK;AAAA,aAAIJ,OAAO,CAACK,IAAI,CAACC,KAAL,CAAWF,KAAK,CAACG,MAAN,CAAa3N,MAAxB,CAAD,CAAX;AAAA,KAAzB;;AACAqN,IAAAA,UAAU,CAACO,OAAX,GAAqB;AAAA,aAAMR,OAAO,CAAC,IAAD,CAAb;AAAA,KAArB;;AACAC,IAAAA,UAAU,CAACQ,OAAX,GAAqB;AAAA,aAAMT,OAAO,CAAC,IAAD,CAAb;AAAA,KAArB;;AACAC,IAAAA,UAAU,CAACS,UAAX,CAAsB7P,IAAtB;AACH,GAjBM,CAAP;AAkBH;;AAED,SACIT,WADJ,EAEIH,aAFJ,EAGIQ,QAHJ,EAII0B,QAJJ,EAKIiG,mBALJ,EAMIsC,sBANJ,EAOIO,yBAPJ,EAQIV,4BARJ,EASIQ,+BATJ,EAUIY,6BAVJ,EAWII,gCAXJ,EAYII,eAZJ,EAaIE,gBAbJ,EAcIC,gBAdJ,EAeI8B,sBAfJ,EAgBIhH,kBAhBJ,EAiBIuF,mBAjBJ,EAkBIC,qBAlBJ,EAmBI3I,2BAnBJ,EAoBI2B,eApBJ,EAqBIkD,gBArBJ,EAsBIU,cAtBJ,EAuBI3H,QAvBJ,EAwBIsI,YAxBJ,EAyBID,mBAzBJ,EA0BIkD,aA1BJ,EA2BIG,MA3BJ,EA4BI9I,OA5BJ,EA6BIgJ,iBA7BJ,EA8BIG,eA9BJ,EA+BII,YA/BJ,EAgCI/D,aAhCJ,EAiCID,kBAjCJ,EAkCI8F,gBAlCJ","sourcesContent":["/*\n *  Copyright (c) 2018-present, Evgeny Nadymov\n *\n * This source code is licensed under the GPL v.3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport { getPhotoSize, getPhotoThumbnailSize, getSize } from './Common';\nimport { getChatUserId } from './Chat';\nimport { getProfilePhoto } from './User';\nimport { getLocationId } from './Message';\nimport {\n    FILE_PRIORITY,\n    IV_LOCATION_HEIGHT,\n    IV_LOCATION_WIDTH,\n    IV_PHOTO_SIZE,\n    LOCATION_HEIGHT,\n    LOCATION_SCALE,\n    LOCATION_WIDTH,\n    LOCATION_ZOOM,\n    PHOTO_BIG_SIZE,\n    PHOTO_SIZE,\n    PRELOAD_ANIMATION_SIZE,\n    PRELOAD_AUDIO_SIZE,\n    PRELOAD_DOCUMENT_SIZE,\n    PRELOAD_STICKER_SIZE,\n    PRELOAD_VIDEO_SIZE,\n    PRELOAD_VIDEONOTE_SIZE,\n    PRELOAD_VOICENOTE_SIZE,\n    THUMBNAIL_PRIORITY\n} from '../Constants';\nimport ChatStore from '../Stores/ChatStore';\nimport FileStore from '../Stores/FileStore';\nimport MessageStore from '../Stores/MessageStore';\nimport UserStore from '../Stores/UserStore';\nimport TdLibController from '../Controllers/TdLibController';\n\nfunction getSizeString(size) {\n    if (!size) return `0 B`;\n\n    if (size < 1024) {\n        return `${size} B`;\n    }\n\n    if (size < 1024 * 1024) {\n        return `${(size / 1024).toFixed(1)} KB`;\n    }\n\n    if (size < 1024 * 1024 * 1024) {\n        return `${(size / 1024 / 1024).toFixed(1)} MB`;\n    }\n\n    return `${(size / 1024 / 1024 / 1024).toFixed(1)} GB`;\n}\n\nfunction getFileSize(file) {\n    if (!file) return '';\n\n    let size = file.size;\n    if (!size) return '';\n\n    return getSizeString(size);\n}\n\nfunction getBigPhoto(photo) {\n    if (!photo) return null;\n\n    return photo.big;\n}\n\nfunction saveData(data, filename, mime) {\n    let blob = new Blob([data], { type: mime || 'application/octet-stream' });\n    if (typeof window.navigator.msSaveBlob !== 'undefined') {\n        // IE workaround for \"HTML7007: One or more blob URLs were\n        // revoked by closing the blob for which they were created.\n        // These URLs will no longer resolve as the data backing\n        // the URL has been freed.\"\n        window.navigator.msSaveBlob(blob, filename);\n    } else {\n        let blobURL = window.URL.createObjectURL(blob);\n        let tempLink = document.createElement('a');\n        tempLink.style.display = 'none';\n        tempLink.href = blobURL;\n        tempLink.setAttribute('download', filename);\n\n        // Safari thinks _blank anchor are pop ups. We only want to set _blank\n        // target if the browser does not support the HTML5 download attribute.\n        // This allows you to download files in desktop safari if pop up blocking\n        // is enabled.\n        if (typeof tempLink.download === 'undefined') {\n            tempLink.setAttribute('target', '_blank');\n        }\n\n        document.body.appendChild(tempLink);\n        tempLink.click();\n        document.body.removeChild(tempLink);\n        window.URL.revokeObjectURL(blobURL);\n    }\n}\n\nfunction saveBlob(blob, filename) {\n    if (typeof window.navigator.msSaveBlob !== 'undefined') {\n        // IE workaround for \"HTML7007: One or more blob URLs were\n        // revoked by closing the blob for which they were created.\n        // These URLs will no longer resolve as the data backing\n        // the URL has been freed.\"\n        window.navigator.msSaveBlob(blob, filename);\n    } else {\n        let blobURL = window.URL.createObjectURL(blob);\n        let tempLink = document.createElement('a');\n        tempLink.style.display = 'none';\n        tempLink.href = blobURL;\n        tempLink.setAttribute('download', filename);\n\n        // Safari thinks _blank anchor are pop ups. We only want to set _blank\n        // target if the browser does not support the HTML5 download attribute.\n        // This allows you to download files in desktop safari if pop up blocking\n        // is enabled.\n        if (typeof tempLink.download === 'undefined') {\n            tempLink.setAttribute('target', '_blank');\n        }\n\n        document.body.appendChild(tempLink);\n        tempLink.click();\n        document.body.removeChild(tempLink);\n        window.URL.revokeObjectURL(blobURL);\n    }\n}\n\nasync function loadReplies(store, chatId, messageIds) {\n    if (!chatId) return;\n    if (!messageIds) return;\n    if (!messageIds.length) return;\n\n    const result = await TdLibController.send({\n        '@type': 'getMessages',\n        chat_id: chatId,\n        message_ids: messageIds\n    });\n\n    result.messages = result.messages.map((message, i) => {\n        return (\n            message || {\n                '@type': 'deletedMessage',\n                chat_id: chatId,\n                id: messageIds[i],\n                content: null\n            }\n        );\n    });\n\n    MessageStore.setItems(result.messages);\n\n    for (let i = messageIds.length - 1; i >= 0; i--) {\n        MessageStore.emit('getMessageResult', MessageStore.get(chatId, messageIds[i]));\n    }\n\n    store = FileStore.getStore();\n\n    loadReplyContents(store, result.messages);\n}\n\nfunction loadReplyContents(store, messages) {\n    for (let i = messages.length - 1; i >= 0; i--) {\n        const message = messages[i];\n        if (!message) {\n            continue;\n        }\n\n        const { content } = message;\n        if (content) {\n            switch (content['@type']) {\n                case 'messageAnimation': {\n                    const { animation } = content;\n\n                    loadAnimationThumbnailContent(store, animation, message);\n                    break;\n                }\n                case 'messageAudio': {\n                    const { audio } = content;\n\n                    loadAudioThumbnailContent(store, audio, message);\n                    break;\n                }\n                case 'messageChatChangePhoto': {\n                    const { photo } = content;\n\n                    loadPhotoContent(store, photo, message);\n                    break;\n                }\n                case 'messageDocument': {\n                    const { document } = content;\n\n                    loadDocumentThumbnailContent(store, document, message);\n                    break;\n                }\n                case 'messageGame': {\n                    const { game } = content;\n\n                    loadGameThumbnailContent(store, game, message);\n                    break;\n                }\n                case 'messagePhoto': {\n                    const { photo } = content;\n\n                    loadPhotoContent(store, photo, message);\n                    break;\n                }\n                case 'messageSticker': {\n                    const { sticker } = content;\n\n                    loadStickerThumbnailContent(store, sticker, message);\n                    break;\n                }\n                case 'messageText': {\n                    const { web_page } = content;\n                    if (!web_page) break;\n\n                    const { animation, audio, document, photo, sticker, video, video_note } = web_page;\n\n                    if (photo) {\n                        loadPhotoContent(store, photo, message);\n                        break;\n                    }\n\n                    if (animation) {\n                        loadAnimationThumbnailContent(store, animation, message);\n                        break;\n                    }\n\n                    if (audio) {\n                        loadAudioThumbnailContent(store, audio, message);\n                        break;\n                    }\n\n                    if (document) {\n                        loadDocumentThumbnailContent(store, document, message);\n                        break;\n                    }\n\n                    if (sticker) {\n                        loadStickerThumbnailContent(store, sticker, message);\n                        break;\n                    }\n\n                    if (video) {\n                        loadVideoThumbnailContent(store, video, message);\n                        break;\n                    }\n\n                    if (video_note) {\n                        loadVideoNoteThumbnailContent(store, video_note, message);\n                        break;\n                    }\n\n                    break;\n                }\n                case 'messageVideo': {\n                    const { video } = content;\n\n                    loadVideoThumbnailContent(store, video, message);\n                    break;\n                }\n                case 'messageVideoNote': {\n                    const { video_note } = content;\n\n                    loadVideoNoteThumbnailContent(store, video_note, message);\n                    break;\n                }\n            }\n        }\n    }\n}\n\nfunction loadAudioContent(store, audio, message, useFileSize = true) {\n    if (!audio) return;\n\n    let { audio: file } = audio;\n    if (!file) return;\n\n    file = FileStore.get(file.id) || file;\n    const { id, size } = file;\n\n    const blob = FileStore.getBlob(id);\n    if (blob) return;\n\n    const chatId = message ? message.chat_id : 0;\n    const messageId = message ? message.id : 0;\n\n    FileStore.getLocalFile(\n        store,\n        file,\n        null,\n        () => FileStore.updateAudioBlob(chatId, messageId, id),\n        () => {\n            if (!useFileSize || (size && size < PRELOAD_AUDIO_SIZE)) {\n                FileStore.getRemoteFile(id, FILE_PRIORITY, message || audio);\n            }\n        }\n    );\n}\n\nfunction loadAudioThumbnailContent(store, audio, message) {\n    if (!audio) return false;\n\n    const { album_cover_thumbnail: photoSize } = audio;\n    if (!photoSize) return false;\n\n    let { photo: file } = photoSize;\n    if (!file) return false;\n\n    file = FileStore.get(file.id) || file;\n    const { id } = file;\n\n    const blob = FileStore.getBlob(file.id);\n    if (blob) return true;\n\n    const chatId = message ? message.chat_id : 0;\n    const messageId = message ? message.id : 0;\n\n    FileStore.getLocalFile(\n        store,\n        file,\n        null,\n        () => FileStore.updateAudioThumbnailBlob(chatId, messageId, id),\n        () => FileStore.getRemoteFile(id, THUMBNAIL_PRIORITY, message || audio)\n    );\n\n    return true;\n}\n\nfunction cancelLoadAnimationContent(animation) {\n    const { animation: file } = animation;\n    if (!file) return;\n\n    const { id } = file;\n\n    const blob = file.blob || FileStore.getBlob(id);\n    if (blob) return;\n\n    FileStore.cancelGetRemoteFile(id);\n}\n\nfunction loadAnimationContent(store, animation, message, useFileSize = true) {\n    if (!animation) return;\n\n    let { animation: file } = animation;\n    if (!file) return;\n\n    file = FileStore.get(file.id) || file;\n    const { id, size } = file;\n\n    const blob = FileStore.getBlob(id);\n    if (blob) return;\n\n    const chatId = message ? message.chat_id : 0;\n    const messageId = message ? message.id : 0;\n\n    FileStore.getLocalFile(\n        store,\n        file,\n        null,\n        () => FileStore.updateAnimationBlob(chatId, messageId, id),\n        () => {\n            if (!useFileSize || (size && size < PRELOAD_ANIMATION_SIZE)) {\n                FileStore.getRemoteFile(id, FILE_PRIORITY, message || animation);\n            }\n        }\n    );\n}\n\nfunction cancelLoadAnimationThumbnailContent(animation){\n    if (!animation) return;\n\n    const { thumbnail: photoSize } = animation;\n    if (!photoSize) return;\n\n    let { photo: file } = photoSize;\n    if (!file) return;\n\n    file = FileStore.get(file.id) || file;\n    const { id } = file;\n\n    const blob = FileStore.getBlob(id);\n    if (blob) return;\n\n    FileStore.cancelGetRemoteFile(id);\n}\n\nfunction loadAnimationThumbnailContent(store, animation, message) {\n    if (!animation) return false;\n\n    const { thumbnail: photoSize } = animation;\n    if (!photoSize) return false;\n\n    let { photo: file } = photoSize;\n    if (!file) return false;\n\n    file = FileStore.get(file.id) || file;\n    const { id } = file;\n\n    const blob = FileStore.getBlob(file.id);\n    if (blob) return true;\n\n    const chatId = message ? message.chat_id : 0;\n    const messageId = message ? message.id : 0;\n\n    FileStore.getLocalFile(\n        store,\n        file,\n        null,\n        () => FileStore.updateAnimationThumbnailBlob(chatId, messageId, id),\n        () => FileStore.getRemoteFile(id, THUMBNAIL_PRIORITY, message || animation)\n    );\n\n    return true;\n}\n\nfunction loadContactContent(store, contact, message) {\n    if (!contact) return;\n    if (!message) return;\n\n    const { user_id } = contact;\n    const user = UserStore.get(user_id);\n    if (!user) return;\n\n    loadUserContent(store, user);\n}\n\nfunction loadDocumentContent(store, document, message, useFileSize = true) {\n    if (!document) return;\n\n    let { document: file } = document;\n    if (!file) return;\n\n    file = FileStore.get(file.id) || file;\n    const { id, size } = file;\n\n    const blob = FileStore.getBlob(id);\n    if (blob) return;\n\n    const chatId = message ? message.chat_id : 0;\n    const messageId = message ? message.id : 0;\n\n    FileStore.getLocalFile(\n        store,\n        file,\n        null,\n        () => FileStore.updateDocumentBlob(chatId, messageId, id),\n        () => {\n            if (!useFileSize || (size && size < PRELOAD_DOCUMENT_SIZE)) {\n                FileStore.getRemoteFile(id, FILE_PRIORITY, message || document);\n            }\n        }\n    );\n}\n\nfunction loadDocumentThumbnailContent(store, document, message) {\n    if (!document) return false;\n\n    const { thumbnail: photoSize } = document;\n    if (!photoSize) return false;\n\n    let { photo: file } = photoSize;\n    if (!file) return false;\n\n    file = FileStore.get(file.id) || file;\n    const { id } = file;\n\n    const blob = FileStore.getBlob(file.id);\n    if (blob) return true;\n\n    const chatId = message ? message.chat_id : 0;\n    const messageId = message ? message.id : 0;\n\n    FileStore.getLocalFile(\n        store,\n        file,\n        null,\n        () => FileStore.updateDocumentThumbnailBlob(chatId, messageId, id),\n        () => FileStore.getRemoteFile(id, THUMBNAIL_PRIORITY, message || document)\n    );\n\n    return true;\n}\n\nfunction loadGameContent(store, game, message, useFileSize = true) {\n    if (!game) return;\n\n    const { animation } = game;\n\n    loadAnimationContent(store, animation, message, useFileSize);\n}\n\nfunction loadGameThumbnailContent(store, game, message) {\n    if (!game) return false;\n\n    const { photo, animation } = game;\n    if (loadAnimationThumbnailContent(store, animation, message)) {\n        return true;\n    }\n\n    loadPhotoContent(store, photo, message);\n    return true;\n}\n\nasync function loadPageBlockMapContent(store, pageBlockMap, message) {\n    if (!pageBlockMap) return;\n\n    const { location } = pageBlockMap;\n    const locationId = getLocationId(location, IV_LOCATION_WIDTH, IV_LOCATION_HEIGHT);\n    if (!locationId) return;\n\n    let file = FileStore.getLocationFile(locationId);\n    if (!file) {\n        file = await TdLibController.send({\n            '@type': 'getMapThumbnailFile',\n            location,\n            width: IV_LOCATION_WIDTH,\n            height: IV_LOCATION_HEIGHT,\n            zoom: LOCATION_ZOOM,\n            scale: LOCATION_SCALE,\n            chat_id: message ? message.chat_id : 0\n        });\n        FileStore.setLocationFile(locationId, file);\n\n        store = FileStore.getStore();\n    }\n\n    file = FileStore.get(file.id) || file;\n    const { id } = file;\n\n    const blob = FileStore.getBlob(file.id);\n    if (blob) return;\n\n    const chatId = message ? message.chat_id : 0;\n    const messageId = message ? message.id : 0;\n\n    FileStore.getLocalFile(\n        store,\n        file,\n        null,\n        () => FileStore.updateLocationBlob(chatId, messageId, id),\n        () => FileStore.getRemoteFile(id, FILE_PRIORITY, message || pageBlockMap)\n    );\n}\n\nasync function loadLocationContent(store, location, message) {\n    if (!location) return;\n\n    const locationId = getLocationId(location);\n    if (!locationId) return;\n\n    let file = FileStore.getLocationFile(locationId);\n    if (!file) {\n        file = await TdLibController.send({\n            '@type': 'getMapThumbnailFile',\n            location,\n            width: LOCATION_WIDTH,\n            height: LOCATION_HEIGHT,\n            zoom: LOCATION_ZOOM,\n            scale: LOCATION_SCALE,\n            chat_id: message ? message.chat_id : 0\n        });\n        FileStore.setLocationFile(locationId, file);\n\n        store = FileStore.getStore();\n    }\n\n    file = FileStore.get(file.id) || file;\n    const { id } = file;\n\n    const blob = FileStore.getBlob(file.id);\n    if (blob) return;\n\n    const chatId = message ? message.chat_id : 0;\n    const messageId = message ? message.id : 0;\n\n    FileStore.getLocalFile(\n        store,\n        file,\n        null,\n        () => FileStore.updateLocationBlob(chatId, messageId, id),\n        () => FileStore.getRemoteFile(id, FILE_PRIORITY, message || location)\n    );\n}\n\nfunction cancelLoadBigPhotoContent(photo) {\n    if (!photo) return;\n\n    const { sizes } = photo;\n    if (!sizes) return;\n\n    const photoSize = getSize(sizes, PHOTO_BIG_SIZE);\n    if (!photoSize) return;\n\n    let { photo: file } = photoSize;\n    if (!file) return;\n\n    file = FileStore.get(file.id) || file;\n    const { id } = file;\n\n    const blob = FileStore.getBlob(id);\n    if (blob) return;\n\n    FileStore.cancelGetRemoteFile(id);\n}\n\nfunction loadBigPhotoContent(store, photo, message) {\n    if (!photo) return;\n\n    const { sizes } = photo;\n    if (!sizes) return;\n\n    const photoSize = getSize(sizes, PHOTO_BIG_SIZE);\n    if (!photoSize) return;\n\n    let { photo: file } = photoSize;\n    if (!file) return;\n\n    file = FileStore.get(file.id) || file;\n    const { id } = file;\n\n    const blob = FileStore.getBlob(id);\n    if (blob) return;\n\n    const chatId = message ? message.chat_id : 0;\n    const messageId = message ? message.id : 0;\n\n    FileStore.getLocalFile(\n        store,\n        file,\n        null,\n        () => FileStore.updatePhotoBlob(chatId, messageId, id),\n        () => FileStore.getRemoteFile(id, FILE_PRIORITY, message || photo)\n    );\n}\n\nfunction loadPhotoContent(store, photo, message, displaySize = PHOTO_SIZE) {\n    if (!photo) return;\n\n    const { sizes } = photo;\n    if (!sizes) return;\n\n    const photoSize = getPhotoSize(sizes, displaySize);\n    if (!photoSize) return;\n\n    let { photo: file } = photoSize;\n    if (!file) return;\n\n    file = FileStore.get(file.id) || file;\n    const { id } = file;\n\n    const blob = FileStore.getBlob(id);\n    if (blob) return;\n\n    const chatId = message ? message.chat_id : 0;\n    const messageId = message ? message.id : 0;\n\n    FileStore.getLocalFile(\n        store,\n        file,\n        null,\n        () => FileStore.updatePhotoBlob(chatId, messageId, id),\n        () => FileStore.getRemoteFile(id, FILE_PRIORITY, message || photo)\n    );\n}\n\nfunction loadPhotoThumbnailContent(store, photo, message) {\n    if (!photo) return false;\n    if (!message) return false;\n\n    const thumbSize = getPhotoThumbnailSize(photo.sizes);\n    if (!thumbSize) return false;\n\n    const photoSize = getPhotoSize(photo.sizes);\n    if (photoSize === thumbSize) return;\n\n    let { photo: file } = thumbSize;\n    if (!file) return false;\n\n    file = FileStore.get(file.id) || file;\n    const { id } = file;\n\n    const blob = FileStore.getBlob(id);\n    if (blob) return true;\n\n    FileStore.getLocalFile(\n        store,\n        file,\n        null,\n        () => FileStore.updatePhotoBlob(message.chat_id, message.id, id),\n        () => FileStore.getRemoteFile(id, THUMBNAIL_PRIORITY, message)\n    );\n\n    return true;\n}\n\nfunction loadStickerContent(store, sticker, message, useFileSize = true) {\n    if (!sticker) return;\n\n    let { sticker: file } = sticker;\n    if (!file) return;\n\n    file = FileStore.get(file.id) || file;\n    const { id, size } = file;\n\n    const blob = FileStore.getBlob(id);\n    if (blob) return;\n\n    const chatId = message ? message.chat_id : 0;\n    const messageId = message ? message.id : 0;\n\n    FileStore.getLocalFile(\n        store,\n        file,\n        null,\n        () => FileStore.updateStickerBlob(chatId, messageId, id),\n        () => {\n            if (!useFileSize || (size && size < PRELOAD_STICKER_SIZE)) {\n                FileStore.getRemoteFile(id, FILE_PRIORITY, message || sticker);\n            }\n        }\n    );\n}\n\nfunction loadStickerThumbnailContent(store, sticker, message) {\n    if (!sticker) return false;\n\n    const { thumbnail: photoSize } = sticker;\n    if (!photoSize) return false;\n\n    let { photo: file } = photoSize;\n    if (!file) return false;\n\n    file = FileStore.get(file.id) || file;\n    const { id } = file;\n\n    const blob = FileStore.getBlob(id);\n    if (blob) return true;\n\n    const chatId = message ? message.chat_id : 0;\n    const messageId = message ? message.id : 0;\n\n    FileStore.getLocalFile(\n        store,\n        file,\n        null,\n        () => FileStore.updateStickerThumbnailBlob(chatId, messageId, id),\n        () => FileStore.getRemoteFile(id, THUMBNAIL_PRIORITY, message || sticker)\n    );\n\n    return true;\n}\n\nfunction cancelLoadVideoContent(video) {\n    if (!video) return;\n\n    let { video: file } = video;\n    if (!file) return;\n\n    file = FileStore.get(file.id) || file;\n    const { id } = file;\n\n    const blob = FileStore.getBlob(id);\n    if (blob) return;\n\n    FileStore.cancelGetRemoteFile(id);\n}\n\nfunction loadVideoContent(store, video, message, useFileSize = true) {\n    if (!video) return;\n\n    let { video: file } = video;\n    if (!file) return;\n\n    file = FileStore.get(file.id) || file;\n    const { id, size } = file;\n\n    const blob = FileStore.getBlob(id);\n    if (blob) return;\n\n    const chatId = message ? message.chat_id : 0;\n    const messageId = message ? message.id : 0;\n\n    FileStore.getLocalFile(\n        store,\n        file,\n        null,\n        () => FileStore.updateVideoBlob(chatId, messageId, id),\n        () => {\n            if (!useFileSize || (size && size < PRELOAD_VIDEO_SIZE)) {\n                FileStore.getRemoteFile(id, FILE_PRIORITY, message || video);\n            }\n        }\n    );\n}\n\nfunction cancelLoadVideoThumbnailContent(video) {\n    if (!video) return;\n\n    const { thumbnail: photoSize } = video;\n    if (!photoSize) return false;\n\n    let { photo: file } = photoSize;\n    if (!file) return false;\n\n    file = FileStore.get(file.id) || file;\n    const { id } = file;\n\n    const blob = FileStore.getBlob(id);\n    if (blob) return true;\n\n    FileStore.cancelGetRemoteFile(id);\n}\n\nfunction loadVideoThumbnailContent(store, video, message) {\n    if (!video) return false;\n\n    const { thumbnail: photoSize } = video;\n    if (!photoSize) return false;\n\n    let { photo: file } = photoSize;\n    if (!file) return false;\n\n    file = FileStore.get(file.id) || file;\n    const { id } = file;\n\n    const blob = FileStore.getBlob(id);\n    if (blob) return true;\n\n    const chatId = message ? message.chat_id : 0;\n    const messageId = message ? message.id : 0;\n\n    FileStore.getLocalFile(\n        store,\n        file,\n        null,\n        () => FileStore.updateVideoThumbnailBlob(chatId, messageId, id),\n        () => FileStore.getRemoteFile(id, THUMBNAIL_PRIORITY, message || video)\n    );\n\n    return true;\n}\n\nfunction loadVideoNoteContent(store, videoNote, message, useFileSize = true) {\n    if (!videoNote) return;\n\n    let { video: file } = videoNote;\n    if (!file) return;\n\n    file = FileStore.get(file.id) || file;\n    const { id, size } = file;\n\n    const blob = FileStore.getBlob(id);\n    if (blob) return;\n\n    const chatId = message ? message.chat_id : 0;\n    const messageId = message ? message.id : 0;\n\n    FileStore.getLocalFile(\n        store,\n        file,\n        null,\n        () => FileStore.updateVideoNoteBlob(chatId, messageId, id),\n        () => {\n            if (!useFileSize || (size && size < PRELOAD_VIDEONOTE_SIZE)) {\n                FileStore.getRemoteFile(id, FILE_PRIORITY, message || videoNote);\n            }\n        }\n    );\n}\n\nfunction loadVideoNoteThumbnailContent(store, videoNote, message) {\n    if (!videoNote) return false;\n\n    const { thumbnail: photoSize } = videoNote;\n    if (!photoSize) return false;\n\n    let { photo: file } = photoSize;\n    if (!file) return false;\n\n    file = FileStore.get(file.id) || file;\n    const { id } = file;\n\n    const blob = FileStore.getBlob(id);\n    if (blob) return true;\n\n    const chatId = message ? message.chat_id : 0;\n    const messageId = message ? message.id : 0;\n\n    FileStore.getLocalFile(\n        store,\n        file,\n        null,\n        () => FileStore.updateVideoNoteThumbnailBlob(chatId, messageId, id),\n        () => FileStore.getRemoteFile(id, THUMBNAIL_PRIORITY, message || videoNote)\n    );\n\n    return true;\n}\n\nfunction loadVoiceNoteContent(store, voiceNote, message, useFileSize = true) {\n    if (!voiceNote) return;\n\n    let { voice: file } = voiceNote;\n    if (!file) return;\n\n    file = FileStore.get(file.id) || file;\n    const { id, size } = file;\n\n    const blob = FileStore.getBlob(id);\n    if (blob) return;\n\n    const chatId = message ? message.chat_id : 0;\n    const messageId = message ? message.id : 0;\n\n    FileStore.getLocalFile(\n        store,\n        file,\n        null,\n        () => FileStore.updateVoiceNoteBlob(chatId, messageId, id),\n        () => {\n            if (!useFileSize || (size && size < PRELOAD_VOICENOTE_SIZE)) {\n                FileStore.getRemoteFile(id, FILE_PRIORITY, message || voiceNote);\n            }\n        }\n    );\n}\n\nfunction loadMessageContents(store, messages) {\n    const users = new Map();\n    let chatId = 0;\n    const replies = new Map();\n\n    for (let i = messages.length - 1; i >= 0; i--) {\n        const message = messages[i];\n        if (!message) {\n            continue;\n        }\n\n        const { chat_id, content, sender_user_id, reply_to_message_id } = message;\n\n        if (sender_user_id) {\n            users.set(sender_user_id, sender_user_id);\n        }\n\n        if (reply_to_message_id) {\n            chatId = chat_id;\n            replies.set(reply_to_message_id, reply_to_message_id);\n        }\n\n        if (content) {\n            switch (content['@type']) {\n                case 'messageAnimation': {\n                    const { animation } = content;\n\n                    loadAnimationContent(store, animation, message);\n                    loadAnimationThumbnailContent(store, animation, message);\n                    break;\n                }\n                case 'messageAudio': {\n                    const { audio } = content;\n\n                    loadAudioContent(store, audio, message);\n                    loadAudioThumbnailContent(store, audio, message);\n                    break;\n                }\n                case 'messageChatChangePhoto': {\n                    const { photo } = content;\n\n                    loadPhotoContent(store, photo, message);\n                    loadBigPhotoContent(store, photo, message);\n                    break;\n                }\n                case 'messageContact': {\n                    const { contact } = content;\n\n                    loadContactContent(store, contact, message);\n                    break;\n                }\n                case 'messageDocument': {\n                    const { document } = content;\n\n                    loadDocumentContent(store, document, message);\n                    loadDocumentThumbnailContent(store, document, message);\n                    break;\n                }\n                case 'messageGame': {\n                    const { game } = content;\n\n                    loadGameContent(store, game, message);\n                    loadGameThumbnailContent(store, game, message);\n                    break;\n                }\n                case 'messageLocation': {\n                    const { location } = content;\n\n                    loadLocationContent(store, location, message);\n                    break;\n                }\n                case 'messageText': {\n                    const { web_page } = content;\n                    if (!web_page) {\n                        break;\n                    }\n\n                    const { animation, audio, document, photo, sticker, video, video_note, voice_note } = web_page;\n                    let loadPhoto = true;\n\n                    if (animation) {\n                        loadAnimationContent(store, animation, message);\n                        loadPhoto = !loadAnimationThumbnailContent(store, animation, message);\n                    }\n\n                    if (audio) {\n                        loadAudioContent(store, audio, message);\n                        loadPhoto = !loadAudioThumbnailContent(store, audio, message);\n                    }\n\n                    if (document) {\n                        loadDocumentContent(store, document, message);\n                        loadPhoto = !loadDocumentThumbnailContent(store, document, message);\n                    }\n\n                    if (sticker) {\n                        loadStickerContent(store, sticker, message);\n                        loadPhoto = !loadStickerThumbnailContent(store, sticker, message);\n                    }\n\n                    if (video) {\n                        // loadVideoContent(store, video, message); // start loading only on video click event\n                        loadPhoto = !loadVideoThumbnailContent(store, video, message);\n                    }\n\n                    if (video_note) {\n                        loadVideoNoteContent(store, video_note, message);\n                        loadPhoto = !loadVideoNoteThumbnailContent(store, video_note, message);\n                    }\n\n                    if (voice_note) {\n                        loadVoiceNoteContent(store, voice_note, message);\n                    }\n\n                    if (loadPhoto) {\n                        loadBigPhotoContent(store, photo, message);\n                        loadPhotoContent(store, photo, message);\n                        loadPhotoThumbnailContent(store, photo, message);\n                    }\n                    break;\n                }\n                case 'messagePhoto': {\n                    const { photo } = content;\n\n                    loadBigPhotoContent(store, photo, message);\n                    loadPhotoContent(store, photo, message);\n                    loadPhotoThumbnailContent(store, photo, message);\n                    break;\n                }\n                case 'messageSticker': {\n                    const { sticker } = content;\n\n                    loadStickerContent(store, sticker, message);\n                    loadStickerThumbnailContent(store, sticker, message);\n                    break;\n                }\n                case 'messageVenue': {\n                    const { venue } = content;\n                    const { location } = venue;\n\n                    loadLocationContent(store, location, message);\n                    break;\n                }\n                case 'messageVideo': {\n                    const { video } = content;\n\n                    // loadVideoContent(store, video, message); // start loading only on video click event\n                    loadVideoThumbnailContent(store, video, message);\n                    break;\n                }\n                case 'messageVideoNote': {\n                    const { video_note } = content;\n\n                    loadVideoNoteContent(store, video_note, message);\n                    loadVideoNoteThumbnailContent(store, video_note, message);\n                    break;\n                }\n                case 'messageVoiceNote': {\n                    const { voice_note } = content;\n\n                    loadVoiceNoteContent(store, voice_note, message);\n                    break;\n                }\n                default: {\n                    break;\n                }\n            }\n        }\n    }\n\n    loadUsersContent(store, [...users.keys()]);\n    loadReplies(store, chatId, [...replies.keys()]);\n}\n\nexport function saveMedia(media, message) {\n    if (!media) return;\n\n    switch (media['@type']) {\n        case 'animation': {\n            saveAnimation(media, message);\n            break;\n        }\n        case 'document': {\n            saveDocument(media, message);\n            break;\n        }\n        case 'photo': {\n            savePhoto(media, message);\n            break;\n        }\n        case 'video': {\n            saveVideo(media, message);\n            break;\n        }\n    }\n}\n\nfunction saveAnimation(animation, message) {\n    const chatId = message ? message.chat_id : 0;\n    const messageId = message ? message.id : 0;\n\n    if (!animation) return;\n\n    const { animation: file, file_name } = animation;\n    if (!file) return;\n\n    const { id: fileId } = file;\n\n    saveOrDownload(file, file_name || fileId, message || animation, () =>\n        FileStore.updateAnimationBlob(chatId, messageId, fileId)\n    );\n}\n\nfunction saveDocument(document, message) {\n    const chatId = message ? message.chat_id : 0;\n    const messageId = message ? message.id : 0;\n\n    if (!document) return;\n\n    const { document: file, file_name } = document;\n    if (!file) return;\n\n    const { id: fileId } = file;\n\n    saveOrDownload(file, file_name || fileId, message || document, () =>\n        FileStore.updateDocumentBlob(chatId, messageId, fileId)\n    );\n}\n\nfunction saveVideo(video, message) {\n    const chatId = message ? message.chat_id : 0;\n    const messageId = message ? message.id : 0;\n\n    if (!video) return;\n\n    const { video: file, file_name } = video;\n    if (!file) return;\n\n    const { id: fileId } = file;\n\n    saveOrDownload(file, file_name || fileId, message || video, () =>\n        FileStore.updateVideoBlob(chatId, messageId, fileId)\n    );\n}\n\nfunction savePhoto(photo, message) {\n    const chatId = message ? message.chat_id : 0;\n    const messageId = message ? message.id : 0;\n\n    if (!photo) return;\n\n    const photoSize = getSize(photo.sizes, PHOTO_BIG_SIZE);\n    if (!photoSize) return;\n\n    const { photo: file } = photoSize;\n    if (!file) return;\n\n    const { id: fileId } = file;\n\n    saveOrDownload(file, fileId + '.jpg', message || photo, () => FileStore.updatePhotoBlob(chatId, messageId, fileId));\n}\n\nfunction saveOrDownload(file, fileName, obj, callback) {\n    if (!file) return;\n    if (!fileName) return;\n\n    if (file.arr) {\n        saveData(file.arr, fileName);\n        return;\n    }\n\n    let blob = FileStore.getBlob(file.id) || file.blob;\n    if (blob) {\n        saveBlob(blob, fileName);\n        return;\n    }\n\n    download(file, obj, () => {\n        if (callback) callback();\n\n        blob = FileStore.getBlob(file.id) || file.blob;\n        if (blob) {\n            saveBlob(blob, fileName);\n        }\n    });\n}\n\nfunction download(file, obj, callback) {\n    if (!file) return;\n    const { id, local } = file;\n\n    const blob = FileStore.getBlob(id);\n    if (blob) {\n        return;\n    }\n\n    if (local.is_downloading_completed) {\n        const store = FileStore.getStore();\n\n        FileStore.getLocalFile(store, file, null, callback, () => {\n            if (local.can_be_downloaded) {\n                FileStore.getRemoteFile(file.id, FILE_PRIORITY, obj);\n            }\n        });\n        return;\n    }\n\n    if (local.can_be_downloaded) {\n        FileStore.getRemoteFile(id, FILE_PRIORITY, obj);\n    }\n}\n\nfunction getViewerThumbnail(media) {\n    if (!media) return [0, 0, null];\n\n    switch (media['@type']) {\n        case 'animation': {\n            const { thumbnail } = media;\n            if (thumbnail) {\n                return [thumbnail.width, thumbnail.height, thumbnail.photo];\n            }\n            break;\n        }\n        case 'document': {\n            const { thumbnail } = media;\n            if (thumbnail) {\n                return [thumbnail.width, thumbnail.height, thumbnail.photo];\n            }\n            break;\n        }\n        case 'photo': {\n            return getViewerFile(media, PHOTO_SIZE);\n        }\n        case 'video': {\n            const { thumbnail } = media;\n            if (thumbnail) {\n                return [thumbnail.width, thumbnail.height, thumbnail.photo];\n            }\n            break;\n        }\n        default: {\n            return [0, 0, null];\n        }\n    }\n\n    return [0, 0, null];\n}\n\nfunction getMediaPreviewFile(chatId, messageId) {\n    const message = MessageStore.get(chatId, messageId);\n    if (!message) return [0, 0, null];\n\n    const { content } = message;\n    if (!content) return [0, 0, null];\n\n    switch (content['@type']) {\n        case 'messageAnimation': {\n            const { animation } = content;\n            if (animation && animation.thumbnail) {\n                return [animation.thumbnail.width, animation.thumbnail.height, animation.thumbnail.photo];\n            }\n            break;\n        }\n        case 'messageChatChangePhoto': {\n            return getMediaFile(chatId, messageId, PHOTO_SIZE);\n        }\n        case 'messageDocument': {\n            const { document } = content;\n            if (document) {\n                return [50, 50, document.document];\n            }\n            break;\n        }\n        case 'messagePhoto': {\n            return getMediaFile(chatId, messageId, PHOTO_SIZE);\n        }\n        case 'messageText': {\n            const { web_page } = content;\n            if (web_page) {\n                const { animation, document, video, photo } = web_page;\n\n                if (animation && animation.thumbnail) {\n                    return [animation.thumbnail.width, animation.thumbnail.height, animation.thumbnail.photo];\n                }\n\n                if (document) {\n                    return [50, 50, document.document];\n                }\n\n                if (video && video.thumbnail) {\n                    return [video.thumbnail.width, video.thumbnail.height, video.thumbnail.photo];\n                }\n\n                if (photo) {\n                    return getMediaFile(chatId, messageId, PHOTO_SIZE);\n                }\n            }\n            break;\n        }\n        case 'messageVideo': {\n            const { video } = content;\n            if (video.thumbnail) {\n                return [video.thumbnail.width, video.thumbnail.height, video.thumbnail.photo];\n            }\n            break;\n        }\n        default: {\n            return [0, 0, null];\n        }\n    }\n\n    return [0, 0, null];\n}\n\nfunction getViewerFile(media, size) {\n    if (!size) return [0, 0, null, ''];\n\n    switch (media['@type']) {\n        case 'animation': {\n            return [media.width, media.height, media.animation, media.mime_type];\n        }\n        case 'photo': {\n            const photoSize = getSize(media.sizes, size);\n            if (photoSize) {\n                return [photoSize.width, photoSize.height, photoSize.photo, ''];\n            }\n            break;\n        }\n        case 'document': {\n            return [50, 50, document.document, document.mime_type];\n        }\n        case 'video': {\n            return [media.width, media.height, media.video, media.mime_type];\n        }\n        default: {\n        }\n    }\n\n    return [0, 0, null, ''];\n}\n\nfunction getMediaFile(chatId, messageId, size) {\n    if (!size) return [0, 0, null];\n    const message = MessageStore.get(chatId, messageId);\n    if (!message) return [0, 0, null, ''];\n\n    const { content } = message;\n    if (!content) return [0, 0, null, ''];\n\n    switch (content['@type']) {\n        case 'messageAnimation': {\n            const { animation } = content;\n            if (animation) {\n                const { width, height, animation: file, mime_type } = animation;\n                return [width, height, file, mime_type];\n            }\n            break;\n        }\n        case 'messageChatChangePhoto': {\n            const { photo } = content;\n            if (photo) {\n                const photoSize = getSize(photo.sizes, size);\n                if (photoSize) {\n                    const { width, height, photo: file } = photoSize;\n                    return [width, height, file, ''];\n                }\n            }\n            break;\n        }\n        case 'messageDocument': {\n            const { document } = content;\n            if (document) {\n                const { document: file, mime_type } = document;\n                return [50, 50, file, mime_type];\n            }\n            break;\n        }\n        case 'messagePhoto': {\n            const { photo } = content;\n            if (photo) {\n                const photoSize = getSize(photo.sizes, size);\n                if (photoSize) {\n                    const { width, height, photo: file } = photoSize;\n                    return [width, height, file, ''];\n                }\n            }\n            break;\n        }\n        case 'messageText': {\n            const { web_page } = content;\n            if (web_page) {\n                const { animation, document, photo, video } = web_page;\n                if (animation) {\n                    const { width, height, animation: file, mime_type } = animation;\n                    return [width, height, file, mime_type];\n                }\n\n                if (document) {\n                    const { document: file, mime_type } = document;\n                    return [50, 50, file, mime_type];\n                }\n\n                if (photo) {\n                    const photoSize = getSize(photo.sizes, size);\n                    if (photoSize) {\n                        const { width, height, photo: file } = photoSize;\n                        return [width, height, file, ''];\n                    }\n                    break;\n                }\n\n                if (video) {\n                    const { width, height, video: file, mime_type } = video;\n                    return [width, height, file, mime_type];\n                }\n            }\n            break;\n        }\n        case 'messageVideo': {\n            const { video } = content;\n            if (video) {\n                const { width, height, video: file, mime_type } = video;\n                return [width, height, file, mime_type];\n            }\n            break;\n        }\n        default: {\n        }\n    }\n\n    return [0, 0, null, ''];\n}\n\nexport function cancelLoadIVMediaViewerContent(blocks) {\n    if (!blocks) return;\n    if (!blocks.length) return;\n\n    for (let i = 0; i < blocks.length; i++) {\n        const content = blocks[i];\n        if (content) {\n            switch (content['@type']) {\n                case 'pageBlockAnimation': {\n                    const { animation } = content;\n                    if (!animation) break;\n\n                    cancelLoadAnimationThumbnailContent(animation);\n                    cancelLoadAnimationContent(animation);\n                    break;\n                }\n                case 'pageBlockPhoto': {\n                    const { photo } = content;\n                    if (!photo) break;\n\n                    cancelLoadBigPhotoContent(photo);\n                    break;\n                }\n                case 'pageBlockVideo': {\n                    const { video } = content;\n                    if (!video) break;\n\n                    cancelLoadVideoThumbnailContent(video);\n                    cancelLoadVideoContent(video);\n                    break;\n                }\n            }\n        }\n    }\n}\n\nfunction cancelLoadMediaViewerContent(messages) {\n    if (!messages) return;\n    if (!messages.length) return;\n\n    for (let i = 0; i < messages.length; i++) {\n        let message = messages[i];\n        const { content } = message;\n        if (content) {\n            switch (content['@type']) {\n                case 'messageAnimation': {\n                    const { animation } = content;\n                    if (!animation) break;\n\n                    cancelLoadAnimationThumbnailContent(animation);\n                    cancelLoadAnimationContent(animation);\n                    break;\n                }\n                case 'messagePhoto': {\n                    const { photo } = content;\n                    if (!photo) break;\n\n                    cancelLoadBigPhotoContent(photo);\n                    break;\n                }\n                case 'messageVideo': {\n                    const { video } = content;\n                    if (!video) break;\n\n                    cancelLoadVideoThumbnailContent(video);\n                    cancelLoadVideoContent(video);\n                    break;\n                }\n                case 'messageText': {\n                    const { web_page } = message.content;\n                    if (web_page) {\n                        const { animation, photo, video } = web_page;\n\n                        if (animation) {\n                            cancelLoadAnimationThumbnailContent(animation);\n                            cancelLoadAnimationContent(animation);\n                        }\n\n                        if (photo) {\n                            cancelLoadBigPhotoContent(photo);\n                        }\n\n                        if (video) {\n                            cancelLoadVideoThumbnailContent(video);\n                            cancelLoadVideoContent(video);\n                        }\n                    }\n\n                    break;\n                }\n            }\n        }\n    }\n}\n\nexport function loadIVMediaViewerContent(blocks, useSizeLimit = false) {\n    if (!blocks) return;\n    if (!blocks.length) return;\n\n    const store = FileStore.getStore();\n\n    for (let i = 0; i < blocks.length; i++) {\n        const content = blocks[i];\n        if (content) {\n            switch (content['@type']) {\n                case 'pageBlockAnimation': {\n                    const { animation } = content;\n\n                    loadAnimationContent(store, animation, null, useSizeLimit);\n                    loadAnimationThumbnailContent(store, animation, null);\n                    break;\n                }\n                case 'pageBlockPhoto': {\n                    const { photo } = content;\n\n                    loadBigPhotoContent(store, photo, null);\n                    break;\n                }\n                case 'pageBlockVideo': {\n                    const { video } = content;\n\n                    loadVideoThumbnailContent(store, video, null);\n                    loadVideoContent(store, video, null, useSizeLimit);\n                    break;\n                }\n            }\n        }\n    }\n}\n\nfunction loadMediaViewerContent(messages, useSizeLimit = false) {\n    if (!messages) return;\n    if (!messages.length) return;\n\n    const store = FileStore.getStore();\n\n    for (let i = 0; i < messages.length; i++) {\n        let message = messages[i];\n        const { content } = message;\n        if (content) {\n            switch (content['@type']) {\n                case 'messageAnimation': {\n                    const { animation } = content;\n\n                    loadAnimationContent(store, animation, message, useSizeLimit);\n                    loadAnimationThumbnailContent(store, animation, message);\n                    break;\n                }\n                case 'messageChatChangePhoto': {\n                    const { photo } = content;\n\n                    loadBigPhotoContent(store, photo, message);\n                    break;\n                }\n                case 'messageDocument': {\n                    const { document } = content;\n\n                    loadDocumentContent(store, document, message, useSizeLimit);\n                    break;\n                }\n                case 'messagePhoto': {\n                    const { photo } = content;\n\n                    loadBigPhotoContent(store, photo, message);\n                    break;\n                }\n                case 'messageText': {\n                    const { web_page } = message.content;\n                    if (!web_page) {\n                        break;\n                    }\n\n                    const { animation, document, photo, video } = web_page;\n                    let loadPhoto = true;\n\n                    if (animation) {\n                        loadAnimationContent(store, animation, message, useSizeLimit);\n                        loadPhoto = !loadAnimationThumbnailContent(store, animation, message);\n                    }\n\n                    if (document) {\n                        loadDocumentContent(store, document, message, useSizeLimit);\n                        loadPhoto = false;\n                    }\n\n                    if (video) {\n                        loadVideoContent(store, video, message, useSizeLimit);\n                        loadPhoto = !loadVideoThumbnailContent(store, video, message);\n                    }\n\n                    if (loadPhoto) {\n                        loadBigPhotoContent(store, photo, message);\n                    }\n\n                    break;\n                }\n                case 'messageVideo': {\n                    const { video } = content;\n\n                    loadVideoThumbnailContent(store, video, message);\n                    loadVideoContent(store, video, message, useSizeLimit);\n                    break;\n                }\n            }\n        }\n    }\n}\n\nexport function cancelPreloadIVMediaViewerContent(index, blocks) {\n    if (!blocks.length) return;\n\n    const preload = [];\n    if (index > 0) {\n        preload.push(blocks[index - 1]);\n    }\n    if (index < blocks.length - 1) {\n        preload.push(blocks[index + 1]);\n    }\n\n    cancelLoadIVMediaViewerContent([blocks[index]]);\n    cancelLoadIVMediaViewerContent(blocks);\n}\n\nfunction cancelPreloadMediaViewerContent(index, history) {\n    if (!history.length) return;\n\n    const messages = [];\n    if (index > 0) {\n        messages.push(history[index - 1]);\n    }\n    if (index < history.length - 1) {\n        messages.push(history[index + 1]);\n    }\n\n    cancelLoadMediaViewerContent([history[index]]);\n    cancelLoadMediaViewerContent(messages);\n}\n\nfunction preloadMediaViewerContent(index, history) {\n    if (!history.length) return;\n\n    const messages = [];\n    if (index > 0) {\n        messages.push(history[index - 1]);\n    }\n    if (index < history.length - 1) {\n        messages.push(history[index + 1]);\n    }\n\n    loadMediaViewerContent([history[index]], false);\n    loadMediaViewerContent(messages, true);\n}\n\nexport function preloadIVMediaViewerContent(index, blocks) {\n    if (!blocks.length) return;\n\n    const preload = [];\n    if (index > 0) {\n        preload.push(blocks[index - 1]);\n    }\n    if (index < blocks.length - 1) {\n        preload.push(blocks[index + 1]);\n    }\n\n    loadIVMediaViewerContent([blocks[index]], false);\n    loadIVMediaViewerContent(preload, true);\n}\n\nfunction loadUserFileContent(store, file, userId) {\n    if (!file) return;\n\n    const { id } = file;\n    file = FileStore.get(id) || file;\n\n    const user = UserStore.get(userId);\n    if (!user) return;\n\n    const blob = file.blob || FileStore.getBlob(id);\n    if (blob) return;\n\n    FileStore.getLocalFile(\n        store,\n        file,\n        null,\n        () => FileStore.updateUserPhotoBlob(userId, id),\n        () => FileStore.getRemoteFile(id, THUMBNAIL_PRIORITY, user)\n    );\n}\n\nfunction loadChatFileContent(store, file, chatId) {\n    if (!file) return;\n\n    const { id } = file;\n    file = FileStore.get(id) || file;\n\n    const chat = ChatStore.get(chatId);\n    if (!chat) return;\n\n    const dataUrl = FileStore.getDataUrl(id);\n    if (dataUrl) return;\n\n    const blob = file.blob || FileStore.getBlob(id);\n    if (blob) return;\n\n    FileStore.getLocalFile(\n        store,\n        file,\n        null,\n        () => FileStore.updateChatPhotoBlob(chatId, id),\n        () => FileStore.getRemoteFile(id, THUMBNAIL_PRIORITY, chat)\n    );\n}\n\nfunction loadProfileMediaViewerContent(chatId, photos) {\n    if (!photos) return;\n\n    const store = FileStore.getStore();\n\n    photos.forEach(photo => {\n        switch (photo['@type']) {\n            case 'chatPhoto': {\n                const { small, big } = photo;\n\n                loadChatFileContent(store, small, chatId);\n                loadChatFileContent(store, big, chatId);\n                break;\n            }\n            case 'profilePhoto': {\n                const userId = getChatUserId(chatId);\n\n                const { small, big } = photo;\n\n                loadUserFileContent(store, small, userId);\n                loadUserFileContent(store, big, userId);\n                break;\n            }\n            case 'userProfilePhoto': {\n                photo = getProfilePhoto(photo);\n                if (!photo) break;\n\n                const userId = getChatUserId(chatId);\n\n                const { small, big } = photo;\n\n                loadUserFileContent(store, small, userId);\n                loadUserFileContent(store, big, userId);\n                break;\n            }\n        }\n    });\n}\n\nfunction preloadProfileMediaViewerContent(chatId, index, history) {\n    if (!history.length) return;\n\n    const items = [];\n    if (index > 0) {\n        items.push(history[index - 1]);\n    }\n    if (index < history.length - 1) {\n        items.push(history[index + 1]);\n    }\n    if (index >= 0 && index < history.length) {\n        items.push(history[index]);\n    }\n\n    loadProfileMediaViewerContent(chatId, items);\n}\n\nfunction loadUserContent(store, userId) {\n    const user = UserStore.get(userId);\n    if (!user) return;\n\n    const { profile_photo } = user;\n    if (!profile_photo) return;\n\n    const { small: file } = profile_photo;\n\n    loadUserFileContent(store, file, userId);\n}\n\nfunction loadUsersContent(store, ids) {\n    if (!ids) return;\n\n    ids.forEach(id => loadUserContent(store, id));\n}\n\nfunction loadChatContent(store, chatId) {\n    const chat = ChatStore.get(chatId);\n    if (!chat) return;\n\n    const { photo } = chat;\n    loadChatPhotoContent(store, photo, chat.id);\n}\n\nfunction loadChatPhotoContent(store, photo, chatId) {\n    if (!photo) return;\n\n    const { small: file } = photo;\n\n    loadChatFileContent(store, file, chatId);\n}\n\nfunction loadChatsContent(store, ids) {\n    if (!ids) return;\n\n    ids.forEach(id => loadChatContent(store, id));\n}\n\nfunction loadDraftContent(store, chatId) {\n    const chat = ChatStore.get(chatId);\n    if (!chat) return;\n\n    const { draft_message } = chat;\n    if (!draft_message) return;\n\n    const { reply_to_message_id } = draft_message;\n    if (!reply_to_message_id) return;\n\n    loadReplies(store, chatId, [reply_to_message_id]);\n}\n\nexport function loadRecentStickersContent(store, recent) {\n    if (!recent) return;\n\n    const { stickers } = recent;\n    loadStickersContent(store, stickers);\n}\n\nfunction loadStickerSetContent(store, stickerSet) {\n    if (!stickerSet) return;\n\n    const { stickers } = stickerSet;\n    loadStickersContent(store, stickers);\n}\n\nexport function loadBackgroundsContent(store, backgrounds) {\n    if (!backgrounds) return;\n\n    backgrounds.forEach(background => {\n        loadBackgroundContent(store, background, false);\n    });\n}\n\nexport function loadBackgroundContent(store, background, full = false) {\n    if (!background) return;\n\n    switch (background.type['@type']) {\n        case 'backgroundTypeFill': {\n            break;\n        }\n        case 'backgroundTypePattern': {\n            const { document } = background;\n            if (document) {\n                loadDocumentThumbnailContent(store, document, null);\n                if (full) loadDocumentContent(store, document, null, false);\n            }\n            break;\n        }\n        case 'backgroundTypeWallpaper': {\n            const { document } = background;\n            if (document) {\n                loadDocumentThumbnailContent(store, document, null);\n                if (full) loadDocumentContent(store, document, null, false);\n            }\n            break;\n        }\n    }\n}\n\nfunction loadStickersContent(store, stickers) {\n    if (!stickers) return;\n\n    stickers.forEach(sticker => {\n        loadStickerThumbnailContent(store, sticker, null);\n        if (sticker.is_animated) {\n            loadStickerContent(store, sticker, null);\n        }\n    });\n}\n\nfunction isGifMimeType(mimeType) {\n    return mimeType && mimeType.toLowerCase() === 'image/gif';\n}\n\nfunction getSrc(file) {\n    const dataUrl = file && FileStore.getDataUrl(file.id);\n    if (dataUrl) return dataUrl;\n\n    const blob = getBlob(file);\n\n    return FileStore.getBlobUrl(blob) || '';\n}\n\nfunction getBlob(file) {\n    return file ? FileStore.getBlob(file.id) || file.blob : null;\n}\n\nfunction getDownloadedSize(file) {\n    if (!file) return '0';\n    if (!file.local) return '0';\n    if (!file.local.is_downloading_active) return '0';\n\n    return getSizeString(file.local.downloaded_size);\n}\n\nfunction getUploadedSize(file) {\n    if (!file) return '0';\n    if (!file.remote) return '0';\n    if (!file.remote.is_uploading_active) return '0';\n\n    return getSizeString(file.remote.uploaded_size);\n}\n\nfunction getExtension(fileName) {\n    if (!fileName) {\n        return '';\n    }\n\n    const parts = fileName.split('.');\n    if (parts.length === 1 || (parts[0] === '' && parts.length === 2)) {\n        return '';\n    }\n    return parts.pop().toLowerCase();\n}\n\nfunction loadInstantViewContent(instantView) {\n    if (!instantView) return;\n\n    const { page_blocks } = instantView;\n    if (!page_blocks) return;\n\n    const store = FileStore.getStore();\n\n    page_blocks.forEach(pageBlock => loadPageBlockContent(store, pageBlock));\n}\n\nfunction loadPageBlockContent(store, b) {\n    if (!b) return;\n\n    switch (b['@type']) {\n        case 'pageBlockAnchor': {\n            break;\n        }\n        case 'pageBlockAnimation': {\n            const { animation, caption } = b;\n\n            loadAnimationThumbnailContent(store, animation, null);\n            loadAnimationContent(store, animation, null);\n            loadPageBlockContent(store, caption);\n            break;\n        }\n        case 'pageBlockAudio': {\n            const { audio, caption } = b;\n\n            loadAudioThumbnailContent(store, audio, null);\n            loadAudioContent(store, audio, null);\n            loadPageBlockContent(store, caption);\n            break;\n        }\n        case 'pageBlockAuthorDate': {\n            const { author } = b;\n\n            loadRichTextContent(store, author);\n            break;\n        }\n        case 'pageBlockBlockQuote': {\n            const { text, credit } = b;\n\n            loadRichTextContent(store, text);\n            loadRichTextContent(store, credit);\n            break;\n        }\n        // actually not a pageBlock child but load content in the same way\n        case 'pageBlockCaption': {\n            const { text, credit } = b;\n\n            loadRichTextContent(store, text);\n            loadRichTextContent(store, credit);\n            break;\n        }\n        case 'pageBlockChatLink': {\n            const { photo } = b;\n\n            loadChatPhotoContent(store, photo, 0);\n            break;\n        }\n        case 'pageBlockCollage': {\n            const { page_blocks, caption } = b;\n\n            loadPageBlockContent(store, caption);\n            page_blocks.forEach(x => loadPageBlockContent(store, x));\n            break;\n        }\n        case 'pageBlockCover': {\n            const { cover } = b;\n\n            loadPageBlockContent(store, cover);\n            break;\n        }\n        case 'pageBlockDetails': {\n            const { header, page_blocks } = b;\n\n            loadPageBlockContent(store, header);\n            page_blocks.forEach(x => loadPageBlockContent(store, x));\n            break;\n        }\n        case 'pageBlockDivider': {\n            break;\n        }\n        case 'pageBlockEmbedded': {\n            const { poster_photo, caption } = b;\n\n            loadPhotoContent(store, poster_photo, null);\n            loadPageBlockContent(store, caption);\n            break;\n        }\n        case 'pageBlockEmbeddedPost': {\n            const { author_photo, page_blocks, caption } = b;\n\n            loadPhotoContent(store, author_photo, null);\n            page_blocks.forEach(x => loadPageBlockContent(store, x));\n            loadPageBlockContent(store, caption);\n            break;\n        }\n        case 'pageBlockFooter': {\n            const { footer } = b;\n\n            loadRichTextContent(store, footer);\n            break;\n        }\n        case 'pageBlockHeader': {\n            const { header } = b;\n\n            loadRichTextContent(store, header);\n            break;\n        }\n        case 'pageBlockKicker': {\n            const { kicker } = b;\n\n            loadRichTextContent(store, kicker);\n            break;\n        }\n        case 'pageBlockList': {\n            const { items } = b;\n\n            items.forEach(x => loadPageBlockContent(store, x));\n            break;\n        }\n        // actually not a pageBlock child but load content in the same way\n        case 'pageBlockListItem': {\n            const { page_blocks } = b;\n\n            page_blocks.forEach(x => loadPageBlockContent(store, x));\n            break;\n        }\n        case 'pageBlockMap': {\n            const { caption } = b;\n\n            loadPageBlockMapContent(store, b, null);\n            loadPageBlockContent(store, caption);\n            break;\n        }\n        case 'pageBlockParagraph': {\n            const { text } = b;\n\n            loadRichTextContent(store, text);\n            break;\n        }\n        case 'pageBlockPhoto': {\n            const { photo, caption } = b;\n\n            loadPhotoContent(store, photo, null, IV_PHOTO_SIZE);\n            loadPageBlockContent(store, caption);\n            break;\n        }\n        case 'pageBlockPreformatted': {\n            const { text } = b;\n\n            loadRichTextContent(store, text);\n            break;\n        }\n        case 'pageBlockPullQuote': {\n            const { text, credit } = b;\n\n            loadRichTextContent(store, text);\n            loadRichTextContent(store, credit);\n            break;\n        }\n        case 'pageBlockRelatedArticles': {\n            const { header, articles } = b;\n\n            loadRichTextContent(store, header);\n            articles.forEach(x => loadPageBlockContent(store, x));\n            break;\n        }\n        // actually not a pageBlock child but load content in the same way\n        case 'pageBlockRelatedArticle': {\n            const { photo } = b;\n\n            loadPhotoContent(store, photo, null);\n            break;\n        }\n        case 'pageBlockSlideshow': {\n            const { page_blocks, caption } = b;\n\n            loadPageBlockContent(store, caption);\n            page_blocks.forEach(x => loadPageBlockContent(store, x));\n            break;\n        }\n        case 'pageBlockSubheader': {\n            const { subheader } = b;\n\n            loadRichTextContent(store, subheader);\n            break;\n        }\n        case 'pageBlockSubtitle': {\n            const { subtitle } = b;\n\n            loadRichTextContent(store, subtitle);\n            break;\n        }\n        case 'pageBlockTable': {\n            const { caption, cells } = b;\n\n            loadRichTextContent(store, caption);\n            cells.forEach(row => row.forEach(x => loadPageBlockContent(store, x)));\n            break;\n        }\n        // actually not a pageBlock child but load content in the same way\n        case 'pageBlockTableCell': {\n            const { text } = b;\n\n            loadRichTextContent(store, text);\n            break;\n        }\n        case 'pageBlockTitle': {\n            const { title } = b;\n\n            loadRichTextContent(store, title);\n            break;\n        }\n        case 'pageBlockVideo': {\n            const { video, caption } = b;\n\n            loadVideoThumbnailContent(store, video, null);\n            loadVideoContent(store, video, null);\n            loadPageBlockContent(store, caption);\n            break;\n        }\n    }\n}\n\nfunction loadRichTextContent(store, t) {\n    if (!t) return;\n\n    switch (t['@type']) {\n        case 'richTextAnchor': {\n            const { text } = t;\n\n            loadRichTextContent(store, text);\n            break;\n        }\n        case 'richTextBold': {\n            const { text } = t;\n\n            loadRichTextContent(store, text);\n            break;\n        }\n        case 'richTextEmailAddress': {\n            const { text } = t;\n\n            loadRichTextContent(store, text);\n            break;\n        }\n        case 'richTextFixed': {\n            const { text } = t;\n\n            loadRichTextContent(store, text);\n            break;\n        }\n        case 'richTextIcon': {\n            const { document } = t;\n\n            loadDocumentThumbnailContent(store, document, null);\n            loadDocumentContent(store, document, null, false);\n            break;\n        }\n        case 'richTextItalic': {\n            const { text } = t;\n\n            loadRichTextContent(store, text);\n            break;\n        }\n        case 'richTextMarked': {\n            const { text } = t;\n\n            loadRichTextContent(store, text);\n            break;\n        }\n        case 'richTextPhoneNumber': {\n            const { text } = t;\n\n            loadRichTextContent(store, text);\n            break;\n        }\n        case 'richTextPlain': {\n            const { text } = t;\n\n            loadRichTextContent(store, text);\n            break;\n        }\n        case 'richTexts': {\n            const { texts } = t;\n\n            texts.forEach(x => loadRichTextContent(store, x));\n            break;\n        }\n        case 'richTextStrikethrough': {\n            const { text } = t;\n\n            loadRichTextContent(store, text);\n            break;\n        }\n        case 'richTextSubscript': {\n            const { text } = t;\n\n            loadRichTextContent(store, text);\n            break;\n        }\n        case 'richTextSuperscript': {\n            const { text } = t;\n\n            loadRichTextContent(store, text);\n            break;\n        }\n        case 'richTextUnderline': {\n            const { text } = t;\n\n            loadRichTextContent(store, text);\n            break;\n        }\n        case 'richTextUrl': {\n            const { text } = t;\n\n            loadRichTextContent(store, text);\n            break;\n        }\n    }\n}\n\nfunction getAnimationData(file) {\n    return new Promise(resolve => {\n        if (!file) {\n            resolve(null);\n            return;\n        }\n\n        const blob = FileStore.getBlob(file.id);\n        if (!blob) {\n            resolve(null);\n            return;\n        }\n\n        const fileReader = new FileReader();\n        fileReader.onload = event => resolve(JSON.parse(event.target.result));\n        fileReader.onerror = () => resolve(null);\n        fileReader.onabort = () => resolve(null);\n        fileReader.readAsText(blob);\n    });\n}\n\nexport {\n    getFileSize,\n    getSizeString,\n    saveData,\n    saveBlob,\n    loadMessageContents,\n    loadMediaViewerContent,\n    preloadMediaViewerContent,\n    cancelLoadMediaViewerContent,\n    cancelPreloadMediaViewerContent,\n    loadProfileMediaViewerContent,\n    preloadProfileMediaViewerContent,\n    loadChatContent,\n    loadChatsContent,\n    loadDraftContent,\n    loadInstantViewContent,\n    loadStickerContent,\n    loadStickersContent,\n    loadStickerSetContent,\n    loadStickerThumbnailContent,\n    loadUserContent,\n    loadUsersContent,\n    saveOrDownload,\n    download,\n    getMediaFile,\n    getMediaPreviewFile,\n    isGifMimeType,\n    getSrc,\n    getBlob,\n    getDownloadedSize,\n    getUploadedSize,\n    getExtension,\n    getViewerFile,\n    getViewerThumbnail,\n    getAnimationData\n};\n"]},"metadata":{},"sourceType":"module"}