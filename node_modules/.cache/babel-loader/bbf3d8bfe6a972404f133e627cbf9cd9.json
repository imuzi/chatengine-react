{"ast":null,"code":"import _defineProperty from \"/Users/wubenqi/nebula-chat/telegram-react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _classCallCheck from \"/Users/wubenqi/nebula-chat/telegram-react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/wubenqi/nebula-chat/telegram-react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nvar Storage =\n/*#__PURE__*/\nfunction () {\n  function Storage(options) {\n    _classCallCheck(this, Storage);\n\n    this.store = options.store;\n  }\n\n  _createClass(Storage, [{\n    key: \"setItem\",\n    value: function setItem(key, value) {\n      if (!this.store) return;\n\n      try {\n        this.store.setItem(key, value);\n      } catch (e) {}\n    }\n  }, {\n    key: \"getItem\",\n    value: function getItem(key, value) {\n      if (!this.store) return;\n\n      try {\n        return this.store.getItem(key, value);\n      } catch (e) {}\n\n      return undefined;\n    }\n  }]);\n\n  return Storage;\n}();\n\nfunction getDefaults() {\n  return {\n    prefix: 'i18next_res_',\n    expirationTime: Infinity,\n    versions: {},\n    store: window.localStorage\n  };\n}\n\nvar Cache =\n/*#__PURE__*/\nfunction () {\n  function Cache(services) {\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    _classCallCheck(this, Cache);\n\n    this.init(services, options);\n    this.type = 'backend';\n  }\n\n  _createClass(Cache, [{\n    key: \"init\",\n    value: function init(services) {\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      this.services = services;\n      this.options = _objectSpread({}, getDefaults(), {}, this.options, {}, options);\n      this.storage = new Storage(this.options);\n    }\n  }, {\n    key: \"read\",\n    value: function read(language, namespace, callback) {\n      var nowMS = new Date().getTime();\n\n      if (!this.storage.store) {\n        return callback(null, null);\n      }\n\n      var local = this.storage.getItem(\"\".concat(this.options.prefix).concat(language, \"-\").concat(namespace));\n\n      if (local) {\n        local = JSON.parse(local);\n\n        if ( // expiration field is mandatory, and should not be expired\n        local.i18nStamp && local.i18nStamp + this.options.expirationTime > nowMS && // there should be no language version set, or if it is, it should match the one in translation\n        this.options.versions[language] === local.i18nVersion) {\n          delete local.i18nVersion;\n          delete local.i18nStamp;\n          return callback(null, local);\n        }\n      }\n\n      return callback(null, null);\n    }\n  }, {\n    key: \"save\",\n    value: function save(language, namespace, data) {\n      if (this.storage.store) {\n        data.i18nStamp = new Date().getTime(); // language version (if set)\n\n        if (this.options.versions[language]) {\n          data.i18nVersion = this.options.versions[language];\n        } // save\n\n\n        this.storage.setItem(\"\".concat(this.options.prefix).concat(language, \"-\").concat(namespace), JSON.stringify(data));\n      }\n    }\n  }]);\n\n  return Cache;\n}();\n\nCache.type = 'backend';\nexport default Cache;","map":{"version":3,"sources":["/Users/wubenqi/nebula-chat/telegram-react/src/Localization/Cache.js"],"names":["Storage","options","store","key","value","setItem","e","getItem","undefined","getDefaults","prefix","expirationTime","Infinity","versions","window","localStorage","Cache","services","init","type","storage","language","namespace","callback","nowMS","Date","getTime","local","JSON","parse","i18nStamp","i18nVersion","data","stringify"],"mappings":"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","sourcesContent":["class Storage {\n    constructor(options) {\n        this.store = options.store;\n    }\n\n    setItem(key, value) {\n        if (!this.store) return;\n\n        try {\n            this.store.setItem(key, value);\n        } catch (e) {}\n    }\n\n    getItem(key, value) {\n        if (!this.store) return;\n\n        try {\n            return this.store.getItem(key, value);\n        } catch (e) {}\n\n        return undefined;\n    }\n}\n\nfunction getDefaults() {\n    return {\n        prefix: 'i18next_res_',\n        expirationTime: Infinity,\n        versions: {},\n        store: window.localStorage\n    };\n}\n\nclass Cache {\n    constructor(services, options = {}) {\n        this.init(services, options);\n\n        this.type = 'backend';\n    }\n\n    init(services, options = {}) {\n        this.services = services;\n        this.options = { ...getDefaults(), ...this.options, ...options };\n        this.storage = new Storage(this.options);\n    }\n\n    read(language, namespace, callback) {\n        const nowMS = new Date().getTime();\n\n        if (!this.storage.store) {\n            return callback(null, null);\n        }\n\n        let local = this.storage.getItem(`${this.options.prefix}${language}-${namespace}`);\n\n        if (local) {\n            local = JSON.parse(local);\n            if (\n                // expiration field is mandatory, and should not be expired\n                local.i18nStamp &&\n                local.i18nStamp + this.options.expirationTime > nowMS &&\n                // there should be no language version set, or if it is, it should match the one in translation\n                this.options.versions[language] === local.i18nVersion\n            ) {\n                delete local.i18nVersion;\n                delete local.i18nStamp;\n                return callback(null, local);\n            }\n        }\n\n        return callback(null, null);\n    }\n\n    save(language, namespace, data) {\n        if (this.storage.store) {\n            data.i18nStamp = new Date().getTime();\n\n            // language version (if set)\n            if (this.options.versions[language]) {\n                data.i18nVersion = this.options.versions[language];\n            }\n\n            // save\n            this.storage.setItem(`${this.options.prefix}${language}-${namespace}`, JSON.stringify(data));\n        }\n    }\n}\n\nCache.type = 'backend';\n\nexport default Cache;\n"]},"metadata":{},"sourceType":"module"}