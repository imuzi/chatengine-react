{"ast":null,"code":"import _regeneratorRuntime from \"/Users/wubenqi/nebula-chat/telegram-react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/wubenqi/nebula-chat/telegram-react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/Users/wubenqi/nebula-chat/telegram-react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/wubenqi/nebula-chat/telegram-react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/wubenqi/nebula-chat/telegram-react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/wubenqi/nebula-chat/telegram-react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/wubenqi/nebula-chat/telegram-react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/wubenqi/nebula-chat/telegram-react/src/Components/Viewer/ProfileMediaViewer.js\";\n\n/*\n *  Copyright (c) 2018-present, Evgeny Nadymov\n *\n * This source code is licensed under the GPL v.3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport classNames from 'classnames';\nimport { withTranslation } from 'react-i18next';\nimport KeyboardManager, { KeyboardHandler } from '../Additional/KeyboardManager';\nimport CloseIcon from '../../Assets/Icons/Close';\nimport NavigateBeforeIcon from '../../Assets/Icons/Left';\nimport ReplyIcon from '../../Assets/Icons/Share';\nimport DeleteIcon from '../../Assets/Icons/Delete';\nimport MediaViewerDownloadButton from './MediaViewerDownloadButton';\nimport MediaViewerButton from './MediaViewerButton';\nimport MediaViewerFooterText from './MediaViewerFooterText';\nimport MediaViewerFooterButton from './MediaViewerFooterButton';\nimport ProfileMediaViewerContent from './ProfileMediaViewerContent';\nimport ProfileMediaInfo from '../Tile/ProfileMediaInfo';\nimport { forward, setProfileMediaViewerContent } from '../../Actions/Client';\nimport { getPhotoFromChat, getChatUserId, isPrivateChat } from '../../Utils/Chat';\nimport { getProfilePhotoDateHint, getProfilePhoto } from '../../Utils/User';\nimport { loadProfileMediaViewerContent, preloadProfileMediaViewerContent, saveOrDownload } from '../../Utils/File';\nimport { PROFILE_PHOTO_BIG_SIZE } from '../../Constants';\nimport FileStore from '../../Stores/FileStore';\nimport ChatStore from '../../Stores/ChatStore';\nimport TdLibController from '../../Controllers/TdLibController';\nimport './MediaViewer.css';\nimport './ProfileMediaViewer.css';\n\nvar ProfileMediaViewer =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(ProfileMediaViewer, _React$Component);\n\n  function ProfileMediaViewer(props) {\n    var _this;\n\n    _classCallCheck(this, ProfileMediaViewer);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(ProfileMediaViewer).call(this, props));\n\n    _this.handleKeyDown = function (event) {\n      event.preventDefault();\n      event.stopPropagation();\n\n      if (event.keyCode === 27) {\n        var deleteConfirmationOpened = _this.state.deleteConfirmationOpened;\n        if (deleteConfirmationOpened) return;\n\n        _this.handleClose();\n      } else if (event.keyCode === 39) {\n        _this.handlePrevious();\n      } else if (event.keyCode === 37) {\n        _this.handleNext();\n      }\n    };\n\n    _this.loadHistory =\n    /*#__PURE__*/\n    function () {\n      var _ref = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(photo) {\n        var chatId, result, index;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                chatId = _this.props.chatId;\n\n                if (isPrivateChat(chatId)) {\n                  _context.next = 3;\n                  break;\n                }\n\n                return _context.abrupt(\"return\");\n\n              case 3:\n                _context.next = 5;\n                return TdLibController.send({\n                  '@type': 'getUserProfilePhotos',\n                  user_id: getChatUserId(chatId),\n                  offset: 0,\n                  limit: 100\n                });\n\n              case 5:\n                result = _context.sent;\n                _this.history = result.photos;\n                _this.firstSliceLoaded = result.photos.length === 0;\n                index = 0;\n\n                _this.setState({\n                  currentIndex: index,\n                  hasNextMedia: _this.hasNextMedia(index),\n                  hasPreviousMedia: _this.hasPreviousMedia(index),\n                  totalCount: result.total_count\n                });\n\n                preloadProfileMediaViewerContent(chatId, index, _this.history);\n\n              case 11:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }();\n\n    _this.handleClose = function () {\n      setProfileMediaViewerContent(null);\n    };\n\n    _this.handleSave = function () {\n      var chatId = _this.props.chatId;\n      var _this$state = _this.state,\n          currentIndex = _this$state.currentIndex,\n          totalCount = _this$state.totalCount;\n      var chat = ChatStore.get(chatId);\n      if (!chat) return;\n      var index = -1;\n\n      if (totalCount) {\n        index = currentIndex;\n      }\n\n      var photo = index > 0 && index < _this.history.length ? getProfilePhoto(_this.history[index]) : getPhotoFromChat(chatId);\n      if (!photo) return;\n      if (!photo.big) return;\n      var file = FileStore.get(photo.big.id) || photo.big;\n      if (!file) return;\n      saveOrDownload(file, file.id + '.jpg', chat, function () {\n        return FileStore.updateChatPhotoBlob(chatId, file.id);\n      });\n    };\n\n    _this.handleForward = function () {\n      var chatId = _this.props.chatId;\n      var _this$state2 = _this.state,\n          currentIndex = _this$state2.currentIndex,\n          totalCount = _this$state2.totalCount;\n      var index = -1;\n\n      if (totalCount) {\n        index = currentIndex;\n      }\n\n      var inputFile = null;\n      var inputMessagePhoto = null;\n      var inHistory = _this.history && index >= 0 && index < _this.history.length;\n\n      if (inHistory) {\n        var photo = getProfilePhoto(_this.history[index]);\n        if (!photo) return;\n        var file = photo.big;\n        if (!file) return;\n        inputFile = {\n          '@type': 'inputFileId',\n          id: file.id\n        };\n      } else {\n        var chatPhoto = getPhotoFromChat(chatId);\n        if (!chatPhoto) return;\n        var _file = chatPhoto.big;\n        if (!_file) return;\n        var blob = FileStore.getBlob(_file.id);\n        if (!blob) return;\n        inputFile = {\n          '@type': 'inputFileBlob',\n          data: blob,\n          name: ''\n        };\n      }\n\n      if (!inputFile) return;\n      var inputMessageContent = {\n        '@type': 'inputMessagePhoto',\n        photo: inputFile,\n        thumbnail: null,\n        added_sticker_file_ids: [],\n        width: PROFILE_PHOTO_BIG_SIZE,\n        height: PROFILE_PHOTO_BIG_SIZE,\n        caption: {\n          '@type': 'formattedText',\n          text: '',\n          entities: null\n        },\n        ttl: 0\n      };\n      forward(inputMessageContent);\n    };\n\n    _this.handleDelete = function () {\n      var _this$props = _this.props,\n          chatId = _this$props.chatId,\n          messageId = _this$props.messageId;\n      var _this$state3 = _this.state,\n          currentIndex = _this$state3.currentIndex,\n          totalCount = _this$state3.totalCount;\n      var index = -1;\n\n      if (totalCount) {\n        index = currentIndex;\n      }\n\n      var photo = index > 0 && index < _this.history.length ? getProfilePhoto(_this.history[index]) : getPhotoFromChat(chatId);\n\n      if (photo) {\n        var file = photo.big;\n        file = FileStore.get(file.id) || file;\n\n        if (file) {\n          var store = FileStore.getReadWriteStore();\n          FileStore.deleteLocalFile(store, file);\n        }\n      }\n    };\n\n    _this.hasPreviousMedia = function (index) {\n      if (index === -1) return false;\n      var nextIndex = index + 1;\n      return nextIndex < _this.history.length;\n    };\n\n    _this.handlePrevious = function (event) {\n      if (event) {\n        event.stopPropagation();\n      }\n\n      var currentIndex = _this.state.currentIndex;\n      var nextIndex = currentIndex + 1;\n      return _this.loadMedia(nextIndex, function () {\n        if (nextIndex === _this.history.length - 1) {\n          _this.loadPrevious();\n        }\n      });\n    };\n\n    _this.loadPrevious =\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee2() {\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              return _context2.abrupt(\"return\");\n\n            case 1:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    _this.hasNextMedia = function (index) {\n      if (index === -1) return false;\n      var nextIndex = index - 1;\n      return nextIndex >= 0;\n    };\n\n    _this.handleNext = function (event) {\n      if (event) {\n        event.stopPropagation();\n      }\n\n      var currentIndex = _this.state.currentIndex;\n      var nextIndex = currentIndex - 1;\n      return _this.loadMedia(nextIndex, function () {\n        if (nextIndex === 0) {\n          _this.loadNext();\n        }\n      });\n    };\n\n    _this.loadNext =\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee3() {\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              return _context3.abrupt(\"return\");\n\n            case 1:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    _this.loadMedia = function (index, callback) {\n      if (index < 0) return false;\n      if (index >= _this.history.length) return false;\n\n      _this.setState({\n        currentIndex: index,\n        hasNextMedia: _this.hasNextMedia(index),\n        hasPreviousMedia: _this.hasPreviousMedia(index)\n      }, callback);\n\n      var chatId = _this.props.chatId;\n      preloadProfileMediaViewerContent(chatId, index, _this.history);\n      return true;\n    };\n\n    _this.history = [];\n    _this.keyboardHandler = new KeyboardHandler(_this.handleKeyDown);\n    var _this$props2 = _this.props,\n        _chatId = _this$props2.chatId,\n        fileId = _this$props2.fileId;\n    _this.state = {\n      prevChatId: _chatId,\n      prevFileId: fileId,\n      currentIndex: 0,\n      hasNextMedia: false,\n      hasPreviousMedia: false,\n      deleteConfirmationOpened: false\n    };\n    return _this;\n  }\n\n  _createClass(ProfileMediaViewer, [{\n    key: \"shouldComponentUpdate\",\n    value: function shouldComponentUpdate(nextProps, nextState) {\n      var _this$props3 = this.props,\n          chatId = _this$props3.chatId,\n          messageId = _this$props3.messageId;\n      var _this$state4 = this.state,\n          currentFileId = _this$state4.currentFileId,\n          hasPreviousMedia = _this$state4.hasPreviousMedia,\n          hasNextMedia = _this$state4.hasNextMedia,\n          firstSliceLoaded = _this$state4.firstSliceLoaded,\n          totalCount = _this$state4.totalCount,\n          deleteConfirmationOpened = _this$state4.deleteConfirmationOpened;\n\n      if (nextProps.chatId !== chatId) {\n        return true;\n      }\n\n      if (nextProps.messageId !== messageId) {\n        return true;\n      }\n\n      if (nextState.currentFileId !== currentFileId) {\n        return true;\n      }\n\n      if (nextState.hasPrevousMedia !== hasPreviousMedia) {\n        return true;\n      }\n\n      if (nextState.hasNextMedia !== hasNextMedia) {\n        return true;\n      }\n\n      if (nextState.firstSliceLoaded !== firstSliceLoaded) {\n        return true;\n      }\n\n      if (nextState.totalCount !== totalCount) {\n        return true;\n      }\n\n      if (nextState.deleteConfirmationOpened !== deleteConfirmationOpened) {\n        return true;\n      }\n\n      return false;\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var chatId = this.props.chatId;\n      var photo = getPhotoFromChat(chatId);\n      loadProfileMediaViewerContent(chatId, [photo]);\n      this.loadHistory(photo);\n      KeyboardManager.add(this.keyboardHandler);\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      KeyboardManager.remove(this.keyboardHandler);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$props4 = this.props,\n          chatId = _this$props4.chatId,\n          t = _this$props4.t;\n      var _this$state5 = this.state,\n          currentIndex = _this$state5.currentIndex,\n          hasNextMedia = _this$state5.hasNextMedia,\n          hasPreviousMedia = _this$state5.hasPreviousMedia,\n          firstSliceLoaded = _this$state5.firstSliceLoaded,\n          totalCount = _this$state5.totalCount,\n          deleteConfirmationOpened = _this$state5.deleteConfirmationOpened,\n          deleteForAll = _this$state5.deleteForAll;\n      var index = -1;\n\n      if (totalCount) {\n        index = currentIndex;\n      }\n\n      var deleteConfirmation = null;\n      var inHistory = index >= 0 && index < this.history.length;\n      var photo = inHistory && index !== 0 ? getProfilePhoto(this.history[index]) : getPhotoFromChat(chatId);\n      var userProfilePhoto = inHistory ? this.history[index] : null;\n      var file = photo.big;\n      return React.createElement(\"div\", {\n        className: classNames('media-viewer', 'media-viewer-default'),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 361\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"media-viewer-footer\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 362\n        },\n        __self: this\n      }, React.createElement(ProfileMediaInfo, {\n        chatId: chatId,\n        date: getProfilePhotoDateHint(userProfilePhoto),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 363\n        },\n        __self: this\n      }), React.createElement(MediaViewerFooterText, {\n        title: t('AttachPhoto'),\n        subtitle: totalCount && index >= 0 ? \"\".concat(index + 1, \" of \").concat(totalCount) : null,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 364\n        },\n        __self: this\n      }), React.createElement(MediaViewerDownloadButton, {\n        title: t('Save'),\n        fileId: file.id,\n        onClick: this.handleSave,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 368\n        },\n        __self: this\n      }), React.createElement(MediaViewerDownloadButton, {\n        title: t('Forward'),\n        fileId: file.id,\n        onClick: this.handleForward,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 369\n        },\n        __self: this\n      }, React.createElement(ReplyIcon, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 370\n        },\n        __self: this\n      })), React.createElement(MediaViewerFooterButton, {\n        title: t('Delete'),\n        disabled: true,\n        onClick: this.handleDelete,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 372\n        },\n        __self: this\n      }, React.createElement(DeleteIcon, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 373\n        },\n        __self: this\n      })), React.createElement(MediaViewerFooterButton, {\n        title: t('Close'),\n        onClick: this.handleClose,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 375\n        },\n        __self: this\n      }, React.createElement(CloseIcon, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 376\n        },\n        __self: this\n      }))), React.createElement(\"div\", {\n        className: \"media-viewer-wrapper\",\n        onClick: this.handlePrevious,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 379\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"media-viewer-left-column\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 380\n        },\n        __self: this\n      }, React.createElement(MediaViewerButton, {\n        disabled: !hasNextMedia,\n        grow: true,\n        onClick: this.handleNext,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 381\n        },\n        __self: this\n      }, React.createElement(NavigateBeforeIcon, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 382\n        },\n        __self: this\n      }))), React.createElement(\"div\", {\n        className: \"media-viewer-content-column\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 386\n        },\n        __self: this\n      }, React.createElement(ProfileMediaViewerContent, {\n        chatId: chatId,\n        photo: photo,\n        onClick: this.handlePrevious,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 387\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        className: \"media-viewer-right-column\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 390\n        },\n        __self: this\n      }, React.createElement(MediaViewerButton, {\n        disabled: !hasPreviousMedia,\n        grow: true,\n        onClick: this.handlePrevious,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 391\n        },\n        __self: this\n      }, React.createElement(NavigateBeforeIcon, {\n        style: {\n          transform: 'rotate(180deg)'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 392\n        },\n        __self: this\n      })))), deleteConfirmation);\n    }\n  }]);\n\n  return ProfileMediaViewer;\n}(React.Component);\n\nProfileMediaViewer.propTypes = {\n  chatId: PropTypes.number.isRequired\n};\nexport default withTranslation()(ProfileMediaViewer);","map":{"version":3,"sources":["/Users/wubenqi/nebula-chat/telegram-react/src/Components/Viewer/ProfileMediaViewer.js"],"names":["React","PropTypes","classNames","withTranslation","KeyboardManager","KeyboardHandler","CloseIcon","NavigateBeforeIcon","ReplyIcon","DeleteIcon","MediaViewerDownloadButton","MediaViewerButton","MediaViewerFooterText","MediaViewerFooterButton","ProfileMediaViewerContent","ProfileMediaInfo","forward","setProfileMediaViewerContent","getPhotoFromChat","getChatUserId","isPrivateChat","getProfilePhotoDateHint","getProfilePhoto","loadProfileMediaViewerContent","preloadProfileMediaViewerContent","saveOrDownload","PROFILE_PHOTO_BIG_SIZE","FileStore","ChatStore","TdLibController","ProfileMediaViewer","props","handleKeyDown","event","preventDefault","stopPropagation","keyCode","deleteConfirmationOpened","state","handleClose","handlePrevious","handleNext","loadHistory","photo","chatId","send","user_id","offset","limit","result","history","photos","firstSliceLoaded","length","index","setState","currentIndex","hasNextMedia","hasPreviousMedia","totalCount","total_count","handleSave","chat","get","big","file","id","updateChatPhotoBlob","handleForward","inputFile","inputMessagePhoto","inHistory","chatPhoto","blob","getBlob","data","name","inputMessageContent","thumbnail","added_sticker_file_ids","width","height","caption","text","entities","ttl","handleDelete","messageId","store","getReadWriteStore","deleteLocalFile","nextIndex","loadMedia","loadPrevious","loadNext","callback","keyboardHandler","fileId","prevChatId","prevFileId","nextProps","nextState","currentFileId","hasPrevousMedia","add","remove","t","deleteForAll","deleteConfirmation","userProfilePhoto","transform","Component","propTypes","number","isRequired"],"mappings":";;;;;;;;;AAAA;;;;;;AAOA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,SAAP,MAAsB,YAAtB;AACA,OAAOC,UAAP,MAAuB,YAAvB;AACA,SAASC,eAAT,QAAgC,eAAhC;AACA,OAAOC,eAAP,IAA0BC,eAA1B,QAAiD,+BAAjD;AACA,OAAOC,SAAP,MAAsB,0BAAtB;AACA,OAAOC,kBAAP,MAA+B,yBAA/B;AACA,OAAOC,SAAP,MAAsB,0BAAtB;AACA,OAAOC,UAAP,MAAuB,2BAAvB;AACA,OAAOC,yBAAP,MAAsC,6BAAtC;AACA,OAAOC,iBAAP,MAA8B,qBAA9B;AACA,OAAOC,qBAAP,MAAkC,yBAAlC;AACA,OAAOC,uBAAP,MAAoC,2BAApC;AACA,OAAOC,yBAAP,MAAsC,6BAAtC;AACA,OAAOC,gBAAP,MAA6B,0BAA7B;AACA,SAASC,OAAT,EAAkBC,4BAAlB,QAAsD,sBAAtD;AACA,SAASC,gBAAT,EAA2BC,aAA3B,EAA0CC,aAA1C,QAA+D,kBAA/D;AACA,SAASC,uBAAT,EAAkCC,eAAlC,QAAyD,kBAAzD;AACA,SAASC,6BAAT,EAAwCC,gCAAxC,EAA0EC,cAA1E,QAAgG,kBAAhG;AACA,SAASC,sBAAT,QAAuC,iBAAvC;AACA,OAAOC,SAAP,MAAsB,wBAAtB;AACA,OAAOC,SAAP,MAAsB,wBAAtB;AACA,OAAOC,eAAP,MAA4B,mCAA5B;AACA,OAAO,mBAAP;AACA,OAAO,0BAAP;;IAEMC,kB;;;;;AACF,8BAAYC,KAAZ,EAAmB;AAAA;;AAAA;;AACf,4FAAMA,KAAN;;AADe,UA8EnBC,aA9EmB,GA8EH,UAAAC,KAAK,EAAI;AACrBA,MAAAA,KAAK,CAACC,cAAN;AACAD,MAAAA,KAAK,CAACE,eAAN;;AAEA,UAAIF,KAAK,CAACG,OAAN,KAAkB,EAAtB,EAA0B;AAAA,YACdC,wBADc,GACe,MAAKC,KADpB,CACdD,wBADc;AAEtB,YAAIA,wBAAJ,EAA8B;;AAE9B,cAAKE,WAAL;AACH,OALD,MAKO,IAAIN,KAAK,CAACG,OAAN,KAAkB,EAAtB,EAA0B;AAC7B,cAAKI,cAAL;AACH,OAFM,MAEA,IAAIP,KAAK,CAACG,OAAN,KAAkB,EAAtB,EAA0B;AAC7B,cAAKK,UAAL;AACH;AACJ,KA5FkB;;AAAA,UA8FnBC,WA9FmB;AAAA;AAAA;AAAA;AAAA;AAAA,+BA8FL,iBAAMC,KAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AACFC,gBAAAA,MADE,GACS,MAAKb,KADd,CACFa,MADE;;AAAA,oBAGLxB,aAAa,CAACwB,MAAD,CAHR;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA,uBAKWf,eAAe,CAACgB,IAAhB,CAAqB;AACtC,2BAAS,sBAD6B;AAEtCC,kBAAAA,OAAO,EAAE3B,aAAa,CAACyB,MAAD,CAFgB;AAGtCG,kBAAAA,MAAM,EAAE,CAH8B;AAItCC,kBAAAA,KAAK,EAAE;AAJ+B,iBAArB,CALX;;AAAA;AAKJC,gBAAAA,MALI;AAYV,sBAAKC,OAAL,GAAeD,MAAM,CAACE,MAAtB;AACA,sBAAKC,gBAAL,GAAwBH,MAAM,CAACE,MAAP,CAAcE,MAAd,KAAyB,CAAjD;AAEMC,gBAAAA,KAfI,GAeI,CAfJ;;AAiBV,sBAAKC,QAAL,CAAc;AACVC,kBAAAA,YAAY,EAAEF,KADJ;AAEVG,kBAAAA,YAAY,EAAE,MAAKA,YAAL,CAAkBH,KAAlB,CAFJ;AAGVI,kBAAAA,gBAAgB,EAAE,MAAKA,gBAAL,CAAsBJ,KAAtB,CAHR;AAIVK,kBAAAA,UAAU,EAAEV,MAAM,CAACW;AAJT,iBAAd;;AAOApC,gBAAAA,gCAAgC,CAACoB,MAAD,EAASU,KAAT,EAAgB,MAAKJ,OAArB,CAAhC;;AAxBU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OA9FK;;AAAA;AAAA;AAAA;AAAA;;AAAA,UAyHnBX,WAzHmB,GAyHL,YAAM;AAChBtB,MAAAA,4BAA4B,CAAC,IAAD,CAA5B;AACH,KA3HkB;;AAAA,UA6HnB4C,UA7HmB,GA6HN,YAAM;AAAA,UACPjB,MADO,GACI,MAAKb,KADT,CACPa,MADO;AAAA,wBAEsB,MAAKN,KAF3B;AAAA,UAEPkB,YAFO,eAEPA,YAFO;AAAA,UAEOG,UAFP,eAEOA,UAFP;AAIf,UAAMG,IAAI,GAAGlC,SAAS,CAACmC,GAAV,CAAcnB,MAAd,CAAb;AACA,UAAI,CAACkB,IAAL,EAAW;AAEX,UAAIR,KAAK,GAAG,CAAC,CAAb;;AACA,UAAIK,UAAJ,EAAgB;AACZL,QAAAA,KAAK,GAAGE,YAAR;AACH;;AAED,UAAMb,KAAK,GACPW,KAAK,GAAG,CAAR,IAAaA,KAAK,GAAG,MAAKJ,OAAL,CAAaG,MAAlC,GAA2C/B,eAAe,CAAC,MAAK4B,OAAL,CAAaI,KAAb,CAAD,CAA1D,GAAkFpC,gBAAgB,CAAC0B,MAAD,CADtG;AAEA,UAAI,CAACD,KAAL,EAAY;AACZ,UAAI,CAACA,KAAK,CAACqB,GAAX,EAAgB;AAEhB,UAAMC,IAAI,GAAGtC,SAAS,CAACoC,GAAV,CAAcpB,KAAK,CAACqB,GAAN,CAAUE,EAAxB,KAA+BvB,KAAK,CAACqB,GAAlD;AACA,UAAI,CAACC,IAAL,EAAW;AAEXxC,MAAAA,cAAc,CAACwC,IAAD,EAAOA,IAAI,CAACC,EAAL,GAAU,MAAjB,EAAyBJ,IAAzB,EAA+B;AAAA,eAAMnC,SAAS,CAACwC,mBAAV,CAA8BvB,MAA9B,EAAsCqB,IAAI,CAACC,EAA3C,CAAN;AAAA,OAA/B,CAAd;AACH,KAlJkB;;AAAA,UAoJnBE,aApJmB,GAoJH,YAAM;AAAA,UACVxB,MADU,GACC,MAAKb,KADN,CACVa,MADU;AAAA,yBAEmB,MAAKN,KAFxB;AAAA,UAEVkB,YAFU,gBAEVA,YAFU;AAAA,UAEIG,UAFJ,gBAEIA,UAFJ;AAIlB,UAAIL,KAAK,GAAG,CAAC,CAAb;;AACA,UAAIK,UAAJ,EAAgB;AACZL,QAAAA,KAAK,GAAGE,YAAR;AACH;;AAED,UAAIa,SAAS,GAAG,IAAhB;AACA,UAAIC,iBAAiB,GAAG,IAAxB;AACA,UAAMC,SAAS,GAAG,MAAKrB,OAAL,IAAgBI,KAAK,IAAI,CAAzB,IAA8BA,KAAK,GAAG,MAAKJ,OAAL,CAAaG,MAArE;;AACA,UAAIkB,SAAJ,EAAe;AACX,YAAM5B,KAAK,GAAGrB,eAAe,CAAC,MAAK4B,OAAL,CAAaI,KAAb,CAAD,CAA7B;AACA,YAAI,CAACX,KAAL,EAAY;AAFD,YAIAsB,IAJA,GAIStB,KAJT,CAILqB,GAJK;AAKX,YAAI,CAACC,IAAL,EAAW;AAEXI,QAAAA,SAAS,GAAG;AACR,mBAAS,aADD;AAERH,UAAAA,EAAE,EAAED,IAAI,CAACC;AAFD,SAAZ;AAIH,OAXD,MAWO;AACH,YAAMM,SAAS,GAAGtD,gBAAgB,CAAC0B,MAAD,CAAlC;AACA,YAAI,CAAC4B,SAAL,EAAgB;AAFb,YAIUP,KAJV,GAImBO,SAJnB,CAIKR,GAJL;AAKH,YAAI,CAACC,KAAL,EAAW;AAEX,YAAMQ,IAAI,GAAG9C,SAAS,CAAC+C,OAAV,CAAkBT,KAAI,CAACC,EAAvB,CAAb;AACA,YAAI,CAACO,IAAL,EAAW;AAEXJ,QAAAA,SAAS,GAAG;AACR,mBAAS,eADD;AAERM,UAAAA,IAAI,EAAEF,IAFE;AAGRG,UAAAA,IAAI,EAAE;AAHE,SAAZ;AAKH;;AAED,UAAI,CAACP,SAAL,EAAgB;AAEhB,UAAMQ,mBAAmB,GAAG;AACxB,iBAAS,mBADe;AAExBlC,QAAAA,KAAK,EAAE0B,SAFiB;AAGxBS,QAAAA,SAAS,EAAE,IAHa;AAIxBC,QAAAA,sBAAsB,EAAE,EAJA;AAKxBC,QAAAA,KAAK,EAAEtD,sBALiB;AAMxBuD,QAAAA,MAAM,EAAEvD,sBANgB;AAOxBwD,QAAAA,OAAO,EAAE;AACL,mBAAS,eADJ;AAELC,UAAAA,IAAI,EAAE,EAFD;AAGLC,UAAAA,QAAQ,EAAE;AAHL,SAPe;AAYxBC,QAAAA,GAAG,EAAE;AAZmB,OAA5B;AAeArE,MAAAA,OAAO,CAAC6D,mBAAD,CAAP;AACH,KA9MkB;;AAAA,UAgNnBS,YAhNmB,GAgNJ,YAAM;AAAA,wBACa,MAAKvD,KADlB;AAAA,UACTa,MADS,eACTA,MADS;AAAA,UACD2C,SADC,eACDA,SADC;AAAA,yBAEoB,MAAKjD,KAFzB;AAAA,UAETkB,YAFS,gBAETA,YAFS;AAAA,UAEKG,UAFL,gBAEKA,UAFL;AAIjB,UAAIL,KAAK,GAAG,CAAC,CAAb;;AACA,UAAIK,UAAJ,EAAgB;AACZL,QAAAA,KAAK,GAAGE,YAAR;AACH;;AAED,UAAMb,KAAK,GACPW,KAAK,GAAG,CAAR,IAAaA,KAAK,GAAG,MAAKJ,OAAL,CAAaG,MAAlC,GAA2C/B,eAAe,CAAC,MAAK4B,OAAL,CAAaI,KAAb,CAAD,CAA1D,GAAkFpC,gBAAgB,CAAC0B,MAAD,CADtG;;AAGA,UAAID,KAAJ,EAAW;AACP,YAAIsB,IAAI,GAAGtB,KAAK,CAACqB,GAAjB;AACAC,QAAAA,IAAI,GAAGtC,SAAS,CAACoC,GAAV,CAAcE,IAAI,CAACC,EAAnB,KAA0BD,IAAjC;;AACA,YAAIA,IAAJ,EAAU;AACN,cAAMuB,KAAK,GAAG7D,SAAS,CAAC8D,iBAAV,EAAd;AAEA9D,UAAAA,SAAS,CAAC+D,eAAV,CAA0BF,KAA1B,EAAiCvB,IAAjC;AACH;AACJ;AACJ,KArOkB;;AAAA,UAuOnBP,gBAvOmB,GAuOA,UAAAJ,KAAK,EAAI;AACxB,UAAIA,KAAK,KAAK,CAAC,CAAf,EAAkB,OAAO,KAAP;AAElB,UAAMqC,SAAS,GAAGrC,KAAK,GAAG,CAA1B;AACA,aAAOqC,SAAS,GAAG,MAAKzC,OAAL,CAAaG,MAAhC;AACH,KA5OkB;;AAAA,UA8OnBb,cA9OmB,GA8OF,UAAAP,KAAK,EAAI;AACtB,UAAIA,KAAJ,EAAW;AACPA,QAAAA,KAAK,CAACE,eAAN;AACH;;AAHqB,UAKdqB,YALc,GAKG,MAAKlB,KALR,CAKdkB,YALc;AAMtB,UAAMmC,SAAS,GAAGnC,YAAY,GAAG,CAAjC;AAEA,aAAO,MAAKoC,SAAL,CAAeD,SAAf,EAA0B,YAAM;AACnC,YAAIA,SAAS,KAAK,MAAKzC,OAAL,CAAaG,MAAb,GAAsB,CAAxC,EAA2C;AACvC,gBAAKwC,YAAL;AACH;AACJ,OAJM,CAAP;AAKH,KA3PkB;;AAAA,UA6PnBA,YA7PmB;AAAA;AAAA;AAAA;AAAA,6BA6PJ;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KA7PI;;AAAA,UAiQnBpC,YAjQmB,GAiQJ,UAAAH,KAAK,EAAI;AACpB,UAAIA,KAAK,KAAK,CAAC,CAAf,EAAkB,OAAO,KAAP;AAElB,UAAMqC,SAAS,GAAGrC,KAAK,GAAG,CAA1B;AACA,aAAOqC,SAAS,IAAI,CAApB;AACH,KAtQkB;;AAAA,UAwQnBlD,UAxQmB,GAwQN,UAAAR,KAAK,EAAI;AAClB,UAAIA,KAAJ,EAAW;AACPA,QAAAA,KAAK,CAACE,eAAN;AACH;;AAHiB,UAKVqB,YALU,GAKO,MAAKlB,KALZ,CAKVkB,YALU;AAMlB,UAAMmC,SAAS,GAAGnC,YAAY,GAAG,CAAjC;AAEA,aAAO,MAAKoC,SAAL,CAAeD,SAAf,EAA0B,YAAM;AACnC,YAAIA,SAAS,KAAK,CAAlB,EAAqB;AACjB,gBAAKG,QAAL;AACH;AACJ,OAJM,CAAP;AAKH,KArRkB;;AAAA,UAuRnBA,QAvRmB;AAAA;AAAA;AAAA;AAAA,6BAuRR;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAvRQ;;AAAA,UA2RnBF,SA3RmB,GA2RP,UAACtC,KAAD,EAAQyC,QAAR,EAAqB;AAC7B,UAAIzC,KAAK,GAAG,CAAZ,EAAe,OAAO,KAAP;AACf,UAAIA,KAAK,IAAI,MAAKJ,OAAL,CAAaG,MAA1B,EAAkC,OAAO,KAAP;;AAElC,YAAKE,QAAL,CACI;AACIC,QAAAA,YAAY,EAAEF,KADlB;AAEIG,QAAAA,YAAY,EAAE,MAAKA,YAAL,CAAkBH,KAAlB,CAFlB;AAGII,QAAAA,gBAAgB,EAAE,MAAKA,gBAAL,CAAsBJ,KAAtB;AAHtB,OADJ,EAMIyC,QANJ;;AAJ6B,UAarBnD,MAbqB,GAaV,MAAKb,KAbK,CAarBa,MAbqB;AAe7BpB,MAAAA,gCAAgC,CAACoB,MAAD,EAASU,KAAT,EAAgB,MAAKJ,OAArB,CAAhC;AACA,aAAO,IAAP;AACH,KA5SkB;;AAGf,UAAKA,OAAL,GAAe,EAAf;AACA,UAAK8C,eAAL,GAAuB,IAAI3F,eAAJ,CAAoB,MAAK2B,aAAzB,CAAvB;AAJe,uBAMY,MAAKD,KANjB;AAAA,QAMPa,OANO,gBAMPA,MANO;AAAA,QAMCqD,MAND,gBAMCA,MAND;AAQf,UAAK3D,KAAL,GAAa;AACT4D,MAAAA,UAAU,EAAEtD,OADH;AAETuD,MAAAA,UAAU,EAAEF,MAFH;AAGTzC,MAAAA,YAAY,EAAE,CAHL;AAITC,MAAAA,YAAY,EAAE,KAJL;AAKTC,MAAAA,gBAAgB,EAAE,KALT;AAMTrB,MAAAA,wBAAwB,EAAE;AANjB,KAAb;AARe;AAgBlB;;;;0CAEqB+D,S,EAAWC,S,EAAW;AAAA,yBACV,KAAKtE,KADK;AAAA,UAChCa,MADgC,gBAChCA,MADgC;AAAA,UACxB2C,SADwB,gBACxBA,SADwB;AAAA,yBASpC,KAAKjD,KAT+B;AAAA,UAGpCgE,aAHoC,gBAGpCA,aAHoC;AAAA,UAIpC5C,gBAJoC,gBAIpCA,gBAJoC;AAAA,UAKpCD,YALoC,gBAKpCA,YALoC;AAAA,UAMpCL,gBANoC,gBAMpCA,gBANoC;AAAA,UAOpCO,UAPoC,gBAOpCA,UAPoC;AAAA,UAQpCtB,wBARoC,gBAQpCA,wBARoC;;AAWxC,UAAI+D,SAAS,CAACxD,MAAV,KAAqBA,MAAzB,EAAiC;AAC7B,eAAO,IAAP;AACH;;AAED,UAAIwD,SAAS,CAACb,SAAV,KAAwBA,SAA5B,EAAuC;AACnC,eAAO,IAAP;AACH;;AAED,UAAIc,SAAS,CAACC,aAAV,KAA4BA,aAAhC,EAA+C;AAC3C,eAAO,IAAP;AACH;;AAED,UAAID,SAAS,CAACE,eAAV,KAA8B7C,gBAAlC,EAAoD;AAChD,eAAO,IAAP;AACH;;AAED,UAAI2C,SAAS,CAAC5C,YAAV,KAA2BA,YAA/B,EAA6C;AACzC,eAAO,IAAP;AACH;;AAED,UAAI4C,SAAS,CAACjD,gBAAV,KAA+BA,gBAAnC,EAAqD;AACjD,eAAO,IAAP;AACH;;AAED,UAAIiD,SAAS,CAAC1C,UAAV,KAAyBA,UAA7B,EAAyC;AACrC,eAAO,IAAP;AACH;;AAED,UAAI0C,SAAS,CAAChE,wBAAV,KAAuCA,wBAA3C,EAAqE;AACjE,eAAO,IAAP;AACH;;AAED,aAAO,KAAP;AACH;;;wCAEmB;AAAA,UACRO,MADQ,GACG,KAAKb,KADR,CACRa,MADQ;AAEhB,UAAMD,KAAK,GAAGzB,gBAAgB,CAAC0B,MAAD,CAA9B;AACArB,MAAAA,6BAA6B,CAACqB,MAAD,EAAS,CAACD,KAAD,CAAT,CAA7B;AAEA,WAAKD,WAAL,CAAiBC,KAAjB;AAEAvC,MAAAA,eAAe,CAACoG,GAAhB,CAAoB,KAAKR,eAAzB;AACH;;;2CAEsB;AACnB5F,MAAAA,eAAe,CAACqG,MAAhB,CAAuB,KAAKT,eAA5B;AACH;;;6BAkOQ;AAAA,yBACiB,KAAKjE,KADtB;AAAA,UACGa,MADH,gBACGA,MADH;AAAA,UACW8D,CADX,gBACWA,CADX;AAAA,yBAUD,KAAKpE,KAVJ;AAAA,UAGDkB,YAHC,gBAGDA,YAHC;AAAA,UAIDC,YAJC,gBAIDA,YAJC;AAAA,UAKDC,gBALC,gBAKDA,gBALC;AAAA,UAMDN,gBANC,gBAMDA,gBANC;AAAA,UAODO,UAPC,gBAODA,UAPC;AAAA,UAQDtB,wBARC,gBAQDA,wBARC;AAAA,UASDsE,YATC,gBASDA,YATC;AAYL,UAAIrD,KAAK,GAAG,CAAC,CAAb;;AACA,UAAIK,UAAJ,EAAgB;AACZL,QAAAA,KAAK,GAAGE,YAAR;AACH;;AAED,UAAMoD,kBAAkB,GAAG,IAA3B;AACA,UAAMrC,SAAS,GAAGjB,KAAK,IAAI,CAAT,IAAcA,KAAK,GAAG,KAAKJ,OAAL,CAAaG,MAArD;AACA,UAAMV,KAAK,GAAG4B,SAAS,IAAIjB,KAAK,KAAK,CAAvB,GAA2BhC,eAAe,CAAC,KAAK4B,OAAL,CAAaI,KAAb,CAAD,CAA1C,GAAkEpC,gBAAgB,CAAC0B,MAAD,CAAhG;AACA,UAAMiE,gBAAgB,GAAGtC,SAAS,GAAG,KAAKrB,OAAL,CAAaI,KAAb,CAAH,GAAyB,IAA3D;AApBK,UAqBQW,IArBR,GAqBiBtB,KArBjB,CAqBGqB,GArBH;AAuBL,aACI;AAAK,QAAA,SAAS,EAAE9D,UAAU,CAAC,cAAD,EAAiB,sBAAjB,CAA1B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI;AAAK,QAAA,SAAS,EAAC,qBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI,oBAAC,gBAAD;AAAkB,QAAA,MAAM,EAAE0C,MAA1B;AAAkC,QAAA,IAAI,EAAEvB,uBAAuB,CAACwF,gBAAD,CAA/D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADJ,EAEI,oBAAC,qBAAD;AACI,QAAA,KAAK,EAAEH,CAAC,CAAC,aAAD,CADZ;AAEI,QAAA,QAAQ,EAAE/C,UAAU,IAAIL,KAAK,IAAI,CAAvB,aAA8BA,KAAK,GAAG,CAAtC,iBAA8CK,UAA9C,IAA6D,IAF3E;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAFJ,EAMI,oBAAC,yBAAD;AAA2B,QAAA,KAAK,EAAE+C,CAAC,CAAC,MAAD,CAAnC;AAA6C,QAAA,MAAM,EAAEzC,IAAI,CAACC,EAA1D;AAA8D,QAAA,OAAO,EAAE,KAAKL,UAA5E;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QANJ,EAOI,oBAAC,yBAAD;AAA2B,QAAA,KAAK,EAAE6C,CAAC,CAAC,SAAD,CAAnC;AAAgD,QAAA,MAAM,EAAEzC,IAAI,CAACC,EAA7D;AAAiE,QAAA,OAAO,EAAE,KAAKE,aAA/E;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI,oBAAC,SAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADJ,CAPJ,EAUI,oBAAC,uBAAD;AAAyB,QAAA,KAAK,EAAEsC,CAAC,CAAC,QAAD,CAAjC;AAA6C,QAAA,QAAQ,MAArD;AAAsD,QAAA,OAAO,EAAE,KAAKpB,YAApE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI,oBAAC,UAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADJ,CAVJ,EAaI,oBAAC,uBAAD;AAAyB,QAAA,KAAK,EAAEoB,CAAC,CAAC,OAAD,CAAjC;AAA4C,QAAA,OAAO,EAAE,KAAKnE,WAA1D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI,oBAAC,SAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADJ,CAbJ,CADJ,EAkBI;AAAK,QAAA,SAAS,EAAC,sBAAf;AAAsC,QAAA,OAAO,EAAE,KAAKC,cAApD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI;AAAK,QAAA,SAAS,EAAC,0BAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI,oBAAC,iBAAD;AAAmB,QAAA,QAAQ,EAAE,CAACiB,YAA9B;AAA4C,QAAA,IAAI,MAAhD;AAAiD,QAAA,OAAO,EAAE,KAAKhB,UAA/D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI,oBAAC,kBAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADJ,CADJ,CADJ,EAOI;AAAK,QAAA,SAAS,EAAC,6BAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI,oBAAC,yBAAD;AAA2B,QAAA,MAAM,EAAEG,MAAnC;AAA2C,QAAA,KAAK,EAAED,KAAlD;AAAyD,QAAA,OAAO,EAAE,KAAKH,cAAvE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADJ,CAPJ,EAWI;AAAK,QAAA,SAAS,EAAC,2BAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI,oBAAC,iBAAD;AAAmB,QAAA,QAAQ,EAAE,CAACkB,gBAA9B;AAAgD,QAAA,IAAI,MAApD;AAAqD,QAAA,OAAO,EAAE,KAAKlB,cAAnE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI,oBAAC,kBAAD;AAAoB,QAAA,KAAK,EAAE;AAAEsE,UAAAA,SAAS,EAAE;AAAb,SAA3B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADJ,CADJ,CAXJ,CAlBJ,EAmCKF,kBAnCL,CADJ;AAuCH;;;;EA7W4B5G,KAAK,CAAC+G,S;;AAgXvCjF,kBAAkB,CAACkF,SAAnB,GAA+B;AAC3BpE,EAAAA,MAAM,EAAE3C,SAAS,CAACgH,MAAV,CAAiBC;AADE,CAA/B;AAIA,eAAe/G,eAAe,GAAG2B,kBAAH,CAA9B","sourcesContent":["/*\n *  Copyright (c) 2018-present, Evgeny Nadymov\n *\n * This source code is licensed under the GPL v.3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport classNames from 'classnames';\nimport { withTranslation } from 'react-i18next';\nimport KeyboardManager, { KeyboardHandler } from '../Additional/KeyboardManager';\nimport CloseIcon from '../../Assets/Icons/Close';\nimport NavigateBeforeIcon from '../../Assets/Icons/Left';\nimport ReplyIcon from '../../Assets/Icons/Share';\nimport DeleteIcon from '../../Assets/Icons/Delete';\nimport MediaViewerDownloadButton from './MediaViewerDownloadButton';\nimport MediaViewerButton from './MediaViewerButton';\nimport MediaViewerFooterText from './MediaViewerFooterText';\nimport MediaViewerFooterButton from './MediaViewerFooterButton';\nimport ProfileMediaViewerContent from './ProfileMediaViewerContent';\nimport ProfileMediaInfo from '../Tile/ProfileMediaInfo';\nimport { forward, setProfileMediaViewerContent } from '../../Actions/Client';\nimport { getPhotoFromChat, getChatUserId, isPrivateChat } from '../../Utils/Chat';\nimport { getProfilePhotoDateHint, getProfilePhoto } from '../../Utils/User';\nimport { loadProfileMediaViewerContent, preloadProfileMediaViewerContent, saveOrDownload } from '../../Utils/File';\nimport { PROFILE_PHOTO_BIG_SIZE } from '../../Constants';\nimport FileStore from '../../Stores/FileStore';\nimport ChatStore from '../../Stores/ChatStore';\nimport TdLibController from '../../Controllers/TdLibController';\nimport './MediaViewer.css';\nimport './ProfileMediaViewer.css';\n\nclass ProfileMediaViewer extends React.Component {\n    constructor(props) {\n        super(props);\n\n        this.history = [];\n        this.keyboardHandler = new KeyboardHandler(this.handleKeyDown);\n\n        const { chatId, fileId } = this.props;\n\n        this.state = {\n            prevChatId: chatId,\n            prevFileId: fileId,\n            currentIndex: 0,\n            hasNextMedia: false,\n            hasPreviousMedia: false,\n            deleteConfirmationOpened: false\n        };\n    }\n\n    shouldComponentUpdate(nextProps, nextState) {\n        const { chatId, messageId } = this.props;\n        const {\n            currentFileId,\n            hasPreviousMedia,\n            hasNextMedia,\n            firstSliceLoaded,\n            totalCount,\n            deleteConfirmationOpened\n        } = this.state;\n\n        if (nextProps.chatId !== chatId) {\n            return true;\n        }\n\n        if (nextProps.messageId !== messageId) {\n            return true;\n        }\n\n        if (nextState.currentFileId !== currentFileId) {\n            return true;\n        }\n\n        if (nextState.hasPrevousMedia !== hasPreviousMedia) {\n            return true;\n        }\n\n        if (nextState.hasNextMedia !== hasNextMedia) {\n            return true;\n        }\n\n        if (nextState.firstSliceLoaded !== firstSliceLoaded) {\n            return true;\n        }\n\n        if (nextState.totalCount !== totalCount) {\n            return true;\n        }\n\n        if (nextState.deleteConfirmationOpened !== deleteConfirmationOpened) {\n            return true;\n        }\n\n        return false;\n    }\n\n    componentDidMount() {\n        const { chatId } = this.props;\n        const photo = getPhotoFromChat(chatId);\n        loadProfileMediaViewerContent(chatId, [photo]);\n\n        this.loadHistory(photo);\n\n        KeyboardManager.add(this.keyboardHandler);\n    }\n\n    componentWillUnmount() {\n        KeyboardManager.remove(this.keyboardHandler);\n    }\n\n    handleKeyDown = event => {\n        event.preventDefault();\n        event.stopPropagation();\n\n        if (event.keyCode === 27) {\n            const { deleteConfirmationOpened } = this.state;\n            if (deleteConfirmationOpened) return;\n\n            this.handleClose();\n        } else if (event.keyCode === 39) {\n            this.handlePrevious();\n        } else if (event.keyCode === 37) {\n            this.handleNext();\n        }\n    };\n\n    loadHistory = async photo => {\n        const { chatId } = this.props;\n\n        if (!isPrivateChat(chatId)) return;\n\n        const result = await TdLibController.send({\n            '@type': 'getUserProfilePhotos',\n            user_id: getChatUserId(chatId),\n            offset: 0,\n            limit: 100\n        });\n\n        this.history = result.photos;\n        this.firstSliceLoaded = result.photos.length === 0;\n\n        const index = 0;\n\n        this.setState({\n            currentIndex: index,\n            hasNextMedia: this.hasNextMedia(index),\n            hasPreviousMedia: this.hasPreviousMedia(index),\n            totalCount: result.total_count\n        });\n\n        preloadProfileMediaViewerContent(chatId, index, this.history);\n    };\n\n    handleClose = () => {\n        setProfileMediaViewerContent(null);\n    };\n\n    handleSave = () => {\n        const { chatId } = this.props;\n        const { currentIndex, totalCount } = this.state;\n\n        const chat = ChatStore.get(chatId);\n        if (!chat) return;\n\n        let index = -1;\n        if (totalCount) {\n            index = currentIndex;\n        }\n\n        const photo =\n            index > 0 && index < this.history.length ? getProfilePhoto(this.history[index]) : getPhotoFromChat(chatId);\n        if (!photo) return;\n        if (!photo.big) return;\n\n        const file = FileStore.get(photo.big.id) || photo.big;\n        if (!file) return;\n\n        saveOrDownload(file, file.id + '.jpg', chat, () => FileStore.updateChatPhotoBlob(chatId, file.id));\n    };\n\n    handleForward = () => {\n        const { chatId } = this.props;\n        const { currentIndex, totalCount } = this.state;\n\n        let index = -1;\n        if (totalCount) {\n            index = currentIndex;\n        }\n\n        let inputFile = null;\n        let inputMessagePhoto = null;\n        const inHistory = this.history && index >= 0 && index < this.history.length;\n        if (inHistory) {\n            const photo = getProfilePhoto(this.history[index]);\n            if (!photo) return;\n\n            let { big: file } = photo;\n            if (!file) return;\n\n            inputFile = {\n                '@type': 'inputFileId',\n                id: file.id\n            };\n        } else {\n            const chatPhoto = getPhotoFromChat(chatId);\n            if (!chatPhoto) return;\n\n            const { big: file } = chatPhoto;\n            if (!file) return;\n\n            const blob = FileStore.getBlob(file.id);\n            if (!blob) return;\n\n            inputFile = {\n                '@type': 'inputFileBlob',\n                data: blob,\n                name: ''\n            };\n        }\n\n        if (!inputFile) return;\n\n        const inputMessageContent = {\n            '@type': 'inputMessagePhoto',\n            photo: inputFile,\n            thumbnail: null,\n            added_sticker_file_ids: [],\n            width: PROFILE_PHOTO_BIG_SIZE,\n            height: PROFILE_PHOTO_BIG_SIZE,\n            caption: {\n                '@type': 'formattedText',\n                text: '',\n                entities: null\n            },\n            ttl: 0\n        };\n\n        forward(inputMessageContent);\n    };\n\n    handleDelete = () => {\n        const { chatId, messageId } = this.props;\n        const { currentIndex, totalCount } = this.state;\n\n        let index = -1;\n        if (totalCount) {\n            index = currentIndex;\n        }\n\n        const photo =\n            index > 0 && index < this.history.length ? getProfilePhoto(this.history[index]) : getPhotoFromChat(chatId);\n\n        if (photo) {\n            let file = photo.big;\n            file = FileStore.get(file.id) || file;\n            if (file) {\n                const store = FileStore.getReadWriteStore();\n\n                FileStore.deleteLocalFile(store, file);\n            }\n        }\n    };\n\n    hasPreviousMedia = index => {\n        if (index === -1) return false;\n\n        const nextIndex = index + 1;\n        return nextIndex < this.history.length;\n    };\n\n    handlePrevious = event => {\n        if (event) {\n            event.stopPropagation();\n        }\n\n        const { currentIndex } = this.state;\n        const nextIndex = currentIndex + 1;\n\n        return this.loadMedia(nextIndex, () => {\n            if (nextIndex === this.history.length - 1) {\n                this.loadPrevious();\n            }\n        });\n    };\n\n    loadPrevious = async () => {\n        return;\n    };\n\n    hasNextMedia = index => {\n        if (index === -1) return false;\n\n        const nextIndex = index - 1;\n        return nextIndex >= 0;\n    };\n\n    handleNext = event => {\n        if (event) {\n            event.stopPropagation();\n        }\n\n        const { currentIndex } = this.state;\n        const nextIndex = currentIndex - 1;\n\n        return this.loadMedia(nextIndex, () => {\n            if (nextIndex === 0) {\n                this.loadNext();\n            }\n        });\n    };\n\n    loadNext = async () => {\n        return;\n    };\n\n    loadMedia = (index, callback) => {\n        if (index < 0) return false;\n        if (index >= this.history.length) return false;\n\n        this.setState(\n            {\n                currentIndex: index,\n                hasNextMedia: this.hasNextMedia(index),\n                hasPreviousMedia: this.hasPreviousMedia(index)\n            },\n            callback\n        );\n\n        const { chatId } = this.props;\n\n        preloadProfileMediaViewerContent(chatId, index, this.history);\n        return true;\n    };\n\n    render() {\n        const { chatId, t } = this.props;\n        const {\n            currentIndex,\n            hasNextMedia,\n            hasPreviousMedia,\n            firstSliceLoaded,\n            totalCount,\n            deleteConfirmationOpened,\n            deleteForAll\n        } = this.state;\n\n        let index = -1;\n        if (totalCount) {\n            index = currentIndex;\n        }\n\n        const deleteConfirmation = null;\n        const inHistory = index >= 0 && index < this.history.length;\n        const photo = inHistory && index !== 0 ? getProfilePhoto(this.history[index]) : getPhotoFromChat(chatId);\n        const userProfilePhoto = inHistory ? this.history[index] : null;\n        const { big: file } = photo;\n\n        return (\n            <div className={classNames('media-viewer', 'media-viewer-default')}>\n                <div className='media-viewer-footer'>\n                    <ProfileMediaInfo chatId={chatId} date={getProfilePhotoDateHint(userProfilePhoto)} />\n                    <MediaViewerFooterText\n                        title={t('AttachPhoto')}\n                        subtitle={totalCount && index >= 0 ? `${index + 1} of ${totalCount}` : null}\n                    />\n                    <MediaViewerDownloadButton title={t('Save')} fileId={file.id} onClick={this.handleSave} />\n                    <MediaViewerDownloadButton title={t('Forward')} fileId={file.id} onClick={this.handleForward}>\n                        <ReplyIcon />\n                    </MediaViewerDownloadButton>\n                    <MediaViewerFooterButton title={t('Delete')} disabled onClick={this.handleDelete}>\n                        <DeleteIcon />\n                    </MediaViewerFooterButton>\n                    <MediaViewerFooterButton title={t('Close')} onClick={this.handleClose}>\n                        <CloseIcon />\n                    </MediaViewerFooterButton>\n                </div>\n                <div className='media-viewer-wrapper' onClick={this.handlePrevious}>\n                    <div className='media-viewer-left-column'>\n                        <MediaViewerButton disabled={!hasNextMedia} grow onClick={this.handleNext}>\n                            <NavigateBeforeIcon />\n                        </MediaViewerButton>\n                    </div>\n\n                    <div className='media-viewer-content-column'>\n                        <ProfileMediaViewerContent chatId={chatId} photo={photo} onClick={this.handlePrevious} />\n                    </div>\n\n                    <div className='media-viewer-right-column'>\n                        <MediaViewerButton disabled={!hasPreviousMedia} grow onClick={this.handlePrevious}>\n                            <NavigateBeforeIcon style={{ transform: 'rotate(180deg)' }} />\n                        </MediaViewerButton>\n                    </div>\n                </div>\n                {deleteConfirmation}\n            </div>\n        );\n    }\n}\n\nProfileMediaViewer.propTypes = {\n    chatId: PropTypes.number.isRequired\n};\n\nexport default withTranslation()(ProfileMediaViewer);\n"]},"metadata":{},"sourceType":"module"}