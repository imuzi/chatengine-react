{"ast":null,"code":"import _regeneratorRuntime from \"/Users/wubenqi/nebula-chat/telegram-react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/wubenqi/nebula-chat/telegram-react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"/Users/wubenqi/nebula-chat/telegram-react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/wubenqi/nebula-chat/telegram-react/src/Utils/Media.js\";\n\n/*\n *  Copyright (c) 2018-present, Evgeny Nadymov\n *\n * This source code is licensed under the GPL v.3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\nimport jsmediatags from 'jsmediatags';\nimport { THUMBNAIL_BLURRED_SIZE_90 } from '../Constants';\nimport MessageStore from '../Stores/MessageStore';\nimport Animation from '../Components/Message/Media/Animation';\nimport Audio from '../Components/Message/Media/Audio';\nimport Call from '../Components/Message/Media/Call';\nimport Contact from '../Components/Message/Media/Contact';\nimport Document from '../Components/Message/Media/Document';\nimport Game from '../Components/Message/Media/Game';\nimport Location from '../Components/Message/Media/Location';\nimport Photo from '../Components/Message/Media/Photo';\nimport Poll from '../Components/Message/Media/Poll';\nimport Sticker, { StickerSourceEnum } from '../Components/Message/Media/Sticker';\nimport Venue from '../Components/Message/Media/Venue';\nimport Video from '../Components/Message/Media/Video';\nimport VideoNote from '../Components/Message/Media/VideoNote';\nimport VoiceNote from '../Components/Message/Media/VoiceNote';\nimport React from 'react';\nimport { getRandomInt, readImageSize } from './Common';\nimport FileStore from '../Stores/FileStore';\nexport function getCallTitle(chatId, messageId) {\n  var message = MessageStore.get(chatId, messageId);\n  if (!message) return null;\n  var content = message.content,\n      is_outgoing = message.is_outgoing;\n  if (content['@type'] !== 'messageCall') return null;\n  var discard_reason = content.discard_reason,\n      duration = content.duration;\n\n  if (is_outgoing) {\n    return discard_reason['@type'] === 'callDiscardReasonMissed' ? 'Cancelled Call' : 'Outgoing Call';\n  } else if (discard_reason['@type'] === 'callDiscardReasonMissed') {\n    return 'Missed Call';\n  } else if (discard_reason['@type'] === 'callDiscardReasonDeclined') {\n    return 'Declined Call';\n  }\n\n  return 'Incoming Call';\n}\nexport function isEditedMedia(chatId, messageId) {\n  var message = MessageStore.get(chatId, messageId);\n  if (!message) return;\n  var content = message.content;\n\n  switch (content['@type']) {\n    case 'messageAnimation':\n      {\n        return true;\n      }\n\n    case 'messageAudio':\n      {\n        return true;\n      }\n\n    case 'messageDocument':\n      {\n        return true;\n      }\n\n    case 'messagePhoto':\n      {\n        return true;\n      }\n\n    case 'messageVideo':\n      {\n        return true;\n      }\n  }\n\n  return false;\n}\nexport function isValidAnimatedSticker(sticker, chatId, messageId) {\n  if (!sticker) return false;\n  if (!sticker.is_animated) return false;\n  var message = MessageStore.get(chatId, messageId);\n\n  if (message) {\n    var sending_state = message.sending_state;\n    if (sending_state && !sticker.set_id) return false;\n  }\n\n  return true;\n}\nexport function isBlurredThumbnail(thumbnail) {\n  var blurredSize = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : THUMBNAIL_BLURRED_SIZE_90;\n  if (!thumbnail) return false;\n  return Math.max(thumbnail.width, thumbnail.height) < blurredSize;\n}\nexport function getAudioTitle(audio) {\n  if (!audio) return null;\n  var file_name = audio.file_name,\n      title = audio.title,\n      performer = audio.performer;\n  var trimmedTitle = title ? title.trim() : '';\n  var trimmedPerformer = performer ? performer.trim() : '';\n  return trimmedTitle || trimmedPerformer ? \"\".concat(trimmedPerformer || 'Unknown Artist', \" \\u2014 \").concat(trimmedTitle || 'Unknown Track') : file_name;\n}\nexport function getAudioShortTitle(audio) {\n  if (!audio) return null;\n  var file_name = audio.file_name,\n      title = audio.title,\n      performer = audio.performer;\n  var trimmedTitle = title ? title.trim() : '';\n  var trimmedPerformer = performer ? performer.trim() : '';\n  return trimmedTitle || trimmedPerformer ? \"\".concat(trimmedPerformer || 'Unknown Artist') : file_name;\n}\nexport function getAudioSubtitle(audio) {\n  if (!audio) return null;\n  var title = audio.title;\n  var trimmedTitle = title ? title.trim() : '';\n  return trimmedTitle || 'Unknown Track';\n}\nexport function getStickers(sets) {\n  return sets.reduce(function (stickers, set) {\n    return stickers.concat(set.stickers);\n  }, []);\n}\nexport function getNeighborStickersFromSets(sticker, sets, stickersPerRow) {\n  var result = [];\n\n  var _toRowColumn = toRowColumn(sticker, sets, stickersPerRow),\n      _toRowColumn2 = _slicedToArray(_toRowColumn, 2),\n      row = _toRowColumn2[0],\n      column = _toRowColumn2[1];\n\n  if (row === -1) return [];\n  if (column === -1) return [];\n  var prevPrevRow = row - 2;\n  var prevRow = row - 1;\n  var nextRow = row + 1;\n  var nextNextRow = row + 2;\n  var prevColumn = column - 1;\n  var nextColumn = column + 1;\n  var skipPrevRow = prevRow < 0;\n  var skipPrePrevRow = prevPrevRow < 0;\n\n  if (!skipPrevRow) {\n    if (prevColumn >= 0) {\n      var _index = toIndex(prevRow, prevColumn, sets, stickersPerRow);\n\n      if (_index === -1) {\n        skipPrevRow = true;\n        _index = skipPrePrevRow ? -1 : toIndex(prevPrevRow, prevColumn, sets, stickersPerRow);\n        skipPrePrevRow = _index === -1;\n      }\n\n      if (_index !== -1) {\n        result.push(_index);\n      }\n    }\n\n    var index = skipPrevRow ? -1 : toIndex(prevRow, column, sets, stickersPerRow);\n\n    if (index === -1) {\n      skipPrevRow = true;\n      index = skipPrePrevRow ? -1 : toIndex(prevPrevRow, column, sets, stickersPerRow);\n      skipPrePrevRow = index === -1;\n    }\n\n    if (index !== -1) {\n      result.push(index);\n    }\n\n    if (nextColumn < stickersPerRow) {\n      var _index2 = skipPrevRow ? -1 : toIndex(prevRow, nextColumn, sets, stickersPerRow);\n\n      if (_index2 === -1) {\n        _index2 = skipPrePrevRow ? -1 : toIndex(prevPrevRow, nextColumn, sets, stickersPerRow);\n      }\n\n      if (_index2 !== -1) {\n        result.push(_index2);\n      }\n    }\n  }\n\n  if (prevColumn >= 0) {\n    var _index3 = toIndex(row, prevColumn, sets, stickersPerRow);\n\n    if (_index3 !== -1) {\n      result.push(_index3);\n    }\n  }\n\n  if (nextColumn < stickersPerRow) {\n    var _index4 = toIndex(row, nextColumn, sets, stickersPerRow);\n\n    if (_index4 !== -1) {\n      result.push(_index4);\n    }\n  }\n\n  var totalRows = sets.reduce(function (totalRows, set) {\n    return totalRows + Math.ceil(set.stickers.length / stickersPerRow);\n  }, 0);\n  var skipNextRow = nextRow >= totalRows;\n  var skipNextNextRow = nextRow >= totalRows;\n\n  if (!skipNextRow) {\n    if (prevColumn >= 0) {\n      var _index6 = toIndex(nextRow, prevColumn, sets, stickersPerRow);\n\n      if (_index6 === -1) {\n        skipNextRow = true;\n        _index6 = skipNextNextRow ? -1 : toIndex(nextNextRow, prevColumn, sets, stickersPerRow);\n        skipNextNextRow = _index6 === -1;\n      }\n\n      if (_index6 !== -1) {\n        result.push(_index6);\n      }\n    }\n\n    var _index5 = skipNextRow ? -1 : toIndex(nextRow, column, sets, stickersPerRow);\n\n    if (_index5 === -1) {\n      skipNextRow = true;\n      _index5 = skipNextNextRow ? -1 : toIndex(nextNextRow, column, sets, stickersPerRow);\n      skipNextNextRow = _index5 === -1;\n    }\n\n    if (_index5 !== -1) {\n      result.push(_index5);\n    }\n\n    if (nextColumn < stickersPerRow) {\n      var _index7 = skipNextRow ? -1 : toIndex(nextRow, nextColumn, sets, stickersPerRow);\n\n      if (_index7 === -1) {\n        _index7 = skipNextNextRow ? -1 : toIndex(nextNextRow, nextColumn, sets, stickersPerRow);\n      }\n\n      if (_index7 !== -1) {\n        result.push(_index7);\n      }\n    }\n  }\n\n  var items = getStickers(sets);\n  return result.map(function (x) {\n    return items[x];\n  });\n}\n\nfunction toRowColumn(sticker, sets, stickersPerRow) {\n  var setIndex = sets.findIndex(function (x) {\n    return x.id === sticker.set_id;\n  });\n  if (setIndex === -1) return [-1, -1];\n  var stickerIndex = sets[setIndex].stickers.findIndex(function (x) {\n    return x.sticker.id === sticker.sticker.id;\n  });\n  if (stickerIndex === -1) return [-1, -1];\n  var prevRows = 0;\n\n  for (var i = 0; i < setIndex; i++) {\n    prevRows += Math.ceil(sets[i].stickers.length / stickersPerRow);\n  }\n\n  return [prevRows + Math.floor(stickerIndex / stickersPerRow), stickerIndex % stickersPerRow];\n}\n\nfunction toIndex(row, column, sets, stickersPerRow) {\n  var index = -1;\n  var totalRows = 0;\n  var setIndex = -1;\n\n  for (var i = 0; i < sets.length; i++) {\n    var setRows = Math.ceil(sets[i].stickers.length / stickersPerRow);\n    totalRows += setRows;\n\n    if (totalRows > row) {\n      setIndex = i;\n      break;\n    }\n  }\n\n  if (setIndex === -1) return index;\n  var setRow = row;\n  var setColumn = column;\n\n  for (var _i = 0; _i < setIndex; _i++) {\n    var _setRows = Math.ceil(sets[_i].stickers.length / stickersPerRow);\n\n    setRow -= _setRows;\n  }\n\n  index = stickersPerRow * setRow + setColumn;\n  if (index >= sets[setIndex].stickers.length) return -1;\n\n  for (var _i2 = 0; _i2 < setIndex; _i2++) {\n    index += sets[_i2].stickers.length;\n  }\n\n  return index;\n}\n\nfunction getInputMediaThumbnail(thumbnail) {\n  if (!thumbnail) return null;\n  var photo = thumbnail.photo,\n      width = thumbnail.width,\n      height = thumbnail.height;\n  if (!photo) return null;\n  return {\n    '@type': 'inputThumbnail',\n    thumbnail: {\n      '@type': 'inputFileId',\n      id: photo.id\n    },\n    width: width,\n    height: height\n  };\n}\n\nfunction getInputMediaCaption(text) {\n  if (!text) return null;\n  return {\n    '@type': 'formattedText',\n    text: text,\n    entities: null\n  };\n}\n\nexport function getInputMediaContent(media, text) {\n  if (!media) return null;\n\n  switch (media['@type']) {\n    case 'animation':\n      {\n        var file = media.animation,\n            thumbnail = media.thumbnail,\n            width = media.width,\n            height = media.height,\n            duration = media.duration;\n        return {\n          '@type': 'inputMessageAnimation',\n          animation: {\n            '@type': 'inputFileId',\n            id: file.id\n          },\n          thumbnail: getInputMediaThumbnail(thumbnail),\n          duration: duration,\n          width: width,\n          height: height,\n          caption: getInputMediaCaption(text)\n        };\n      }\n\n    case 'audio':\n      {\n        var _file = media.audio,\n            _thumbnail = media.album_cover_thumbnail,\n            title = media.title,\n            performer = media.performer,\n            _duration = media.duration;\n        return {\n          '@type': 'inputMessageAudio',\n          audio: {\n            '@type': 'inputFileId',\n            id: _file.id\n          },\n          album_cover_thumbnail: getInputMediaThumbnail(_thumbnail),\n          duration: _duration,\n          title: title,\n          performer: performer,\n          caption: getInputMediaCaption(text)\n        };\n      }\n\n    case 'contact':\n      {\n        return {\n          '@type': 'inputMessageContact',\n          contact: media\n        };\n      }\n\n    case 'document':\n      {\n        var _file2 = media.document,\n            _thumbnail2 = media.thumbnail;\n        return {\n          '@type': 'inputMessageDocument',\n          document: {\n            '@type': 'inputFileId',\n            id: _file2.id\n          },\n          thumbnail: getInputMediaThumbnail(_thumbnail2),\n          caption: getInputMediaCaption(text)\n        };\n      }\n\n    case 'game':\n      {\n        return null;\n      }\n\n    case 'invoice':\n      {\n        return null;\n      }\n\n    case 'location':\n      {\n        return {\n          '@type': 'inputMessageLocation',\n          location: media,\n          live_period: 0\n        };\n      }\n\n    case 'photo':\n      {\n        var sizes = media.sizes;\n        if (!sizes.length) return null;\n        var _thumbnail3 = sizes[0];\n        var photo = sizes[sizes.length - 1];\n        if (!photo) return null;\n        var _file3 = photo.photo,\n            _width = photo.width,\n            _height = photo.height;\n        return {\n          '@type': 'inputMessagePhoto',\n          photo: {\n            '@type': 'inputFileId',\n            id: _file3.id\n          },\n          thumbnail: getInputMediaThumbnail(_thumbnail3),\n          added_sticker_file_ids: [],\n          width: _width,\n          height: _height,\n          caption: getInputMediaCaption(text),\n          ttl: 0\n        };\n      }\n\n    case 'poll':\n      {\n        return null;\n      }\n\n    case 'sticker':\n      {\n        var _file4 = media.sticker,\n            _thumbnail4 = media.thumbnail,\n            _width2 = media.width,\n            _height2 = media.height;\n        return {\n          '@type': 'inputMessageSticker',\n          sticker: {\n            '@type': 'inputFileId',\n            id: _file4.id\n          },\n          thumbnail: getInputMediaThumbnail(_thumbnail4),\n          width: _width2,\n          height: _height2,\n          caption: getInputMediaCaption(text)\n        };\n      }\n\n    case 'venue':\n      {\n        return {\n          '@type': 'inputMessageVenue',\n          venue: media\n        };\n      }\n\n    case 'video':\n      {\n        var _file5 = media.video,\n            _thumbnail5 = media.thumbnail,\n            _width3 = media.width,\n            _height3 = media.height,\n            _duration2 = media.duration,\n            supports_streaming = media.supports_streaming;\n        return {\n          '@type': 'inputMessageVideo',\n          video: {\n            '@type': 'inputFileId',\n            id: _file5.id\n          },\n          thumbnail: getInputMediaThumbnail(_thumbnail5),\n          added_sticker_file_ids: [],\n          duration: _duration2,\n          width: _width3,\n          height: _height3,\n          supports_streaming: supports_streaming,\n          caption: getInputMediaCaption(text),\n          ttl: 0\n        };\n      }\n\n    case 'videoNote':\n      {\n        var _file6 = media.video,\n            _thumbnail6 = media.thumbnail,\n            _duration3 = media.duration,\n            length = media.length;\n        return {\n          '@type': 'inputMessageVideoNote',\n          video: {\n            '@type': 'inputFileId',\n            id: _file6.id\n          },\n          thumbnail: getInputMediaThumbnail(_thumbnail6),\n          duration: _duration3,\n          length: length,\n          ttl: 0\n        };\n      }\n\n    case 'voiceNote':\n      {\n        var _file7 = media.voice,\n            _duration4 = media.duration,\n            waveform = media.waveform;\n        return {\n          '@type': 'inputMessageVideoNote',\n          voice_note: {\n            '@type': 'inputFileId',\n            id: _file7.id\n          },\n          duration: _duration4,\n          waveform: waveform\n        };\n      }\n  }\n\n  return null;\n}\nexport function getMedia(message, openMedia) {\n  var hasTitle = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n  var hasCaption = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n  var inlineMeta = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : null;\n  if (!message) return null;\n  var chat_id = message.chat_id,\n      id = message.id,\n      content = message.content;\n  if (!content) return null;\n\n  switch (content['@type']) {\n    case 'messageAnimation':\n      return React.createElement(Animation, {\n        type: \"message\",\n        title: hasTitle,\n        caption: hasCaption,\n        chatId: chat_id,\n        messageId: id,\n        animation: content.animation,\n        openMedia: openMedia,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 484\n        },\n        __self: this\n      });\n\n    case 'messageAudio':\n      return React.createElement(Audio, {\n        title: hasTitle,\n        caption: hasCaption,\n        chatId: chat_id,\n        messageId: id,\n        audio: content.audio,\n        openMedia: openMedia,\n        meta: inlineMeta,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 496\n        },\n        __self: this\n      });\n\n    case 'messageCall':\n      return React.createElement(Call, {\n        title: hasTitle,\n        caption: hasCaption,\n        chatId: chat_id,\n        messageId: id,\n        duraton: content.duration,\n        discardReason: content.discard_reason,\n        openMedia: openMedia,\n        meta: inlineMeta,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 508\n        },\n        __self: this\n      });\n\n    case 'messageContact':\n      return React.createElement(Contact, {\n        title: hasTitle,\n        caption: hasCaption,\n        chatId: chat_id,\n        messageId: id,\n        contact: content.contact,\n        openMedia: openMedia,\n        meta: inlineMeta,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 521\n        },\n        __self: this\n      });\n\n    case 'messageDocument':\n      return React.createElement(Document, {\n        title: hasTitle,\n        caption: hasCaption,\n        chatId: chat_id,\n        messageId: id,\n        document: content.document,\n        openMedia: openMedia,\n        meta: inlineMeta,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 533\n        },\n        __self: this\n      });\n\n    case 'messageGame':\n      return React.createElement(Game, {\n        chatId: chat_id,\n        messageId: id,\n        game: content.game,\n        openMedia: openMedia,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 544\n        },\n        __self: this\n      });\n\n    case 'messageLocation':\n      return React.createElement(Location, {\n        type: \"message\",\n        title: hasTitle,\n        caption: hasCaption,\n        chatId: chat_id,\n        messageId: id,\n        location: content.location,\n        openMedia: openMedia,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 547\n        },\n        __self: this\n      });\n\n    case 'messagePhoto':\n      return React.createElement(Photo, {\n        type: \"message\",\n        title: hasTitle,\n        caption: hasCaption,\n        chatId: chat_id,\n        messageId: id,\n        photo: content.photo,\n        openMedia: openMedia,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 559\n        },\n        __self: this\n      });\n\n    case 'messagePoll':\n      return React.createElement(Poll, {\n        chatId: chat_id,\n        messageId: id,\n        poll: content.poll,\n        openMedia: openMedia,\n        meta: inlineMeta,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 570\n        },\n        __self: this\n      });\n\n    case 'messageSticker':\n      return React.createElement(Sticker, {\n        chatId: chat_id,\n        messageId: id,\n        sticker: content.sticker,\n        source: StickerSourceEnum.MESSAGE,\n        openMedia: openMedia,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 573\n        },\n        __self: this\n      });\n\n    case 'messageText':\n      return null;\n\n    case 'messageVenue':\n      return React.createElement(Venue, {\n        type: \"message\",\n        title: hasTitle,\n        caption: hasCaption,\n        chatId: chat_id,\n        messageId: id,\n        venue: content.venue,\n        openMedia: openMedia,\n        meta: inlineMeta,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 585\n        },\n        __self: this\n      });\n\n    case 'messageVideo':\n      return React.createElement(Video, {\n        type: \"message\",\n        title: hasTitle,\n        caption: hasCaption,\n        chatId: chat_id,\n        messageId: id,\n        video: content.video,\n        openMedia: openMedia,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 598\n        },\n        __self: this\n      });\n\n    case 'messageVideoNote':\n      return React.createElement(VideoNote, {\n        type: \"message\",\n        title: hasTitle,\n        caption: hasCaption,\n        chatId: chat_id,\n        messageId: id,\n        videoNote: content.video_note,\n        openMedia: openMedia,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 610\n        },\n        __self: this\n      });\n\n    case 'messageVoiceNote':\n      return React.createElement(VoiceNote, {\n        type: \"message\",\n        title: hasTitle,\n        caption: hasCaption,\n        chatId: chat_id,\n        messageId: id,\n        voiceNote: content.voice_note,\n        openMedia: openMedia,\n        meta: inlineMeta,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 622\n        },\n        __self: this\n      });\n\n    default:\n      return [\"[\".concat(content['@type'], \"]\"), inlineMeta];\n  }\n}\nexport function getMediaTags(_x) {\n  return _getMediaTags.apply(this, arguments);\n}\n\nfunction _getMediaTags() {\n  _getMediaTags = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee2(file) {\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            return _context2.abrupt(\"return\", new Promise(function (resolve) {\n              jsmediatags.read(file, {\n                onSuccess: function () {\n                  var _onSuccess = _asyncToGenerator(\n                  /*#__PURE__*/\n                  _regeneratorRuntime.mark(function _callee(tag) {\n                    var tags, artist, title;\n                    return _regeneratorRuntime.wrap(function _callee$(_context) {\n                      while (1) {\n                        switch (_context.prev = _context.next) {\n                          case 0:\n                            tags = tag.tags;\n                            artist = tags.artist, title = tags.title;\n                            _context.t0 = new AudioContext();\n                            _context.next = 5;\n                            return file.arrayBuffer();\n\n                          case 5:\n                            _context.t1 = _context.sent;\n\n                            _context.t2 = function (result) {\n                              resolve({\n                                title: title,\n                                performer: artist,\n                                duration: Math.trunc(result.duration)\n                              });\n                            };\n\n                            _context.t3 = function (error) {\n                              resolve(null);\n                            };\n\n                            _context.t0.decodeAudioData.call(_context.t0, _context.t1, _context.t2, _context.t3);\n\n                          case 9:\n                          case \"end\":\n                            return _context.stop();\n                        }\n                      }\n                    }, _callee);\n                  }));\n\n                  function onSuccess(_x4) {\n                    return _onSuccess.apply(this, arguments);\n                  }\n\n                  return onSuccess;\n                }(),\n                onError: function onError(error) {\n                  resolve(null);\n                }\n              });\n            }));\n\n          case 1:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n  return _getMediaTags.apply(this, arguments);\n}\n\nexport function getMediaDocumentFromFile(_x2) {\n  return _getMediaDocumentFromFile.apply(this, arguments);\n}\n\nfunction _getMediaDocumentFromFile() {\n  _getMediaDocumentFromFile = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee3(file) {\n    var fileId, name, type, size, tags, title, performer, duration;\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            if (file) {\n              _context3.next = 2;\n              break;\n            }\n\n            return _context3.abrupt(\"return\", null);\n\n          case 2:\n            fileId = -getRandomInt(1, 1000000);\n            FileStore.setBlob(fileId, file);\n            name = file.name, type = file.type, size = file.size;\n\n            if (!(type === 'audio/mp3')) {\n              _context3.next = 12;\n              break;\n            }\n\n            _context3.next = 8;\n            return getMediaTags(file);\n\n          case 8:\n            tags = _context3.sent;\n\n            if (!tags) {\n              _context3.next = 12;\n              break;\n            }\n\n            title = tags.title, performer = tags.performer, duration = tags.duration;\n            return _context3.abrupt(\"return\", {\n              '@type': 'messageAudio',\n              audio: {\n                '@type': 'audio',\n                duration: duration,\n                title: title,\n                performer: performer,\n                file_name: name,\n                mime_type: type,\n                album_cover_minithumbnail: null,\n                album_cover_thumbnail: null,\n                audio: {\n                  '@type': 'file',\n                  id: fileId,\n                  size: size,\n                  expected_size: size,\n                  local: {\n                    is_downloading_completed: true\n                  }\n                }\n              }\n            });\n\n          case 12:\n            return _context3.abrupt(\"return\", {\n              '@type': 'messageDocument',\n              document: {\n                '@type': 'document',\n                file_name: name,\n                mime_type: type,\n                minithumbnail: null,\n                thumbnail: null,\n                document: {\n                  '@type': 'file',\n                  id: fileId,\n                  size: size,\n                  expected_size: size,\n                  local: {\n                    is_downloading_completed: true\n                  }\n                }\n              }\n            });\n\n          case 13:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3);\n  }));\n  return _getMediaDocumentFromFile.apply(this, arguments);\n}\n\nexport function getMediaPhotoFromFile(_x3) {\n  return _getMediaPhotoFromFile.apply(this, arguments);\n}\n\nfunction _getMediaPhotoFromFile() {\n  _getMediaPhotoFromFile = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee4(file) {\n    var _ref, _ref2, width, height, fileId, photoSize;\n\n    return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            if (file) {\n              _context4.next = 2;\n              break;\n            }\n\n            return _context4.abrupt(\"return\", null);\n\n          case 2:\n            if (!file.type.startsWith('image')) {\n              _context4.next = 15;\n              break;\n            }\n\n            _context4.next = 5;\n            return readImageSize(file);\n\n          case 5:\n            _ref = _context4.sent;\n            _ref2 = _slicedToArray(_ref, 2);\n            width = _ref2[0];\n            height = _ref2[1];\n            fileId = -getRandomInt(1, 1000000);\n            FileStore.setBlob(fileId, file);\n            photoSize = {\n              '@type': 'photoSize',\n              photo: {\n                '@type': 'file',\n                id: fileId,\n                size: file.size,\n                expected_size: file.expected_size,\n                local: {\n                  is_downloading_completed: true\n                }\n              },\n              width: width,\n              height: height\n            };\n            return _context4.abrupt(\"return\", {\n              '@type': 'messagePhoto',\n              photo: {\n                '@type': 'photo',\n                has_stickers: false,\n                minithumbnail: null,\n                sizes: [photoSize]\n              }\n            });\n\n          case 15:\n            return _context4.abrupt(\"return\", null);\n\n          case 16:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, _callee4);\n  }));\n  return _getMediaPhotoFromFile.apply(this, arguments);\n}","map":{"version":3,"sources":["/Users/wubenqi/nebula-chat/telegram-react/src/Utils/Media.js"],"names":["jsmediatags","THUMBNAIL_BLURRED_SIZE_90","MessageStore","Animation","Audio","Call","Contact","Document","Game","Location","Photo","Poll","Sticker","StickerSourceEnum","Venue","Video","VideoNote","VoiceNote","React","getRandomInt","readImageSize","FileStore","getCallTitle","chatId","messageId","message","get","content","is_outgoing","discard_reason","duration","isEditedMedia","isValidAnimatedSticker","sticker","is_animated","sending_state","set_id","isBlurredThumbnail","thumbnail","blurredSize","Math","max","width","height","getAudioTitle","audio","file_name","title","performer","trimmedTitle","trim","trimmedPerformer","getAudioShortTitle","getAudioSubtitle","getStickers","sets","reduce","stickers","set","concat","getNeighborStickersFromSets","stickersPerRow","result","toRowColumn","row","column","prevPrevRow","prevRow","nextRow","nextNextRow","prevColumn","nextColumn","skipPrevRow","skipPrePrevRow","index","toIndex","push","totalRows","ceil","length","skipNextRow","skipNextNextRow","items","map","x","setIndex","findIndex","id","stickerIndex","prevRows","i","floor","setRows","setRow","setColumn","getInputMediaThumbnail","photo","getInputMediaCaption","text","entities","getInputMediaContent","media","file","animation","caption","album_cover_thumbnail","contact","document","location","live_period","sizes","added_sticker_file_ids","ttl","venue","video","supports_streaming","voice","waveform","voice_note","getMedia","openMedia","hasTitle","hasCaption","inlineMeta","chat_id","game","poll","MESSAGE","video_note","getMediaTags","Promise","resolve","read","onSuccess","tag","tags","artist","AudioContext","arrayBuffer","trunc","error","decodeAudioData","onError","getMediaDocumentFromFile","fileId","setBlob","name","type","size","mime_type","album_cover_minithumbnail","expected_size","local","is_downloading_completed","minithumbnail","getMediaPhotoFromFile","startsWith","photoSize","has_stickers"],"mappings":"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","sourcesContent":["/*\n *  Copyright (c) 2018-present, Evgeny Nadymov\n *\n * This source code is licensed under the GPL v.3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport jsmediatags from 'jsmediatags';\nimport { THUMBNAIL_BLURRED_SIZE_90 } from '../Constants';\nimport MessageStore from '../Stores/MessageStore';\nimport Animation from '../Components/Message/Media/Animation';\nimport Audio from '../Components/Message/Media/Audio';\nimport Call from '../Components/Message/Media/Call';\nimport Contact from '../Components/Message/Media/Contact';\nimport Document from '../Components/Message/Media/Document';\nimport Game from '../Components/Message/Media/Game';\nimport Location from '../Components/Message/Media/Location';\nimport Photo from '../Components/Message/Media/Photo';\nimport Poll from '../Components/Message/Media/Poll';\nimport Sticker, { StickerSourceEnum } from '../Components/Message/Media/Sticker';\nimport Venue from '../Components/Message/Media/Venue';\nimport Video from '../Components/Message/Media/Video';\nimport VideoNote from '../Components/Message/Media/VideoNote';\nimport VoiceNote from '../Components/Message/Media/VoiceNote';\nimport React from 'react';\nimport { getRandomInt, readImageSize } from './Common';\nimport FileStore from '../Stores/FileStore';\n\nexport function getCallTitle(chatId, messageId) {\n    const message = MessageStore.get(chatId, messageId);\n    if (!message) return null;\n\n    const { content, is_outgoing } = message;\n    if (content['@type'] !== 'messageCall') return null;\n\n    const { discard_reason, duration } = content;\n    if (is_outgoing) {\n        return discard_reason['@type'] === 'callDiscardReasonMissed' ? 'Cancelled Call' : 'Outgoing Call';\n    } else if (discard_reason['@type'] === 'callDiscardReasonMissed') {\n        return 'Missed Call';\n    } else if (discard_reason['@type'] === 'callDiscardReasonDeclined') {\n        return 'Declined Call';\n    }\n\n    return 'Incoming Call';\n}\n\nexport function isEditedMedia(chatId, messageId) {\n    const message = MessageStore.get(chatId, messageId);\n    if (!message) return;\n\n    const { content } = message;\n    switch (content['@type']) {\n        case 'messageAnimation': {\n            return true;\n        }\n        case 'messageAudio': {\n            return true;\n        }\n        case 'messageDocument': {\n            return true;\n        }\n        case 'messagePhoto': {\n            return true;\n        }\n        case 'messageVideo': {\n            return true;\n        }\n    }\n\n    return false;\n}\n\nexport function isValidAnimatedSticker(sticker, chatId, messageId) {\n    if (!sticker) return false;\n    if (!sticker.is_animated) return false;\n\n    const message = MessageStore.get(chatId, messageId);\n    if (message) {\n        const { sending_state } = message;\n        if (sending_state && !sticker.set_id) return false;\n    }\n\n    return true;\n}\n\nexport function isBlurredThumbnail(thumbnail, blurredSize = THUMBNAIL_BLURRED_SIZE_90) {\n    if (!thumbnail) return false;\n\n    return Math.max(thumbnail.width, thumbnail.height) < blurredSize;\n}\n\nexport function getAudioTitle(audio) {\n    if (!audio) return null;\n\n    const { file_name, title, performer } = audio;\n    const trimmedTitle = title ? title.trim() : '';\n    const trimmedPerformer = performer ? performer.trim() : '';\n\n    return trimmedTitle || trimmedPerformer\n        ? `${trimmedPerformer || 'Unknown Artist'} — ${trimmedTitle || 'Unknown Track'}`\n        : file_name;\n}\n\nexport function getAudioShortTitle(audio) {\n    if (!audio) return null;\n\n    const { file_name, title, performer } = audio;\n    const trimmedTitle = title ? title.trim() : '';\n    const trimmedPerformer = performer ? performer.trim() : '';\n\n    return trimmedTitle || trimmedPerformer ? `${trimmedPerformer || 'Unknown Artist'}` : file_name;\n}\n\nexport function getAudioSubtitle(audio) {\n    if (!audio) return null;\n\n    const { title } = audio;\n    const trimmedTitle = title ? title.trim() : '';\n\n    return trimmedTitle || 'Unknown Track';\n}\n\nexport function getStickers(sets) {\n    return sets.reduce((stickers, set) => stickers.concat(set.stickers), []);\n}\n\nexport function getNeighborStickersFromSets(sticker, sets, stickersPerRow) {\n    const result = [];\n    const [row, column] = toRowColumn(sticker, sets, stickersPerRow);\n    if (row === -1) return [];\n    if (column === -1) return [];\n\n    const prevPrevRow = row - 2;\n    const prevRow = row - 1;\n    const nextRow = row + 1;\n    const nextNextRow = row + 2;\n\n    const prevColumn = column - 1;\n    const nextColumn = column + 1;\n\n    let skipPrevRow = prevRow < 0;\n    let skipPrePrevRow = prevPrevRow < 0;\n    if (!skipPrevRow) {\n        if (prevColumn >= 0) {\n            let index = toIndex(prevRow, prevColumn, sets, stickersPerRow);\n            if (index === -1) {\n                skipPrevRow = true;\n                index = skipPrePrevRow ? -1 : toIndex(prevPrevRow, prevColumn, sets, stickersPerRow);\n                skipPrePrevRow = index === -1;\n            }\n            if (index !== -1) {\n                result.push(index);\n            }\n        }\n\n        let index = skipPrevRow ? -1 : toIndex(prevRow, column, sets, stickersPerRow);\n        if (index === -1) {\n            skipPrevRow = true;\n            index = skipPrePrevRow ? -1 : toIndex(prevPrevRow, column, sets, stickersPerRow);\n            skipPrePrevRow = index === -1;\n        }\n        if (index !== -1) {\n            result.push(index);\n        }\n\n        if (nextColumn < stickersPerRow) {\n            let index = skipPrevRow ? -1 : toIndex(prevRow, nextColumn, sets, stickersPerRow);\n            if (index === -1) {\n                index = skipPrePrevRow ? -1 : toIndex(prevPrevRow, nextColumn, sets, stickersPerRow);\n            }\n            if (index !== -1) {\n                result.push(index);\n            }\n        }\n    }\n\n    if (prevColumn >= 0) {\n        const index = toIndex(row, prevColumn, sets, stickersPerRow);\n        if (index !== -1) {\n            result.push(index);\n        }\n    }\n\n    if (nextColumn < stickersPerRow) {\n        const index = toIndex(row, nextColumn, sets, stickersPerRow);\n        if (index !== -1) {\n            result.push(index);\n        }\n    }\n\n    let totalRows = sets.reduce((totalRows, set) => totalRows + Math.ceil(set.stickers.length / stickersPerRow), 0);\n    let skipNextRow = nextRow >= totalRows;\n    let skipNextNextRow = nextRow >= totalRows;\n    if (!skipNextRow) {\n        if (prevColumn >= 0) {\n            let index = toIndex(nextRow, prevColumn, sets, stickersPerRow);\n            if (index === -1) {\n                skipNextRow = true;\n                index = skipNextNextRow ? -1 : toIndex(nextNextRow, prevColumn, sets, stickersPerRow);\n                skipNextNextRow = index === -1;\n            }\n            if (index !== -1) {\n                result.push(index);\n            }\n        }\n\n        let index = skipNextRow ? -1 : toIndex(nextRow, column, sets, stickersPerRow);\n        if (index === -1) {\n            skipNextRow = true;\n            index = skipNextNextRow ? -1 : toIndex(nextNextRow, column, sets, stickersPerRow);\n            skipNextNextRow = index === -1;\n        }\n        if (index !== -1) {\n            result.push(index);\n        }\n\n        if (nextColumn < stickersPerRow) {\n            let index = skipNextRow ? -1 : toIndex(nextRow, nextColumn, sets, stickersPerRow);\n            if (index === -1) {\n                index = skipNextNextRow ? -1 : toIndex(nextNextRow, nextColumn, sets, stickersPerRow);\n            }\n            if (index !== -1) {\n                result.push(index);\n            }\n        }\n    }\n\n    const items = getStickers(sets);\n    return result.map(x => items[x]);\n}\n\nfunction toRowColumn(sticker, sets, stickersPerRow) {\n    const setIndex = sets.findIndex(x => x.id === sticker.set_id);\n    if (setIndex === -1) return [-1, -1];\n\n    const stickerIndex = sets[setIndex].stickers.findIndex(x => x.sticker.id === sticker.sticker.id);\n    if (stickerIndex === -1) return [-1, -1];\n\n    let prevRows = 0;\n    for (let i = 0; i < setIndex; i++) {\n        prevRows += Math.ceil(sets[i].stickers.length / stickersPerRow);\n    }\n\n    return [prevRows + Math.floor(stickerIndex / stickersPerRow), stickerIndex % stickersPerRow];\n}\n\nfunction toIndex(row, column, sets, stickersPerRow) {\n    let index = -1;\n    let totalRows = 0;\n    let setIndex = -1;\n    for (let i = 0; i < sets.length; i++) {\n        let setRows = Math.ceil(sets[i].stickers.length / stickersPerRow);\n        totalRows += setRows;\n        if (totalRows > row) {\n            setIndex = i;\n            break;\n        }\n    }\n    if (setIndex === -1) return index;\n\n    let setRow = row;\n    let setColumn = column;\n    for (let i = 0; i < setIndex; i++) {\n        let setRows = Math.ceil(sets[i].stickers.length / stickersPerRow);\n        setRow -= setRows;\n    }\n\n    index = stickersPerRow * setRow + setColumn;\n\n    if (index >= sets[setIndex].stickers.length) return -1;\n\n    for (let i = 0; i < setIndex; i++) {\n        index += sets[i].stickers.length;\n    }\n\n    return index;\n}\n\nfunction getInputMediaThumbnail(thumbnail) {\n    if (!thumbnail) return null;\n\n    const { photo, width, height } = thumbnail;\n    if (!photo) return null;\n\n    return {\n        '@type': 'inputThumbnail',\n        thumbnail: {\n            '@type': 'inputFileId',\n            id: photo.id\n        },\n        width,\n        height\n    };\n}\n\nfunction getInputMediaCaption(text) {\n    if (!text) return null;\n\n    return {\n        '@type': 'formattedText',\n        text: text,\n        entities: null\n    };\n}\n\nexport function getInputMediaContent(media, text) {\n    if (!media) return null;\n\n    switch (media['@type']) {\n        case 'animation': {\n            const { animation: file, thumbnail, width, height, duration } = media;\n\n            return {\n                '@type': 'inputMessageAnimation',\n                animation: {\n                    '@type': 'inputFileId',\n                    id: file.id\n                },\n                thumbnail: getInputMediaThumbnail(thumbnail),\n                duration,\n                width,\n                height,\n                caption: getInputMediaCaption(text)\n            };\n        }\n        case 'audio': {\n            const { audio: file, album_cover_thumbnail: thumbnail, title, performer, duration } = media;\n\n            return {\n                '@type': 'inputMessageAudio',\n                audio: {\n                    '@type': 'inputFileId',\n                    id: file.id\n                },\n                album_cover_thumbnail: getInputMediaThumbnail(thumbnail),\n                duration,\n                title,\n                performer,\n                caption: getInputMediaCaption(text)\n            };\n        }\n        case 'contact': {\n            return {\n                '@type': 'inputMessageContact',\n                contact: media\n            };\n        }\n        case 'document': {\n            const { document: file, thumbnail } = media;\n\n            return {\n                '@type': 'inputMessageDocument',\n                document: {\n                    '@type': 'inputFileId',\n                    id: file.id\n                },\n                thumbnail: getInputMediaThumbnail(thumbnail),\n                caption: getInputMediaCaption(text)\n            };\n        }\n        case 'game': {\n            return null;\n        }\n        case 'invoice': {\n            return null;\n        }\n        case 'location': {\n            return {\n                '@type': 'inputMessageLocation',\n                location: media,\n                live_period: 0\n            };\n        }\n        case 'photo': {\n            const { sizes } = media;\n            if (!sizes.length) return null;\n\n            const thumbnail = sizes[0];\n            const photo = sizes[sizes.length - 1];\n            if (!photo) return null;\n\n            const { photo: file, width, height } = photo;\n\n            return {\n                '@type': 'inputMessagePhoto',\n                photo: {\n                    '@type': 'inputFileId',\n                    id: file.id\n                },\n                thumbnail: getInputMediaThumbnail(thumbnail),\n                added_sticker_file_ids: [],\n                width,\n                height,\n                caption: getInputMediaCaption(text),\n                ttl: 0\n            };\n        }\n        case 'poll': {\n            return null;\n        }\n        case 'sticker': {\n            const { sticker: file, thumbnail, width, height } = media;\n\n            return {\n                '@type': 'inputMessageSticker',\n                sticker: {\n                    '@type': 'inputFileId',\n                    id: file.id\n                },\n                thumbnail: getInputMediaThumbnail(thumbnail),\n                width,\n                height,\n                caption: getInputMediaCaption(text)\n            };\n        }\n        case 'venue': {\n            return {\n                '@type': 'inputMessageVenue',\n                venue: media\n            };\n        }\n        case 'video': {\n            const { video: file, thumbnail, width, height, duration, supports_streaming } = media;\n\n            return {\n                '@type': 'inputMessageVideo',\n                video: {\n                    '@type': 'inputFileId',\n                    id: file.id\n                },\n                thumbnail: getInputMediaThumbnail(thumbnail),\n                added_sticker_file_ids: [],\n                duration,\n                width,\n                height,\n                supports_streaming,\n                caption: getInputMediaCaption(text),\n                ttl: 0\n            };\n        }\n        case 'videoNote': {\n            const { video: file, thumbnail, duration, length } = media;\n\n            return {\n                '@type': 'inputMessageVideoNote',\n                video: {\n                    '@type': 'inputFileId',\n                    id: file.id\n                },\n                thumbnail: getInputMediaThumbnail(thumbnail),\n                duration,\n                length,\n                ttl: 0\n            };\n        }\n        case 'voiceNote': {\n            const { voice: file, duration, waveform } = media;\n\n            return {\n                '@type': 'inputMessageVideoNote',\n                voice_note: {\n                    '@type': 'inputFileId',\n                    id: file.id\n                },\n                duration,\n                waveform\n            };\n        }\n    }\n\n    return null;\n}\n\nexport function getMedia(message, openMedia, hasTitle = false, hasCaption = false, inlineMeta = null) {\n    if (!message) return null;\n\n    const { chat_id, id, content } = message;\n    if (!content) return null;\n\n    switch (content['@type']) {\n        case 'messageAnimation':\n            return (\n                <Animation\n                    type='message'\n                    title={hasTitle}\n                    caption={hasCaption}\n                    chatId={chat_id}\n                    messageId={id}\n                    animation={content.animation}\n                    openMedia={openMedia}\n                />\n            );\n        case 'messageAudio':\n            return (\n                <Audio\n                    title={hasTitle}\n                    caption={hasCaption}\n                    chatId={chat_id}\n                    messageId={id}\n                    audio={content.audio}\n                    openMedia={openMedia}\n                    meta={inlineMeta}\n                />\n            );\n        case 'messageCall':\n            return (\n                <Call\n                    title={hasTitle}\n                    caption={hasCaption}\n                    chatId={chat_id}\n                    messageId={id}\n                    duraton={content.duration}\n                    discardReason={content.discard_reason}\n                    openMedia={openMedia}\n                    meta={inlineMeta}\n                />\n            );\n        case 'messageContact':\n            return (\n                <Contact\n                    title={hasTitle}\n                    caption={hasCaption}\n                    chatId={chat_id}\n                    messageId={id}\n                    contact={content.contact}\n                    openMedia={openMedia}\n                    meta={inlineMeta}\n                />\n            );\n        case 'messageDocument':\n            return (\n                <Document\n                    title={hasTitle}\n                    caption={hasCaption}\n                    chatId={chat_id}\n                    messageId={id}\n                    document={content.document}\n                    openMedia={openMedia}\n                    meta={inlineMeta}\n                />\n            );\n        case 'messageGame':\n            return <Game chatId={chat_id} messageId={id} game={content.game} openMedia={openMedia} />;\n        case 'messageLocation':\n            return (\n                <Location\n                    type='message'\n                    title={hasTitle}\n                    caption={hasCaption}\n                    chatId={chat_id}\n                    messageId={id}\n                    location={content.location}\n                    openMedia={openMedia}\n                />\n            );\n        case 'messagePhoto':\n            return (\n                <Photo\n                    type='message'\n                    title={hasTitle}\n                    caption={hasCaption}\n                    chatId={chat_id}\n                    messageId={id}\n                    photo={content.photo}\n                    openMedia={openMedia}\n                />\n            );\n        case 'messagePoll':\n            return <Poll chatId={chat_id} messageId={id} poll={content.poll} openMedia={openMedia} meta={inlineMeta} />;\n        case 'messageSticker':\n            return (\n                <Sticker\n                    chatId={chat_id}\n                    messageId={id}\n                    sticker={content.sticker}\n                    source={StickerSourceEnum.MESSAGE}\n                    openMedia={openMedia}\n                />\n            );\n        case 'messageText':\n            return null;\n        case 'messageVenue':\n            return (\n                <Venue\n                    type='message'\n                    title={hasTitle}\n                    caption={hasCaption}\n                    chatId={chat_id}\n                    messageId={id}\n                    venue={content.venue}\n                    openMedia={openMedia}\n                    meta={inlineMeta}\n                />\n            );\n        case 'messageVideo':\n            return (\n                <Video\n                    type='message'\n                    title={hasTitle}\n                    caption={hasCaption}\n                    chatId={chat_id}\n                    messageId={id}\n                    video={content.video}\n                    openMedia={openMedia}\n                />\n            );\n        case 'messageVideoNote':\n            return (\n                <VideoNote\n                    type='message'\n                    title={hasTitle}\n                    caption={hasCaption}\n                    chatId={chat_id}\n                    messageId={id}\n                    videoNote={content.video_note}\n                    openMedia={openMedia}\n                />\n            );\n        case 'messageVoiceNote':\n            return (\n                <VoiceNote\n                    type='message'\n                    title={hasTitle}\n                    caption={hasCaption}\n                    chatId={chat_id}\n                    messageId={id}\n                    voiceNote={content.voice_note}\n                    openMedia={openMedia}\n                    meta={inlineMeta}\n                />\n            );\n        default:\n            return [`[${content['@type']}]`, inlineMeta];\n    }\n}\n\nexport async function getMediaTags(file) {\n    return new Promise(resolve => {\n        jsmediatags.read(file, {\n            onSuccess: async function(tag) {\n                const { tags } = tag;\n                const { artist, title } = tags;\n\n                new AudioContext().decodeAudioData(\n                    await file.arrayBuffer(),\n                    result => {\n                        resolve({ title, performer: artist, duration: Math.trunc(result.duration) });\n                    },\n                    error => {\n                        resolve(null);\n                });\n            },\n            onError: function(error) {\n                resolve(null);\n            }\n        });\n    })\n}\n\nexport async function getMediaDocumentFromFile(file) {\n    if (!file) {\n        return null;\n    }\n\n    const fileId = -getRandomInt(1, 1000000);\n    FileStore.setBlob(fileId, file);\n\n    const { name, type, size } = file;\n\n    if (type === 'audio/mp3') {\n        const tags = await getMediaTags(file);\n        if (tags) {\n            const { title, performer, duration } = tags;\n\n            return ({\n                '@type': 'messageAudio',\n                audio: {\n                    '@type': 'audio',\n                    duration,\n                    title,\n                    performer,\n                    file_name: name,\n                    mime_type: type,\n                    album_cover_minithumbnail: null,\n                    album_cover_thumbnail: null,\n                    audio: {\n                        '@type': 'file',\n                        id: fileId,\n                        size,\n                        expected_size: size,\n                        local: {\n                            is_downloading_completed: true\n                        }\n                    }\n                }\n            });\n        }\n    }\n\n    return ({\n        '@type': 'messageDocument',\n        document: {\n            '@type': 'document',\n            file_name: name,\n            mime_type: type,\n            minithumbnail: null,\n            thumbnail: null,\n            document: {\n                '@type': 'file',\n                id: fileId,\n                size,\n                expected_size: size,\n                local: {\n                    is_downloading_completed: true\n                }\n            }\n        }\n    });\n}\n\nexport async function getMediaPhotoFromFile(file) {\n    if (!file) {\n        return null;\n    }\n\n    if (file.type.startsWith('image')) {\n        const [width, height] = await readImageSize(file);\n\n        const fileId = -getRandomInt(1, 1000000);\n        FileStore.setBlob(fileId, file);\n\n        const photoSize = {\n            '@type': 'photoSize',\n            photo: {\n                '@type': 'file',\n                id: fileId,\n                size: file.size,\n                expected_size: file.expected_size,\n                local: {\n                    is_downloading_completed: true\n                }\n            },\n            width,\n            height\n        };\n\n        return ({\n            '@type': 'messagePhoto',\n            photo: {\n                '@type': 'photo',\n                has_stickers: false,\n                minithumbnail: null,\n                sizes: [ photoSize ]\n            }\n        });\n    } else {\n        return null;\n    }\n}\n"]},"metadata":{},"sourceType":"module"}